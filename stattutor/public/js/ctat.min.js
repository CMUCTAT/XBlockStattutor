/*
 MIT License - https://bitbucket.org/pellepim/jstimezonedetect/src/default/LICENCE.txt

 For usage and examples, visit:
 http://pellepim.bitbucket.org/jstz/

 Copyright (c) Jon Nylander
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,e=[];!(b=a.next()).done;)e.push(b.value);return e};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.checkStringArgs=function(a,b,e){if(null==a)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return a+""};
$jscomp.polyfill=function(a,b,e,f){if(b){e=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var d=a[f];d in e||(e[d]={});e=e[d]}a=a[a.length-1];f=e[a];b=b(f);b!=f&&null!=b&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,e){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var d=b.length,c=a.length,g=Math.max(0,Math.min(e|0,b.length)),h=0;h<c&&g<d;)if(b[g++]!=a[h++])return!1;return h>=c}},"es6-impl","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(a){$jscomp.owns(a,f)||$jscomp.defineProperty(a,f,{value:{}})}function e(a){var g=Object[a];g&&(Object[a]=function(a){b(a);return g(a)})}if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),c=Object.seal({}),d=new a([[b,2],[c,3]]);if(2!=d.get(b)||3!=d.get(c))return!1;d["delete"](b);d.set(c,4);return!d.has(b)&&4==d.get(c)}catch(m){return!1}}())return a;var f="$jscomp_hidden_"+Math.random().toString().substring(2);e("freeze");e("preventExtensions");
e("seal");var d=0,c=function(a){this.id_=(d+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};c.prototype.set=function(a,c){b(a);if(!$jscomp.owns(a,f))throw Error("WeakMap key fail: "+a);a[f][this.id_]=c;return this};c.prototype.get=function(a){return $jscomp.owns(a,f)?a[f][this.id_]:void 0};c.prototype.has=function(a){return $jscomp.owns(a,f)&&$jscomp.owns(a[f],this.id_)};c.prototype["delete"]=
function(a){return $jscomp.owns(a,f)&&$jscomp.owns(a[f],this.id_)?delete a[f][this.id_]:!1};return c},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var d=c.entries(),g=d.next();if(g.done||g.value[0]!=b||"s"!=g.value[1])return!1;g=d.next();return g.done||4!=g.value[0].x||"t"!=g.value[1]||!d.next().done?!1:!0}catch(p){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b=new WeakMap,e=function(a){this.data_={};this.head_=c();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};e.prototype.set=function(a,b){var c=f(this,a);c.list||(c.list=this.data_[c.id]=[]);c.entry?c.entry.value=b:(c.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},c.list.push(c.entry),this.head_.previous.next=c.entry,this.head_.previous=c.entry,this.size++);return this};e.prototype["delete"]=
function(a){a=f(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};e.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=c();this.size=0};e.prototype.has=function(a){return!!f(this,a).entry};e.prototype.get=function(a){return(a=f(this,a).entry)&&a.value};e.prototype.entries=function(){return d(this,function(a){return[a.key,
a.value]})};e.prototype.keys=function(){return d(this,function(a){return a.key})};e.prototype.values=function(){return d(this,function(a){return a.value})};e.prototype.forEach=function(a,b){for(var c=this.entries(),d;!(d=c.next()).done;)d=d.value,a.call(b,d[1],d[0],this)};e.prototype[Symbol.iterator]=e.prototype.entries;var f=function(a,c){var d;d=c&&typeof c;"object"==d||"function"==d?b.has(c)?d=b.get(c):(d=""+ ++g,b.set(c,d)):d="p_"+c;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(var h=0;h<
e.length;h++){var l=e[h];if(c!==c&&l.key!==l.key||c===l.key)return{id:d,list:e,index:h,entry:l}}return{id:d,list:e,index:-1,entry:void 0}},d=function(a,b){var c=a.head_;return $jscomp.iteratorPrototype(function(){if(c){for(;c.head!=a.head_;)c=c.previous;for(;c.next!=c.head;)return c=c.next,{done:!1,value:b(c)};c=null}return{done:!0,value:void 0}})},c=function(){var a={};return a.previous=a.next=a.head=a},g=0;return e},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),f=new a($jscomp.makeIterator([b]));if(!f.has(b)||1!=f.size||f.add(b)!=f||1!=f.size||f.add({x:4})!=f||2!=f.size)return!1;var d=f.entries(),c=d.next();if(c.done||c.value[0]!=b||c.value[1]!=b)return!1;c=d.next();return c.done||c.value[0]==b||4!=c.value[0].x||c.value[1]!=c.value[0]?!1:d.next().done}catch(g){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};b.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};b.prototype["delete"]=function(a){a=this.map_["delete"](a);this.size=this.map_.size;return a};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(a){return this.map_.has(a)};b.prototype.entries=
function(){return this.map_.entries()};b.prototype.values=function(){return this.map_.values()};b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(a,b){var d=this;this.map_.forEach(function(c){return a.call(b,c,c,d)})};return b},"es6-impl","es3");$jscomp.findInternal=function(a,b,e){a instanceof String&&(a=String(a));for(var f=a.length,d=0;d<f;d++){var c=a[d];if(b.call(e,c,d,a))return{i:d,v:c}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,e){return $jscomp.findInternal(this,a,e).v}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var e=0,f={next:function(){if(e<a.length){var d=e++;return{value:b(d,a[d]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,e){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,e||0)}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,e){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===e&&(e=b.length);for(var d=Math.max(0,Math.min(e|0,b.length)),c=a.length;0<c&&0<d;)if(b[--d]!=a[--c])return!1;return 0>=c}},"es6-impl","es3");$jscomp.polyfill("Number.isNaN",function(a){return a?a:function(a){return"number"===typeof a&&isNaN(a)}},"es6-impl","es3");
$jscomp.polyfill("Math.sign",function(a){return a?a:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(a,e){return $jscomp.findInternal(this,a,e).i}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,e){return e})}},"es6","es3");
$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6-impl","es3");$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}},"es6-impl","es3");$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}},"es6-impl","es3");
$jscomp.polyfill("Number.isSafeInteger",function(a){return a?a:function(a){return Number.isInteger(a)&&Math.abs(a)<=Number.MAX_SAFE_INTEGER}},"es6-impl","es3");
var jstz=function(){var a={"America/Denver":["America/Mazatlan"],"America/Chicago":["America/Mexico_City"],"America/Santiago":["America/Asuncion","America/Campo_Grande"],"America/Montevideo":["America/Sao_Paulo"],"Asia/Beirut":"Asia/Amman Asia/Jerusalem Europe/Helsinki Asia/Damascus Africa/Cairo Asia/Gaza Europe/Minsk".split(" "),"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],
"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza",
"Africa/Cairo"]},b=function(a){a=-a.getTimezoneOffset();return null!==a?a:0},e=function(){var a=b(new Date(2014,0,2)),c=b(new Date(2014,5,2)),d=a-c;return 0>d?a+",1":0<d?c+",1,s":a+",0"},f=function(){if("undefined"!==typeof Intl&&"undefined"!==typeof Intl.DateTimeFormat){var a=Intl.DateTimeFormat();if("undefined"!==typeof a&&"undefined"!==typeof a.resolvedOptions)return a.resolvedOptions().timeZone}},d=function m(a,b,c){"undefined"===typeof b&&(b=864E5,c=36E5);var d=(new Date(a.getTime()-b)).getTime();
a=a.getTime()+b;for(var g=(new Date(d)).getTimezoneOffset(),e=null;d<a-c;){var h=new Date(d);if(h.getTimezoneOffset()!==g){e=h;break}d+=c}return 864E5===b?m(e,36E5,6E4):36E5===b?m(e,6E4,1E3):e},c=function(a,b,c,d){if("N/A"!==c)return c;if("Asia/Beirut"===b){if("Africa/Cairo"===d.name&&13983768E5===a[6].s&&14116788E5===a[6].e||"Asia/Jerusalem"===d.name&&13959648E5===a[6].s&&14118588E5===a[6].e)return 0}else if("America/Santiago"===b){if("America/Asuncion"===d.name&&14124816E5===a[6].s&&1397358E6===
a[6].e||"America/Campo_Grande"===d.name&&14136912E5===a[6].s&&13925196E5===a[6].e)return 0}else if("America/Montevideo"===b){if("America/Sao_Paulo"===d.name&&14136876E5===a[6].s&&1392516E6===a[6].e)return 0}else if("Pacific/Auckland"===b&&"Pacific/Fiji"===d.name&&14142456E5===a[6].s&&13961016E5===a[6].e)return 0;return c},g=function(b,d){for(var g={},e=jstz.olson.dst_rules.zones,h=e.length,f=a[d],n=0;n<h;n++){var m=e[n],r;r=e[n];for(var z=0,A=0;A<b.length;A++)if(r.rules[A]&&b[A]){if(b[A].s>=r.rules[A].s&&
b[A].e<=r.rules[A].e)z=0,z+=Math.abs(b[A].s-r.rules[A].s),z+=Math.abs(r.rules[A].e-b[A].e);else{z="N/A";break}if(864E6<z){z="N/A";break}}r=z=c(b,d,z,r);"N/A"!==r&&(g[m.name]=r)}for(var D in g)if(g.hasOwnProperty(D)&&-1!=f.indexOf(D))return D;return d},h=function(a){var b=function(){for(var a=[],b=0;b<jstz.olson.dst_rules.years.length;b++){var c;c=jstz.olson.dst_rules.years[b];var g=(new Date(c,0,1,0,0,1,0)).getTime();c=(new Date(c,12,31,23,59,59)).getTime();for(var e=(new Date(g)).getTimezoneOffset(),
h=null,f=null;g<c-864E5;){var m=new Date(g),r=m.getTimezoneOffset();r!==e&&(r<e&&(h=m),r>e&&(f=m),e=r);g+=864E5}c=h&&f?{s:d(h).getTime(),e:d(f).getTime()}:!1;a.push(c)}return a}();return function(a){for(var b=0;b<a.length;b++)if(!1!==a[b])return!0;return!1}(b)?g(b,a):a};return{determine:function(){var b=f();b||(b=jstz.olson.timezones[e()],"undefined"!==typeof a[b]&&(b=h(b)));return{name:function(){return b}}}}}();jstz.olson=jstz.olson||{};
jstz.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas",
"-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Santiago","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad",
"180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide",
"600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"};jstz.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572E5,s:12090744E5},{e:1250802E6,s:1240524E6},{e:12858804E5,s:12840696E5},!1,!1,!1,{e:14116788E5,s:1406844E6}]},{name:"America/Asuncion",rules:[{e:12050316E5,s:12243888E5},{e:12364812E5,s:12558384E5},{e:12709548E5,s:12860784E5},{e:13024044E5,s:1317528E6},{e:1333854E6,s:13495824E5},{e:1364094E6,s:1381032E6},{e:13955436E5,s:14124816E5}]},{name:"America/Campo_Grande",rules:[{e:12032172E5,s:12243888E5},
{e:12346668E5,s:12558384E5},{e:12667212E5,s:1287288E6},{e:12981708E5,s:13187376E5},{e:13302252E5,s:1350792E6},{e:136107E7,s:13822416E5},{e:13925196E5,s:14136912E5}]},{name:"America/Goose_Bay",rules:[{e:122559486E4,s:120503526E4},{e:125704446E4,s:123648486E4},{e:128909886E4,s:126853926E4},{e:13205556E5,s:129998886E4},{e:13520052E5,s:13314456E5},{e:13834548E5,s:13628952E5},{e:14149044E5,s:13943448E5}]},{name:"America/Havana",rules:[{e:12249972E5,s:12056436E5},{e:12564468E5,s:12364884E5},{e:12885012E5,
s:12685428E5},{e:13211604E5,s:13005972E5},{e:13520052E5,s:13332564E5},{e:13834548E5,s:13628916E5},{e:14149044E5,s:13943412E5}]},{name:"America/Mazatlan",rules:[{e:1225008E6,s:12074724E5},{e:12564576E5,s:1238922E6},{e:1288512E6,s:12703716E5},{e:13199616E5,s:13018212E5},{e:13514112E5,s:13332708E5},{e:13828608E5,s:13653252E5},{e:14143104E5,s:13967748E5}]},{name:"America/Mexico_City",rules:[{e:12250044E5,s:12074688E5},{e:1256454E6,s:12389184E5},{e:12885084E5,s:1270368E6},{e:1319958E6,s:13018176E5},{e:13514076E5,
s:13332672E5},{e:13828572E5,s:13653216E5},{e:14143068E5,s:13967712E5}]},{name:"America/Miquelon",rules:[{e:12255984E5,s:12050388E5},{e:1257048E6,s:12364884E5},{e:12891024E5,s:12685428E5},{e:1320552E6,s:12999924E5},{e:13520016E5,s:1331442E6},{e:13834512E5,s:13628916E5},{e:14149008E5,s:13943412E5}]},{name:"America/Santa_Isabel",rules:[{e:12250116E5,s:1207476E6},{e:12564612E5,s:12389256E5},{e:12885156E5,s:12703752E5},{e:13199652E5,s:13018248E5},{e:13514148E5,s:13332744E5},{e:13828644E5,s:13653288E5},
{e:1414314E6,s:13967784E5}]},{name:"America/Sao_Paulo",rules:[{e:12032136E5,s:12243852E5},{e:12346632E5,s:12558348E5},{e:12667176E5,s:12872844E5},{e:12981672E5,s:1318734E6},{e:13302216E5,s:13507884E5},{e:13610664E5,s:1382238E6},{e:1392516E6,s:14136876E5}]},{name:"Asia/Amman",rules:[{e:1225404E6,s:12066552E5},{e:12568536E5,s:12381048E5},{e:12883032E5,s:12695544E5},{e:13197528E5,s:13016088E5},!1,!1,{e:14147064E5,s:13959576E5}]},{name:"Asia/Damascus",rules:[{e:12254868E5,s:120726E7},{e:125685E7,s:12381048E5},
{e:12882996E5,s:12701592E5},{e:13197492E5,s:13016088E5},{e:13511988E5,s:13330584E5},{e:13826484E5,s:1364508E6},{e:14147028E5,s:13959576E5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572E5,s:12066552E5},{e:12520152E5,s:12381048E5},{e:1281474E6,s:126964086E4},{e:1312146E6,s:130160886E4},{e:13481784E5,s:13330584E5},{e:13802292E5,s:1364508E6},{e:14116788E5,s:13959576E5}]},{name:"Asia/Irkutsk",rules:[{e:12249576E5,s:12068136E5},{e:12564072E5,s:12382632E5},{e:12884616E5,
s:12697128E5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612E5,s:12066624E5},{e:1254006E6,s:1238112E6},{e:1284246E6,s:12695616E5},{e:131751E7,s:1301616E6},{e:13483548E5,s:13330656E5},{e:13828284E5,s:13645152E5},{e:1414278E6,s:13959648E5}]},{name:"Asia/Kamchatka",rules:[{e:12249432E5,s:12067992E5},{e:12563928E5,s:12382488E5},{e:12884508E5,s:12696984E5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612E5,s:12068172E5},{e:12564108E5,s:12382668E5},{e:12884652E5,s:12697164E5},!1,!1,!1,
!1]},{name:"Asia/Omsk",rules:[{e:12249648E5,s:12068208E5},{e:12564144E5,s:12382704E5},{e:12884688E5,s:126972E7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504E5,s:12068064E5},{e:12564E8,s:1238256E6},{e:12884544E5,s:12697056E5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954E6,s:120681E7},{e:12564036E5,s:12382596E5},{e:1288458E6,s:12697092E5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684E5,s:12068244E5},{e:1256418E6,s:1238274E6},{e:12884724E5,s:12697236E5},!1,!1,!1,!1]},
{name:"Asia/Yerevan",rules:[{e:1224972E6,s:1206828E6},{e:12564216E5,s:12382776E5},{e:1288476E6,s:12697272E5},{e:13199256E5,s:13011768E5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076E5,s:12231342E5},{e:12388572E5,s:12545838E5},{e:12703068E5,s:12860334E5},{e:13017564E5,s:1317483E6},{e:1333206E6,s:13495374E5},{e:13652604E5,s:1380987E6},{e:139671E7,s:14124366E5}]},{name:"Australia/Perth",rules:[{e:12068136E5,s:12249576E5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828E5,s:12068388E5},
{e:12564324E5,s:12382884E5},{e:12884868E5,s:1269738E6},{e:13199364E5,s:13011876E5},{e:1351386E6,s:13326372E5},{e:13828356E5,s:13646916E5},{e:14142852E5,s:13961412E5}]},{name:"Europe/Minsk",rules:[{e:12249792E5,s:12068352E5},{e:12564288E5,s:12382848E5},{e:12884832E5,s:12697344E5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756E5,s:12068316E5},{e:12564252E5,s:12382812E5},{e:12884796E5,s:12697308E5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528E5,s:13168728E5},{e:13332024E5,s:13489272E5},
{e:13652568E5,s:13803768E5},{e:13967064E5,s:14118264E5}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984E5,s:12878424E5},{e:13271544E5,s:1319292E6},{e:1358604E6,s:13507416E5},{e:139005E7,s:1382796E6},{e:14215032E5,s:14148504E5}]}]};(function(a,b){"object"==typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()})(this,function(){function a(a,b){var c=document.createElement(a||"div"),d;for(d in b)c[d]=b[d];return c}function b(a){for(var b=1,c=arguments.length;b<c;b++)a.appendChild(arguments[b]);return a}function e(a,b,c,d){var g=["opacity",b,~~(100*a),c,d].join("-");c=.01+c/d*100;d=Math.max(1-(1-a)/b*(100-c),a);var e=p.substring(0,p.indexOf("Animation")).toLowerCase();r[g]||
(x.insertRule("@"+(e&&"-"+e+"-"||"")+"keyframes "+g+"{0%{opacity:"+d+"}"+c+"%{opacity:"+a+"}"+(c+.01)+"%{opacity:1}"+(c+b)%100+"%{opacity:"+a+"}100%{opacity:"+d+"}}",x.cssRules.length),r[g]=1);return g}function f(a,b){var c=a.style,d,g;b=b.charAt(0).toUpperCase()+b.slice(1);if(void 0!==c[b])return b;for(g=0;g<m.length;g++)if(d=m[g]+b,void 0!==c[d])return d}function d(a,b){for(var c in b)a.style[f(a,c)||c]=b[c];return a}function c(a){for(var b=1;b<arguments.length;b++){var c=arguments[b],d;for(d in c)void 0===
a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=c(a||{},h.defaults,q)}function l(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}x.addRule(".spin-vml","behavior:url(#default#VML)");h.prototype.lines=function(a,e){function h(){return d(c("group",{coordsize:f+" "+f,coordorigin:-l+" "+-l}),{width:f,height:f})}function n(a,n,f){b(m,b(d(h(),{rotation:360/e.lines*a+"deg",left:~~n}),b(d(c("roundrect",
{arcsize:e.corners}),{width:l,height:e.scale*e.width,left:e.scale*e.radius,top:-e.scale*e.width>>1,filter:f}),c("fill",{color:g(e.color,a),opacity:e.opacity}),c("stroke",{opacity:0}))))}var l=e.scale*(e.length+e.width),f=2*e.scale*l,u=-(e.width+e.length)*e.scale*2+"px",m=d(h(),{position:"absolute",top:u,left:u});if(e.shadow)for(u=1;u<=e.lines;u++)n(u,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(u=1;u<=e.lines;u++)n(u);return b(a,m)};h.prototype.opacity=
function(a,b,c,d){a=a.firstChild;d=d.shadow&&d.lines||0;a&&b+d<a.childNodes.length&&(a=(a=(a=a.childNodes[b+d])&&a.firstChild)&&a.firstChild)&&(a.opacity=c)}}var m=["webkit","Moz","ms","O"],r={},p,x,q={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2E9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};h.defaults={};c(h.prototype,{spin:function(b){this.stop();var c=this,g=c.opts,e=
c.el=a(null,{className:g.className});d(e,{position:g.position,width:0,zIndex:g.zIndex,left:g.left,top:g.top});b&&b.insertBefore(e,b.firstChild||null);e.setAttribute("role","progressbar");c.lines(e,c.opts);if(!p){var h=0,n=(g.lines-1)*(1-g.direction)/2,l,f=g.fps,u=f/g.speed,m=(1-g.opacity)/(u*g.trail/100),q=u/g.lines;(function y(){h++;for(var a=0;a<g.lines;a++)l=Math.max(1-(h+(g.lines-a)*q)%u*m,g.opacity),c.opacity(e,a*g.direction+n,l,g);c.timeout=c.el&&setTimeout(y,~~(1E3/f))})()}return c},stop:function(){var a=
this.el;a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0);return this},lines:function(c,h){function n(b,c){return d(a(),{position:"absolute",width:h.scale*(h.length+h.width)+"px",height:h.scale*h.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/h.lines*l+h.rotate)+"deg) translate("+h.scale*h.radius+"px,0)",borderRadius:(h.corners*h.scale*h.width>>1)+"px"})}for(var l=0,f=(h.lines-1)*(1-h.direction)/2,u;l<h.lines;l++)u=d(a(),
{position:"absolute",top:1+~(h.scale*h.width/2)+"px",transform:h.hwaccel?"translate3d(0,0,0)":"",opacity:h.opacity,animation:p&&e(h.opacity,h.trail,f+l*h.direction,h.lines)+" "+1/h.speed+"s linear infinite"}),h.shadow&&b(u,d(n("#000","0 0 4px #000"),{top:"2px"})),b(c,b(u,n(g(h.color,l),"0 0 1px rgba(0,0,0,.1)")));return c},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});if("undefined"!==typeof document){x=function(){var c=a("style",{type:"text/css"});b(document.getElementsByTagName("head")[0],
c);return c.sheet||c.styleSheet}();var u=d(a("group"),{behavior:"url(#default#VML)"});!f(u,"transform")&&u.adj?l():p=f(u,"animation")}return h});var CTATConfig={Options:{},addProperty:function(a,b,e,f){e=e||b[0];Object.defineProperty(CTATConfig,a,{enumerable:!0,configurable:!1,writable:!f,value:e.toLowerCase()});var d={};b.forEach(function(b){d[b]=b.toLowerCase();Object.defineProperty(CTATConfig,a+"_is_"+b,{enumerable:!1,writable:!1,value:function(){return CTATConfig[this.prop].toLowerCase()==this.val}.bind({prop:a,val:d[b]})})});CTATConfig.Options[a]=d}};CTATConfig.addProperty("platform",["CTAT","Google","Undefined"],"CTAT",!0);
CTATConfig.addProperty("external",["Google","LTI","SCORM","None"],"None");CTATConfig.addProperty("parserType",["XML","JSON"],"XML");"undefined"!==typeof module&&(module.exports=CTATConfig);var CTATGlobals={tutorRunning:!1,Tab:{Tracker:1,Focus:null,previousFocus:null},NameSpace:{svg:"http://www.w3.org/2000/svg",xml:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",ev:"http://www.w3.org/2001/xml-events",mathml:"http://www.w3.org/1998/Math/MathML"},EncodedParams:{authenticity_token:"authenticity_token",info:"info",question_file:"question_file",skills:"skills"},CommDisabled:!1,orientation:"portrait",ignoreInterfaceDescriptions:!0},useDebugging;
void 0===useDebugging&&(useDebugging=!1);var useDebuggingBasic;void 0===useDebuggingBasic&&(useDebuggingBasic=!1);var version="4.1.0",ctatcontainer="container",movieclips=[],canvasCalibrate=5,flashVars=null,mobileAPI=null,aVars=null;CTATGlobals.interfaceElement=null;var commMessageHandler=CTATGlobals.selectedTextInput=null,commLoggingLibrary=null,logHintSAI=null,nameTranslator=null,hints=[],hintIndex=0,caseInsensitive=!0,unordered=!0,lockWidget=!0,highlightRightSelection=!0;
CTATGlobals.suppressStudentFeedback=!1;CTATGlobals.confirmDone=!1;var incompatibleBrowserMessage="Your browser does not support CTAT. Please update or replace your browser.";var CTATSandboxDriver={};function getSafeElementById(a){return document.getElementById(a)};var CTATGlobalFunctions={};function unhighlightall(a){if(CTATShellTools.component_descriptions){a=CTATShellTools.getAllComponents();for(var b=0;b<a.length;b++){var e=a[b];e.setHintHighlight&&e.setHintHighlight(!1,null)}}}CTATGlobalFunctions.stringToBoolean=function(a){switch(String(a).toLowerCase()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case "":case null:return!1;default:return!!a}};
CTATGlobalFunctions.isInstructorMode=function(){var a=flashVars?flashVars.getRawFlashVars():null;return a&&a.deliverymode?"delivery"==a.deliverymode?!1:!0:!1};CTATGlobalFunctions.getLoggingLibrary=function(a){null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};CTATGlobalFunctions.setPreviewMode=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setPreviewMode(b):a.previewMode=b};
CTATGlobalFunctions.setCenterTutor=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setCenterTutor(b):a.centerTutor=b};CTATGlobalFunctions.setTutorWidth=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setTutorWidth(b):a.width=b};CTATGlobalFunctions.setTutorHeight=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setTutorHeight(b):a.height=b};CTATGlobalFunctions.setTutorDimensions=function(a,b,e){CTATGlobalFunctions.isCTATObject(a)?a.setTutorDimensions(b,e):(a.width=b,a.height=e)};
CTATGlobalFunctions.setTutorValue=function(a,b,e){CTATGlobalFunctions.isCTATObject(a)?a.setTutorValue(b,e):a[b]=e};CTATGlobalFunctions.setCommunicationMode=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setCommunicationMode(b):a.tutoring_service_communication=b};CTATGlobalFunctions.setRemoteSocketURL=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setRemoteSocketURL(b):a.remoteSocketURL=b};
CTATGlobalFunctions.setRemoteSocketPort=function(a,b){CTATGlobalFunctions.isCTATObject(a)?a.setRemoteSocketPort(b):a.remoteSocketPort=b};CTATGlobalFunctions.setProblemSummary=function(a){};CTATGlobalFunctions.isCTATObject=function(a){return"object"==typeof testConfig&&testConfig.getClassName?!0:!1};CTATGlobalFunctions.getCTATClassname=function(a){return"object"==typeof testConfig&&testConfig.getClassName?testConfig.getClassName():"object"};
CTATGlobalFunctions.toBoolean=function(a){return"boolean"===typeof a?a:"string"===typeof a?CTATGlobalFunctions.stringToBoolean(a):"number"===typeof a?0<a:a?!0:!1};function noenter(a){if(CTATConfig.platform_is_Google())return 0;a=a||window.event;return 13!==(a.keyCode||a.charCode)}CTATGlobalFunctions.isBlank=function(a){return!a||/^\s*$/.test(a)};function componentToHex(a){a=a.toString(16);return 1==a.length?"0"+a:a}
function rgbToHex(a,b,e){return"#"+componentToHex(a)+componentToHex(b)+componentToHex(e)}function hexToRgb(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}
function parseQueryStringArgs(a){ctatdebug("parseQueryStringArgs ()");ctatdebug("Query String: "+a);var b="?"==a.charAt(0)?a.substring(1):a;a={};if(b)for(var b=b.split("&"),e=0;e<b.length;e++){var f=b[e].split("=");a[decodeURIComponent(f[0])]=decodeURIComponent(f[1].replace(/\+/g," "))}return a}
function setOrientation(a){ctatdebug("setOrientation ("+a+")");switch(a){case -90:case 90:mobileAPI&&mobileAPI.processOrientationChange("landscape");break;default:mobileAPI&&mobileAPI.processOrientationChange("portrait")}}Object.hasOwnProperty("create")||(Object.create=function(){function a(){}return function(b){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");a.prototype=b;return new a}}());
function thisMovie(a){return-1!=navigator.appName.indexOf("Microsoft")?window[a]:document[a]}function introspect(a,b,e,f){e=e||"";"number"!==this.typeOf(f)&&(f=1);var d=this.typeOf(b);a=[e,a," ",d," :"].join("");if("object"===d){if(0<f){e=[e,"  "].join("");for(var c in b)d=this.introspect(c,b[c],e,f-1),a=[a,"\n",d].join("");return a}return[a," ..."].join("")}return"null"===d?[a," null"].join(""):[a," ",b].join("")}
function findPointOfAttachment(a){ctatdebug("findPointOfAttachment ("+a+")");for(var b=0;b<movieclips.length;b++){var e=movieclips[b];ctatdebug("Examining: "+e.getName()+"...");if(!0===e.isRegistered(a))return e}return null}function findMovieClip(a){a=a.trim();ctatdebug("findMovieClip ("+a.trim()+")");for(var b=0;b<movieclips.length;b++){var e=movieclips[b];ctatdebug("Examining: "+e.getName()+"...");if(e.getName()==a)return e}return null}
function colName(a,b){ctatdebug("colName ("+a+")");for(var e="";0<=a;)e=String.fromCharCode(a%26+97)+e,a=Math.floor(a/26)-1;!0===b&&e.toUpperCase();return e}function selectText(a){}function urldecode(a){return decodeURIComponent((""+a).replace(/\+/g,"%20"))}function detectIE(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),e=a.indexOf("Trident/");return 0<b?parseInt(a.substring(b+5,a.indexOf(".",b)),10):0<e?(b=a.indexOf("rv:"),parseInt(a.substring(b+3,a.indexOf(".",b)),10)):!1}
function listProperties(a){ctatdebug("listProperties (l: "+a.length+")");for(var b in a)ctatdebug("["+b+"]")}function listPropertiesKV(a,b){ctatdebug("listPropertiesKV (size: "+a.length+")");if(1==b)for(var e=0;e<a.length;e++)ctatdebug("["+e+"]: "+a[e]);else for(e in a)ctatdebug("["+e+"]: "+a[e])}function listAllDivAttributes(a){ctatdebug("listAllDivAttributes ()");var b=0;a=a.attributes;for(var e=a.length;b<e;b++)pointer.ctatdebug("Attribute: "+a[b].nodeName+", with value: "+a[b].nodeValue)}
var getBackgroundDimensions=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var b=new Image;b.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,"");return b.width+" "+b.height},getBackgroundWidth=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var b=new Image;b.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,"");return b.width},getBackgroundHeight=function(a){ctatdebug("Using url: "+$(a).css("background-image"));var b=new Image;b.src=$(a).css("background-image").replace(/url\(|\)$|"/ig,
"");return b.height};function getIndicesOf(a,b,e){var f=0,d=a.length,c=[];e||(b=b.toLowerCase(),a=a.toLowerCase());for(;-1<(e=b.indexOf(a,f));)c.push(e),f=e+d;return c}CTATGlobalFunctions.formatColor=function(a){if(/^#[0-9a-f]{6}$/i.test(a))return a;var b=a.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(null!==b)return rgbToHex(Number(b[1]),Number(b[2]),Number(b[3]));b=a.match(/^#?([0-9a-f]{0,6})$/i);if(null!==b){for(a=b[1];6>a.length;)a="0"+a;return"#"+a}return a};
CTATGlobalFunctions.Gensym=function(){this.make_gensym=function(){var a="",b=0;return{set_prefix:function(b){a=String(b)},set_index:function(a){b=a},gensym:function(){var d=a+b;b+=1;return d}}};var a=this.make_gensym();a.set_index(2);var b=this.make_gensym();b.set_index(1);b.set_prefix("ctatdiv");return{z_index:a.gensym,div_id:b.gensym}};CTATGlobalFunctions.gensym=CTATGlobalFunctions.Gensym();var CTATBase=function(a,b){function e(a,b,c){null===a&&(a="unknownclass");null===b&&(b="nullinstance");return"["+a+":"+b+"] "+c}var f=a,d=b,c=this,g=!0;"undefined"!=CTATBase.DebuggingFilter[f]&&CTATBase.DebuggingFilter[f]&&(g=!1);this.getClassName=function(){return f};this.getClassname=function(){return f};this.setClassName=function(a){f=a};this.setName=function(a){d=a};this.getName=function(){return d};this.getUseDebugging=function(){return useDebugging};this.setUseDebugging=function(a){useDebugging=
a};this.toHHMMSS=function(a){var b=parseInt(a,10);a=Math.floor(b/3600);var c=Math.floor((b-3600*a)/60),b=b-3600*a-60*c;10>a&&(a="0"+a);10>c&&(c="0"+c);10>b&&(b="0"+b);return a+":"+c+":"+b};this.ctatdebug=function(a){if(g){var b=a;useDebuggingBasic?c.ctatdebugInternal(b,"UnknownClass"):(null===a&&(b="No message provided"),useDebugging&&c.ctatdebugInternal(b,c.getClassName()))}};this.ctatdebugObject=function(a){var b=0,c;for(c in a)this.ctatdebug("("+b+")"+c+": "+a[c]),b++};this.ctatdebugInternal=function(a,
b){var d=a;if(null===d||void 0===d)d="No message!";""===d&&(d="Empty message!");if(useDebuggingBasic)d=e("Unknown","undefined",d),CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),CTATBase.customconsole&&(CTATBase.customconsole.innerHTML+=d+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight);else{null===b&&(b="UndefinedClass");null===d&&(d="No message");d=e(b,c.getName(),d);try{console.trace(d)}catch(r){}"google"==CTATConfig.platform?Logger.log(d):
(CTATBase.customconsole||(CTATBase.customconsole=getSafeElementById("customconsole")),null!==CTATBase.customconsole&&(CTATBase.customconsole.innerHTML+=d+"<br>",CTATBase.customconsole.scrollTop=CTATBase.customconsole.scrollHeight))}};this.ctatdebugObjectShallow=function(a){var b="",d;for(d in a)b+=d+", ";c.ctatdebugInternal("Object: "+b,"Global")};this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,"%20"))};this.entitiesConvert=function(a){this.ctatdebug("entitiesConvert ()");
return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return a}};function formatLogMessageGoogle(a,b,e){e=(new CTATBase(a,b)).htmlEncode(e);return"["+a+":"+b+"] "+e}function ctatdebug(a){(useDebugging||useDebuggingBasic)&&null!==a&&("google"==CTATConfig.platform?Logger.log(formatLogMessageGoogle("CTATTutor","tutor",a)):(ctatdebug.debugPointer||(ctatdebug.debugPointer=new CTATBase("CTATTutor","tutor")),ctatdebug.debugPointer.ctatdebug(a,"CTATTutor")))}
Object.defineProperty(CTATBase,"DebuggingFilter",{enumerable:!1,configurable:!1,writable:!0,value:[]});"undefined"!==typeof module&&(module.exports=CTATBase);var CTATProblem=function(){CTATBase.call(this,"CTATProblem","problem");var a="",b="",e="tutor",f="",d="",c="notstarted";this.setState=function(a){c=a};this.getState=function(){return c};this.setLabel=function(b){a=b};this.getLabel=function(){return a};this.setDescription=function(a){b=a};this.getDescription=function(){return b};this.setTutorFlag=function(a){e=a};this.getTutorFlag=function(){return e};this.setProblemFile=function(a){f=a};this.getProblemFile=function(){return f};this.setStudentInterface=
function(a){d=a};this.getStudentInterface=function(){return d}};CTATProblem.prototype=Object.create(CTATBase.prototype);CTATProblem.prototype.constructor=CTATProblem;var CTATProblemSet=function(){CTATBase.call(this,"CTATProblemSet","problemset");var a=[];this.addProblem=function(b){a.push(b)};this.getProblems=function(){return a};this.getProblemSize=function(){return a.length};this.getFirstProblem=function(){pointer.ctatdebug("getFirstProblem ()");return 0==a.length?null:a[0]}};CTATProblemSet.prototype=Object.create(CTATBase.prototype);CTATProblemSet.prototype.constructor=CTATProblemSet;var CTATXML=function(){CTATBase.call(this,"CTATXML","xmlparser");this.parse=function(a){return this.parseXML(a)};this.parseXML=function(a){this.ctatdebug("parseXML ()");var b=null;try{"undefined"!==typeof $?b=$.parseXML(a):"undefined"!==typeof XMLParser?b=(new XMLParser).parseFromString(a):this.ctatdebug("Bottoming out, no parser configured!")}catch(e){return null!=b?this.ctatdebug("JQuery could not process the provided XML: "+e.message+" ("+b.parseError.errorCode+") ("+b.parseError.reason+") ("+
b.parseError.line+")"):this.ctatdebug("JQuery could not process the provided XML (xmlDoc==null): "+e.message),null}return null==b?(this.ctatdebug("Unspecified error parsing xml message. xmlDoc is null"),null):b.documentElement};this.getElementName=function(a){return a.nodeName};this.getElementValue=function(a){return a.nodeValue};this.getElementChildren=function(a){for(var b=[],e=0;e<a.childNodes.length;e++)1==a.childNodes[e].nodeType&&b.push(a.childNodes[e]);return b};this.getNodeTextValue=function(a){if(null==
a)return"";if(null==a.childNodes)return a.nodeValue;if(0==a.childNodes.length)return"";for(var b=a.childNodes,e=0;e<b.length;e++){var f=b[e];if("value"==f.nodeName||"Value"==f.nodeName){if(1==f.childNodes.length)return f.childNodes[0].nodeValue;if(0==f.childNodes.length)break;else return f.childNodes[1].nodeValue}}return a.childNodes[0].nodeValue};this.getElementAttr=function(a,b){if(!a.attributes)return this.ctatdebug("Warning: Element "+a.nodeName+" does not have any attributes"),"";for(var e=0;e<
a.attributes.length;e++)if(a.attributes[e].nodeName==b)return a.attributes[e].nodeValue;return""};this.listElementAttr=function(a){this.ctatdebug("Listing "+a.attributes.length+" attributes for element "+a.nodeName+" ...");for(var b=0;b<a.attributes.length;b++)this.ctatdebug(b+" name: "+a.attributes[b].nodeName+", value: "+a.attributes[b].nodeValue)};this.stringify=function(a){return this.xmlToString(a)};this.xmlToString=function(a){this.ctatdebug("xmlToString ()");return null==a?(this.ctatdebug("Error: xml data is null"),
null):(new XMLSerializer).serializeToString(a)}};CTATXML.prototype=Object.create(CTATBase.prototype);CTATXML.prototype.constructor=CTATXML;"undefined"!==typeof module&&(module.exports=CTATXML);var CTATPackage=function(){CTATBase.call(this,"CTATPackage","packagemanager");var a=this,b=new CTATXML,e=new CTATProblemSet,f=[];this.init=function(d){a.ctatdebug("init ()");if(null==d)a.ctatdebug("Error: document root to be parsed is null.");else{a.ctatdebug("Root name: "+b.getElementName(d));d=b.getElementChildren(d);for(var c=0;c<d.length;c++){var g=d[c],h=b.getElementName(g);a.ctatdebug("Examining element: "+b.getElementName(g));if("Problems"==h){a.ctatdebug("Processing Problems ...");for(var g=
b.getElementChildren(g),l=0;l<g.length;l++){var f=g[l];a.ctatdebug("Problem ["+l+"] desc: "+b.getElementAttr(f,"description")+", interface: "+b.getElementAttr(f,"student_interface")+", brd: "+b.getElementAttr(f,"problem_file"));var r=new CTATProblem;r.setName(b.getElementAttr(f,"name"));r.setLabel(b.getElementAttr(f,"label"));r.setDescription(b.getElementAttr(f,"description"));r.setTutorFlag(b.getElementAttr(f,"tutor_flag"));r.setProblemFile(b.getElementAttr(f,"problem_file"));r.setStudentInterface(b.getElementAttr(f,
"student_interface"));a.ctatdebug("Adding problem ...");e.addProblem(r)}}"ProblemSets"==h&&a.ctatdebug("Processing ProblemSets ...");"Assets"==h&&a.ctatdebug("Processing Assets ...")}}};this.getProblems=function(){return e};this.getProblemSets=function(){return f}};CTATPackage.prototype=Object.create(CTATBase.prototype);CTATPackage.prototype.constructor=CTATPackage;var CTATConnectionBase=function(a,b){CTATBase.call(this,"CTATConnectionBase","ctatconnection");var e=-1,f="",d="http";this.setURL=function(a){f=a};this.getURL=function(){return f};this.setID=function(a){e=a};this.getID=function(){return e};this.setSocketType=function(a){d=a};this.getSocketType=function(){return d}};CTATConnectionBase.prototype=Object.create(CTATBase.prototype);CTATConnectionBase.prototype.constructor=CTATConnectionBase;var CTATConnection=function(a){CTATConnectionBase.call(this,"CTATConnection");var b=null,e=null,f=!1,d=this,c="text/plain";d.setSocketType("http");this.setContentType=function(a){c=a};this.getContentType=function(){return c};this.setConsumed=function(a){f=a;d.ctatdebug("consumed: "+f)};this.getConsumed=function(){d.ctatdebug("consumed: "+f);return f};this.assignReceiveFunction=function(a){e.onreadystatechange=a};this.setData=function(a){b=a};this.getData=function(){return b};this.getHTTPObject=function(){return e};
this.createHTTPObject=function(){d.ctatdebug("createHTTPObject ()");e=new XMLHttpRequest;if(window.XMLHttpRequest)d.ctatdebug("Creating regular XMLHttpRequest ..."),e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/html");else if(d.ctatdebug("Trying alternative HTTP object creation ..."),window.ActiveXObject){d.ctatdebug("Detected window.ActiveXObject ...");try{d.ctatdebug("Creating Msxml2.XMLHTTP ..."),e=new ActiveXObject("Msxml2.XMLHTTP")}catch(g){try{d.ctatdebug("Creating Microsoft.XMLHTTP ..."),
e=new ActiveXObject("Microsoft.XMLHTTP")}catch(h){alert("Error: Unable to create HTTP Request Object: "+h.message)}}}else alert("Internal error: an HTTP connection object could not be created")};this.init=function(){d.ctatdebug("init ()");if(null!==e){var b=flashVars?flashVars.getRawFlashVars():a,b=b.session_id?b.session_id:"dummySession";"dummySession"==b&&d.ctatdebug("Unable to find CTAT session information from environment, trying OLI ...");try{e.setRequestHeader("Content-type",c),e.setRequestHeader("ctatsession",
b)}catch(h){alert("HTTP object creation error: "+h.message)}}else alert("Internal error: http object is null right after creation");d.ctatdebug("init () done")};this.send=function(){d.ctatdebug("send ()");d.getHTTPObject().onerror=function(){d.ctatdebug("Networking error!")};try{d.getHTTPObject().open("POST",d.getURL(),!0)}catch(g){d.ctatdebug("Error in newConnection.httpObject.open: "+g.message);return}d.init();try{b?d.getHTTPObject().send(b):d.getHTTPObject().send()}catch(g){this.ctatdebug("Error in newConnection.httpObject.send: "+
g.message)}};d.createHTTPObject()};CTATConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATConnection.prototype.constructor=CTATConnection;var CTATWSConnection=function(a){CTATConnectionBase.call(this,"CTATWSConnection");var b="",e=!1,f=this,d=null,c=[],g=!1,h=0,l=0,m=null,r=null;f.setSocketType("ws");this.setConsumed=function(a){e=a;f.ctatdebug("consumed: "+e)};this.getConsumed=function(){f.ctatdebug("consumed: "+e);return e};this.assignReceiveFunction=function(a){m=a};this.assignCloseFunction=function(a){r=a};this.setData=function(a){b=a};this.getData=function(){return b};this.init=function(){ctatdebug("init ("+f.getURL()+"); websocket "+
d);null==d&&(d=new WebSocket(f.getURL()),d.addEventListener("open",function(a){ctatdebug("STATUS: open");g=!0;ctatdebug("Connection open, flushing outgoing queue ...");h=(new Date).getTime();if(0<c.length){for(a=0;a<c.length;a++)d.send(c[a]);c=[]}}),d.addEventListener("message",function(a){l=(new Date).getTime();ctatdebug("STATUS: message after "+(l-h)+" ms");ctatdebug("Received: "+a.data);m?m(a.data):ctatdebug("Error: no processing function provided")}),d.addEventListener("close",function(a){ctatdebug("STATUS: close; "+
(a?"code "+a.code+", reason "+a.reason:"no event"));g=!1;d.close(1E3,a?a.reason?a.reason:"received close code "+a.code:"no close event received");r&&r(a)}),d.addEventListener("error",function(a){ctatdebug("STATUS: error; "+(a?a.type:"no event"));g=!1;d.close(1E3,"client closing in response to error")}),ctatdebug("init () done"))};this.send=function(){ctatdebug("send ()");f.init();!1===g?(ctatdebug("Connection not ready yet, storing ..."),c.push(b)):(ctatdebug("Connection ready, sending data ..."),
h=(new Date).getTime(),d.send(b))};this.getWebSocket=function(){return d};this.close=function(a,b){g=!1;r=b||r;d.close(1E3,a||"no reason")}};CTATWSConnection.prototype=Object.create(CTATConnectionBase.prototype);CTATWSConnection.prototype.constructor=CTATWSConnection;var CTATCanvasComponent=function(a){var b=this,e=[];this.addShape=function(a){e.push(a)};this.hideShape=function(a){for(var b=0;b<e.length;b++)if(e[b].getName()==a){e[b].modifyCanvasCSS("visibility","hidden");break}};this.showShape=function(a){for(var b=0;b<e.length;b++)if(e[b].getName()==a){e[b].modifyCanvasCSS("visibility","visible");break}};this.hideComponent=function(){for(var a=0;a<e.length;a++)e[a].modifyCanvasCSS("visibility","hidden")};this.showComponent=function(){for(var a=0;a<e.length;a++)e[a].modifyCanvasCSS("visibility",
"visible")};this.moveShape=function(a,b,c){for(var d=0;d<e.length;d++)if(e[d].getName()==a){e[d].modifyCanvasCSS("left",b+"px");e[d].modifyCanvasCSS("top",c+"px");break}};this.moveComponent=function(a,b){for(var c=0;c<e.length;c++)e[c].modifyCanvasCSS("left",a+"px"),e[c].modifyCanvasCSS("top",b+"px")};this.removeShape=function(a){for(var b=0,c=0;c<e.length;c++)if(e[c].getName()==a){b=c;break}e[b].detatchCanvas();e.splice(b,1)};this.removeComponent=function(){for(;0<e.length;)b.removeShape(e[0].getName())}};var CTATDefaultLangagePack={HORIZONTAL:"LR",VERTICAL:"TB",LOADING:"Please wait while the tutor is being loaded",NEXTPROBLEM:"Retrieving the Next Problem...",TUTORDISCONNECTED:"The tutor has disconnected. Please refresh the page.",OUTOFORDER:"You need to do other steps first, before doing the step you just worked on. You might request a hint for more help.",DONE:"Done",HINT:"Hint",NEXT:"Next",PREVIOUS:"Previous",HIGHLIGHTEDSTEP:"Instead of the step you are working on, please work on the highlighted step.",
NOTDONE:"I'm sorry, but you are not done yet. Please continue working.",AUTHORPLEASECLOSE:"Authoring Tools disconnected. Please close this page.",ERROR_502:"Error contacting the server, please refresh the page and try again (HTTP status 502: gateway response).",ERROR_CONN_TS:"Connection refused by tutoring service, please check your server or contact an administrator.",ERROR_CONN_LS:"Connection refused by the logging server, please check your connection or contact an administrator."},CTATLanguageManager=
function(){CTATBase.call(this,"CTATLanguageManager","theLanguagePack");var a=this;this.getString=function(b){a.ctatdebug("getString ("+b+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[b])return CTATLanguagePack[b]}else a.ctatdebug("No custom language pack defined, using default...");return CTATDefaultLangagePack[b]};this.filterString=function(b){a.ctatdebug("filterString ("+b+") -> "+typeof CTATLanguagePack);if("undefined"!==typeof CTATLanguagePack){if(CTATLanguagePack[b])return a.ctatdebug("Found tag in provided language pack, returning: "+
CTATLanguagePack[b]),CTATLanguagePack[b]}else a.ctatdebug("No custom language pack defined, using default...");return"undefined"!==typeof CTATDefaultLangagePack&&CTATDefaultLangagePack[b]?(a.ctatdebug("Found tag in default language pack, returning: "+CTATDefaultLangagePack[b]),CTATDefaultLangagePack[b]):b}};CTATLanguageManager.prototype=Object.create(CTATBase.prototype);CTATLanguageManager.prototype.constructor=CTATLanguageManager;CTATLanguageManager.theSingleton=new CTATLanguageManager;var scrimIsUp=!1,errorScrim=!1,waitScrim=!0,warnScrim=!1,connectionScrim=!1,authorTimeSet=!0,inAuthorTime=!0,CTATScrim=function(){function a(){warnScrim=!1;n.scrimDown()}function b(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&n.scrimDownForced(),n.ctatdebug("errScrimUp ("+a+")"),!0===errorScrim?!0===g&&(g=!1,getSafeElementById(ctatcontainer).removeChild(q)):!0===warnScrim&&(g=!0),n.scrimUp(a))}function e(a,b){n.ctatdebug("makeHTMLButton ()");var c=document.createElement("input");c.type="button";
c.value=b;a?(n.ctatdebug("clickHandle!=null"),c.onclick=a):(n.ctatdebug("clickHandle==null"),c.onclick=n.defaultClickHandler);c.id=b;c.setAttribute("class","scrimButton");return c}CTATBase.call(this,"CTATScrim","__undefined__");var f="",d=!1,c=!1,g=!1,h=null,l=null,m=new CTATCanvasComponent("CTAT Scrim"),r=[],p=null,x=null,q=null,u=null,n=this;this.scrimUp=function(b){if("google"!=CTATConfig.platform)if(n.ctatdebug("scrimUp ()"),b=CTATGlobals.languageManager.filterString(b),n.ctatdebug("Message: "+
b),!0===scrimIsUp?(f=!0===waitScrim?b:f+(" \n "+b),m.removeComponent(),n.removeHTMLElements()):(f=b,scrimIsUp=!0),n.ctatdebug("scrimUp() to call drawScrim() scrimIsUp "+scrimIsUp),n.ctatdebug("drawScrim ()"),"google"==CTATConfig.platform)n.ctatdebug("This is not available for now when we're in this environment");else if($('<div id="scrim" class="ctatpageoverlay"></div>').appendTo("body"),$("#scrim").css("z-index",1E3),"google"!=CTATConfig.platform&&($("#scrimpanel").empty(),$("#scrim").append('<div class="css3-windows-7"><div class="fenster"><h4 class="titel">CTAT Info Panel</h4><div id="scrimpanel" class="inhalt"><br>'+
f+"<br><br></div></div></div>"),!0===g&&(waitScrim=!1,q=e(a,"close"),$(q).appendTo("#scrimpanel")),!0===d&&(waitScrim=!1,p=e(h,"yes"),$(p).appendTo("#scrimpanel"),d=!1),!0===c&&(waitScrim=!1,x=e(l,"no"),$(x).appendTo("#scrimpanel"),c=!1),!0===waitScrim)){n.ctatdebug("Adding spinner ...");$("#scrimpanel").append("<br>");b=$('<div id="scrim_spin">');b.css("width","100%");b.css("position","relative");$("#scrimpanel").append(b);try{var u=(new Spinner({className:"scrim_spinner"})).spin();$("#scrim_spin").append(u.el)}catch(z){(z instanceof
ReferenceError||z instanceof TypeError)&&n.ctatdebug('Spinner is not available, please include it in the build or add <script src="node_modules/spin.js/spin.min.js">\x3c/script> to the html file.',z,typeof z)}}};this.waitScrimUp=function(){n.ctatdebug("waitScrimUp () CTATConfig.platform "+CTATConfig.platform+", scrimIsUp "+scrimIsUp);"google"!=CTATConfig.platform&&(!0===scrimIsUp&&n.scrimDownForced(),waitScrim=!0,n.scrimUp(CTATGlobals.languageManager.getString("LOADING")),n.ctatdebug("return from waitScrimUp(): scrimIsUp "+
scrimIsUp))};this.nextProblemScrimUp=function(){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&n.scrimDownForced(),n.ctatdebug("nextProblemScrimUp ()"),n.scrimUp(CTATGlobals.languageManager.getString("NEXTPROBLEM")))};this.OKScrimUp=function(a,b){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&n.scrimDownForced(),n.ctatdebug("OKScrimUp ("+a+","+b+")"),waitScrim=c=d=g=warnScrim=errorScrim=!1,n.scrimUp(a),u=e(b,"OK"),$(u).appendTo("#scrimpanel"))};this.confirmScrimUp=function(a,b,g){"google"!=CTATConfig.platform&&
(!0===scrimIsUp&&n.scrimDownForced(),n.ctatdebug("confirmScrimUp ("+a+","+b+","+g+")"),c=d=!0,l=g,h=b,n.scrimUp(a))};this.errorScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&n.scrimDownForced(),!1===authorTimeSet?(n.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),r.push("ERROR: "+a),errorScrim=!0):!1===inAuthorTime?n.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(errorScrim=!0,b("ERROR: "+
a)))};this.warningScrimUp=function(a){"google"!=CTATConfig.platform&&(!0===scrimIsUp&&n.scrimDownForced(),!1===authorTimeSet?(n.ctatdebug("we don't know if we're in authorTime or not yet so we're just going to hold onto the messasge"),r.push("WARNING: "+a),warnScrim=!0):!1===inAuthorTime?n.ctatdebug("We're not in authorTime, student's don't need to see our design mistakes"):(warnScrim=!0,b("WARNING: "+a)))};this.handleTSDisconnect=function(){connectionScrim=!0;n.scrimUp(CTATGlobals.languageManager.getString("TUTORDISCONNECTED"))};
this.removeHTMLElements=function(){};this.scrimDown=function(){"google"!=CTATConfig.platform&&(!1===scrimIsUp?n.ctatdebug("The scrim isn't up, returning"):!0===errorScrim?n.ctatdebug("The scrim is up to describe errors to the user, leave it up!"):!0===warnScrim?n.ctatdebug("The scrim is up to display warnings to the user, leave it up!"):!0===connectionScrim?n.ctatdebug("The scrim is up for a connection issue leave it up!"):n.scrimDownForced())};this.scrimDownForced=function(){n.ctatdebug("enter scrimDownForced() scrimIsUp "+
scrimIsUp);$("#scrim").remove();m.removeComponent();n.removeHTMLElements();waitScrim=scrimIsUp=!1;f="";n.ctatdebug("exit scrimDownForced() scrimIsUp "+scrimIsUp)};this.defaultClickHandler=function(){n.ctatdebug("defaultClickHandler ()");n.scrimDown()};this.setInAuthorTime=function(a){n.ctatdebug("setting inAuthorTime = "+a);authorTimeSet=!0;inAuthorTime=a;if(!a)warnScrim=errorScrim=!1,g&&null.removeChild(q);else if(errorScrim||warnScrim)for(var c in r)b(c)};this.getInAuthorTime=function(){return inAuthorTime}};
CTATScrim.prototype=Object.create(CTATBase.prototype);CTATScrim.prototype.constructor=CTATScrim;CTATGlobals.languageManager=CTATLanguageManager.theSingleton;CTATScrim.scrim=new CTATScrim;var CTAT={ToolTutor:{interfaceMessages:[],tutorMessages:[]}};
Object.defineProperty(CTAT.ToolTutor,"message_handler",{enumerable:!0,get:function(){if(window.hasOwnProperty("getInterfaceObject")&&"function"===typeof window.getInterfaceObject)return window.getInterfaceObject();if(window.hasOwnProperty("interfaceObject"))return window.interfaceObject;this.hasOwnProperty("_interface")||(this._interface=null);return this._interface},set:function(a){window.hasOwnProperty("interfaceObject")?window.interfaceObject=a:this._interface=a;return a}});
Object.defineProperty(CTAT.ToolTutor,"tutor",{enumerable:!0,get:function(){if(window.hasOwnProperty("getTutorObject")&&"function"===typeof window.getTutorObject)return window.getTutorObject();if(window.hasOwnProperty("tutorObject"))return window.tutorObject;this.hasOwnProperty("_tutor")||(this._tutor=null);return this._tutor},set:function(a){window.hasOwnProperty("tutorObject")?window.tutorObject=a:this._tutor=a;return a}});
CTAT.ToolTutor.registerTutor=function(a){if(window.hasOwnProperty("registerTutor")&&"function"===typeof window.registerTutor)return window.registerTutor(a);if(this.tutor=a)for(;0<this.tutorMessages.length;)this.sendToTutor(this.tutorMessages.shift())};
CTAT.ToolTutor.sendToInterface=function(a){ctatdebug("CTAT.ToolTutor.sendToInterface()\n  "+a);return window.hasOwnProperty("sendToInterface")&&"function"===typeof window.sendToInterface?window.sendToInterface.apply(null,arguments):this.message_handler?this.message_handler.receiveFromTutor(a):commMessageHandler?commMessageHandler.processMessage(a):this.interfaceMessages.push(a)};
CTAT.ToolTutor.registerInterfaceMessageHandler=function(a){ctatdebug("CTAT.ToolTutor.registerInterfaceMessageHandler("+a+")");"string"===typeof a&&(a=document.getElementById(a));if(this.message_handler=a)for(;0<this.interfaceMessages.length;)this.sendToInterface(this.interfaceMessages.shift())};CTAT.ToolTutor.registerInterface=function(a){if(window.hasOwnProperty("registerInterface")&&"function"===typeof window.registerInterface)return window.registerInterface(a);this.registerInterfaceMessageHandler(a)};
CTAT.ToolTutor.sendToTutor=function(a){return window.hasOwnProperty("sendToTutor")&&"function"===typeof window.sendToTutor?window.sendToTutor(a):this.tutor?this.tutor.receiveFromInterface(a):this.tutorMessages.push(a)};
CTAT.ToolTutor.reboot=function(a){(a="undefined"!=typeof location&&location&&location.href?location.href:null)&&console.log("ToolTutor.reboot(), setting location to "+a);return a&&!CTATConfiguration.get("editorMode")?("function"==typeof setTimeout?setTimeout(location.replace.bind(location),600,a):location.replace(a),!0):!1};var CTATGuid={s4:function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}};var CTATConfiguration=function(){CTATBase.call(this,"CTATConfiguration","config");var a=this,b=[],e=null,f=null,d=null,c=null;this.raw={admit_code:"ies",authenticity_token:"",auth_token:"none",BehaviorRecorderMode:"AuthorTimeTutoring",class_name:"DefaultClass",curriculum_service_url:"",connection:"javascript",dataset_level_name:"none",dataset_level_type:"ProblemSet",dataset_name:"none",expire_logout_url:"none",info:"",instructor_name:"none",instrumentation_log:"off",lcId:"none",Logging:"None",log_service_url:"http://pslc-qa.andrew.cmu.edu/log/server",
log_to_disk_directory:".",problem_name:"none",problem_position:"none",problem_started_url:"none",problem_state_status:"empty",question_file:"none",refresh_session_url:"none",remoteSocketPort:"20080",remoteSocketSecurePort:"20443",remoteSocketURL:"127.0.0.1",restore_problem_url:"",reuse_swf:"false",run_problem_url:"none",school_name:"none",SessionLog:"true",session_id:CTATGuid.guid(),session_timeout:"none",show_debug_traces:"false",skills:"",source_id:"PACT_CTAT_HTML5",student_interface:"none",student_problem_id:"none",
study_condition_name:"none",study_condition_type:"none",study_condition_description:"none",study_name:"Study1",target_frame:"_parent",TutorShopDeliveryMethod:"sendandload",tutoring_service_communication:"javascript",user_guid:"none",wmode:"opaque",ssl:"off",sui:"",centerTutor:!1,previewMode:!1,width:550,height:450};this.assignRawFlashVars=function(b){a.ctatdebug("assignRawFlashVars() raw['session_id'] "+a.raw.session_id+", aData['session_id'] "+b.session_id);a.raw=b;a.preParse()};this.getRawFlashVars=
function(){return a.raw};this.getSingleParameterValues=function(b){var c=[];if(!b)return c;var d=a.getRawFlashVars(),g;for(g in b){var e=b[g];d[e]&&"none"!=d[e]&&c.push(d[e])}return c};this.usingFlash=function(){return this.getSingleParameterValues(["student_interface","swf_name"]).some(function(a){return 0<=a.search(/[.]swf$/i)})};this.generateDefaultConfiguration=function(b){var c={},d=0;if(b)for(var g in b)c[g]=b[g],d++;a.ctatdebug("generateDefaultConfiguration() nDefaults "+d+", result['session_id'] "+
c.session_id);d=b=null;if(window&&window.frameElement&&(d=window.frameElement.getAttribute("data-params"))){b=jQuery.parseJSON(d);console.log("setting data params from iframe attr");for(var e in b)c[e]=CTATGlobals.EncodedParams[e]?decodeURIComponent(b[e].replace(/\+/g,"%20")):b[e],console.log("set "+e+" to "+c[e])}if(null===b)for(e=$('object param[name="flashvars"]'),a.ctatdebug("generateDefaultConfiguration() objs "+e),b=0;b<e.length;++b)if(d=$(e[b]).attr("value"),a.ctatdebug("generateDefaultConfiguration() fVarsAsString "+
d),d&&(d=parseQueryStringArgs(d))&&d.question_file)for(var f in d)c[f]=d[f];ctatdebug("tutorPrep ("+c+")");f={};if(null===c||void 0===c)ctatdebug("tutorPrep(): Internal error: null argument passed");else{ctatdebug("parseQueryString ()");e=location.search;ctatdebug("Query String: "+e);b="?"==e.charAt(0)?e.substring(1):e;e={};if(b)for(b=b.split("&"),d=0;d<b.length;d++){g=b[d].split("=");ctatdebug("Setting flashvar "+g[0]+", to: "+decodeURIComponent(g[1].replace(/\+/g," ")));e[decodeURIComponent(g[0])]=
"";for(var x=1;x<g.length;x++)e[decodeURIComponent(g[0])]+=(1<x?"=":"")+decodeURIComponent(g[x].replace(/\+/g," "));ctatdebug("Decoded args: "+e[decodeURIComponent(g[0])])}null!==e&&(ctatdebug("tutorPrep(): Assigning parsed arguments ..."),f=e);e=!1;for(var q in f)if(f.hasOwnProperty(q))switch(ctatdebug("Processing external FlashVar "+q+"("+f[q]+")"),q){case "GENERATED":"on"==f[q]&&(c.session_id=CTATGuid.guid(),e=!0);break;case "BRD":c.question_file=f[q];break;case "BRMODE":c.BehaviorRecorderMode=
f[q];break;case "PROBLEM":c.problem_name=f[q];break;case "DATASET":c.dataset_name=f[q];break;case "LEVEL1":c.dataset_level_name1=f[q];break;case "TYPE1":c.dataset_level_type1=f[q];break;case "LEVEL2":c.dataset_level_name2=f[q];break;case "TYPE2":c.dataset_level_type2=f[q];break;case "LEVEL3":c.dataset_level_name3=f[q];break;case "TYPE3":c.dataset_level_type3=f[q];break;case "LEVEL4":c.dataset_level_name4=f[q];break;case "TYPE4":c.dataset_level_type4=f[q];break;case "USER":c.user_guid=f[q];break;case "SESSION":!1===
e&&(c.session_id=f[q]);break;case "SOURCE":c.source_id=f[q];break;case "LOGTYPE":c.Logging=f[q];break;case "PORT":c.remoteSocketPort=f[q];break;case "REMOTEURL":c.remoteSocketURL=f[q];break;case "DISKDIR":c.log_to_disk_directory=f[q];break;case "log_service_url":c.log_service_url=f[q];break;case "URL":c.log_service_url=f[q];break;case "LOGURL":c.log_service_url=f[q];break;case "CONNECTION":c.tutoring_service_communication=f[q];break;case "SUI":c.sui=f[q];break;case "VAR1":c.var1=f[q];break;case "VAL1":c.val1=
f[q];break;case "VAR2":c.var2=f[q];break;case "VAL2":c.val2=f[q];break;case "VAR3":c.var3=f[q];break;case "VAL3":c.val3=f[q];break;case "VAR4":c.var4=f[q];break;case "VAL4":c.val4=f[q];break;case "SLOG":case "SessionLog":c.SessionLog=f[q];break;case "KEYBOARDGROUP":"Disabled"==f[q]&&(c.keyboard="disabled");"Auto"==f[q]&&(c.keyboard="auto");"On"==f[q]&&(c.keyboard="on");break;default:c[q]=f[q]}}return c};this.getCustomFields=function(){return b};this.setTimeZone=function(b){a.ctatdebug("setTimeZone ("+
b+")");null==b||""==b||void 0==b?(b=jstz.determine(),a.ctatdebug("Assigning detected timezone: "+b.name()),b=b.name()):(50<b.length&&(b=b.substr(0,50)),3!=b.length&&4!=b.length||a.ctatdebug("3 and 4 letter time zone abbreviations are deprecated. See list of tz database zone names for better options"));null!=a.raw&&(a.raw.timezone=b)};this.getTimeZone=function(){return null!=a.raw&&a.raw.timezone?a.raw.timezone:"UTC"};this.listWithAmpersands=function(){var b="",c;for(c in a.raw)var d=c+"="+encodeURIComponent(a.raw[c]),
b=""!=b?b+"&"+d:d;a.ctatdebug("CTATConfiguration.listWithAmpersands() result "+b.substring(0,25)+"...");return b};this.listFlashVars=function(){ctatdebug("listFlashVars ()");for(var b in a.raw)ctatdebug("["+b+"]: "+a.raw[b])};this.preParse=function(){ctatdebug("preParse ()");if(void 0==a.raw.dataset_name||void 0==a.raw.dataset_name)a.raw.dataset_name="DefaultDataset";var c=0,d;for(d in a.raw){if("VAR"==d||"var"==d)b[d]=a.raw[d];c++}a.ctatdebug("preParse() nRaw "+c);c=0;for(d=!0;1==d;){d=!1;var e=
"custom_field_name"+(c+1),f="custom_field_value"+(c+1);a.ctatdebug("Trying : "+a.raw[e]+","+a.raw[f]);null!=a.raw[e]&&(a.ctatdebug("Adding: "+e+","+a.raw[f]),b[a.raw[e]]=a.raw[f],d=!0,c++)}};this.getDatasetNames=function(){a.ctatdebug("getDatasetNames ()");if(null!=e)return e;e={};e=[];for(var b=0,c=!0;1==c;){var c=!1,d="dataset_level_name"+(b+1);null!=a.raw[d]&&(a.ctatdebug("Adding: "+d+","+a.raw[d]),e[b]=a.raw[d],c=!0,b++)}return e};this.getDatasetTypes=function(){a.ctatdebug("getDatasetTypes ()");
if(null!=f)return f;f=[];for(var b=0,c=!0;1==c;){var c=!1,d="dataset_level_type"+(b+1);null!=a.raw[d]&&(a.ctatdebug("Adding: "+d+","+a.raw[d]),f[b]=a.raw[d],c=!0,b++)}return f};this.getConditionNames=function(){var b=[],c=0;void 0!=a.raw.study_condition_name&&""!=a.raw.study_condition_name&&(b.push(a.raw.study_condition_name),c++);for(var d=0,e=!0;1==e;){var e=!1,f="study_condition_name"+(d+1);null!=a.raw[f]&&(a.ctatdebug("Adding: "+f+","+a.raw[f]),b[d+c]=a.raw[f],e=!0,d++)}return b};this.getConditionTypes=
function(){d=[];var b=0;void 0!=a.raw.study_condition_type&&""!=a.raw.study_condition_type&&(d.push(a.raw.study_condition_type),b++);for(var c=0,e=!0;1==e;){var e=!1,f="study_condition_type"+(c+1);null!=a.raw[f]&&(a.ctatdebug("Adding: "+f+","+a.raw[f]),d[c+b]=a.raw[f],e=!0,c++)}return d};this.getConditionDescriptions=function(){a.ctatdebug("getConditionDescriptions ()");c=[];var b=0;a.raw.study_condition_description&&""!==a.raw.study_condition_description&&(a.ctatdebug("Adding study_condition_description: "+
a.raw.study_condition_description),c.push(a.raw.study_condition_description),b++);for(var d=0,e=!0;!0===e;){var e=!1,f="study_condition_description"+(d+1);null!=a.raw[f]&&(a.ctatdebug("Adding: "+f+","+a.raw[f]),c[d+b]=a.raw[f],e=!0,d++)}return c};this.get=function(b){return a.raw[b]};this.set=function(b,c){b&&(a.raw[b]=c)};this.setParams=function(b){if(b)for(var c in b)a.set(c,b[c])};this.isInstructorMode=function(){var a=this.getRawFlashVars();return a&&a.deliverymode?"delivery"==a.deliverymode?
!1:!0:!1};this.getLoggingLibrary=function(){null===commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));return commLoggingLibrary};this.setPreviewMode=function(b,c){a.raw.previewMode=c};this.setCenterTutor=function(b,c){a.raw.centerTutor=c};this.setTutorWidth=function(b,c){a.raw.width=c};this.setTutorHeight=function(b,c){a.raw.height=c};this.setTutorDimensions=function(b,c,d){a.raw.width=c;a.raw.height=d};this.setTutorValue=function(b,c,d){a.raw[c]=d};this.setCommunicationMode=function(b,
c){a.raw.tutoring_service_communication=c};this.setRemoteSocketURL=function(b,c){a.raw.remoteSocketURL=c};this.setRemoteSocketPort=function(b,c){a.raw.remoteSocketPort=c}};CTATConfiguration.prototype=Object.create(CTATBase.prototype);CTATConfiguration.prototype.constructor=CTATConfiguration;flashVars=CTATConfiguration.theConfObject=null;
CTATConfiguration.generateDefaultConfigurationObject=function(){if(!CTATConfiguration.theConfObject){this.theConfObject=new CTATConfiguration;var a=this.theConfObject.generateDefaultConfiguration(this.theConfObject.raw);this.theConfObject.assignRawFlashVars(a);"none"==this.theConfObject.get("session_id")&&this.theConfObject.set("session_id",CTATGuid.guid());flashVars=this.theConfObject;console.log("CTATConfiguration.generateDefaultConfigurationObject() flashVars.getRawFlashVars()['session_id'] "+
flashVars.getRawFlashVars().session_id);console.log("flashVars.getRawFlashVars()['remoteSocketPort'] "+flashVars.getRawFlashVars().remoteSocketPort)}return this.theConfObject};CTATConfiguration.getRawFlashVars=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getRawFlashVars()};CTATConfiguration.get=function(a){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.get(a)};
CTATConfiguration.set=function(a,b){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.set(a,b)};CTATConfiguration.setParams=function(a){CTATConfiguration.generateDefaultConfigurationObject();CTATConfiguration.theConfObject.setParams(a)};CTATConfiguration.getSingleParameterValues=function(a){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.getSingleParameterValues(a)};
CTATConfiguration.usingFlash=function(){CTATConfiguration.generateDefaultConfigurationObject();return CTATConfiguration.theConfObject.usingFlash()};CTATConfiguration.prototype.set=CTATConfiguration.prototype.set;CTATConfiguration.prototype.get=CTATConfiguration.prototype.get;var CTATTutorMessageBuilder=function(){CTATBase.call(this,"CTATTutorMessageBuilder","__undefined__")};CTATTutorMessageBuilder.isHint=function(a){return null===a||"undefined"===typeof a?!1:0===a.toString().toLowerCase().indexOf(CTATTutorMessageBuilder.HINT.toLowerCase())};CTATTutorMessageBuilder.isCorrect=function(a){if(null===a||"undefined"===typeof a)return!1;a=a.toString().toLowerCase();return 0===a.indexOf(CTATTutorMessageBuilder.CORRECT.toLowerCase())?!0:0===a.indexOf(CTATExampleTracerLink.SUCCESS.toLowerCase())};
CTATTutorMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutorMessageBuilder.prototype.createInCorrectActionMessage=function(a,b){this.ctatdebug("createInCorrectActionMessage ()");var e;e="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>");this.ctatdebug("In CTATTutorMessageBuilder "+b);e+=b.toXMLString(!1);return e+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createCorrectActionMessage=function(a,b){this.ctatdebug("createCorrectActionMessage ()");var e;e="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return e+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForHint=function(a,b,e,f,d,c){b="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType><Indicator>Hint</Indicator>"+b.toXMLString();b+="<TutorAdvice>";for(var g=0;g<a.length;g++)b+="<value><![CDATA["+a[g]+"]]\x3e</value>";b+="</TutorAdvice><TotalHintsAvailable>"+a.length+"</TotalHintsAvailable><CurrentHintNumber>1</CurrentHintNumber>";b=b+("<Actor>"+e+"</Actor>")+this.fmtSkillBarVector(f);b=b+"<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>"+
("<StepID>"+d+"</StepID>")+("<transaction_id>"+c+"</transaction_id>");b+="<LogAsResult>true</LogAsResult>";return b+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createAssociatedRulesMessageForAction=function(a,b,e,f,d,c,g,h){a="<message><verb>SendNoteProperty</verb><properties><MessageType>AssociatedRules</MessageType>"+("<Indicator>"+(CTATTutorMessageBuilder.isCorrect(a)?"Correct":"InCorrect")+"</Indicator>");a+=b.toXMLString();b=f.toXMLString().replace("<Selection>","<StudentSelection>").replace("<Action>","<StudentAction>").replace("<Input>","<StudentInput>");b=b.replace("</Selection>","</StudentSelection>").replace("</Action>",
"</StudentAction>").replace("</Input>","</StudentInput>");a=a+b+("<Actor>"+e+"</Actor>")+this.fmtSkillBarVector(d);a+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";a+="<StepID>"+c+"</StepID>";a+="<transaction_id>"+g+"</transaction_id>";h&&(a+="<TutorAdvice><![CDATA["+h+"]]\x3e</TutorAdvice>");a+="<LogAsResult>true</LogAsResult>";a+="<end_of_transaction>"+(h?!1:!0)+"</end_of_transaction>";return a+="</properties></message>"};
CTATTutorMessageBuilder.prototype.isDoneStep=function(a,b){b[0]=!1;var e=a.getIndicator();if(!e)return!1;var f=a.getStudentSelection();f||(f=a.getProperty("tool_selection"));b[0]=CTATTutorMessageBuilder.isCorrect(indicator);var d="done"==f;this.ctatdebug("isDoneStep() indicatorObj "+e+", selectionObj "+f+", correct[0] "+b[0]+", result "+d);return d};
CTATTutorMessageBuilder.prototype.createHintMessage=function(a,b,e,f){e="<message><verb>SendNoteProperty</verb><properties><MessageType>ShowHintsMessage</MessageType><HintsMessage>";for(var d=0;d<a.length;d++)e+="<value><![CDATA["+a[d]+"]]\x3e</value>";e=e+"</HintsMessage>"+b.toXMLString();return e+("<transaction_id>"+f+"</transaction_id>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createErrorMessage=function(a,b){var e;e="<message><verb>SendNoteProperty</verb><properties><MessageType>TutoringServiceError</MessageType><ErrorType>"+a+"</ErrorType><Details>"+(b?b:"");return e+="</Details></properties></message>"};
CTATTutorMessageBuilder.prototype.createSuccessMessage=function(a,b){var e;e="<message><verb>SendNoteProperty</verb><properties><MessageType>SuccessMessage</MessageType>"+("<SuccessMsg><![CDATA["+b+"]]\x3e</SuccessMsg>")+("<transaction_id>"+a+"</transaction_id>")+"<end_of_transaction>true</end_of_transaction>";return e+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createBuggyMessage=function(a,b){var e;e="<message><verb>SendNoteProperty</verb><properties><MessageType>BuggyMessage</MessageType>"+("<BuggyMsg><![CDATA["+b+"]]\x3e</BuggyMsg>")+("<transaction_id>"+a+"</transaction_id>")+"<end_of_transaction>true</end_of_transaction>";return e+="</properties></message>"};
CTATTutorMessageBuilder.prototype.createLockWidgetMsg=function(a){return"<message><verb>SendNoteProperty</verb><properties><MessageType>SendWidgetLock</MessageType>"+("<WidgetLockFlag>"+a+"</WidgetLockFlag>")+"</properties></message>"};
CTATTutorMessageBuilder.prototype.createMessage=function(a,b){var e="<message><verb>SendNoteProperty</verb><properties><MessageType>"+a+"</MessageType>";if(b)for(var f in b)e+="<"+f+">"+b[f]+"</"+f+">";e+="</properties></message>";this.ctatdebug("CTATTutorMessageBuilder.createMessage("+a+", "+b+") returns "+e);return e};
CTATTutorMessageBuilder.prototype.createStateGraphMessage=function(a,b,e,f,d,c,g){a="<message><verb>SendNoteProperty</verb><properties><MessageType>StateGraph</MessageType>"+("<caseInsensitive>"+a+"</caseInsensitive>")+("<unordered>"+b+"</unordered>")+("<lockWidget>"+e+"</lockWidget>");a+="<suppressStudentFeedback>"+f+"</suppressStudentFeedback>";a+="<highlightRightSelection>"+d+"</highlightRightSelection>";a+="<confirmDone>"+c+"</confirmDone>";a+="<skillBarDelimiter><![CDATA[`]]\x3e</skillBarDelimiter>";
a+=this.fmtSkillBarVector(g);return a+="</properties></message>"};CTATTutorMessageBuilder.prototype.fmtSkillBarVector=function(a){var b="";if(void 0!==a&&null!==a&&0<a.length){for(var b=b+"<Skills>",e=0;e<a.length;e++)b+="<value><![CDATA["+a[e]+"]]\x3e</value>";b+="</Skills>"}return b};
CTATTutorMessageBuilder.prototype.createHighlightWidgetMessage=function(a,b,e,f){a="<message><verb>SendNoteProperty</verb><properties><MessageType>HighlightMsg</MessageType>"+("<HighlightMsgText>"+e+"</HighlightMsgText>")+("<Selection><value>"+a+"</value></Selection>")+("<Action><value>"+b+"</value></Action>");a+="<transaction_id>"+f+"</transaction_id>";a+="<end_of_transaction>true</end_of_transaction>";return a+="</properties></message>"};
Object.defineProperty(CTATTutorMessageBuilder,"TRIGGER",{enumerable:!1,configurable:!1,writable:!1,value:"trigger"});Object.defineProperty(CTATTutorMessageBuilder,"SUBTYPE",{enumerable:!1,configurable:!1,writable:!1,value:"subtype"});Object.defineProperty(CTATTutorMessageBuilder,"TUTOR_PERFORMED",{enumerable:!1,configurable:!1,writable:!1,value:"tutor-performed"});Object.defineProperty(CTATTutorMessageBuilder,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"Hint"});
Object.defineProperty(CTATTutorMessageBuilder,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"Correct"});CTATTutorMessageBuilder.prototype.constructor=CTATTutorMessageBuilder;"undefined"!==typeof module&&(module.exports=CTATTutorMessageBuilder);var CTATLMS={identifier:null,initLMSConnection:function(){},closeLMSConnection:function(){},setValue:function(a,b){},getValue:function(a){return null},saveProblemState:function(a){},getProblemState:function(a){return a(null)},gradeStudent:function(a,b){},logEvent:function(a){},processProblemSummary:function(a){},is:{},init:{}};
CTATLMS.init.StandAlone=function(){CTATLMS.identifier=null;CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(){};CTATLMS.getValue=function(){return null};CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(){};CTATLMS.getProblemState=function(a){return a(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=function(){}};CTATLMS.is.SCORM=function(){return window.location.search&&/[?&;]mode=SCORM/i.test(window.location.search)};
CTATLMS.init.SCORM=function(){var a=!1;CTATLMS.identifier="SCORM";CTATLMS.initLMSConnection=function(){if(!0!==a){window.parent.doLMSInitialize();var b=CTATLMS.getValue("cmi.core.lesson_status");CTATConfiguration.set("problem_state_status",b);"not attempted"==b&&CTATConfiguration.set("problem_state_status","incomplete");"passed"==b&&CTATConfiguration.set("problem_state_status","completed");"failed"==b&&CTATConfiguration.set("problem_state_status","incomplete");"browsed"==b&&CTATConfiguration.set("problem_state_status",
"incomplete");CTATLMS.setValue("cmi.core.lesson_status","incomplete");a=!0}};CTATLMS.commit=window.parent.doLMSCommit;CTATLMS.closeLMSConnection=window.parent.doLMSFinish;CTATLMS.setValue=window.parent.doLMSSetValue;CTATLMS.getValue=window.parent.doLMSGetValue;CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(a){return CTATLMS.setValue("cmi.suspend_data",a.problem_state)};CTATLMS.getProblemState=function(a){var b=CTATLMS.getValue("cmi.suspend_data");return a(b)};CTATLMS.gradeStudent=
function(a,e){CTATLMS.setValue("cmi.core.score.min",0);CTATLMS.setValue("cmi.core.score.max",100);return CTATLMS.setValue("cmi.core.score.raw",Number((a/e).toFixed(2).replace(/[.]/,"")))};CTATLMS.processProblemSummary=function(a){["cmi.core.lesson_status","cmi.core.score.raw","cmi.core.exit","cmi.core.session_time"].forEach(function(a){var b=this.getElementsByTagName(a);CTATLMS.setValue(a,$("<div>").html(b[0].innerHTML).text())},a);CTATLMS.commit();CTATLMS.closeLMSConnection()};CTATLMS.initLMSConnection()};
CTATLMS.is.XBlock=function(){return window.location.search&&/[?&;]mode=XBlock/i.test(window.location.search)};
CTATLMS.init.XBlock=function(){var a=document.referrer?(new URL(document.referrer)).origin:"";CTATLMS.identifier="XBlock";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(a,e){};CTATLMS.getValue=function(a){return null};CTATLMS.saveProblemState=function(b){parent.postMessage({action:"save_problem_state",input:window.btoa(b.problem_state)},a)};CTATLMS.getProblemState=function(a){return a(window.atob(CTATConfiguration.get("saveandrestore")))};
CTATLMS.gradeStudent=function(b,e){parent.postMessage({action:"grade",input:{value:b,max:e}},a)};CTATLMS.logEvent=function(b){parent.postMessage({action:"log",input:b},a)};CTATLMS.processProblemSummary=function(a){}};CTATLMS.is.Authoring=function(){return window.location.search&&/[?&;]mode=AUTH(ORING)?/i.test(window.location.search)};CTATLMS.is.OLI=function(){return"OLI"==CTATConfiguration.get("CTATTarget")};CTATLMS.is.TutorShop=function(){return"TutorShop"==CTATConfiguration.get("LMS")};
CTATLMS.init.TutorShop=function(){CTATLMS.identifier="TutorShop";CTATLMS.initLMSConnection=function(){};CTATLMS.closeLMSConnection=function(){};CTATLMS.commit=function(){};CTATLMS.setValue=function(a,b){};CTATLMS.getValue=function(a){return null};CTATLMS.logEvent=function(a){};CTATLMS.saveProblemState=function(a){if(CTATConfiguration.get("restoreProblemUrl")&&CTATConfiguration.get("curriculum_service_url")){a.session_id=a.session_id?a.session_id:"dummySession";var b=[],e;for(e in a)b.push(e+"="+encodeURIComponent(a[e]));
$.post(CTATConfiguration.get("curriculum_service_url"),b.join("&"),null,"application/x-www-form-urlencoded")}};CTATLMS.getProblemState=function(a){CTATConfiguration.get("restoreProblemUrl")?$.get(CTATConfiguration.get("restoreProblemUrl"),"",null,"text").done(function(b){a(b)}).fail(function(b,e,f){a(null);b=(new CTATTutorMessageBuilder).createErrorMessage("Load ProblemState Error",e+" "+f);CTAT.ToolTutor.sendToInterface(b,!0)}):a(null)};CTATLMS.gradeStudent=function(){};CTATLMS.processProblemSummary=
function(){}};CTATLMS.is.Assistments=function(){return CTATTarget&&"ASSISTMENTS"==CTATTarget};var bundleFormatter="",inBundle=!1,useBundling=!1,useOLIEncoding=!1,CTATCommLibrary=function(a,b){CTATBase.call(this,"CTATCommLibrary",a);var e=authenticityToken="",f=0,d=[],c=a?a:null,g=null==b?!0:b,h=!0,l=null,m=this,r="http",p="ERROR_CONN_TS",x="";this.setUseCommSettings=function(a){h=a};this.getUseCommSettings=function(){return h};this.setConnectionRefusedMessage=function(a){p=a};this.setSocketType=function(a){r=a};this.getSocketType=function(){return r};this.assignHandler=function(a){c=a};this.assignMessageListener=
function(a){l=a};this.encodeVariables=function(a){m.ctatdebug("encodeVariables ()");for(var b="",c=0;c<a.length;c++){var d=a[c];0<c&&(b+="&");b+=d.name;b+="=";b+=encodeURIComponent(d.value)}return b};this.encodeVariablesOLI=function(a){m.ctatdebug("encodeVariablesOLI ()");for(var b="",c=0;c<a.length;c++){var d=a[c];0<c&&(b+="&");b+=d.name;b+="=";b+=encodeURIComponent(d.value)}return b};this.createConnection=function(a,b){m.ctatdebug("createConnection ()");if(!b)return new CTATConnection(a);flashVars.getRawFlashVars();
var c;if("websocket"==m.getSocketType())return c=this.findWSConnection(b),c||(c=new CTATWSConnection(a),c.setID(f),c.setURL(b),c.assignReceiveFunction(this.processWSReply),c.assignCloseFunction(this.processWSClose),d.push(c),f++),c;c=new CTATConnection(a);c.setID(f);c.setURL(b);c.assignReceiveFunction(this.processReply);d.push(c);f++;return c};this.findWSConnection=function(a){ctatdebug("findWSConnection( "+a+" )");a=m.editSocketURLForHTTPS(a);for(var b=0;b<d.length;b++){var c=d[b];ctatdebug("checking: socketType = "+
c.getSocketType()+" URL = "+c.getURL());if("ws"==c.getSocketType()&&c.getURL()==a)return c}return null};this.startBundle=function(){m.ctatdebug("startBundle ()");!1===useBundling?this.ctatdebug("Not using bundling, bump"):(bundleFormatter='<?xml version="1.0" encoding="UTF-8"?><message><verb/><properties><MessageType>MessageBundle</MessageType><messages>',inBundle=!0)};this.endBundle=function(){m.ctatdebug("endBundle ()");!1===useBundling?m.ctatdebug("Not using bundling, bump"):(inBundle=!1,bundleFormatter+=
"</messages></properties></message>",m.sendXML(bundleFormatter))};this.setFixedURL=function(a){e=a};this.getURL=function(){m.ctatdebug("getURL ()");if(""!==e)return m.ctatdebug("Returning fixedURL: "+e),e;var a=flashVars.getRawFlashVars(),b="http://";"https"==m.getSocketType()&&(b="https://");b=b+a.remoteSocketURL+":"+a.remoteSocketPort;-1!=a.remoteSocketURL.indexOf("http")&&(b=a.remoteSocketURL+":"+a.remoteSocketPort);return b};this.sendXML=function(a){m.ctatdebug("Sending: "+a);m.ctatdebug("sendXML ("+
a+")");if(!0===useBundling&&!0===inBundle)m.ctatdebug("Bundling ..."),bundleFormatter+=a;else{bundleFormatter=a;flashVars.getRawFlashVars();a=this.getURL();var b=bundleFormatter;-1==bundleFormatter.indexOf("<?xml")&&(b='<?xml version="1.0" encoding="UTF-8"?>'+bundleFormatter);this.getUseCommSettings()&&"javascript"==m.getSocketType()?CTAT.ToolTutor.sendToTutor(b):this.send_post(a,b)}};this.sendXMLNoBundle=function(a){m.ctatdebug("sendXMLNoBundle ("+a+")");bundleFormatter=a;var b=this.getURL(),c=a;
-1==a.indexOf("<?xml")&&(c='<?xml version="1.0" encoding="UTF-8"?>'+a);flashVars.getRawFlashVars();this.getUseCommSettings()&&"javascript"==m.getSocketType()?CTAT.ToolTutor.sendToTutor(c):this.send_post(b,c)};this.sendXMLURL=function(a,b){ctatdebug("sendXMLURL ("+b+")");var c=a;-1==a.indexOf("<?xml")&&(c='<?xml version="1.0" encoding="UTF-8"?>'+a);flashVars.getRawFlashVars();m.ctatdebug("Sending: "+c);this.getUseCommSettings()&&"javascript"==m.getSocketType()?CTAT.ToolTutor.sendToTutor(c):this.send_post(b,
c)};this.sendURLVariables=function(a,b){this.ctatdebug("sendURLVariables ("+a+")");this.send_post_variables(a,b)};this.send=function(a){m.ctatdebug("send ("+a+")");if(!0===CTATGlobals.CommDisabled)m.ctatdebug("Communications globally disabled, please check your settings");else{var b=new CTATConnection(null);b.setID(f);f++;if(null===b.getHTTPObject())return alert("Cannot create XMLHTTP instance"),!1;d.push(b);b.setURL(a);b.assignReceiveFunction(this.processReply);try{b.getHTTPObject().open("GET",a,
!0)}catch(n){this.ctatdebug("Error in newConnection.httpObject.open: "+n.message);return}try{b.init()}catch(n){this.ctatdebug("Error in newConnection.init: "+n.message);return}try{b.getHTTPObject().send(null)}catch(n){this.ctatdebug("Error in newConnection.httpObject.send: "+n.message)}}};this.send_post_variables=function(a,b){m.ctatdebug("send_post_variables ("+a+")");flashVars.getRawFlashVars();m.getSocketType();var c;c=!1===useOLIEncoding?this.encodeVariables(b):this.encodeVariablesOLI(b);this.ctatdebug("Sending: "+
c);if(!0===CTATGlobals.CommDisabled)m.ctatdebug("Communications globally disabled, please check your settings");else{var e=m.createConnection(CTATConfiguration.getRawFlashVars(),a);e.setContentType("application/x-www-form-urlencoded");f++;d.push(e);m.ctatdebug(c);null!==l&&l.processOutgoing(c);e.setURL(a);e.setData(c);e.assignReceiveFunction(this.processReply);e.send()}};this.send_post=function(a,b){var c;ctatdebug("send_post ("+a+")");if(!0===CTATGlobals.CommDisabled)m.ctatdebug("Communications globally disabled, please check your settings");
else{ctatdebug("Outoing on wire: "+b);c=flashVars.getRawFlashVars();var d=a;"websocket"==m.getSocketType()?(ctatdebug("opening websocket connection: url "+a),d=a.replace("http:","ws:"),d=m.editSocketURLForHTTPS(d),ctatdebug("opening websocket connection to "+d),c=m.createConnection(c,d),c.setData(b),m.ctatdebug(b)):(c=m.createConnection(c,d),c.setData(b));null!==l&&l.processOutgoing(b);c.send()}};this.processReply=function(a){m.ctatdebug("processReply ("+d.length+","+a+")");var b=0,e;a=[];var f;for(f=
0;f<d.length;f++){var h=d[f],q=h.getHTTPObject();m.ctatdebug("Testing connection entry "+f+", readyState: "+q.readyState+", consumed: "+h.getConsumed()+", status: "+q.status);4==q.readyState&&!1===h.getConsumed()?(m.ctatdebug("Investigating request response: "+b+" -> "+q.status+", for: "+h.getURL()),e=!1,0===q.status&&(e=!0,m.ctatdebug("Received message (status 0): ("+q.responseText+"), status: "+q.status),g&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(p))),408==q.status&&
(e=!0,m.ctatdebug("Received message (status 408): "+q.responseText),g&&CTATScrim.scrim.scrimDown()),502==q.status&&(e=!0,m.ctatdebug("Received message (status 502): "+q.responseText),g&&CTATScrim.scrim.errorScrimUp(CTATGlobals.languageManager.filterString(ERROR_502))),200==q.status?(e=!0,m.ctatdebug("Processing 200 response ..."),null!==c?(a.push(q.responseText),null!==l&&l.processIncoming(q.responseText)):m.ctatdebug("Error: httphandler is null, can't process response!")):c&&c.processError&&(e=!0,
m.ctatdebug("Processing non-200 response, status "+q.status),c.processError(q.status,q.responseText)),!1===e&&m.ctatdebug("Error: status not handled for: "+q.status),m.ctatdebug("Marking connection as consumed ..."),h.setConsumed(!0)):(0===q.readyState&&m.ctatdebug("Received message (status 0, request not initialized)"),1===q.readyState&&m.ctatdebug("Received message (status 1, server connection established)"),2===q.readyState&&m.ctatdebug("Received message (status 2, request received)"),3===q.readyState&&
m.ctatdebug("Received message (status 3, processing request)"));b++}m.cleanup();for(b=0;b<a.length;b++)m.ctatdebug("Processing incoming message: "+b),e=a[b],-1!=e.indexOf("status=success")?m.ctatdebug("Info: logging success message received, not propagating to message handler"):(m.ctatdebug("Processing incoming message: "+e),c.processMessage(e))};this.processWSReply=function(a){m.ctatdebug("processWSReply() length "+(null===a?null:a.toString().length));"string"==typeof a&&(null!==l&&l.processIncoming(a),
-1!=a.indexOf("status=success")?m.ctatdebug("processWSReply() logging success message received, not propagating to message handler: "+a):(m.ctatdebug("Processing incoming message: "+a),c.processMessage(a)))};this.processWSClose=function(a){m.ctatdebug("processWSClose("+a+")");a instanceof CloseEvent&&m.ctatdebug("CloseEvent: code "+a.code+", reason "+a.reason+", wasClean "+a.wasClean);CTATLMS.is.Authoring()?CTATScrim.scrim.scrimUp(CTATGlobals.languageManager.filterString("AUTHORPLEASECLOSE")):CTATScrim.scrim.handleTSDisconnect()};
this.cleanup=function(){m.ctatdebug("cleanup ()");for(var a=0,b,c=!1;!1===c;)b=this.checkEntries(),!1===b?c=!0:a++;m.ctatdebug("Removed "+a+" entries")};this.checkEntries=function(){m.ctatdebug("checkEntries ("+d.length+")");var a=0,b;for(b=0;b<d.length;b++){var c=d[b];if(!0===c.getConsumed())return m.ctatdebug("Removing : "+c.getID()),d.splice(a,1),!0;var e=c.getHTTPObject();m.ctatdebug("Check, readyState: "+e.readyState+", consumed: "+c.getConsumed());a++}return!1};this.retrieveXMLFile=function(a,
b,c){m.ctatdebug("retrieveXMLFile ("+a+")");if(location.href){if(m.ctatdebug("Location: "),-1!=location.href.toLowerCase().indexOf("file://")){a=(new CTATTutorMessageBuilder).createErrorMessage("","You have loaded your tutor directly from the file system, please do not load a tutor using file://. Please use the CTAT Authoring Tools to launch the html file.");m.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0);return}}else m.ctatdebug("We can't check location.href in the current configuration");
if(-1!=a.toLowerCase().indexOf("file://"))a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+a+" - You are trying to use the file:// protocol, which is not allowed in this browser."),m.ctatdebug("onerror GET for xmlFile "+a),CTAT.ToolTutor.sendToInterface(a,!0);else{x=a;var d=(new CTATConnection).getHTTPObject();d.onreadystatechange=function(){m.ctatdebug("onready... GET for xmlFile xmlhttp.readyState "+d.readyState+", .status "+d.status+", parser "+b);if(4==d.readyState){if(200==
d.status){var a;d.responseXML?(m.ctatdebug("parsing brd xml using something else"),a=d.responseXML.documentElement):(m.ctatdebug("parsing brd xml using node"),a=(b=new CTATXML).parseXML(d.responseText));if(null===a){a=(new CTATTutorMessageBuilder).createErrorMessage("Error parsing xmlFile "+x);m.ctatdebug("Error parsing xmlFile "+x+": "+a);CTAT.ToolTutor.sendToInterface(a,!0);return}c.processXML(a)}404==d.status&&(a=(new CTATTutorMessageBuilder).createErrorMessage("Unable to download file","("+x+
") not found"),m.ctatdebug("Error loading xmlFile "+x+": "+a),CTAT.ToolTutor.sendToInterface(a,!0))}};d.onerror=function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+x+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");m.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0);c.processXML(null)};
d.open("GET",a,!0);d.setRequestHeader("Content-type","text/plain");d.send()}};this.retrieveJSONFile=function(a,b){m.ctatdebug("retrieveJSONFile ("+a+")");if(location.href){if(m.ctatdebug("Location: "),-1!=location.href.toLowerCase().indexOf("file://")){var c=(new CTATTutorMessageBuilder).createErrorMessage("","You have loaded your tutor directly from the file system, please do not load a tutor using file://. Please use the CTAT Authoring Tools to launch the html file.");m.ctatdebug("onerror GET for xmlFile "+
c);CTAT.ToolTutor.sendToInterface(c,!0);return}}else m.ctatdebug("We can't check location.href in the current configuration");if(-1!=a.toLowerCase().indexOf("file://"))c=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+a+" - You are trying to use the file:// protocol, which is not allowed in this browser."),m.ctatdebug("onerror GET for xmlFile "+c),CTAT.ToolTutor.sendToInterface(c,!0);else{x=a;var d=(new CTATConnection).getHTTPObject();d.onreadystatechange=function(){4==d.readyState&&
200==d.status&&(m.ctatdebug("Successfully retrieved file: "+a),b(JSON.parse(d.responseText)))};d.onerror=function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+x+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");m.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)};d.open("GET",a,!0);d.setRequestHeader("Content-type",
"text/plain");d.send()}};this.retrieveFile=function(a,b){m.ctatdebug("retrieveFile ("+a+")");if(location.href){if(m.ctatdebug("Location: "),-1!=location.href.toLowerCase().indexOf("file://")){var c=(new CTATTutorMessageBuilder).createErrorMessage("","You have loaded your tutor directly from the file system, please do not load a tutor using file://. Please use the CTAT Authoring Tools to launch the html file.");m.ctatdebug("onerror GET for xmlFile "+c);CTAT.ToolTutor.sendToInterface(c,!0);return}}else m.ctatdebug("We can't check location.href in the current configuration");
if(-1!=a.toLowerCase().indexOf("file://"))c=(new CTATTutorMessageBuilder).createErrorMessage("","Unable to load: "+a+" - You are trying to use the file:// protocol, which is not allowed in this browser."),m.ctatdebug("onerror GET for xmlFile "+c),CTAT.ToolTutor.sendToInterface(c,!0);else{x=a;var d=(new CTATConnection).getHTTPObject();d.onreadystatechange=function(){4==d.readyState&&200==d.status&&(m.ctatdebug("Successfully retrieved file: "+a),b(d.responseText))};d.onerror=function(){var a=(new CTATTutorMessageBuilder).createErrorMessage("",
"Unable to load: "+x+" - Either you are trying to use the  file:// protocol, there is a firewall between the tutor and BRD, or the BRD is on a different domain and permission to retrieve data from that server is denied.");m.ctatdebug("onerror GET for xmlFile "+a);CTAT.ToolTutor.sendToInterface(a,!0)};d.open("GET",a,!0);d.setRequestHeader("Content-type","text/plain");d.send()}}};
CTATCommLibrary.setAuthenticityToken=function(a){Array.isArray(a)&&(a=0<a.length?a[0]:"");a&&(CTATCommLibrary.authenticityToken=decodeURIComponent(a))};CTATCommLibrary.getAuthenticityToken=function(a){return CTATCommLibrary.authenticityToken};
CTATCommLibrary.addAuthenticityToken=function(a){return CTATCommLibrary.authenticityToken&&(""===a||0>a.search(/authenticity_token=/)&&0<=a.search(/^[?]?[^?&=><]+=?[^&=]*(&[^?&=><]+=?[^&=]*)*$/))?""+a+(a?"&":"")+"authenticity_token="+encodeURIComponent(CTATCommLibrary.authenticityToken):a};CTATCommLibrary.prototype=Object.create(CTATBase.prototype);CTATCommLibrary.prototype.constructor=CTATCommLibrary;
CTATCommLibrary.prototype.editSocketURLForHTTPS=function(a){if(a&&"https:"===window.top.location.protocol){ctatdebug("We're embedded in an https window, using wss...");a=a.replace("ws:","wss:");var b=CTATConfiguration.get("remoteSocketSecurePort");b&&(a=a.replace(/(wss:\/\/[^:]{1,}:)\d{1,}/,"$1"+b));ctatdebug("url after replace: "+a)}return a};var CTATSequencer=function(){CTATBase.call(this,"CTATSequencer","sequencer");var a=this,b=new CTATPackage,e=new CTATXML,f=null,d="sequential",c=null;this.setAlgorithm=function(a){d=a};this.getAlgorithm=function(){return d};this.handlePackageRetrieval=function(d){a.ctatdebug("handlePackageRetrieval ()");b.init(d);null!=c&&c()};this.processXML=function(d){a.ctatdebug("parseXML ()");b.init(d);null!=c&&c()};this.init=function(b,d){a.ctatdebug("init ()");c=d;f=new CTATCommLibrary(null,!1);f.retrieveXMLFile(b,
e,this)};this.getProblemSetSize=function(){a.ctatdebug("getProblemSetSize ()");var c=b.getProblemSets();return 0==c.length?(a.ctatdebug("Error: no problem sets available, trying list of problems directly ..."),b.getProblems().getProblemSize()):c[0].getProblemSize()};this.getFirstProblem=function(){a.ctatdebug("getFirstProblem ()");if(0==b.getProblemSets().length){a.ctatdebug("Error: no problem sets available, trying list of problems directly ...");var c=b.getProblems();return c[0]}return c[0].getFirstProblem()};
this.getProblemList=function(){a.ctatdebug("getProblemList ()");if(0==b.getProblemSets().length){a.ctatdebug("Error: no problem sets available, trying list of problems directly ...");var c=b.getProblems()}return c};this.getNextProblem=function(b){a.ctatdebug("getNextProblem ()")}};CTATSequencer.prototype=Object.create(CTATBase.prototype);CTATSequencer.prototype.constructor=CTATSequencer;var CTATActionEvaluationData=function(a){CTATBase.call(this,"CTATActionEvaluationData","actionevaluation");var b=0,e=0,f="",d=a;this.setClassification=function(a){this.classification=a};this.isHint=function(){return"HINT"==d};this.hasClassification=function(){return!0};this.setCurrentHintNumber=function(a){b=a};this.setTotalHintsAvailable=function(a){e=a};this.setHintID=function(a){f=a};this.getClassification=function(){return""};this.setEvaluation=function(a){d=a};this.getEvaluation=function(){return d};
this.getAttributeString=function(){var a="";if(!this.isHint())return a;a+='current_hint_number="'+b+'" ';a+='total_hints_available="'+e+'" ';""!==f&&(a+='hint_id="'+f+'" ');return a}};CTATActionEvaluationData.prototype=Object.create(CTATBase.prototype);CTATActionEvaluationData.prototype.constructor=CTATActionEvaluationData;var CTATVariable=function(){this.value=this.name=""};var CTATCurriculumService=function(a){CTATBase.call(this,"CTATCurriculumService","curriculum_service");var b=[],e=this;this.reset=function(){b=[]};this.addVariable=function(a,d){var c=new CTATVariable;c.name=a;c.value=d;b.push(c)};this.sendSummary=function(f){e.ctatdebug("sendSummary ()");var d=new CTATXML,c=f.getXMLObject();f=c.getElementsByTagName("ProblemSummary");f=$("<div>").html(f[0].innerHTML).text();d.xmlToString(c);var c=flashVars.getRawFlashVars(),d=c.curriculum_service_url,g=new CTATXML,
h=g.parse(f),g=g.getElementAttr(h,"CompletionStatus");d?("complete"==g&&(CTATScrim.scrim.nextProblemScrimUp(),a.assignMessageListener(e),a.assignHandler(e)),b=[],this.addVariable("user_guid",c.user_guid),this.addVariable("session_id",c.session_id),this.addVariable("authenticity_token",c.authenticity_token),this.addVariable("school_name",c.school_name),this.addVariable("summary",f),f=c.target_frame,g=c.reuse_swf,c=c.run_problem_url,this.addVariable("targetFrame",f),this.addVariable("reuseSWF",g),e.ctatdebug("CTATCurriculumService.sendSummary about to send targetFrame = "+
f+", reuseSwf "+g+", runProblemUrl "+c),a.send_post_variables(d,b)):"complete"==g&&CTATScrim.scrim.scrimUp("Congratulations, you are done with this problem.")};this.processOutgoing=function(a){e.ctatdebug('CTATCurriculumService.processOutgoing("'+a+'")')};this.processIncoming=function(a){var b=flashVars.getRawFlashVars().run_problem_url;e.ctatdebug("CTATCurriculumService.processIncoming("+(a?a.substring(0,12)+"...":"")+") parent.location.replace "+parent.location.replace+', runProblemUrl "'+b+'"');
b&&parent&&parent.location&&parent.location.replace(b)};this.processMessage=function(a){this.ctatdebug("CTATCurriculumService.processMessage("+(a?a.substring(0,30)+"...":"")+")")};this.updateFlashVars=function(a){e.ctatdebug("UpdateFlashVars ()")};this.checkProtocol=function(a){return"localhost"==a||"127.0.0.1"==a?!0:null===/^http[s]?:\/\/([^\/]+)\//.exec(a)||4096<=a.length?!1:!0}};CTATCurriculumService.prototype=Object.create(CTATBase.prototype);CTATCurriculumService.prototype.constructor=CTATCurriculumService;var CTATHTMLManager=function(){var a=null,b="";this.urldecode=function(a){return decodeURIComponent((a+"").replace(/\+/g,"%20"))};this.showEntities=function(){ctatdebug("showEntities ()");for(var b,f=0;f<a.length;f++)b=a[f],ctatdebug(b)};this.initEntities=function(){null==a&&(a=[],a["&amp;"]="*!*",a["&nbsp;"]="\u00a0",a["&iexcl;"]="\u00a1",a["&cent;"]="\u00a2",a["&pound;"]="\u00a3",a["&curren;"]="\u00a4",a["&yen;"]="\u00a5",a["&brvbar;"]="\u00a6",a["&sect;"]="\u00a7",a["&uml;"]="\u00a8",a["&copy;"]=
"\u00a9",a["&reg;"]="\u00ae",a["&deg;"]="\u00b0",a["&plusmn;"]="\u00b1",a["&sup1;"]="\u00b9",a["&sup2;"]="\u00b2",a["&sup3;"]="\u00b3",a["&acute;"]="\u00b4",a["&micro;"]="\u00b5",a["&frac14;"]="\u00bc",a["&frac12;"]="\u00bd",a["&frac34;"]="\u00be",a["&iquest;"]="\u00bf",a["&Agrave;"]="\u00c0",a["&Aacute;"]="\u00c1",a["&Acirc;"]="\u00c2",a["&Atilde;"]="\u00c3",a["&Auml;"]="\u00c4",a["&Aring;"]="\u00c5",a["&AElig;"]="\u00c6",a["&Ccedil;"]="\u00c7",a["&Egrave;"]="\u00c8",a["&Eacute;"]="\u00c9",a["&Ecirc;"]=
"\u00ca",a["&Euml;"]="\u00cb",a["&Igrave;"]="\u00cc",a["&Iacute;"]="\u00cd",a["&Icirc;"]="\u00ce",a["&Iuml;"]="\u00cf",a["&ETH;"]="\u00d0",a["&Ntilde;"]="\u00d1",a["&Ograve;"]="\u00d2",a["&Oacute;"]="\u00d3",a["&Ocirc;"]="\u00d4",a["&Otilde;"]="\u00d5",a["&Ouml;"]="\u00d6",a["&Oslash;"]="\u00d8",a["&Ugrave;"]="\u00d9",a["&Uacute;"]="\u00da",a["&Ucirc;"]="\u00db",a["&Uuml;"]="\u00dc",a["&Yacute;"]="\u00dd",a["&THORN;"]="\u00de",a["&szlig;"]="\u00df",a["&agrave;"]="\u00e0",a["&aacute;"]="\u00e1",a["&acirc;"]=
"\u00e2",a["&atilde;"]="\u00e3",a["&auml;"]="\u00e4",a["&aring;"]="\u00e5",a["&aelig;"]="\u00e6",a["&ccedil;"]="\u00e7",a["&egrave;"]="\u00e8",a["&eacute;"]="\u00e9",a["&ecirc;"]="\u00ea",a["&euml;"]="\u00eb",a["&igrave;"]="\u00ec",a["&iacute;"]="\u00ed",a["&icirc;"]="\u00ee",a["&iuml;"]="\u00ef",a["&eth;"]="\u00f0",a["&ntilde;"]="\u00f1",a["&ograve;"]="\u00f2",a["&oacute;"]="\u00f3",a["&ocirc;"]="\u00f4",a["&otilde;"]="\u00f5",a["&ouml;"]="\u00f6",a["&oslash;"]="\u00f8",a["&ugrave;"]="\u00f9",a["&uacute;"]=
"\u00fa",a["&ucirc;"]="\u00fb",a["&uuml;"]="\u00fc",a["&yacute;"]="\u00fd",a["&thorn;"]="\u00fe",a["&yuml;"]="\u00ff",a["&gt;"]=">",a["&lt;"]="<",a["&#61;"]="=",a["&361;"]="=",a["&quot;"]='"');ctatdebug("(singleQuoteEscape==true) Replacing &apos; with: \\'");a["&apos;"]="\\'"};this.entitiesConvert=function(a){ctatdebug("entitiesConvert ()");return this.urldecode(unescape(a))};this.entitiesGenerate=function(a){return b=a};this.htmlEncode=function(a){return a};this.htmlDecode=function(a){return"undefined"!==
typeof $?$("<div/>").html(a).text():"undefined"!==typeof Entities?(new Entities).decode(a):a}};"undefined"!==typeof module&&(module.exports=CTATHTMLManager);var CTATFlashVars=function(){CTATConfiguration.call(this,"CTATFlashVars","flashvars")};CTATFlashVars.prototype=Object.create(CTATConfiguration.prototype);CTATFlashVars.prototype.constructor=CTATFlashVars;var CTATLogMessageBuilder=function(){CTATBase.call(this,"CTATLogMessageBuilder","logmessagebuilder");var a=this,b=[],e=[];this.setContextName=function(a){CTATLogMessageBuilder.contextGUID=a};this.getContextName=function(){return CTATLogMessageBuilder.contextGUID};this.makeSessionElement=function(){var a=flashVars.getRawFlashVars();return void 0!=a.log_session_id&&null!=a.log_session_id?"<session_id>"+a.log_session_id+"</session_id>":"<session_id>"+a.session_id+"</session_id>"};this.createContextMessage=
function(b){a.ctatdebug("createContextMessage()");var d=new Date,c=flashVars.getRawFlashVars(),e='<context_message context_message_id="'+this.getContextName()+'" name="START_PROBLEM">';b||(e+=this.makeMetaElement(d));void 0!=c.class_name?""!=c.class_name?(b="<class>"+("<name>"+c.class_name+"</name>"),void 0!=c.school_name&&(b+="<school>"+c.school_name+"</school>"),void 0!=c.period_name&&(b+="<period>"+c.period_name+"</period>"),void 0!=c.class_description&&(b+="<description>"+c.class_description+
"</description>"),void 0!=c.instructor_name&&(b+="<instructor>"+c.instructor_name+"</instructor>"),b+="</class>"):b="<class />":b="<class />";e+=b;b=flashVars.getDatasetTypes();var f=flashVars.getDatasetNames();a.ctatdebug("Check: "+b.length+", "+f.length);if(null!=b&&null!=f){a.ctatdebug("We have valid data set names and types, adding to message ...");for(var d="<dataset>"+("<name>"+c.dataset_name+"</name>"),l=0;l<b.length;l++)a.ctatdebug("Adding ..."),d+='<level type="'+b[l]+'">',d+="<name>"+f[l]+
"</name>";d+="<problem ";a.ctatdebug('Checking vars ["problem_tutorflag"]: '+c.problem_tutorflag);a.ctatdebug('Checking vars ["problem_otherproblemflag"]: '+c.problem_otherproblemflag);if(void 0!=c.problem_tutorflag||void 0!=c.problem_otherproblemflag)void 0!=c.problem_tutorflag?d+=' tutorFlag="'+c.problem_tutorflag+'"':void 0!=c.problem_otherproblemflag&&(d+='tutorFlag="'+c.problem_otherproblemflag+'"');d=d+">"+("<name>"+c.problem_name+"</name>");d=void 0!=c.problem_context?d+("<context>"+c.problem_context+
"</context>"):d+"<context />";d+="</problem>";for(c=0;c<b.length;c++)d+="</level>";e+=d+"</dataset>"}c="";b=flashVars.getConditionNames();d=flashVars.getConditionTypes();f=flashVars.getConditionDescriptions();if(0<b.length)for(l=0;l<b.length;l++)c+="<condition><name>"+b[l]+"</name>",c+=""==d[l]?"":"<type>"+d[l]+"</type>",c+=""==f[l]?"":"<desc>"+f[l]+"</desc>",c+="</condition>";var e=e+c,c=flashVars.getCustomFields(),m;for(m in c)c.hasOwnProperty(m)&&(e+="<custom_field>",e+="<name>"+m+"</name>",e+=
"<value>"+c[m]+"</value>",e+="</custom_field>");e+="</context_message>";a.ctatdebug("messageString = "+e);return e};this.createSemanticEventToolMessage=function(f,d,c,g,h,l){a.ctatdebug("createSemanticEventToolMessage("+l+")");var m=new Date;flashVars.getRawFlashVars();var r='<tool_message context_message_id="'+this.getContextName()+'">';h||(r+=this.makeMetaElement(m));d='<semantic_event transaction_id="'+d+'" name="'+c+'"';""!=g&&(d+=' subtype="'+g+'"');void 0!=l&&""!=l&&(d+=' trigger="'+l+'"');
r+=d+"/>";g="<event_descriptor>";f=f.toXMLString(!0);r+=g+f+"</event_descriptor>";r+=this.createCustomFields(b,e);r+="</tool_message>";a.ctatdebug("messageString = "+r);return r};this.createUIEventToolMessage=function(f,d,c,g){a.ctatdebug("createUIEventToolMessage()");var h=new Date;flashVars.getRawFlashVars();var l='<tool_message context_message_id="'+this.getContextName()+'">';g||(l+=this.makeMetaElement(h));l+='<ui_event name="'+d+'">'+c+"</ui_event>";f="<event_descriptor>"+f.toSerializedString();
l=l+(f+"</event_descriptor>")+this.createCustomFields(b,e);l+="</tool_message>";a.ctatdebug("messageString = "+l);return l};this.createTutorMessage=function(f,d,c,g,h,l,m,r){a.ctatdebug("createTutorMessage()");var p=new Date;flashVars.getRawFlashVars();var x='<tutor_message context_message_id="'+this.getContextName()+'">';r||(x+=this.makeMetaElement(p));d='<semantic_event transaction_id="'+d+'" name="'+c+'"';""!==l&&(d+=' subtype="'+l+'"');x+=d+"/>";f="<event_descriptor>"+f.toXMLString(!0);x+=f+"</event_descriptor>";
f="<action_evaluation ";g.hasClassification()&&null!=g.getAttributeString()&&(f+=g.getAttributeString());f+=">"+g.getEvaluation()+"</action_evaluation>";x+=f;""!=h&&(x+="<tutor_advice>"+h+"</tutor_advice>");null!=m&&(a.ctatdebug("Adding skills to log message ..."),x+=m.toLogString());x+=this.createCustomFields(b,e);x+="</tutor_message>";a.ctatdebug("messageString = "+x);return x};this.createGenericMessage=function(b,d){a.ctatdebug("createGenericMessage()");flashVars.getRawFlashVars();var c='<message context_message_id="'+
this.getContextName()+'">',c=c+b+"</message>";a.ctatdebug("messageString = "+c);return c};this.makeMetaElement=function(b){a.ctatdebug("makeMetaElement ()");var d=flashVars.getRawFlashVars(),c;c="<meta>"+("<user_id>"+d.user_guid+"</user_id>");c+="<session_id>"+d.session_id+"</session_id>";c+="<time>"+this.formatTimeStamp(b)+"</time>";return c+="<time_zone>"+flashVars.getTimeZone()+"</time_zone></meta>"};this.wrapForOLI=function(b){a.ctatdebug("wrapForOLI ()");var d=new Date,c=flashVars.getRawFlashVars();
b=encodeURIComponent(b);var e;e='<?xml version="1.0" encoding="UTF-8"?><log_action '+('auth_token="'+encodeURIComponent(c.auth_token)+'" ');e=void 0!=c.log_session_id&&null!=c.session_id?e+('session_id="'+c.log_session_id+'" '):e+('session_id="'+c.session_id+'" ');e=e+'action_id="EVALUATE_QUESTION" '+('user_guid="'+c.user_guid+'" ');e+='date_time="'+this.formatTimeStampOLI(d)+'" ';e+='timezone="'+flashVars.getTimeZone()+'" ';e+='source_id="'+c.source_id+'" ';e=c.activity_context_guid?e+('external_object_id="'+
c.activity_context_guid+'" info_type="tutor_message.dtd">'):e+'external_object_id="" info_type="tutor_message.dtd">';return e+b+"</log_action>"};this.createLogSessionStart=function(){a.ctatdebug("createLogSessionStart ()");var b=new Date;a.ctatdebug("Date: "+b);var d='<log_session_start timezone="'+flashVars.getTimeZone()+'" ',c=flashVars.getRawFlashVars(),d=d+('date_time="'+this.formatTimeStampOLI(b)+'" '),d=d+('auth_token="'+c.auth_token+'" '),d=d+('session_id="'+c.session_id+'" '),d=d+('user_guid="'+
c.user_guid+'" ');return d+'class_id="" treatment_id="" assignment_id="" info_type="tutor_message.dtd"/>'};this.formatTimeStamp=function(b){a.ctatdebug("formatTimeStamp ("+b+")");var d="",c=b.getUTCFullYear(),d=d+(c+"-"),c=b.getUTCMonth();c++;d+=(10>c?"0"+c:c)+"-";c=b.getUTCDate();d+=(10>c?"0"+c:c)+" ";c=b.getUTCHours();d+=(10>c?"0"+c:c)+":";c=b.getUTCMinutes();d+=(10>c?"0"+c:c)+":";c=b.getUTCSeconds();d+=10>c?"0"+c:c;b=b.getUTCMilliseconds();return d+"."+b};this.formatTimeStampOLI=function(b){a.ctatdebug("formatTimeStampOLI ("+
b+")");var d="",c=b.getUTCFullYear(),d=d+(c+"/"),c=b.getUTCMonth();c++;d+=(10>c?"0"+c:c)+"/";c=b.getUTCDate();d+=(10>c?"0"+c:c)+" ";c=b.getUTCHours();d+=(10>c?"0"+c:c)+":";c=b.getUTCMinutes();d+=(10>c?"0"+c:c)+":";c=b.getUTCSeconds();d+=10>c?"0"+c:c;b=b.getUTCMilliseconds();return d+"."+b};this.resetCustomFields=function(){a.ctatdebug("resetCustomFields ()");b=[];e=[]};this.createCustomFields=function(b,d){a.ctatdebug("createCustomFields ()");if(null==b||null==d)return a.ctatdebug("No custom fields provided"),
"";a.ctatdebug("Processing "+b.length+" custom fields ...");for(var c="",e=0;e<b.length;e++)a.ctatdebug("Adding custom field: ["+b[e]+"],["+d[e]+"]"),c+="<custom_field>",c+="<name>"+b[e]+"</name>",c+="<value>"+d[e]+"</value>",c+="</custom_field>";return c};this.addCustomFields=function(f,d){a.ctatdebug("addCustomFields ()");if(void 0!=f)for(var c=0;c<f.length;c++)b.push(f[c]),e.push(d[c])};this.addCustomField=function(f,d){a.ctatdebug("addCustomfield ("+f+","+d+")");b.push(f);e.push(d)};this.getCustomFieldNames=
function(){return b};this.getCustomFieldValues=function(){return e}};CTATLogMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATLogMessageBuilder.prototype.constructor=CTATLogMessageBuilder;CTATLogMessageBuilder.contextGUID="";CTATLogMessageBuilder.commLogMessageBuilder=null;var CTATCustomLogElementObject=function(){this.reset=function(){};this.addCustomLogElement=function(a,b){customElementsNames.push(a);customElementsTypes.push(a)};this.getCustomElementNames=function(){return customElementsNames};this.getCustomElementTypes=function(){return customElementsTypes}};var loggingDisabled=!1,CTATLoggingLibrary=function(a){CTATBase.call(this,"CTATLoggingLibrary","logginglibrary");var b=this,e=!0,f=!1,d=!1,c=[],g="undefined",h="undefined",l="undefined",m="undefined",r="undefined",p="undefined",x="undefined",q="undefined",u="UnassignedDataset",n="UnassignedLevelName",B="UnassignedLevelType",v=null,z=null,q=CTATGuid.guid();void 0!=a&&null!=a?(f=a,0==f&&(CTATLogMessageBuilder.commLogMessageBuilder=new CTATLogMessageBuilder)):CTATLogMessageBuilder.commLogMessageBuilder=
new CTATLogMessageBuilder;var A=new CTATCommLibrary;A.setName("commLoggingLibrary");A.setUseCommSettings(!1);A.setConnectionRefusedMessage("ERROR_CONN_LS");A.assignHandler(this);this.getLastSAI=function(){return z};this.assignLogListener=function(a){v=a};this.generateSession=function(){c.session_id="ctat_session_"+CTATGuid.guid();return c.session_id};this.setLogClassName=function(a){g=a};this.setDatasetName=function(a){u=a};this.setDatasetLevelName=function(a){n=a};this.setDatasetLevelType=function(a){B=
a};this.setSchool=function(a){h=a};this.setPeriod=function(a){l=a};this.setDescription=function(a){m=a};this.setInstructor=function(a){r=a};this.setProblemName=function(a){p=a};this.setProblemContext=function(a){x=a};this.setUserID=function(a){q=a};this.getLoggingCommLibrary=function(){return A};this.setUseSessionLog=function(a){e=a};this.setLoggingURL=function(a){b.getLoggingCommLibrary().setFixedURL(a)};this.getSessionIdentifierBundle=function(){var a=[];a.class_name=g;a.school_name=h;a.period_name=
l;a.class_description=m;a.instructor_name=r;a.dataset_name=u;a.problem_name=p;a.problem_context=x;a.auth_token="";a.user_guid=q;a.session_id=c.session_id;a.source_id="tutor";a.dataset_level_name1=n;a.dataset_level_type1=B;return a};this.setupExternalLibraryUsage=function(){b.ctatdebug("setupExternalLibraryUsage ()");c.class_name=g;c.school_name=h;c.period_name=l;c.class_description=m;c.instructor_name=r;c.dataset_name=u;c.problem_name=p;c.problem_context=x;c.auth_token="";c.user_guid=q;c.session_id=
"ctat_session_"+CTATGuid.guid();c.source_id="tutor";c.dataset_level_name1=n;c.dataset_level_type1=B;flashVars=new CTATFlashVars;flashVars.assignRawFlashVars(c)};this.initCheck=function(){b.ctatdebug("initCheck ()");0==f&&0==d&&(b.setupExternalLibraryUsage(),d=!0)};this.sendMessage=function(a){b.ctatdebug("sendMessage ()");b.ctatdebug("Raw log message to send: "+a);this.sendMessageInternal(a);null!=v&&v(a)};this.sendMessageInternal=function(a){b.ctatdebug("sendMessageInternal ()");if(!0===loggingDisabled)b.ctatdebug("Warning: loggingDisabled==true");
else if(1==f){var c=CTATConfiguration.get("Logging");if("ClientToService"!=c&&"ClientToLogServer"!=c)b.ctatdebug("Logging is turned off, as per: "+c);else{var d=CTATConfiguration.get("tutoring_service_communication");"ClientToService"!=c||"http"!=d&&"https"!=d||(c=CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),b.setLoggingURL(c),b.ctatdebug("Reconfigured the logging url to be: "+c));b.ctatdebug("Pre encoded log message: "+a);0>a.indexOf("<log_session_start")&&
(a=CTATLogMessageBuilder.commLogMessageBuilder.wrapForOLI('<?xml version="1.0" encoding="UTF-8"?><tutor_related_message_sequence version_number="4">'+a+"</tutor_related_message_sequence>"));b.ctatdebug("Encoded log message: "+a);CTATLMS.logEvent(a);CTATConfiguration.get("log_service_url")&&A.sendXMLNoBundle(a)}}else b.ctatdebug("Use internal: "+f)};this.startProblem=function(){b.ctatdebug("startProblem ()");b.initCheck();b.logSessionStart();b.sendMessage(CTATLogMessageBuilder.commLogMessageBuilder.createContextMessage(!0))};
this.logSessionStart=function(){b.ctatdebug("logSessionStart ()");b.initCheck();var a=flashVars.getRawFlashVars();void 0!=a.SessionLog&&("false"==a.SessionLog||"boolean"==typeof a.SessionLog&&!1===a.SessionLog?(b.ctatdebug("Turning SessionLog off ..."),e=!1):(b.ctatdebug("Turning SessionLog on ..."),e=!0));!0===e&&this.sendMessage(CTATLogMessageBuilder.commLogMessageBuilder.createLogSessionStart())};this.logSemanticEvent=function(a,c,d,e,g,h,f){b.ctatdebug("logSemanticEvent ("+f+")");b.initCheck();
z=c;var l=new Date;CTATLogMessageBuilder.commLogMessageBuilder.resetCustomFields();CTATLogMessageBuilder.commLogMessageBuilder.addCustomFields(g,h);CTATLogMessageBuilder.commLogMessageBuilder.addCustomField("tool_event_time",CTATLogMessageBuilder.commLogMessageBuilder.formatTimeStamp(l)+" UTC");a=CTATLogMessageBuilder.commLogMessageBuilder.createSemanticEventToolMessage(c,a,d,e,!0,f);this.sendMessage(a)};this.logTutorResponse=function(a,c,d,e,g,h,f,l,n){b.ctatdebug("logTutorResponse ()");b.initCheck();
z=c;var u=new Date;CTATLogMessageBuilder.commLogMessageBuilder.resetCustomFields();CTATLogMessageBuilder.commLogMessageBuilder.addCustomFields(l,n);CTATLogMessageBuilder.commLogMessageBuilder.addCustomField("tutor_event_time",CTATLogMessageBuilder.commLogMessageBuilder.formatTimeStamp(u)+" UTC");b.ctatdebug("Formatting feedback ...");void 0!=h&&null!=h?h="<![CDATA["+CTATGlobals.languageManager.filterString(h)+"]]\x3e":(b.ctatdebug("No feedback provided, using empty string"),h="");b.ctatdebug("Creating tutor message ...");
a=CTATLogMessageBuilder.commLogMessageBuilder.createTutorMessage(c,a,d,g,h,e,f,!0);this.sendMessage(a)};this.processMessage=function(a){b.ctatdebug("processMessage ()");b.ctatdebug("Response from log server: "+a)};this.start=function(){b.ctatdebug("start ()");var a=b.generateSession();b.startProblem();return a};this.logInterfaceAttempt=function(a,c,d,e){b.ctatdebug("logInterfaceAttempt ()");e=CTATGuid.guid();a=new CTATSAI(a,c,d);a.setInput(d);z=a;this.logSemanticEvent(e,a,"ATTEMPT","");return e};
this.logInterfaceAttemptSAI=function(a,c){b.ctatdebug("logInterfaceAttemptSAI ()");z=a;var d=CTATGuid.guid();this.logSemanticEvent(d,a,"ATTEMPT","");return d};this.logResponse=function(a,c,d,e,g,h,f,l){b.ctatdebug("logResponse ()");c=new CTATSAI(c,d,e);c.setInput(e);e=new CTATActionEvaluationData("");e.setEvaluation(h);void 0==l?this.logTutorResponse(a,c,g,"",e,f):this.logTutorResponse(a,c,g,"",e,f,null,l.getCustomElementNames(),l.getCustomElementTypes())};this.logResponseSAI=function(a,c,d,e,g,h){b.ctatdebug("logResponse ()");
var f=new CTATActionEvaluationData("");f.setEvaluation(e);void 0==h?this.logTutorResponse(a,c,d,"",f,g):this.logTutorResponse(a,c,d,"",f,g,null,h.getCustomElementNames(),h.getCustomElementTypes())};this.endSession=function(){this.generateSession()}};CTATLoggingLibrary.prototype=Object.create(CTATBase.prototype);CTATLoggingLibrary.prototype.constructor=CTATLoggingLibrary;var CTATArgument=function(){var a="",b="Undefined",e="String",f="text";this.setValue=function(a){b=a};this.getValue=function(){return b};this.setName=function(b){a=b};this.getName=function(){return a};this.setType=function(a){e=a};this.getType=function(){return e};this.setFormat=function(a){f=a};this.getFormat=function(){return f}};CTATArgument.prototype.clone=function(){var a=new CTATArgument;a.setValue(this.getValue());a.setType(this.getType());a.setFormat(this.getFormat());return a};
"undefined"!==typeof module&&(module.exports=CTATArgument);var CTATStringUtil=function(){this.String2Boolean=function(a){switch(a){case "0":case "false":case "no":case "FALSE":case "NO":case "No":return!1}return!0};this.replaceString=function(a,b,e){return a.replace(b,e)}};"undefined"!==typeof module&&(module.exports=CTATStringUtil);var CTATSAI=function(a,b,e,f){CTATBase.call(this,"CTATSAI","sai");var d=new CTATStringUtil,c="undefined",g=[],h=[],l=[],m=[],r=null,p=this,r="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.getArguments=function(){return l};this.getArgument=function(a){if(0==l.length){var b=new CTATArgument;l.push(b)}return l[a]};this.getArgumentsTyped=function(){p.ctatdebug("getArgumentsTyped");var a,b=[];for(a=0;a<l.length;a++){var c=l[a];"Boolean"===c.getType()?(p.ctatdebug("Adding Boolean argument ("+
c.getValue()+") ..."),b.push(d.String2Boolean(c.getValue()))):"Number"===c.getType()?(p.ctatdebug("Adding Number argument ("+c.getValue()+") ..."),b.push(Number(c.getValue()))):"String"===c.getType()?"No_Value"===c.getValue()?(p.ctatdebug("Detected default argument ("+c.getValue()+"), setting contents to null instead"),b.push(null)):b.push(String(c.getValue())):p.ctatdebug("Unrecognized argument type: "+c.getType()+" in "+p.toSerializedString()+" IGNORING IT!!!")}p.ctatdebug("Resulting arguments: "+
b);return b};this.addSelection=function(a,b){var c=new CTATArgument;c.setValue(a);void 0!=b&&null!=b&&c.setType(b);g.push(c)};this.addAction=function(a){h.push(a)};this.checkDefaultArgument=function(){p.ctatdebug("checkDefaultArgument ()");if(0===l.length){p.ctatdebug("Adding default argument ...");var a=new CTATArgument;l.push(a)}};this.setArgument=function(a,b){p.checkDefaultArgument();for(var c=l.length;c<=a;++c)l.push(new CTATArgument);c=l[a];c.setValue(b);return c};this.addArgument=function(a,
b,c){this.ctatdebug("addArgument ("+a+","+b+","+c+")");var d=new CTATArgument;d.setValue(a);d.setType(b);d.setFormat(c);l.push(d);return d};this.addExistingArgument=function(a){l.push(a);return a};this.setSAI=function(a,b,d,e,g){p.setSelection(Array.isArray(a)?0<a.length?a[0]:"":a);p.setAction(Array.isArray(b)?0<b.length?b[0]:"":b);p.setInput(Array.isArray(d)?0<d.length?d[0]:"":d);p.setType(e);c=g};this.setInput=function(a){p.ctatdebug("setInput("+a+")");p.checkDefaultArgument();p.getArgument(0).setValue(a)};
this.getInputObject=function(){return 0===l.length?null:l[0]};this.getInput=function(){return 0===l.length?"":p.getArgument(0).getValue()};this.setType=function(a){p.checkDefaultArgument();p.getArgument(0).type=a};this.getType=function(){return 0===l.length?"":p.getArgument(0).type};this.setFormat=function(a){p.checkDefaultArgument();p.getArgument(0).setFormat(a)};this.getFormat=function(){return 0===l.length?"":p.getArgument(0).getFormat()};this.toString=function(){return"["+String(p.getSelection())+
","+String(p.getAction())+","+String(p.getInput())+"]"};this.setSelection=function(a,b){var c=p.getSelectionObject();null==c?(c=new CTATArgument,c.setValue(a),void 0!=b&&null!=b&&c.setType(b),g.push(c)):c.setValue(a)};this.getSelectionObject=function(){return 0==g.length?null:g[0]};this.getSelection=function(){if(0==g.length)return null;var a=g[0];return"object"===typeof a?a.getValue():a};this.setAction=function(a){0<h.length?h[0]=a:h.push(a)};this.getAction=function(){return 0==h.length?null:h[0]};
this.appendToSelectionArray=function(a,b){var c=new CTATArgument;c.setValue(String(a));void 0!=b&&null!=b&&c.setType(b);g.push(c)};this.setSelectionArray=function(a){g=[];for(var b=0;b<a.length;b++)p.appendToSelectionArray(a[b],"String")};this.getSelectionArray=function(){for(var a=[],b=0;b<g.length;b++){var c=g[b];"object"===typeof c?a.push(g[b].getValue()):a.push(c)}return a};this.appendToActionArray=function(a){null==a?h.push(""):h.push(String(a))};this.setActionArray=function(a){h=null==a?[]:
Array.isArray(a)?a.slice():[String(a)]};this.getActionArray=function(){return h};this.appendToInputArray=function(a){p.ctatdebug("appendToInputArray ("+a+")");null==a?p.addArgument("","String","text"):p.addArgument(a,"String","text")};this.setInputArray=function(a){l=[];if(null!=a)for(var b=0;b<a.length;b++)p.appendToInputArray(a[b])};this.getInputArray=function(){p.ctatdebug("getInputArray ("+l.length+")");m=[];for(var a=0;a<l.length;a++){var b=l[a];"object"===typeof b?(p.ctatdebug("Adding object value ("+
b.getValue()+") to temp input array"),m.push(b.getValue())):(p.ctatdebug("Adding string value ("+b+") to temp input array"),m.push(b))}return m};this.setPrompt=function(a){c=a};this.getPrompt=function(){return c};this.propagate=function(a){p.ctatdebug("propagate ()");a=a.getArguments();for(var b=0;b<a.length;b++){var c=a[b],d=l[b];if(null===c||null===d){p.ctatdebug("Internal error: argument lists do not align between received SAI and source SAI");break}d.setValue(c.getValue())}};this.fromString=function(a){a=
r.parse(a);p.fromXML(a)};this.fromXML=function(a){p.ctatdebug("fromXML ()");l=[];a=r.getElementChildren(a);for(var b,c=0;c<a.length;c++){var d=a[c];if("selection"==r.getElementName(d)||"Selection"==r.getElementName(d)){for(var e=r.getElementChildren(d),g=!1,h=0;h<e.length;h++)b=e[h],"value"==r.getElementName(b)&&(b=r.getNodeTextValue(b),1>h?p.setSelectionArray(b):p.appendToSelectionArray(b),g=!0,p.setSelection(b));!1===g&&(b=r.getNodeTextValue(d),p.setSelectionArray(b),p.setSelection(b))}if("action"==
r.getElementName(d)||"Action"==r.getElementName(d)){e=r.getElementChildren(d);g=!1;for(h=0;h<e.length;h++)b=e[h],"value"==r.getElementName(b)&&(b=r.getNodeTextValue(b),1>h?p.setActionArray(b):p.appendToActionArray(b),g=!0,p.setAction(b));!1===g&&(b=r.getNodeTextValue(d),p.setActionArray(b),p.setAction(b))}if("inputArray"==r.getElementName(d)||"value"==r.getElementName(d)||"Input"==r.getElementName(d)){b=r.getElementChildren(d);var f;l=[];e=new CTATHTMLManager;g=new CTATArgument;h=0;l.push(g);for(var m=
0;m<b.length;m++){var q=b[m];"value"==r.getElementName(q)&&(f=r.getElementChildren(q),null!==f?(p.ctatdebug("Parsing SAI input ..."),p.ctatdebug("Childnodes: "+f.length),1===f.length?(f=e.htmlDecode(r.getNodeTextValue(q)),p.ctatdebug("Setting new value to: "+f),g.setValue(f)):(f=e.htmlDecode(r.getNodeTextValue(q)),p.ctatdebug("Setting new value to: "+f),g.setValue(f),g.setName(q.attributes.getNamedItem("name").value),g.setType(q.attributes.getNamedItem("type").value),g.setFormat(q.attributes.getNamedItem("format").value),
h++),1>m?p.setInputArray(f):p.appendToInputArray(f)):(q=e.htmlDecode(r.getNodeTextValue(q)),p.ctatdebug("Setting new value to: "+q),g.setValue(q),1>m?p.setInputArray(q):p.appendToInputArray(q)))}}if("prompt"==r.getElementName(d)||"Prompt"==r.getElementName(d))p.ctatdebug("Parsing prompt ..."),p.setPrompt(r.getNodeTextValue(d))}p.checkDefaultArgument()};this.appendFromElement=function u(a,b,c,d,e){p.ctatdebug("appendFromElement ()");d=String(r.getElementName(b)).toLowerCase();if(d==a||"value"==d)if(d=
r.getElementChildren(b),!Array.isArray(d)||1>d.length)0==e?c.push(r.getNodeTextValue(b)):p.appendToInputArray(r.getNodeTextValue(b));else for(b=0;b<d.length;++b)u(a,d[b],c,b,e)};this.setArrayFromElements=function(a){p.ctatdebug("setArrayFromElements ()");if(!a||!Array.isArray(a)||1>a.length)p.ctatdebug("can't get name: don't know whether selection, action or input");else{var b,c=String(r.getElementName(a[0])).toLowerCase();switch(c){case "selection":p.ctatdebug("Processing selection field ...");g=
[];for(b=0;b<a.length;++b)p.appendFromElement(c,a[b],g,b,!1);break;case "action":p.ctatdebug("Processing action field ...");h=[];for(b=0;b<a.length;++b)p.appendFromElement(c,a[b],h,b,!1);break;case "input":p.ctatdebug("Processing input field ...");l=[];for(b=0;b<a.length;++b)p.appendFromElement(c,a[b],l,b,!0);break;default:console.log('CTATSAI.setArrayFromElements(): unexpected element name "'+c+'"');return}p.ctatdebug("CTATSAI.setArrayFromElements() eltName "+c+", length "+b+", selectionArray "+
p.getSelectionArray()+", actionArray "+p.getActionArray()+", inputArray "+p.getInputArray())}};this.fromXMLInternal=function(a){p.ctatdebug("fromXMLInternal ()");new CTATXML;l=[];a=r.getElementChildren(a);for(var b,c=0;c<a.length;c++){var d=a[c];if("selection"==r.getElementName(d)||"Selection"==r.getElementName(d)){for(var e=r.getElementChildren(d),g=!1,h=0;h<e.length;h++)b=e[h],"value"==r.getElementName(b)&&(b=r.getNodeTextValue(b),1>h?p.setSelectionArray(b):p.appendToSelectionArray(b),g=!0,p.setSelection(b));
!1===g&&(b=r.getNodeTextValue(d),p.setSelectionArray(b),p.setSelection(b))}if("action"==r.getElementName(d)||"Action"==r.getElementName(d)){e=d.childNodes;g=!1;for(h=0;h<e.length;h++)b=e[h],"value"==r.getElementName(b)&&(b=r.getNodeTextValue(b),1>h?p.setActionArray(b):p.appendToActionArray(b),g=!0,p.setAction(b));!1===g&&(b=r.getNodeTextValue(d),p.setActionArray(b),p.setAction(b))}if("inputArray"==r.getElementName(d)||"Input"==r.getElementName(d)){b=d.childNodes;l=[];var e=new CTATHTMLManager,g=new CTATArgument,
h=0,f;l.push(g);for(var m=0;m<b.length;m++)if(f=b[m],"value"==r.getElementName(f)){var u=r.getElementChildren(f);null!==u?(p.ctatdebug("Parsing SAI input ..."),p.ctatdebug("Childnodes: "+u.length),1===u.length?(f=e.htmlDecode(r.getNodeTextValue(f)),p.ctatdebug("Setting new value to: "+f),g.setValue(f)):(f=e.htmlDecode(r.getNodeTextValue(f)),p.ctatdebug("Setting new value to: "+f),g.setValue(f),g.setName(r.getElementAttr("name")),g.setType(r.getElementAttr("type")),g.setFormat(r.getElementAttr("format")),
h++)):(f=e.htmlDecode(r.getNodeTextValue(f)),p.ctatdebug("Setting new value to: "+f),g.setValue(f));1>m?p.setInputArray(f):p.appendToInputArray(f)}}if("prompt"==r.getElementName(d)||"Prompt"==r.getElementName(d))p.ctatdebug("Parsing prompt ..."),p.setPrompt(r.getNodeTextValue(d))}p.checkDefaultArgument()};this.toXMLString=function(a){p.ctatdebug("toXMLString ()");return a?p.toLSxmlString():p.toTSxmlString()};this.toLSxmlString=function(){p.ctatdebug("toLSxmlString ()");for(var a="",b=0;b<g.length;b++){var c=
g[b];"object"===typeof c?(a="String"!=c.getType()?a+('<selection type="'+c.getType()+'">'):a+"<selection>",a+=c.getValue()+"</selection>"):a+="<selection>"+c+"</selection>"}a+="<action>"+p.getAction();for(b=1;b<h.length;b++)a+="</action><action>"+h[b];a+="</action>";for(b=0;b<l.length;b++)c=l[b],a="object"===typeof c?"String"!=c.getType()?a+('<input type="'+c.getType()+'"><![CDATA['+c.getValue()+"]]\x3e</input>"):a+("<input><![CDATA["+c.getValue()+"]]\x3e</input>"):a+("<input><![CDATA["+c+"]]\x3e</input>");
return a};this.toTSxmlString=function(){p.ctatdebug("toTSxmlString ()");var a;a="<Selection><value>"+p.getSelection();for(var b=1;b<g.length;b++){var c=g[b];a="object"===typeof c?a+("</value><value>"+c.getValue()):a+("</value><value>"+c)}a+="</value></Selection><Action><value>"+p.getAction();for(b=1;b<h.length;b++)a+="</value><value>"+h[b];a+="</value></Action><Input>";if(1<l.length)for(b=0;b<l.length;b++)c=l[b],a+='<value fmt="text" name="'+c.getName()+'" type="'+c.getType()+'"><![CDATA['+c.getValue()+
"]]\x3e</value>";else a+="<value><![CDATA["+p.getInput()+"]]\x3e</value>";return a+"</Input>"};this.toSerializedString=function(){var a;a=""+("<selection>"+p.getSelection()+"</selection><action>"+p.getAction()+"</action><inputArray>");for(var b=0;b<l.length;b++){var c=l[b];a+='<value fmt="text" name="'+c.getName()+'" type="'+c.getType()+'">'+c.getValue()+"</value>"}return a+"</inputArray>"};this.clone=function(){p.ctatdebug("clone ()");for(var a=new CTATSAI(p.getSelection(),p.getAction(),p.getInput(),
p.getPrompt()),b=0;b<p.getArguments().length;++b)a.setArgument(b,p.getArgument(b).clone());a.setSelectionArray(p.getSelectionArray().slice());a.setActionArray(p.getActionArray().slice());a.setInputArray(p.getInputArray().slice());p.ctatdebug("CTATSAI.clone() this "+p+", clone "+a+", clone inputArray "+a.getInputArray());return a};this.isDone=function(){var a=p.getSelection(),b=p.getAction();return null==a||null==b?!1:"done"==a.toString().toLowerCase()&&"buttonpressed"==b.toString().toLowerCase()};
var x=!1;if(Array.isArray(a)&&Array.isArray(b)&&(Array.isArray(e)||null==e)&&(p.setSelectionArray(a),p.setActionArray(b),p.setInputArray(e),x=!0,0<a.length&&0<b.length)){p.setSAI(a[0],b[0],null==e?null:e[0],"String",f);return}null!==a&&""!==a&&p.setSelection(a);null!==a&&(p.setSAI(a,b,e,"String",f),x||(p.setSelectionArray(Array.isArray(a)?a:[a]),p.setActionArray(Array.isArray(b)?b:[b]),p.setInputArray(Array.isArray(e)?e:[e]),x=!0))};CTATSAI.prototype=Object.create(CTATBase.prototype);
CTATSAI.prototype.constructor=CTATSAI;"undefined"!==typeof module&&(module.exports=CTATSAI);var CTATSkill=function(){CTATBase.call(this,"CTATSkill","skill");var a="",b="",e="",f="",d=0,c="",g=!1,h="",l="",m="",r="",p="";this.setSkillName=function(b){a=b};this.setDisplayName=function(a){b=a};this.setModelName=function(a){f=a};this.setCategory=function(a){e=a};this.setLevel=function(a){!0===isNaN(a)?ctatdebug("Error: attempting to set a level to NaN"):(d=a,this.setPKnown(String(d)))};this.setDescription=function(a){c=a};this.getSkillName=function(){return a};this.getDisplayName=function(){return b};
this.hasDisplayName=function(){return""!==b&&null!==b};this.getModelName=function(){return f};this.hasCategory=function(){return""!==e};this.hasModelName=function(){return""!==f};this.getCategory=function(){return e};this.getLevel=function(){return d};this.getDescription=function(){return c};this.setTouched=function(a){g=a};this.getTouched=function(){return g};this.toXMLString=function(){return""};this.toSetPreferencesXMLString=function(){var d='<skill label="'+b+'" pSlip="'+l+'" description="'+c;
return d+='" pKnown="'+m+'" category="'+e+'" pLearn="'+r+'" name="'+a+'" pGuess="'+h+'" history="'+p+'" />'};this.setPGuess=function(a){h=a};this.getPGuess=function(){return h};this.setPSlip=function(a){l=a};this.getPSlip=function(){return l};this.setPLearn=function(a){r=a};this.getPLearn=function(){return r};this.setPKnown=function(a){m=a};this.getPKnown=function(){return m};this.setSkillHistory=function(a){p=a};this.getSkillHistory=function(){return p}};CTATSkill.prototype=Object.create(CTATBase.prototype);
CTATSkill.prototype.constructor=CTATSkill;var CTATSkillSet=function(){CTATBase.call(this,"CTATSkillSet","skills");this.internalSkillSet=[];var a=this;this.fromXMLString=function(a){this.ctatdebug("fromXMLString ()");this.ctatdebug("Skills string: "+a);if(null===a)this.ctatdebug("Warning: skill object is null");else if(""===a)this.ctatdebug("Info: empty skill string provided, bump");else if(a){this.ctatdebug("CTATSkillSet.fromXMLString() Raw:     "+a);a=decodeURIComponent(a.replace(/\+/g," "));this.ctatdebug("CTATSkillSet.fromXMLString() Decoded: "+
a);if(null!==/\/<value>.+<\/value>/.exec(a))this.parseByValue(a);else{var b=(new CTATXML).parseXML(a);this.parseByAttributes(b,a)}this.ctatdebug("fromXMLString () done")}else this.ctatdebug("Warning: skill object is undefined or otherwise empty.")};this.fromXMLData=function(a,e){this.ctatdebug("fromXMLData ()");null!==/\/<value>.+<\/value>/.exec(e)?this.parseByValue(e):this.parseByAttributes(a);this.ctatdebug("fromXMLData () done")};this.parseByValue=function(b){this.ctatdebug("parseByValue()");if(b){b=
b.childNodes;for(var e=new CTATXML,f=0;f<b.length;f++){var d=e.getNodeTextValue(b[f]).split("`"),c=d[0].split(" ");4==d.length?this.addSkill(c[0],d[1],d[2],d[3],d[3],c[1]):this.addSkill(c[0],d[1],d[2],d[3],d[4],c[1])}}else a.ctatdebug("Error: aSkills is null")};this.parseDOM=function(a){this.ctatdebug("parseDOM()");var b=new CTATXML;a=b.getElementChildren(a);for(var f=0;f<a.length;f++){var d=b.getNodeTextValue(a[f]).split("`"),c=d[0].split(" ");4==d.length?this.addSkill(c[0],d[1],d[2],d[3],d[3],c[1]):
this.addSkill(c[0],d[1],d[2],d[3],d[4],c[1])}};this.parseByAttributes=function(b){this.ctatdebug("parseByAttributes()");if(b)if(b=b.childNodes)for(var e=0;e<b.length;e++){var f=b[e];if("Skill"==f.nodeName||"skill"==f.nodeName){this.ctatdebug("Parsing node ("+e+"): "+f.nodeName+" -> "+f.nodeValue);var d=f.attributes.getNamedItem("name");if(d=d?d.value:""){var c=f.attributes.getNamedItem("pKnown"),c=c?c.value:"",g=f.attributes.getNamedItem("description"),g=g?g.value:"",h=f.attributes.getNamedItem("label"),
h=h?h.value:"",l=f.attributes.getNamedItem("category"),l=l?l.value:"",m=f.attributes.getNamedItem("pGuess"),m=m?m.value:"",r=f.attributes.getNamedItem("pLearn"),r=r?r.value:"",p=f.attributes.getNamedItem("pSlip"),p=p?p.value:"",f=(f=f.attributes.getNamedItem("history"))?f.value:"";this.addSkill(d,c,.95,g,h,l,m,r,p,f)}}}else this.ctatdebug("Error: list of skill xml elements is null");else a.ctatdebug("Error: aSkills is null")};this.getSkillSet=function(){return this.internalSkillSet};this.getSize=
function(){return this.internalSkillSet.length};this.addSkill=function(a,e,f,d,c,g,h,l,m,r){this.ctatdebug("addSkill() name = "+a+" level = "+e+" mastery = "+f+" aDescription = "+d+" adisplayName = "+c+" aCategory = "+g+" pguess= "+h+" plearn = "+l+" pslip = "+m+" history = "+r);a=this.setSkillLevel(a,e,f);this.ctatdebug("Configuring "+a.getDisplayName());d&&a.setDescription(d);c&&a.setDisplayName(c);g&&a.setCategory(g);""!==h&&(a.setPGuess(h),a.setPLearn(l),a.setPSlip(m));""!==r&&a.setSkillHistory(r);
return a};this.setSkillLevel=function(a,e,f){this.ctatdebug("setSkillLevel ("+a+","+e+","+f+")");f=this.getSkill(a);null===f?(this.ctatdebug("Skill not found, creating new one ..."),f=new CTATSkill,f.setSkillName(a),f.setLevel(e),this.internalSkillSet.push(f)):(this.ctatdebug("Skill found, adjusting ..."),f.setLevel(1),f.setLevel(e));f.setTouched(!0);return f};this.getSkill=function(a){this.ctatdebug("getSkill ("+a+") -> "+this.internalSkillSet.length);if(!a)return null;for(var b=0;b<this.internalSkillSet.length;b++){var f=
this.internalSkillSet[b];if(f.getSkillName()==a)return this.ctatdebug("Returning: "+b),f}return null};this.getSkillLevel=function(a){if(!a)return-1;for(var b in this.internalSkillSet)if(b.getSkillName()==a)return b.getLevel();return-1};this.getTouched=function(){this.ctatdebug("getTouched ()");for(var a=[],e=0;e<this.internalSkillSet.length;e++){var f=this.internalSkillSet[e];!0===f.getTouched()&&(this.ctatdebug("Adding touched skill: "+f.getSkillName()),a.push(f))}return a};this.untouchSkills=function(){this.ctatdebug("untouchSkills ()");
for(var a=0;a<this.internalSkillSet.length;a++)this.internalSkillSet[a].setTouched(!1)};this.toSetPreferencesXMLString=function(){this.ctatdebug("toSetPreferencesXMLString ()");for(var a="<skills>",e=0;e<this.internalSkillSet.length;e++)a+=this.internalSkillSet[e].toSetPreferencesXMLString();return a+"</skills>"};this.toLogString=function(){this.ctatdebug("toLogString ("+this.internalSkillSet.length+")");for(var a="",e=0;e<this.internalSkillSet.length;e++){var f=this.internalSkillSet[e],a=a+('<skill probability="'+
f.getLevel()+'"><name>'+f.getSkillName()+"</name>");f.hasCategory()&&(a+="<category>"+f.getCategory()+"</category>");f.hasModelName()&&(a+="<model_name>"+f.getModelName()+"</model_name>");a+="</skill>"}return a}};CTATSkillSet.prototype=Object.create(CTATBase.prototype);CTATSkillSet.prototype.constructor=CTATSkillSet;CTATSkillSet.skills=null;"undefined"!==typeof module&&(module.exports=CTATSkillSet);function CTATJSONObject(a,b){this.name=a||"";this.value=b||null}
var transformArray=[],CTATJSON=function(){CTATBase.call(this,"CTATJSON","json");var a=null,b=0;this.isJSONObject=function(a){return a.ctat?!0:!1};this.parse=function(a){return this.parseJSON(a)};this.parseJSON=function(b){this.ctatdebug("parseJSON ()");a=null;if("string"==typeof b){this.ctatdebug("Parsing JSON as a string ... ");try{a=JSON.parse(b)}catch(d){return this.ctatdebug("Error parsing JSON message: "+d.message),a=null}this.ctatdebug("Successfully parsed JSON string")}this.ctatdebug("JSON string has already been parsed, assigning as an object ...");for(var e in a)return this.ctatdebug("Creating internal JSON object with name: "+
e),b=new CTATJSONObject,b.name=e,b.value=a[e],b;return null};this.getElementName=function(a){return"object"!=typeof a?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null):a.name};this.getElementValue=function(a){return null==a?(this.ctatdebug("Error: anElement is null"),null):"object"!=typeof a?(this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null):a.value};this.getElementChildren=
function(a){if(null==a)return this.ctatdebug("Error: anElement is null"),null;if("object"!=typeof a)return this.ctatdebug("Internal error, the provided element is not of type CTATJSONObject, instead we found: "+typeof a),null;var b=a.value,d=[],c;for(c in b){var e=b[c];if("string"==typeof e)a=new CTATJSONObject,a.name=c,a.value=e,d.push(a);else if(null==e[0]||void 0==e[0])a=new CTATJSONObject,a.name=c,a.value=e,d.push(a);else for(var h in e)a=new CTATJSONObject,a.name=c,a.value=e[h],d.push(a)}return d};
this.getNodeTextValue=function(a){if("string"!=typeof a.value){var b=null;for(b in a.value)if("content"==b)return a.value[b].toString();for(b in a.value)if("value"==b)return a.value[b].toString()}return a.value};this.getElementAttr=function(a,b){var d=a.value,c;for(c in d)if(c==b)return d[c];return null};this.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};this.walkDOM=function(a){this.ctatdebug("walkDOM () >>>>>>>>>>>>>>>>>>");b=0;this.walk(a);this.ctatdebug("walkDOM () <<<<<<<<<<<<<<<<<<")};
this.walk=function(a){b++;if(!(5<b)){var e=0,d;for(d in a){var c=a[d];this.ctatdebug("("+e+") typeof (key): "+typeof d+" -> typeof(value): "+typeof c+"("+c.length+")");"string"!=typeof c?(this.ctatdebug("walk ("+d+")"),this.walk(c)):this.ctatdebug("walk ("+d+") : "+c);e++}}};this.stringify=function(a){return this.toJSONString(a)};this.toJSONString=function(a){return JSON.stringify(a,null,2)};this.syntaxHighlight=function(a){"string"!=typeof a&&(a=JSON.stringify(a,void 0,2));a=a.replace(/&/g,"&amp;").replace(/</g,
"&lt;").replace(/>/g,"&gt;");return a.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(a){var b="number";/^"/.test(a)?b=/:$/.test(a)?"key":"string":/true|false/.test(a)?b="boolean":/null/.test(a)&&(b="null");return'<span class="'+b+'">'+a+"</span>"})}};CTATJSON.prototype=Object.create(CTATBase.prototype);CTATJSON.prototype.constructor=CTATJSON;"undefined"!==typeof module&&(module.exports=CTATJSON);var CTATMessage=function(a){function b(a){var b={},c=d.getElementChildren(a);this.ctatdebug("CTATMessage.parseCustomFields("+d.stringify(a)+"): cfElts.length "+c.length);for(a=0;a<c.length;++a){var e=c[a];if("custom_field"==d.getElementName(e)){for(var g=null,h=null,e=d.getElementChildren(e),f=0,l=0;f<e.length&&2>l;++f){var m=e[f];switch(d.getElementName(m)){case "name":g=d.getNodeTextValue(m);l++;break;case "value":h=d.getNodeTextValue(m),l++}}g&&(b[g]=h?h:"",this.ctatdebug("CTATMessage.parseCustomFields(): result["+
g+"]="+b[g]+";"))}}return b}CTATBase.call(this,"CTATMessage","message");CTATMessage.makeTransactionId=function(){return CTATGuid.guid()};var e=a,f=null,d=null;void 0==a&&(e=null);d="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;e&&(this.ctatdebug("messageParser "+d+", messageObj "+e),e.children&&this.ctatdebug(e.children));var c="ungraded",g=!1,h=!1,l=new CTATSkillSet,m="",r="",p="",x="",q="",u,n=null,B=null,v=!1;this.setURL=function(a){u=a};this.getURL=function(){return u};this.assignSAI=
function(a){h=!0;n=a};this.setTransactionID=function(a){r=a};this.getTransactionID=function(){return r};this.setGradeResult=function(a){c=a};this.getGradeResult=function(){return c};this.getXMLObject=function(){return e};this.getSkillsObject=function(){return l};this.getCustomFields=function(){return B};this.getSuccessMessage=function(){return p};this.getBuggyMsg=function(){return x};this.getHighlightMsg=function(){return q};this.parse=function(){this.ctatdebug("parse ()");if(null!==e){this.ctatdebug("messageParser: "+
d);this.ctatdebug("Root name: "+d.getElementName(e));"tool_message"==d.getElementName(e)?(this.ctatdebug("Detected tool message"),m="tool_message"):"message"!=d.getElementName(e)?(this.ctatdebug("Detected log message"),g=!0,m=d.getElementName(e)):(this.ctatdebug("Detected regular message"),g=!1,this.parseMessageType());this.parseTransactionID();this.parseSAI();for(var a=d.getElementChildren(e),b=0;b<a.length;b++){var c=a[b];"properties"==d.getElementName(c)&&(ctatdebug("Found a 'properties' element ... "),
f=d.getElementChildren(c))}this.ctatdebug("Message "+m+", with transaction id: "+r)}};this.parseSAI=function(){this.ctatdebug("parseSAI ()");var a="",c="",f="",r="",v=[],E=[],t=[];if("tool_message"==m){this.ctatdebug("Parsing s, a and i");a=d.getElementChildren(e);for(c=0;c<a.length;c++)if(f=a[c],"tool_message"==d.getElementName(f))for(f=d.getElementChildren(f),r=0;r<f.length;r++)v=f[r],"event_descriptor"==d.getElementName(v)&&(n=new CTATSAI,n.fromXMLInternal(v));h=!0}else{if(g){this.ctatdebug("isLogMessage ...");
for(var C=d.getElementChildren(e),G=0;G<C.length;G++){var y=C[G];if("event_descriptor"==d.getElementName(y))for(var y=d.getElementChildren(y),I=0;I<y.length;I++){var F=y[I];"selection"==d.getElementName(F)&&(a=d.getNodeTextValue(F),v.push(F));"action"==d.getElementName(F)&&(c=d.getNodeTextValue(F),E.push(F));"input"==d.getElementName(F)&&(f=d.getNodeTextValue(F),t.push(F));"prompt"==d.getElementName(F)&&(r=d.getNodeTextValue(F))}}}else for(this.ctatdebug("!isLogMessage ..."),C=d.getElementChildren(e),
G=0;G<C.length;G++)if(y=C[G],"properties"==d.getElementName(y))for(y=d.getElementChildren(y),I=0;I<y.length;I++){var F=y[I],J=d.getElementName(F);this.ctatdebug("Nodename: "+J);switch(J){case "URL":u=d.getNodeTextValue(F);break;case "Skills":l.parseByValue(F);break;case "SuccessMsg":p=a=d.getNodeTextValue(F);break;case "BuggyMsg":x=d.getNodeTextValue(F);break;case "Selection":a=d.getNodeTextValue(F);v.push(F);break;case "Action":c=d.getNodeTextValue(F);E.push(F);break;case "Input":f=d.getNodeTextValue(F);
t.push(F);break;case "prompt":r=d.getNodeTextValue(F);break;case "HighlightMsgText":q=d.getNodeTextValue(F);break;case "custom_fields":B=b(F)}}this.ctatdebug("SAI: "+a+","+c+","+f);""!==a&&null!==a?(n=new CTATSAI(a,c,f,r),n.setArrayFromElements(v),n.setArrayFromElements(E),n.setArrayFromElements(t),h=!0):(this.ctatdebug("No SAI found"),h=!1);this.ctatdebug("parseSAI () done, hassai: "+h+", ("+a+","+c+","+f+","+r+")")}};this.parseTransactionID=function(){this.ctatdebug("parseTransactionID()");if("tool_message"!=
m){if(!g)for(var a=d.getElementChildren(e),b=0;b<a.length;b++){var c=a[b];if("properties"==d.getElementName(c))for(var c=d.getElementChildren(c),h=0;h<c.length;h++){var f=c[h];"transaction_id"==d.getElementName(f)&&(r=d.getNodeTextValue(f))}}this.ctatdebug("parseTransactionID() done, id: "+r)}};this.parseMessageType=function(){this.ctatdebug("parseMessageType()");for(var a=d.getElementChildren(e),b=0;b<a.length;b++){var c=a[b];if("properties"==d.getElementName(c))for(var c=d.getElementChildren(c),
g=0;g<c.length;g++){var h=c[g];"MessageType"==d.getElementName(h)&&(m=d.getNodeTextValue(h))}}this.ctatdebug("parseMessageType() -> "+m)};this.getMessageType=function(){return m};this.getTransactionID=function(){return r};this.getSAI=function(){return h?n:new CTATSAI};this.getSelection=function(){return h?n.getSelection():""};this.getAction=function(){return h?n.getAction():""};this.getInput=function(){return h?n.getInput():""};this.getSelectionArray=function(){return h?n.getSelectionArray():[]};
this.getActionArray=function(){return h?n.getActionArray():[]};this.getInputArray=function(){return h?n.getInputArray():[]};this.getXML=function(){return e};this.getXMLString=function(a){if(e.xml)return e.xml;if(XMLSerializer)return(new XMLSerializer).serializeToString(e);alert("ERROR: Extremely old browser");return""};this.getIndicator=function(){return"AssociatedRules"!=m?"":this.getProperty("Indicator")};this.getIndicatorSub=function(){return"AssociatedRules"!=m?"":this.getProperty("IndicatorSub")};
this.setProperty=function(a,b){this.ctatdebug("setProperty ("+a+","+b+")");if(null!==f)for(var c=0;c<f.length;c++)d.getElementName(f[c]);else this.ctatdebug("Internal error: no messageProperties object available")};this.getProperty=function(a){if(!g)if(null!==f)for(var b=0;b<f.length;b++){var c=f[b];if(d.getElementName(c)==a)return d.getNodeTextValue(c)}else this.ctatdebug("Internal error: no messageProperties object available");return""};this.hasProperty=function(a){a=this.getProperty(a);return!g&&
""!==a};this.hasSAI=function(){return h};this.isEndOfTransaction=function(){return"true"==this.getProperty("end_of_transaction")?!0:!1};this.isLogMessageType=function(){return g};this.hasStudentSAI=function(){return!1};this.getStudentSelection=function(){return null.getSelection()};this.getStudentAction=function(){return null.getAction()};this.getStudentInput=function(){return null.getInput()};this.getStudentSAI=function(){return null};this.getToolSelection=function(){return""};r=CTATMessage.makeTransactionId();
this.parse();this.init=function(a){this.setMessageType(a)};this.setSelection=function(a){n&&n.setSelection(a);this.setProperty("SELECTION",a)};this.setAction=function(a){n&&n.setAction(a);this.setProperty("ACTION",a)};this.setInput=function(a){n&&n.setInput(a);this.setProperty("INPUT",a)};this.lockTransactionId=function(a){if(null===a||"undefined"===typeof a||1>a.length)throw new CTATExampleTracerException("lockTranactionId() argument "+a+" must be a valid id");this.setProperty(CTATMessage.TRANSACTION_ID_TAG,
a);v=!0};this.setMessageType=function(a){this.setProperty(CTATMessage.MESSAGE_TYPE,a);m=a};this.setTransactionId=function(a){if(!v){if(null===a||"undefined"===typeof a||1>a.length)a=CTATMessage.makeTransactionId();this.setProperty(CTATMessage.TRANSACTION_ID_TAG,a)}};CTATMessage.create=function(a,b){var c=new CTATMessage;c.init(a);return c}};Object.defineProperty(CTATMessage,"MESSAGE_TYPE",{enumerable:!1,configurable:!1,writable:!1,value:"MessageType"});
Object.defineProperty(CTATMessage,"TRANSACTION_ID_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"transaction_id"});CTATMessage.prototype=Object.create(CTATBase.prototype);CTATMessage.prototype.constructor=CTATMessage;"undefined"!==typeof module&&(module.exports=CTATMessage);var CTATComponentDescription=function(){CTATBase.call(this,"CTATComponentDescription","");this.groupName=this.name=this.type="Unknown";this.height=this.width=this.y=this.x=0;this.tabIndex=this.zIndex=-1;this.styles={};this.params={};this.componentPointer=null;this.setComponentPointer=function(a){this.componentPointer=a};this.getComponentPointer=function(){return this.componentPointer};this.setGenericDefaults=function(){this.name="Generic name";this.styles={BackgroundColor:null,BorderColor:null,FontName:null,
FontSize:null,FontColor:null,FontBold:null,FontItalic:!1,FontUnderlined:!1,TextAlign:null,ShowHintHighlight:!1,blockOnCorrect:!1,disabledBackgroundColor:"#999999",disabledTextColor:"#999999",tutorComponent:null};return this}};CTATComponentDescription.prototype=Object.create(CTATBase.prototype);CTATComponentDescription.prototype.constructor=CTATComponentDescription;var CTATShellTools={ctat_base:new CTATBase("CTATShellTools","shelltools"),component_descriptions:{},registerComponentDescription:function(a){CTATShellTools.ctat_base.ctatdebug("registerComponentDescription ("+a.name+","+a.type+")");CTATShellTools.component_descriptions[a.name]=a},listComponents:function(){CTATShellTools.ctat_base.ctatdebug("listComponents ()");var a=CTATShellTools.component_descriptions,b;for(b in a){var e=a[b];CTATShellTools.ctat_base.ctatdebug("Obtaining component for "+e.name+
" with type: "+e.type);e=e.getComponentPointer();null!==e?CTATShellTools.ctat_base.ctatdebug("Component: "+e.getName()+" of instance: "+e.getClassName()):CTATShellTools.ctat_base.ctatdebug("Error: component pointer is null")}},feedback_components:[],registerFeedbackComponent:function(a,b,e,f,d){CTATShellTools.feedback_components.push({component:a,next:b,prev:e,showHints:f,showFeedback:d})},showNextHint:function(){CTATShellTools.feedback_components.forEach(function(a){a.next&&a.next.bind(a.component)()})},
showPrevHint:function(){CTATShellTools.feedback_components.forEach(function(a){a.prev&&a.prev.bind(a.component)()})},showFeedback:function(a){0==CTATShellTools.feedback_components.length?CTATScrim.scrim.OKScrimUp(a,null):CTATShellTools.feedback_components.forEach(function(b){b.showFeedback&&b.showFeedback.bind(b.component)(a)})},showHints:function(a){CTATShellTools.feedback_components.forEach(function(b){b.showHints&&b.showHints.bind(b.component)(a)})},getCurrentMs:function(){return(new Date).valueOf()},
getAllComponents:function(){var a=[];$(".CTATComponent").each(function(){a.push($(this).data("CTATComponent"))});return a},getNameFromGroup:function(a){CTATShellTools.ctat_base.ctatdebug("getNameFromGroup ("+a+")");var b=a.split(" ");return 1==b.length?a:b[0].substring(0,b[0].length-1)},findComponent:function(a,b){CTATShellTools.ctat_base.ctatdebug("findComponent("+a+")");var e=CTATShellTools.component_descriptions,f=[],d=null,d=-1<a.indexOf(".")?$('[id="'+a+'"]'):$("#"+a);if(0<d.length){var c=[];
d.each(function(){$(this).data("CTATComponent")&&c.push($(this).data("CTATComponent"))});if(0<c.length)return c}d=$('div[data-ctat-component]:has(input[name="'+a+'"])');if(0<d.length){var g=[];d.each(function(){$(this).data("CTATComponent")&&g.push($(this).data("CTATComponent"))});if(0<g.length)return g}if("done"==a){var h=[];$(".CTATDoneButton").each(function(){$(this).data("CTATComponent")&&h.push($(this).data("CTATComponent"))});if(0<h.length)return h}else if("hint"==a){var l=[];$(".CTATHintButton").each(function(){$(this).data("CTATComponent")&&
l.push($(this).data("CTATComponent"))});if(0<l.length)return l}CTATShellTools.ctat_base.ctatdebug("JQuery couldn't find the component, let's try our internal list ...");for(var m in e){d=e[m];if(null===d)return CTATShellTools.ctat_base.ctatdebug("Internal error parsing component at index "+m),null;if(null===d.name)return CTATShellTools.ctat_base.ctatdebug("Internal error parsing component at index "+m+" (no name attribute available)"),null;CTATShellTools.ctat_base.ctatdebug("Comparing "+d.name+" to: "+
a);if(d.name==a){if(null===d.getComponentPointer())return CTATShellTools.ctat_base.ctatdebug("Internal error, found a component description for ["+d.name+"], but component pointer is null"),null;CTATShellTools.ctat_base.ctatdebug("Found a component description for ["+d.name+"], returning pointer ("+d.getComponentPointer()+") ...");f=[];f.push(d.getComponentPointer());return f}d.groupName==a&&(CTATShellTools.ctat_base.ctatdebug("Found the component group ("+d.groupName+"), adding component instance for "+
d.name+" ..."),f.push(d.getComponentPointer()))}return null===f?(CTATShellTools.ctat_base.ctatdebug("Info (groupArray==null), no appropriate component found, perhaps this is a group component"),-1!=a.indexOf(".")?(e=a.split("."),this.findComponent(e[0])):f):0===f.length&&(CTATShellTools.ctat_base.ctatdebug("Info (groupArray.length==0), no appropriate component found, perhaps this is a group component"),-1!=a.indexOf("."))?(e=a.split("."),this.findComponent(e[0])):f},findComponentInstance:function(a,
b){var e=CTATShellTools.findComponent(a,b);return 1==e.length?e[0]:e},findComponentByClass:function(a){var b=CTATShellTools.component_descriptions,e;for(e in b){var f=b[e];if(null===f)return null;if(null!==f.getComponentPointer()&&f.getComponentPointer().getClassName()==a)return f.getComponentPointer()}a=$("."+a);return 0<a.length?a.first().data("CTATComponent"):null}};var CTATTutoringServiceMessageBuilder=function(){CTATBase.call(this,"CTATTutoringServiceMessageBuilder","__undefined__");this.createStartProblemMessage=function(a){this.ctatdebug("createStartProblemMessage ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>StartProblem</MessageType><ProblemName>"+a+"</ProblemName></properties></message>"};this.createInterfaceIdentificationMessage=function(a){this.ctatdebug("createInterfaceIdentificationMessage ("+a+")");return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceIdentification</MessageType><Guid>"+
a+"</Guid></properties></message>"};this.createInterfaceDescriptionMessage=function(a){this.ctatdebug("createInterfaceDescriptionMessage ()");message="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceDescription</MessageType>";message+="<WidgetType>"+a.getClassName()+"</WidgetType>";message+="<CommName>"+a.getName()+"</CommName>";message+="<UpdateEachCycle>false</UpdateEachCycle>";message+="<serialized>";message+="<"+a.getClassName()+' name="'+a.getName()+'" x="0" y="0" width="50" height="30" scaleX="1" scaleY="1" originalWidth="50" originalHeight="30" zIndex="-1" tabIndex="-1">';
message+="<Parameters><selection>";if("CTATRadioButton"==a.getClassName()||"CTATCheckBox"==a.getClassName())message+="<CTATComponentParameter>",message+="<name>group</name>",message+='<value fmt="text" name="Group Name" type="String" includein="sparse">'+a.getComponentGroup()+"</value>",message+="</CTATComponentParameter>";message+="</selection></Parameters>";message+="</"+a.getClassName()+">";message+="</serialized>";return message+="</properties></message>"};this.createSetPreferencesMessage=function(a){this.ctatdebug("createSetPreferencesMessage ()");
var b=CTATConfiguration.getRawFlashVars(),e;e="<message><verb>NotePropertySet</verb><properties><MessageType>SetPreferences</MessageType>"+("<log_service_url>"+b.log_service_url+"</log_service_url>");var f=!1,d=!1,c=b.Logging;this.ctatdebug("Parsing and processing logMethod: "+c);switch(c){case "ServiceToLogServer":f=!0;break;case "ServiceToDisk":d=!0;break;case "ServiceToDiskAndLogServer":d=f=!0;break;case "ClientToLogServer":d=f=!0}e=e+("<log_to_remote_server>"+f+"</log_to_remote_server><log_to_disk>"+
d+"</log_to_disk>")+("<log_to_disk_directory>"+b.log_to_disk_directory+"</log_to_disk_directory>");e+="<logging>"+b.Logging+"</logging>";e+="<user_guid>"+b.user_guid+"</user_guid>";e+="<problem_name>"+b.problem_name+"</problem_name>";e+="<question_file><![CDATA["+encodeURI(b.question_file)+"]]\x3e</question_file>";e+="<class_name>"+b.class_name+"</class_name>";e+="<school_name>"+b.school_name+"</school_name>";e+="<instructor_name>"+b.instructor_name+"</instructor_name>";e+="<session_id>"+b.session_id+
"</session_id>";e+="<source_id>"+b.source_id+"</source_id>";e+="<sui><![CDATA["+b.sui+"]]\x3e</sui>";e+="<problem_state_status>"+b.problem_state_status+"</problem_state_status>";e+="<curriculum_service_url>"+b.curriculum_service_url+"</curriculum_service_url>";e+="<restore_problem_url>"+b.restore_problem_url+"</restore_problem_url>";e+="<collaborators>"+b.collaborators+"</collaborators>";null!==CTATSkillSet.skills&&(e+=CTATSkillSet.skills.toSetPreferencesXMLString());e=e+("<CommShellVersion>"+a+"</CommShellVersion>")+
"</properties></message>";return""+e};this.createTracerActionMessage=function(a,b){this.ctatdebug("createTracerActionMessage ()");var e;e="<message><verb>NotePropertySet</verb><properties><MessageType>TracerAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return""+(e+"</properties></message>")};this.createInterfaceActionMessage=function(a,b){this.ctatdebug("createInterfaceActionMessage ()");var e;e="<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceAction</MessageType>"+
("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return""+(e+"</properties></message>")};this.createUntutoredActionMessage=function(a,b){this.ctatdebug("createUntutoredActionMessage ("+a+")");var e;e="<message><verb>NotePropertySet</verb><properties><MessageType>UntutoredAction</MessageType>"+("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return""+(e+"</properties></message>")};this.createProblemSummaryRequestMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemSummaryRequest</MessageType></properties></message>"};
this.createProblemRestoreEndMessage=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>ProblemRestoreEnd</MessageType></properties></message>"};this.createInterfaceConfigurationEnd=function(){return"<message><verb>NotePropertySet</verb><properties><MessageType>InterfaceConfigurationEnd</MessageType></properties></message>"};this.createInCorrectActionMessage=function(a,b){this.ctatdebug("createInCorrectActionMessage ()");var e;e="<message><verb>SendNoteProperty</verb><properties><MessageType>InCorrectAction</MessageType>"+
("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return""+(e+"</properties></message>")};this.createURLResponse=function(a,b){CTATGlobal.debug(classType,"createURLResponse ()");return"<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+a+" ]]\x3e</URL><content><![CDATA[ "+btoa(b)+" ]]\x3e</content></properties></message>"};this.createCorrectActionMessage=function(a,b){this.ctatdebug("createCorrectActionMessage ()");var e;e="<message><verb>SendNoteProperty</verb><properties><MessageType>CorrectAction</MessageType>"+
("<transaction_id>"+a+"</transaction_id>")+b.toXMLString(!1);return""+(e+"</properties></message>")}};CTATTutoringServiceMessageBuilder.prototype=Object.create(CTATBase.prototype);CTATTutoringServiceMessageBuilder.prototype.constructor=CTATTutoringServiceMessageBuilder;var CTATMessageHandler=function(a){CTATBase.call(this,"CTATMessageHandler","messagehandler");var b=null,e=this,f=[],d=null,c=0,d=CTATConfig.parserType_is_XML()?new CTATXML:new CTATJSON;this.assignHandler=function(a){e.ctatdebug("assignHandler ()");b=a};this.reset=function(){e.ctatdebug("reset ()");f=[]};this.getInStartState=function(){return CTATMessageHandler.inStartState};var g=!1;this.receiveFromTutor=function(a){this.processMessage(a)};this.processMessage=function(a){e.ctatdebug("Incoming message: "+
a);if(!0!==g)if(CTATConfig.parserType_is_JSON()&&-1!=a.indexOf("<?xml"))alert("Error: CTAT is configured to parse JSON but it received an XML message, disabling comm capabilities ..."),g=!0;else if(CTATConfig.parserType_is_XML()&&0===a.indexOf("{"))alert("Error: CTAT is configured to parse XML but it received a JSON message, disabling comm capabilities ..."),g=!0;else{var b;e.ctatdebug("Attempting parse ...");b=d.parse(a);null===b?e.ctatdebug("Error parsing message: "+a):this.parseElement(b)}};this.parseElement=
function(a){var b=d.getElementName(a);e.ctatdebug("parseElement ("+b+")");"CTATResponseMessages"!=b&&"StartStateMessages"!=b&&"MessageBundle"!=b||this.processMessageBundle(a);"message"==b&&this.processSingleMessage(a)};this.processMessageBundle=function(a){var b=d.getElementName(a);e.ctatdebug("processMessageBundle ("+b+")");a=d.getElementChildren(a);if(null===a)e.ctatdebug("Error parsing bundle");else for(ctatdebug("Processing "+a.length+" objects in bundle"),b=0;b<a.length;b++)this.parseElement(a[b])};
this.processSingleMessage=function(g){e.ctatdebug("processSingleMessage ("+d.getElementName(g)+")");var h=new CTATMessage(g);g=d.getElementChildren(g);e.ctatdebug("Generated CTATMessage, now doing regular processing ...");for(var m=0;m<g.length;m++){var r=g[m];if("properties"==d.getElementName(r)){e.ctatdebug("Parsing properties ...");for(var p=d.getElementChildren(r),x=0;x<p.length;x++){var q=p[x];if("MessageType"==d.getElementName(q)){q=d.getNodeTextValue(q);e.ctatdebug("MessageType: "+q);"StateGraph"==
q&&(ctatdebug("Setting inStartState to true"),CTATMessageHandler.inStartState=!0,a.setGotProblemRestoreEnd(!1),this.processStateGraph(r),a.propagateShellEvent("StateGraph",h));"StartProblem"==q&&(e.ctatdebug("Setting inStartState to true"),CTATMessageHandler.inStartState=!0,a.setGotProblemRestoreEnd(!1),this.processStartProblem(p),a.propagateShellEvent("StartProblem",h));"InterfaceIdentification"==q&&(this.processInterfaceIdentification(p),a.propagateShellEvent("InterfaceIdentification",h));"InterfaceDescription"==
q&&(this.processInterfaceDescription(p),a.propagateShellEvent("InterfaceDescription",h));"GetAllInterfaceDescriptions"==q&&(a.getAllInterfaceDescriptions(),a.propagateShellEvent("GetAllInterfaceDescriptions",h));"SendWidgetLock"==q&&(e.ctatdebug("Found: SendWidgetLock"),a.propagateShellEvent("SendWidgetLock",h));"CorrectAction"==q&&(e.ctatdebug("Found: CorrectAction"),!0===this.getInStartState()?f.push(h):b.processCorrectAction(h),a.propagateShellEvent("CorrectAction",h));"InCorrectAction"==q&&(e.ctatdebug("Found: InCorrectAction"),
!0===CTATMessageHandler.inStartState?f.push(h):(e.ctatdebug("Handing incorrect message to messagehandler ..."),b.processInCorrectAction(h)),a.propagateShellEvent("InCorrectAction",h));"HighlightMsg"==q&&(e.ctatdebug("Found: HighlightMsg"),b.processHighlightMsg(h),a.propagateShellEvent("HighlightMsg",h));"UnHighlightMsg"==q&&(e.ctatdebug("Found: UnHighlightMsg"),b.processUnHighlightMsg(h),a.propagateShellEvent("UnHighlightMsg",h));if("AssociatedRules"==q){e.ctatdebug("Found: AssociatedRules ("+p.length+
")");for(var u="",n="",B=0;B<p.length;B++){var v=p[B];"TutorAdvice"==d.getElementName(v)&&(u=d.getNodeTextValue(v));"Actor"==d.getElementName(v)&&d.getNodeTextValue(v);"Indicator"==d.getElementName(v)&&(n=d.getNodeTextValue(v));"StepID"==d.getElementName(v)&&d.getNodeTextValue(v);"LogAsResult"==d.getElementName(v)&&d.getNodeTextValue(v);"tool_selection"==d.getElementName(v)&&d.getNodeTextValue(v);"Skills"==d.getElementName(v)&&(e.ctatdebug("Processing skills ..."),null===CTATSkillSet.skills&&(e.ctatdebug("Interesting, there isn't a skillSet object yet. Creating ..."),
CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(v))}b.processAssociatedRules(h,n,u);a.propagateShellEvent("AssociatedRules",h)}"BuggyMessage"==q&&(e.ctatdebug("Found: BuggyMessage"),b.processBuggyMessage(h),a.propagateShellEvent("BuggyMessage",h));"SuccessMessage"==q&&(e.ctatdebug("Found: SuccessMessage"),b.processSuccessMessage(h),a.propagateShellEvent("SuccessMessage",h));-1!=q.indexOf("InterfaceAction")&&(e.ctatdebug("Found: InterfaceAction"),u=h.getSAI(),-1!=u.getAction().indexOf(":")?
(e.ctatdebug("Processing and storing timed interface action : "+u.getAction()),n=parseInt(u.getAction().substring(u.getAction().indexOf(":")+1)),e.ctatdebug("Target time: "+n),u.setAction(u.getAction().substring(0,u.getAction().indexOf(":"))),e.ctatdebug("Timing ..."),setTimeout(b.processInterfaceAction,n,h)):(e.ctatdebug("Processing regular (non-timed) interface action"),!0===CTATMessageHandler.inStartState?(e.ctatdebug("inStartState==true => storing for later playback ..."),f.push(h)):b.processInterfaceAction(h),
a.propagateShellEvent("InterfaceAction",h)));"InterfaceIdentification"==q&&(e.ctatdebug("Found: InterfaceIdentification"),a.propagateShellEvent("InterfaceIdentification",h));"AuthorModeChange"==q&&(e.ctatdebug("Found: AuthorModeChange"),b.globalReset(),a.propagateShellEvent("AuthorModeChange",h));"ResetAction"==q&&(e.ctatdebug("Found: ResetAction"),b.globalReset(),a.propagateShellEvent("ResetAction",h));if("ShowHintsMessage"==q){e.ctatdebug("Found: ShowHintsMessage");u=!1;n=[];for(B=0;B<p.length;B++)if(v=
p[B],"HintsMessage"==d.getElementName(v))for(var v=d.getElementChildren(v),z=0;z<v.length;z++){var A=v[z];"value"==d.getElementName(A)&&(n.push(d.getNodeTextValue(A)),u=!0)}!0===u?b.processHintResponse(h,n):e.ctatdebug("Error: incomplete hint message received");a.propagateShellEvent("ShowHintsMessage",h)}"ConfirmDone"==q&&(e.ctatdebug("Found: ConfirmDone"),b.processConfirmDone(h),a.propagateShellEvent("ConfirmDone",h));"VersionInfo"==q&&(e.ctatdebug("Found: VersionInfo"),b.processVersionInfo(p),a.propagateShellEvent("ConfirmDone",
h));"TutoringServiceAlert"==q&&(e.ctatdebug("Found: TutoringServiceAlert"),b.processTutoringServiceAlert(p),a.propagateShellEvent("TutoringServiceAlert",h));"TutoringServiceError"==q&&(e.ctatdebug("Found: TutoringServiceError"),b.processTutoringServiceError(p),a.propagateShellEvent("TutoringServiceError",h));"ProblemSummaryResponse"==q&&(e.ctatdebug("Found: ProblemSummaryResponse"),b.processProblemSummaryResponse(h),a.propagateShellEvent("ProblemSummaryResponse",h));if("StartStateEnd"==q){e.ctatdebug("Found: StartStateEnd");
CTATShellTools.listComponents();null!==b?b.processStartState():this.ctatdebug("Error: no message handler object available to process start state");try{e.processStartStateActions()}catch(D){e.ctatdebug("Caught in the act: "+D.message)}CTATMessageHandler.inStartState=!1;a.propagateShellEvent("StartStateEnd",h)}"ProblemRestoreEnd"==q&&(e.ctatdebug("Found: ProblemRestoreEnd"),b.processProblemRestoreEnd(h),a.propagateShellEvent("ProblemRestoreEnd",h));"GetURL"==q&&(e.ctatdebug("Found: GetURL"),b.processGetURL(h),
a.propagateShellEvent("GetURL",h));"InterfaceReboot"==q&&(c++,ctatdebug("Found: InterfaceReboot #"+c+" -- href "+(location?location.href:"(no location)")),1<c&&!CTAT.ToolTutor.reboot("InterfaceReboot from CTATMessageHandler")&&(q="ws://"+CTATConfiguration.get("remoteSocketURL")+":"+CTATConfiguration.get("remoteSocketPort"),ctatdebug("closing connection w/ url: "+q),a.closeWSConnection(q,function(){var a=window.frameElement.getAttribute("id");"function"==typeof CustomEvent&&(a=new CustomEvent("refreshIframe",
{detail:a}),window.parent.document.dispatchEvent(a))},"interfaceReboot")))}}}}};this.processStateGraph=function(a){e.ctatdebug("processStateGraph ()");if(void 0===a||null===a)e.ctatdebug("Error: state graph property list is undefined");else if(e.ctatdebug("Processing node: "+a.nodeName),null===d.getElementChildren(a))e.ctatdebug("Error: state graph property list is undefined");else{a=d.getElementChildren(a);for(var c=0;c<a.length;c++){var g=a[c];e.ctatdebug("State graph attribute: "+d.getElementName(g));
"caseInsensitive"==d.getElementName(g)&&(caseInsensitive="false"==d.getNodeTextValue(g)?!1:!0);"unordered"==d.getElementName(g)&&(unordered="false"==d.getNodeTextValue(g)?!1:!0);"lockWidget"==d.getElementName(g)&&(lockWidget="false"==d.getNodeTextValue(g)?!1:!0);"suppressStudentFeedback"==d.getElementName(g)&&("false"==d.getNodeTextValue(g)?CTATGlobals.suppressStudentFeedback=!1:CTATGlobals.suppressStudentFeedback=!0);"highlightRightSelection"==d.getElementName(g)&&(highlightRightSelection="false"==
d.getNodeTextValue(g)?!1:!0);"confirmDone"==d.getElementName(g)&&(e.ctatdebug("Confirm done: "+d.getNodeTextValue(g)),"true"==d.getNodeTextValue(g)?CTATGlobals.confirmDone=!0:CTATGlobals.confirmDone=!1);"Skills"==d.getElementName(g)&&(null===CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),CTATSkillSet.skills.parseByValue(g),b.updateSkillWindow())}}};this.processStartProblem=function(a){e.ctatdebug("processStartProblem ()");b.processStartProblem()};this.processInterfaceIdentification=function(a){};
this.processInterfaceDescription=function(a){e.ctatdebug("processInterfaceDescription ("+a.length+")");for(var b="Unknown",c="Unknown",g=null,h=0;h<a.length;h++){var f=a[h];e.ctatdebug("Inspecting element: "+d.getElementName(f));"WidgetType"==d.getElementName(f)&&(e.ctatdebug("Widget type: "+d.getNodeTextValue(f)),b=d.getNodeTextValue(f));"CommName"==d.getElementName(f)&&(e.ctatdebug("Instance name: "+d.getNodeTextValue(f)),c=d.getNodeTextValue(f));if("serialized"==d.getElementName(f)){e.ctatdebug("Prepareing to de-serialize component ...");
for(var q=d.getElementChildren(f),u=0;u<q.length;u++){var n=q[u];-1!=d.getElementName(n).indexOf("CTAT")&&(g=n)}}"interface"==d.getElementName(f)&&(e.ctatdebug("Storing interface for post start-state reconstruction ..."),CTATGlobals.interfaceElement=f);"script"==d.getElementName(f)&&(e.ctatdebug("Storing and loading main javascript code as defined by the BRD ..."),scriptElement=d.getNodeTextValue(f))}null!==g?this.deserializeComponent(b,c,g):e.ctatdebug("Error: unable to find CTAT serialization point of attachement");
e.ctatdebug("processInterfaceDescription () done")};this.deserializeComponent=function(a,b,c){e.ctatdebug("deserializeComponent ("+a+","+b+")");if(!0===CTATGlobals.ignoreInterfaceDescriptions)e.ctatdebug("ignoreInterfaceDescriptions==true");else if(null===d.getElementAttr(c,"x"))e.ctatdebug("Warning: this component does not have x,y information. Probably an older component");else{var g=d.getElementAttr(c,"x"),h=d.getElementAttr(c,"y"),f=d.getElementAttr(c,"width"),l=d.getElementAttr(c,"height"),m=
d.getElementAttr(c,"tabIndex"),n=d.getElementAttr(c,"zIndex");null===m&&(m=-1);null===n&&(n=0);var B=new CTATComponentDescription;B.type=a;B.name=b;B.x=Math.floor(g);B.y=Math.floor(h);B.tabIndex=m;B.zIndex=n;B.width=Math.floor(f);B.height=Math.floor(l);CTATShellTools.registerComponentDescription(B);c=d.getElementChildren(c);for(g=0;g<c.length;g++){h=c[g];d.getElementName(h);if("Parameters"==d.getElementName(h))for(this.ctatdebug("Processing component parameters ..."),f=d.getElementChildren(h)[0],
f=d.getElementChildren(f),l=0;l<f.length;l++){var v=f[l];if("CTATComponentParameter"==d.getElementName(v)){this.ctatdebug("Processing parameter property (CTATComponentParameter) ...");for(var n=m=void 0,v=d.getElementChildren(v),z=0;z<v.length;z++){var A=v[z];"name"==d.getElementName(A)&&(this.ctatdebug("Found parameter name: "+d.getNodeTextValue(A)),m=d.getNodeTextValue(A));"value"==d.getElementName(A)&&(this.ctatdebug("Found parameter value: "+d.getNodeTextValue(A)),n=d.getNodeTextValue(A).trim())}this.ctatdebug("Parameter name: "+
m+", value: "+n);void 0!==m&&(B.params[m]=n,"group"==m&&(B.groupName=n))}}if("Styles"==d.getElementName(h))for(this.ctatdebug("Processing component styles ..."),h=d.getElementChildren(h)[0],h=d.getElementChildren(h),f=0;f<h.length;f++)if(n=h[f],"CTATStyleProperty"==d.getElementName(n)){this.ctatdebug("Processing style property (CTATStyleProperty) ...");m=l="";n=d.getElementChildren(n);for(v=0;v<n.length;v++)z=n[v],"name"==d.getElementName(z)&&(l=d.getNodeTextValue(z)),"value"==d.getElementName(z)&&
(m=d.getNodeTextValue(z).trim());this.ctatdebug("Style (name: "+l+", value: "+m+")");""!==l&&(B.styles[l]=m)}}e.ctatdebug("deserializeComponent ("+a+","+b+") done")}};this.processStartStateActions=function(){e.ctatdebug("processStartStateActions ("+f.length+")");if(0===f.length)e.ctatdebug("No start state messages, bump");else if(0<CTATMessageHandler.startStateHandlers.length)for(var a=0;a<CTATMessageHandler.startStateHandlers.length;a++)CTATMessageHandler.startStateHandlers[a].processStartStateActions(f);
else{for(a=0;a<f.length;a++){var c=f[a];e.ctatdebug("Processing startstate message type: "+c.getMessageType());"InterfaceAction"==c.getMessageType()&&b.processInterfaceAction(c);"CorrectAction"==c.getMessageType()&&b.processCorrectAction(c);"InCorrectAction"==c.getMessageType()&&b.processInCorrectAction(c);this.sleep(1E3)}if(""!==CTATMessageHandler.scriptElement)try{eval(CTATMessageHandler.scriptElement)}catch(m){alert("Error executing script from BRD: "+m.message)}}};this.sleep=function(a){e.ctatdebug("sleep ("+
a+")")}};CTATMessageHandler.prototype=Object.create(CTATBase.prototype);CTATMessageHandler.prototype.constructor=CTATMessageHandler;CTATMessageHandler.startStateHandlers=[];CTATMessageHandler.inStartState=!1;CTATMessageHandler.scriptElement="";var CTATNameTranslator=function(){CTATBase.call(this,"CTATNameTranslator","translator");var a=!1,b=this;this.setPassthrough=function(b){a=CTATGlobalFunctions.toBoolean(b)};this.getPassthrough=function(){return a};this.manufactorJSON=function(a,f){b.ctatdebug("manufactorJSON ("+a+","+f+")");var d=a.split(":");if(1==d.length)return b.ctatdebug("No range in aRange, returning basic JSON ..."),"";var c=this.getA1Row(d[0]),e=this.getA1Col(d[0]),h=this.getA1Row(d[1]),l=this.getA1Col(d[1]);b.ctatdebug("Manufacturing json from: ["+
c+","+e+"] to: ["+h+","+l+"]");d="[";c=parseInt(h)-parseInt(c);e=parseInt(l)-parseInt(e);c++;e++;b.ctatdebug("X range: "+c+", Y range: "+e);for(h=0;h<c;h++){0<h&&(d+=",");d+="[";for(l=0;l<e;l++)0<l&&(d+=","),d+='"',d+=f,d+='"';d+="]"}return d+"]"};this.translateFromCTAT=function(e,f){if(!0===a)return e;var d=e.toLowerCase();b.ctatdebug("translateFromCTAT ("+d+")");var c;if(-1!=d.indexOf(".r")){var g=d.split(".");c=g[1].split("r");0>=c.length&&(c=g[1].split("c"));0>=c.length?b.ctatdebug("Info: incoming name does not need translation"):
(d=c[1],c=c[0].substr(1),b.ctatdebug("Original row (1st format): "+c+" original col: "+d),d=!0===f?colName(d,!1)+c:g[0]+"."+colName(d,!1)+c,b.ctatdebug("Translated: "+d))}else{if(0===d.indexOf("r")){var g=d.indexOf("c"),h=parseInt(d.substr(1,g-1)),l=parseInt(d.substr(g+1));c=h+1;d=l;b.ctatdebug("Original row (2nd format) (columnindex: "+g+"): "+h+" -> "+c+", original col: "+l+" -> "+d);d=colName(d,!1)+c;b.ctatdebug("Translated: "+d);return d}b.ctatdebug("Info: incoming name does not need translation")}return d};
this.translateToCTAT=function(b){if(!0===a)return b;var e=this.letterToColumn(b.substr(0,1))-1;return"R"+(parseInt(b.substr(1))-1)+"C"+e};this.columnToLetter=function(a){for(var b,d="";0<a;)b=(a-1)%26,d=String.fromCharCode(b+65)+d,a=(a-b-1)/26;return d};this.letterToColumn=function(a){for(var b=0,d=a.length,c=0;c<d;c++)b+=(a.charCodeAt(c)-64)*Math.pow(26,d-c-1);return b};this.getA1Row=function(a){return parseInt(a.substr(1))-1};this.getA1Col=function(a){return this.letterToColumn(a.substr(0,1))-1}};
CTATNameTranslator.prototype=Object.create(CTATBase.prototype);CTATNameTranslator.prototype.constructor=CTATNameTranslator;var CTATCommShell=function(){CTATBase.call(this,"CTATCommShell","theShell");var a=null,b=null,e=null,f=null,d=this,c=null,g=null,h={},l=null,m=null,r=null,p=null,x=[],q=!1,g="xml"==CTATConfig.parserType?new CTATXML:new CTATJSON;this.init=function(c){this.ctatdebug("init ()");var g=CTATConfiguration.getRawFlashVars(),h="http://";"https"==g.tutoring_service_communication&&(h="https://");var l=g.remoteSocketURL;l&&(l=String(l).toLowerCase(),0==l.indexOf("http")||0==l.indexOf("ws"))&&(h="");f=c;CTATLogMessageBuilder.contextGUID=
CTATGuid.guid();d.ctatdebug("processSkills ()");CTATSkillSet.skills=new CTATSkillSet;c=flashVars.getRawFlashVars();null!=c.skills&&CTATSkillSet.skills.fromXMLString(c.skills);d.updateSkillWindow(null);null==commMessageHandler&&(commMessageHandler=new CTATMessageHandler(this),CTAT.ToolTutor.registerInterface(commMessageHandler));commMessageHandler.assignHandler(this);e=new CTATTutoringServiceMessageBuilder;g.deliverymode&&"review"==g.deliverymode&&(g.Logging="None");CTATLogMessageBuilder.commLogMessageBuilder=
new CTATLogMessageBuilder;a=new CTATCommLibrary;a.setConnectionRefusedMessage("ERROR_CONN_TS");a.setSocketType(g.tutoring_service_communication);a.assignHandler(this);b=new CTATCurriculumService(a);null==commLoggingLibrary&&(commLoggingLibrary=new CTATLoggingLibrary(!0));commLoggingLibrary.getLoggingCommLibrary().setFixedURL(flashVars.getRawFlashVars().log_service_url);flashVars.setTimeZone(null);new CTATHTMLManager;this.ctatdebug("CTATCommShell.init() FlashVar info: "+g.info);if(null!=g.info)try{parent.javaScriptInfo&&
parent.javaScriptInfo(decodeURIComponent(g.info))}catch(z){}else this.ctatdebug("There is no info flash var");console.log("Connecting to: "+h+g.remoteSocketURL+":"+g.remoteSocketPort);c=e.createSetPreferencesMessage(version);a.sendXMLURL(c,h+g.remoteSocketURL+":"+g.remoteSocketPort)};this.getLoggingLibrary=function(){return commLoggingLibrary};this.propagateShellEvent=function(a,b){ctatdebug("propagateShellEvent ("+a+")");for(var c=0;c<x.length;c++)x[c].processCommShellEvent(a,b)};this.reset=function(){d.ctatdebug("reset ()");
CTATGlobals.interfaceElement=null;commMessageHandler.reset()};this.getMessageHandler=function(){return this.commMessageHandler};this.addStartStateHandler=function(a){d.ctatdebug("addStartStateHandler ()");null==CTATMessageHandler.startStateHandlers&&(CTATMessageHandler.startStateHandlers=[]);CTATMessageHandler.startStateHandlers.push(a)};this.gradeComponent=function(a){this.ctatdebug("gradeComponent ("+a.getName()+","+a.getClassName()+")");var b=CTATShellTools.findComponentByClass("CTATDoneButton");
null!=b&&b!=a?b.moveHintHighlight(!1,null):d.ctatdebug("Info: no done button available to reset");d.clearFeedbackComponents();null!=nameTranslator?nameTranslator.translateFromCTAT(a.getName()):this.ctatdebug("Info: no name translator provided, using as-is");null==a?this.ctatdebug("Internal error, provided component is null"):(this.ctatdebug("Info: we have a valid component, grading ..."),"Do not tutor"==a.getTutorComponent()?d.processComponentAction(a.getSAI(),!1):(this.ctatdebug("Checking for back grading: "+
a.getName()),"CTATTextArea"==a.getClassName()||"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()?(this.ctatdebug("Backgrading ..."),this.ctatdebug("Grading "+a.getClassName()+" with value: "+a.getValue()),!0===CTATGlobalFunctions.isBlank(a.getValue())?this.ctatdebug("Empty component, nothing to grade"):(a.updateSAI(),a=a.getSAI(),d.processComponentAction(a))):(a="CTATTableGoogle"==a.getClassName()?new CTATSAI(a.getCurrentSelection(),"UpdateTextArea",a.getCurrentValue()):a.getSAI(),
d.processComponentAction(a))))};this.processMessage=function(a){this.ctatdebug("processMessage ()");commMessageHandler.processMessage(a);this.ctatdebug("processMessage () done")};this.processStartProblem=function(){this.ctatdebug("processStartProblem ()");"google"==CTATConfig.external&&this.showFeedback("The tutor is starting, please wait ...");CTATLMS.initLMSConnection&&CTATLMS.initLMSConnection()};this.processStartState=function(){this.ctatdebug("processStartState ()");CTATMessageHandler.inStartState=
!0;null!=f?(this.ctatdebug("Calling tutor.createInterface () ..."),f.createInterface()):(this.ctatdebug("Error: no tutor object available, calling createInterface globally ..."),window.hasOwnProperty("createInterface")&&window.createInterface());this.ctatdebug("Logging start of problem ...");null!=commLoggingLibrary?commLoggingLibrary.startProblem():this.ctatdebug("Info: no logging library available!");this.ctatdebug("End of start state, inspecting suppressStudentFeedback ...");if(!0===CTATGlobals.suppressStudentFeedback){this.ctatdebug("Hiding hint button ...");
var a=CTATShellTools.findComponentByClass("CTATHintButton");null!=a&&a.SetVisible(!1)}"google"==CTATConfig.external?(d.ctatdebug("Calling google app script hint request driver ..."),addCall(new RPCObject("resetOnEditQueue","dummy","dummy"))):this.ctatdebug("processStartState () done")};this.sendStartProblemMessage=function(){d.ctatdebug("sendStartProblemMessage()")};this.sendProblemSummaryRequest=function(b){d.ctatdebug("sendProblemSummaryRequest()");r=b;b=(new CTATTutoringServiceMessageBuilder).createProblemSummaryRequestMessage();
a.sendXML(b)};this.getAllInterfaceDescriptions=function(){d.ctatdebug("getAllInterfaceDescriptions ()");d.sendInterfaceDescriptionMessages()};this.sendInterfaceDescriptionMessages=function(){d.ctatdebug("sendInterfaceDescriptionMessages ()");for(var b=CTATShellTools.getAllComponents(),c='<?xml version="1.0" encoding="UTF-8"?><message><verb>NotePropertySet</verb><properties><MessageType>MessageBundle</MessageType><messages>',e=new CTATTutoringServiceMessageBuilder,g=0;g<b.length;g++){var h=b[g];d.ctatdebug("Getting component interface description message for: "+
h.getName());c+=e.createInterfaceDescriptionMessage(h);h.getConfigurationActions&&h.getConfigurationActions().forEach(function(a){c+=e.createInterfaceActionMessage(CTATGuid.guid(),a)})}c+="</messages></properties></message>";d.ctatdebug("Final bundle: "+c);a.sendXMLNoBundle(c)};this.processSerialization=function(){d.ctatdebug("processSerialization()");d.setText(this.label)};this.processComponentAction=function(b,c,e,g,h,f){d.ctatdebug("processComponentAction("+b.getName()+" -> "+b.getSelection()+
","+b.getAction()+","+b.getInput()+")");this.showFeedback("");e=CTATGuid.guid();null!=commLoggingLibrary?q&&(d.ctatdebug("We're not in the start state, logging the action ..."),"scrim"==b.getSelection()?ctatdebug("Not logging any scrim actions (for now)"):void 0!=h?commLoggingLibrary.logSemanticEvent(e,b,h,"","","",f):"hint"==b.getSelection()||"null.nextButton"==b.getSelection()||"null.previousButton"==b.getSelection()?commLoggingLibrary.logSemanticEvent(e,b,"HINT_REQUEST","","","",f):commLoggingLibrary.logSemanticEvent(e,
b,"ATTEMPT","","","",f)):this.ctatdebug("Info: no logging library available!");h=new CTATTutoringServiceMessageBuilder;b=!1!==c?h.createInterfaceActionMessage(e,b):h.createUntutoredActionMessage(e,b);a.sendXML(b)};this.onEditSuccess=function(a){d.ctatdebug("onEditSuccess ("+a+")");null==nameTranslator?d.ctatdebug("Error: CTAT name translator not available"):-1!=a.indexOf(":")?(d.ctatdebug("Bump"),d.showFeedback("You're asking for a hint for multiple cells, please select only a single cell.")):(a=
nameTranslator.translateToCTAT(a),d.ctatdebug("Info A1 notiation mapped to (if needed): "+a),a=new CTATSAI("hint","ButtonPressed",a),d.processComponentAction(a),d.propagateShellEvent("REQUESTHINT",null),d.ctatdebug("onEditSuccess () done"))};this.onFailure=function(a){d.ctatdebug("onFailure ("+a.message+")")};this.onNOPEditSuccess=function(a){d.ctatdebug("onNOPEditSuccess ("+a+")")};this.onNOPFailure=function(a){d.ctatdebug("onNOPFailure ("+a.message+")")};this.requestHint=function(){d.ctatdebug("requestHint(external -> "+
CTATConfig.external+")");var a;if("none"==CTATConfig.external)d.ctatdebug("Calling built-in hint request driver ..."),CTATGlobals.Tab.previousFocus?(a=new CTATSAI("hint","ButtonPressed","hint request"),CTATGlobals.Tab.previousFocus.getSAI?(a.addSelection(CTATGlobals.Tab.previousFocus.getSAI().getSelection()),a.addAction("PreviousFocus")):d.ctatdebug("Current focus is not a CTAT component, can't ask for a hint yet")):(d.ctatdebug("CTATGlobals.Tab.previousFocus===null"),a=new CTATSAI("hint","ButtonPressed",
"hint request")),this.processComponentAction(a),this.propagateShellEvent("RequestHint",null);else if(d.clearFeedbackComponents(),"google"==CTATConfig.external){d.ctatdebug("Calling google app script hint request driver ...");try{google.script.run.withSuccessHandler(d.onEditSuccess).withFailureHandler(d.onFailure).getSheetSelectedRange()}catch(n){d.ctatdebug("google.script.run: "+n.message)}}else d.ctatdebug("'external' has configuration that doesn't match anything: "+CTATConfig.external)};this.processDone=
function(){d.ctatdebug("processDone()");if(!0===CTATGlobals.confirmDone)CTATScrim.scrim.confirmScrimUp("Are you sure you are done?",this.processDoneContinue,this.processDoneCancel);else{var a=new CTATSAI("done","ButtonPressed","-1");d.processComponentAction(a)}};this.processDoneContinue=function(a){d.ctatdebug("processDoneContinue()");CTATScrim.scrim.scrimDown();a=new CTATSAI("done","ButtonPressed","-1");d.processComponentAction(a);d.propagateShellEvent("DonePressed",null)};this.processDoneCancel=
function(a){d.ctatdebug("processDoneCancel()");CTATScrim.scrim.scrimDown();a=CTATGuid.guid();var b=new CTATSAI("ConfirmDone","ButtonPressed","no");commLoggingLibrary.logSemanticEvent(a,b,"ATTEMPT","")};this.processGetURL=function(b){d.ctatdebug("processGetURL()");-1!=b.getURL().indexOf("http://")?a.retrieveFile(b.getURL().substring(7),d.processClientBRDLoad):a.retrieveFile(b.getURL(),d.processClientBRDLoad)};this.processClientBRDLoad=function(b){d.ctatdebug("processClientBRDLoad()");var c=a.getURL();
a.sendXML("<message><verb>NotePropertySet</verb><properties><MessageType>GetURLResponse</MessageType><URL><![CDATA[ "+c+" ]]\x3e</URL><content><![CDATA[ "+window.btoa(b)+" ]]\x3e</content></properties></message>")};this.processCorrectAction=function(a){d.ctatdebug("processCorrectAction()");a.setGradeResult("correct");d.clearFeedbackComponents();null!=p&&(ctatdebug("Calling custom grading processor ..."),p("CORRECT",a));var b=a.getSelection();if(h[b]&&null!=l)l("CORRECT",a),this.propagateShellEvent("CORRECT",
a);else{var c=CTATShellTools.findComponent(b);if(null!=c)for(ctatdebug("Processing "+c.length+" components ..."),b=0;b<c.length;b++)ctatdebug("Check "+c[b].getName()),c[b]?c[b].setCorrect&&c[b].setCorrect(a):d.ctatdebug("Internal error, component pointer is null");else d.ctatdebug("Error: component is null for selection "+b)}};this.processInCorrectAction=function(a){d.ctatdebug("processInCorrectAction()");a.setGradeResult("incorrect");null!=p&&(ctatdebug("Calling custom grading processor ..."),p("INCORRECT",
a));var b=a.getSelection();if(h[b]&&null!=l)l("INCORRECT",a);else{var c=CTATShellTools.findComponent(b);if(null!==c)for(b=0;b<c.length;b++)ctatdebug("Calling setIncorrect on component ("+c[b].getClassName()+")..."),c[b].setIncorrect&&c[b].setIncorrect(a);else d.ctatdebug("Error: component is null for selection "+b)}};this.processHighlightMsg=function(a){d.ctatdebug("processHighlightMsg()");var b=a.getSelection(),c=CTATShellTools.findComponent(b);if(null!=c)for(b=0;b<c.length;b++)c[b].setHintHighlight(!0,
a);else d.ctatdebug("Error: component is null for selection "+b);this.showFeedback(a.getHighlightMsg())};this.processUnHighlightMsg=function(a){d.ctatdebug("processUnHighlightMsg()");var b=a.getSelection(),c=CTATShellTools.findComponent(b);if(null!=c)for(b=0;b<c.length;b++)c[b].setHintHighlight(!1,null,a);else d.ctatdebug("Error: component is null for selection "+b)};this.processAssociatedRules=function(b,c,g){d.ctatdebug("processAssociatedRules()");if(0==commMessageHandler.getInStartState()){logHintSAI=
b.getSAI();var h=new CTATActionEvaluationData("");d.ctatdebug("Found tutor advice: "+g);"Hint"==c||"HintWindow"==c?(ctatdebug("Preparing log message to indicate a hint response","commShell"),h.setCurrentHintNumber(hintIndex+1),h.setTotalHintsAvailable(hints.length),h.setEvaluation("HINT"),c="HINT_MSG",hints[hintIndex]&&(g=hints[hintIndex])):("Correct"==b.getIndicator()?h.setEvaluation("CORRECT"):h.setEvaluation("INCORRECT"),c="RESULT");ctatdebug("Adding custom field names ...");var f=[],l=[];f.push("step_id");
l.push(b.getProperty("StepID"));var m=b.getCustomFields(),n;for(n in m)f.push(n),l.push(m[n]);n=b.getSkillsObject();d.updateSkillWindow(n);ctatdebug("Sending log message ...");null!=commLoggingLibrary?q&&commLoggingLibrary.logTutorResponse(b.getTransactionID(),logHintSAI,c,"",h,g,n,f,l):this.ctatdebug("Info: no logging library available!");"done"==logHintSAI.getSelection()&&"ButtonPressed"==logHintSAI.getAction()&&"Correct"==b.getIndicator()&&(b=e.createProblemSummaryRequestMessage(),a.sendXML(b))}else d.updateSkillWindow(null);
d.ctatdebug("processAssociatedRules() done")};this.processBuggyMessage=function(a){d.ctatdebug("processBuggyMessage()");this.showFeedback(a.getBuggyMsg())};this.processSuccessMessage=function(a){d.ctatdebug("processSuccessMessage()");this.showFeedback(a.getSuccessMessage())};this.processInterfaceAction=function(a){d.ctatdebug("processInterfaceAction ()","commShell");null!=commLoggingLibrary?q&&commLoggingLibrary.logSemanticEvent(a.getTransactionID(),a.getSAI(),"ATTEMPT","tutor-performed"):this.ctatdebug("Info: no logging library available!");
if("root"==a.getSelection()||"_root"==a.getSelection()){d.ctatdebug("Info: selection is 'root', we'll call the function straight up ...");var b=a.getAction();a=a.getInput();d.ctatdebug("Calling as: "+b+"("+a+")");try{window[b](a)}catch(D){d.ctatdebug("Internal error: unable to execute function: "+D.message)}}else if(b=CTATShellTools.findComponent(a.getSelection()),null===b)d.ctatdebug("Internal error: unable to find pointer to component object");else if(0==b.length)d.ctatdebug("Error: no component found to call interface action on");
else{var c=b.length;d.ctatdebug("Call the action on the component(s) -> ("+c+")...");for(var e=0;e<c;e++){d.ctatdebug("About to call "+a.getAction()+" ("+a.getInput()+") on: "+a.getSelection());var g=b[e];g.executeSAI(a);d.ctatdebug("Method executed, continuing with post-processing ...");if(1==commMessageHandler.getInStartState()){var h=a.getAction();h&&h.toLowerCase().startsWith("updatetext")&&g.setEnabled(!1)}}d.ctatdebug("processInterfaceAction() Done")}};this.processInterfaceIdentification=function(a){d.ctatdebug("processInterfaceIdentification()")};
this.processAuthorModeChange=function(a){d.ctatdebug("processAuthorModeChange()")};this.processShowHintsMessage=function(a){d.ctatdebug("processShowHintsMessage()")};this.processConfirmDone=function(a){d.ctatdebug("processConfirmDone()")};this.processVersionInfo=function(a){d.ctatdebug("processVersionInfo()")};this.processTutoringServiceAlert=function(a){d.ctatdebug("processTutoringServiceAlert()");for(var b="",c=0;c<a.length;c++){var e=a[c];"ErrorType"==g.getElementName(e)&&g.getNodeTextValue(e);
"Details"==g.getElementName(e)&&(b=g.getNodeTextValue(e))}CTATScrim.scrim.scrimUp(b)};this.processTutoringServiceError=function(a){d.ctatdebug("processTutoringServiceError()");for(var b="",c="",e=0;e<a.length;e++){var h=a[e];"ErrorType"==g.getElementName(h)&&(b=g.getNodeTextValue(h));"Details"==g.getElementName(h)&&(c=g.getNodeTextValue(h))}CTATScrim.scrim.scrimDown();CTATScrim.scrim.errorScrimUp(b+" - "+c)};this.processProblemSummaryResponse=function(a){d.ctatdebug("processProblemSummaryResponse()");
CTATLMS.processProblemSummary&&CTATLMS.processProblemSummary(a.getXMLObject());CTATLMS.closeLMSConnection&&CTATLMS.closeLMSConnection();if(null!=r){var e=a.getXMLObject(),g=e.getElementsByTagName("ProblemSummary"),h=e.getElementsByTagName("cmi.core.lesson_status"),f=e.getElementsByTagName("cmi.core.score.raw");a=e.getElementsByTagName("cmi.core.exit");e=e.getElementsByTagName("cmi.core.session_time");g=$("<div>").html(g[0].innerHTML).text();h="<cmi.core.lesson_status>"+$("<div>").html(h[0].innerHTML).text()+
"</cmi.core.lesson_status>";f="<cmi.core.score.raw>"+$("<div>").html(f[0].innerHTML).text()+"</cmi.core.score.raw>";a="<cmi.core.exit>"+$("<div>").html(a[0].innerHTML).text()+"</cmi.core.exit>";e="<cmi.core.session_time>"+$("<div>").html(e[0].innerHTML).text()+"</cmi.core.session_time>";r(g,"<scorm>"+h+f+a+e+"</scorm>");r=null}else if(e=new CTATXML,null!=c)window[c](e.xmlToString(a.getXMLObject()));else b.sendSummary(a)};this.setGotProblemRestoreEnd=function(a){q=a};this.processProblemRestoreEnd=
function(a){d.ctatdebug("processProblemRestoreEnd() scrimIsUp "+scrimIsUp);q=!0;CTATScrim.scrim.scrimDown()};this.clearFeedbackComponents=function(){d.ctatdebug("clearFeedbackComponents ()");CTATShellTools.showHints(null)};this.processHintResponse=function(a,b){d.ctatdebug("processHintResponse()");unhighlightall();CTATShellTools.showHints(b);var c=a.getSAI();if(null!=c)if(c=c.getSelection(),null!=c)if(d.ctatdebug("Highlighting selection for hint: "+c),c=CTATShellTools.findComponent(c),null!=c)for(var e=
0;e<c.length;e++)1==CTATCommShell.detailedFeedback&&c[e].setHintHighlight(!0,a);else d.ctatdebug("Unable to find component name in list: "+c);else d.ctatdebug("Error: no highlight selection present in SAI");else d.ctatdebug("Warning: no SAI found in highlight message");CTATCommShell.detailedFeedback=!0;d.ctatdebug("processHintResponse() done")};this.showHighlightSelection=function(a,b){d.ctatdebug("showHighlightSelection ("+a+")");var c=CTATShellTools.findComponent(a);if(null!=c)for(var e=0;e<c.length;e++)1==
CTATCommShell.detailedFeedback&&(0===e?c[e].moveHintHightlight&&c[e].moveHintHighlight(!0,b):c[e].setHintHighlight&&c[e].setHintHighlight(!0,b));else d.ctatdebug("Unable to find component name in list: "+c)};this.globalReset=function(){d.ctatdebug("globalReset ()");CTATMessageHandler.scriptElement=""};this.nextProblem=function(b){d.ctatdebug("nextProblem ()");if(CTATGlobalFunctions.isBlank(b))d.ctatdebug("Message is blank, requesting next problem ..."),b=flashVars.getRawFlashVars().run_problem_url,
a.send(b);else{d.ctatdebug("Message contains html data, writing ...");try{document.close()}catch(n){alert("Error closing document: "+n.message)}try{document.write(b)}catch(n){alert("Error writing document: "+n.message)}}};this.updateSkillWindow=function(a){d.ctatdebug("updateSkillWindow()");CTATSkillSet.skills.untouchSkills();var b=CTATShellTools.findComponentByClass("CTATSkillWindow");null!==b?null!=a?b.updateSkillSet(a):b.drawComponent():d.ctatdebug("Info: no skill window available")};this.processComponentFocus=
function(a){d.ctatdebug("processComponentFocus("+a.getName()+","+a.getClassName()+")");"CTATTextInput"==a.getClassName()||"CTATTextField"==a.getClassName()||"CTATTextArea"==a.getClassName()?(CTATGlobals.selectedTextInput=a,null!==mobileAPI&&!0===mobileAPI.getEnabled()&&mobileAPI.processTextFocus(a.getX(),a.getY(),a.getWidth(),a.getHeight())):CTATGlobals.selectedTextInput=null;d.ctatdebug("processComponentFocus() done")};this.showFeedback=function(a){null!=a&&void 0!=a&&/\S/.test(a)&&" "!=a?(d.ctatdebug("showFeedback("+
a+") -> l: "+a.length),CTATShellTools.showFeedback(a),null!=m&&m(a)):d.ctatdebug("showFeedback(): False alarm: empty message. This can happen when the commshell is trying to clear the hint window and there is no hint window.")};this.assignFeedbackHandler=function(a){d.ctatdebug("assignFeedbackHandler()");m=a};this.gradeSAI=function(a,b,c){d.ctatdebug("gradeSAI()");h[a]=c;a=new CTATSAI(a,b,c);d.processComponentAction(a,!0,!0)};this.assignGradingHandler=function(a){d.ctatdebug("assignGradingHandler()");
l=a};this.assignAnonymousGradingProcessor=function(a){p=a};this.assignDoneProcessor=function(a){c=a};this.addEventListener=function(a,b){};this.addGlobalEventListener=function(a){d.ctatdebug("addGlobalEventListener()");x.push(a)};this.closeWSConnection=function(b,c,d){(b=a.findWSConnection(b))?b.close(d,c):console.warn("connection not found")}};CTATCommShell.prototype=Object.create(CTATBase.prototype);CTATCommShell.prototype.constructor=CTATCommShell;CTATCommShell.commShell=null;
CTATCommShell.detailedFeedback=!0;function enableDetailedFeedback(a){CTATCommShell.detailedFeedback=a};var CTATComponentReference=function(a,b){var e=a,f=b;this.setElement=function(a){e=a};this.getElement=function(){return e};this.setDiv=function(a){f=a};this.getDiv=function(){return f}};CTATComponentReference.components={};CTATComponentReference.list=function(){for(var a in CTATComponentReference.components){var b=CTATComponentReference.components[a];ctatdebug("Component: "+b.getElement().getName()+", with div: "+b.getDiv().id)}};
CTATComponentReference.getComponentFromID=function(a){var b=CTATComponentReference.components;return b.hasOwnProperty(a)?(a=b[a],a.getElement()?a.getElement():null):null};CTATComponentReference.add=function(a,b){var e=new CTATComponentReference(a,b);return CTATComponentReference.components[e.getDiv().getAttribute("id")]=e};var CTATCompBase=function(a,b,e,f,d,c){CTATBase.call(this,a,b);var g=e||0,h=f||0,l=d||-2,m=c||-2,r=50,p=25,x=!1,q=!1,u="",n=!1,B=!0,v=null,z="",A=null;this.isTabIndexable=!0;var D=0,H=null,w=this,E=null,t="hidden",C=CTATGlobalFunctions.gensym.z_index(),G=CTATGlobalFunctions.gensym.div_id(),y=CTATGlobalFunctions.gensym.z_index(),I=CTATGlobalFunctions.gensym.div_id();this.setIsAbstractComponent=function(a){x=a};this.isAbstractComponent=function(){return x};this.setIsFeedbackComponent=function(a){q=
a};this.isFeedbackComponent=function(){return q};this.setTabIndex=function(a){!0===this.isTabIndexable?(A=a,0>A?(A=CTATGlobals.Tab.Tracker,CTATGlobals.Tab.Tracker++):CTATGlobals.Tab.Tracker=A):A=-1};this.getTabIndex=function(){return A||this.getComponent().getAttribute("tabindex")};this.setZIndex=function(a){w.ctatdebug("Setting z index to: "+a);D=a;null!==v&&(v.style.zIndex=a)};this.getZIndex=function(){return D};this.setDefaultWidth=function(a){r=a};this.getDefaultWidth=function(){return r};this.setDefaultHeight=
function(a){p=a};this.getDefaultHeight=function(){return p};this.processCommShellEvent=function(a,b){w.ctatdebug("processCommShellEvent ("+a+")")};this.makeDivWrapper=function(a){v=document.createElement("div");v.id=this.getName();v.setAttribute("onkeypress","return noenter(event)");v.setAttribute("data-ctat-component",this.getClassName());v.style.position="absolute";v.style.left=g+"px";v.style.top=h+"px";v.style.zIndex=C;v.style.width=w.getWidth()+"px";v.style.height=w.getHeight()+"px";$(v).data("CTATComponent",
this);a.appendChild(v)};this.setDivWrapper=function(a){v=a;v.setAttribute("data-ctat-component",this.getClassName())};var F=this.setClassName;this.setClassName=function(a){F(a);v&&v.setAttribute("data-ctat-component",this.getClassName())};this.wrapComponent=function(a){w.ctatdebug("wrapComponent ()");w.makeDivWrapper(a);w.ctatdebug("wrapComponent () done")};this.createCanvas=function(){w.ctatdebug("createCanvas ()");E=document.createElement("canvas");E.setAttribute("id",I);E.setAttribute("onkeypress",
"return noenter(event)");E.setAttribute("width",l+canvasCalibrate+"px");E.setAttribute("height",m+canvasCalibrate+"px");E.setAttribute("style","border: 1px "+this.borderColor+" solid; "+("hidden"==t?"visibility: hidden; ":"")+"z-index:"+y+";");v.firstChild?v.insertBefore(E,v.firstChild):v.appendChild(E);return E};this.redraw=function(){var a=v.style.display;v.style.display="none";v.style.display=a};this.setCanvasVisibility=function(a){t=a};this.getSubCanvasCtx=function(){if(E)return E.getContext("2d")};
this.getSubCanvas=function(){return E};this.getX=function(){return g};this.getY=function(){return h};this.getWidth=function(){if(0>=l){var a;H?a=window.getComputedStyle(H):v&&(a=window.getComputedStyle(v));if(a)return parseFloat(a.width)}return l};this.getHeight=function(){if(0>=m&&v){var a=window.getComputedStyle(v);return parseFloat(a.getPropertyValue("height"))}return m};this.getText=function(){return u};this.getEnabled=function(){return B};this.assignEnabled=function(a){B=a;v.setAttribute("data-ctat-enabled",
B)};this.setEnabled=function(a){w.ctatdebug("setEnabled ("+a+")");w.assignEnabled(a);H?H.disabled=!B:w.ctatdebug("Error: component pointer is null")};this.lock=this.setEnabled.bind(w,!1);this.unlock=this.setEnabled.bind(w,!0);this.getDivWrap=function(){return v};this.getComponent=function(){return H};this.component=null;Object.defineProperty(this,"component",{get:function(){return H}});this.getCanvasZIndex=function(){return y};this.getComponentGroup=function(){return z};this.setComponent=function(a){H=
a;this.setEnabled(this.getEnabled())};this.getTopDivZIndex=function(){return C};this.getTopDivID=function(){return G};this.setComponentGroup=function(a){z=a;H&&(H.name=a)};this.assignText=function(a){u=a};this.init=function(){w.ctatdebug("THIS IS THE BASE INIT METHOD")};this.initialize=function(){w.ctatdebug("initialize ()");w.configFromDescription();w.init();w.processSerialization();w.render();w.processTabOrder();w.ctatdebug("initialize () done")};this.getInitialized=function(){return n};this.setInitialized=
function(a){w.ctatdebug("setInitialized ("+a+")");n=a;!0!==n||v?w.ctatdebug("Not wrapping, initialized="+n+", divWrapper = "+v):(w.ctatdebug("Wrapping a component and appending it to the top container div if one was never set ..."),(a=findPointOfAttachment(this.getName()))?(w.ctatdebug("Attaching component to existing MovieClip ..."),w.wrapComponent(a.getDivWrapper())):(w.ctatdebug("Attaching component to main div ..."),0<$("#"+ctatcontainer).length&&w.wrapComponent(getSafeElementById(ctatcontainer))));
w.getDivWrap().classList.add("CTATComponent");w.ctatdebug("setInitialized () done")};this.addSafeEventListener=function(a,b,c){w.ctatdebug("addSafeEventListener ("+a+")");w.ctatdebug("Adding event listener to: "+c);c?c.addEventListener(a,b):(H?(w.ctatdebug("Adding eventlistener to component instead of target"),H.addEventListener(a,b)):w.ctatdebug("Error: pointer to component is null, can't add event listener"),w.ctatdebug("addSafeEventListener () done"))};this.drawComponent=function(){};this.addComponentReference=
function(a,b){w.ctatdebug("addComponentReference ("+a.getName()+" -> "+b.getAttribute("id")+")");CTATComponentReference.add(a,b);w.ctatdebug("addComponentReference ()")};this.getComponentFromID=function(a){return CTATComponentReference.getComponentFromID(a)};this.processSerialization=function(){w.ctatdebug("processSerialization()");w.ctatdebug("implement in child class")};this.move=function(a,b){g=Number(a);h=Number(b);if(void 0===b||null===b||isNaN(h))if(0<=a.indexOf(",")){var c=a.split(",");g=Number(c[0]);
h=Number(c[1])}else h=0;g=isNaN(g)?0:g;h=isNaN(h)?0:h;v&&(v.style.left=g+"px",v.style.top=h+"px")};this.setSize=function(a,b){var c=Number(a),d=Number(b);(void 0===b||null===b||isNaN(d))&&0<=a.indexOf(",")&&(d=a.split(","),c=Number(d[0]),d=Number(d[1]));w.ctatdebug("setSize ("+c+","+d+")");isNaN(c)||w.setWidth(c);isNaN(d)||w.setHeight(d)};this.SetVisible=this.setVisible=function(a){a=CTATGlobalFunctions.toBoolean(a);t=!0===a?"block":"hidden";E&&E.setAttribute("style","border: 0px; position: absolute; "+
(a?"":"visibility:hidden; ")+"; left:"+g+"px; top:"+h+"px; z-index:"+y+";");v.style.visibility=!0===a?null:"hidden"};this.FadeIn=function(a){w.SetVisible(!0)};this.FadeOut=function(a){w.SetVisible(!1)};this.reset=function(){};this.setX=function(a){this.x=a;v.style.left=this.x+"px";!0===n&&this.render()};this.setY=function(a){this.y=a;v.style.top=this.y+"px";!0===n&&this.render()};this.setWidth=function(a){w.ctatdebug("setWidth ("+a+")");l=a;v?v.style.width=l+"px":w.ctatdebug("Internal error: no div wrapper available to set width")};
this.setHeight=function(a){w.ctatdebug("setHeight ("+a+")");m=a;v?v.style.height=m+"px":w.ctatdebug("Internal error: no div wrapper available to set height")};this.setText=function(a){u=a;return this};this.getValue=function(){return H?H.value:""};this.backgrade=!1;this.unHighlightAll=function(){$(".CTAT--hint").each(function(){for(var a=$(this),b=null;a&&null===b;)a.data("CTATComponent")?b=a.data("CTATComponent"):a=a.parent();b&&b.setHintHighlight&&b.setHintHighlight(!1,null)})};this.processOnFocus=
function(){w.ctatdebug("processOnFocus ("+w.getName()+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus!=w?(w.ctatdebug("CTATGlobals.Tab.Focus!=pointer, updating CTATGlobals.Tab.Focus ..."),CTATGlobals.Tab.Focus=w):w.ctatdebug("CTATGlobals.Tab.Focus==pointer");w.ctatdebug("processOnFocus () done")};this.processFocus=function(a){w.ctatdebug("processFocus ()");a.currentTarget.getAttribute("id");if(w){mobileAPI&&!0===mobileAPI.getEnabled()&&w.hideKeyboard();CTATCommShell.commShell&&
CTATCommShell.commShell.processComponentFocus(w);if(CTATGlobals.Tab.Focus){w.ctatdebug("old focus: "+CTATGlobals.Tab.Focus.getName()+", new focus:"+w.getName()+", correct: "+CTATGlobals.Tab.Focus.isCorrect());if(1==CTATGlobals.Tab.Focus.isCorrect()){w.ctatdebug("Previous focus is a correct component, don't backgrade!");return}if(CTATGlobals.Tab.Focus==w){w.ctatdebug("We're already there!");return}CTATGlobals.Tab.Focus.backgrade&&CTATGlobals.Tab.Focus.processAction()}else w.ctatdebug("No previously focused component yet, can't grade");
"hint"==w.getClassName()||"CTATHintButton"==w.getClassName()?w.ctatdebug("Info: focus moved to hint, bump"):(CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus,CTATGlobals.Tab.Focus=w,w.ctatdebug("processFocus () done"))}else w.ctatdebug("Error: component reference is null")};this.processTabOrder=function(){w.ctatdebug("processTabOrder ("+A+")");!0===x?w.ctatdebug("Component is an abstract component, bump"):H?(w.ctatdebug("We have a component, actually assigning to html component ..."),null!==A&&
(H.tabIndex=A),H.onfocus=w.processOnFocus):w.ctatdebug("Error: we don't have an html component yet, can't assign tab index")};this.hideKeyboard=function(){document.activeElement.blur();$("input").blur()}};CTATCompBase.prototype=Object.create(CTATBase.prototype);CTATCompBase.prototype.constructor=CTATCompBase;var CTATCSS=function(){var a=0,b=[],e=0,f=[],d=0,c=[];this.resetSelectors=function(){e=0;f=[];f[e]=[]};this.resetCSSStringArray=function(){c=[];d=0};this.clearCSS=function(){this.resetSelectors();this.resetCSSStringArray();b=[];a=0};this.addStringCSS=function(a){c[d]=a;d++};this.addCSSAttribute=function(c,d){b[a]=c;b[a+1]=d;a+=2};this.removeStringCSS=function(a){a=c.indexOf(a);0<=a&&c.splice(a,1)};this.removeCSSAttribute=function(a){a=b.indexOf(a);0<=a&&b.splice(a,2)};this.modifyCSSAttribute=function(a,
c){var d=b.indexOf(a);-1==d?this.addCSSAttribute(a,c):b[d+1]=c};this.addSelector=function(a){f[e]=[];f[e][0]=a;e++};this.addSelectorAttribute=function(a,b,c){var d=1;a:if(0===e)a=0;else{for(var g=0;g<f.length&&null!==f[g][0];g++)if(f[g][0]==a){a=g;break a}a=-1}for(;void 0!==f[a][d];)d++;f[a][d]=b;f[a][d+1]=c};this.toCSSString=function(){for(var a="",d=0;d<f.length;d++){for(var a=a+(f[d][0]+" { "),e=1;e<f[d].length;e++)a+=f[d][e],a=0===e%2?a+"; ":a+": ";a+=" }; "}for(d=0;d<b.length;d++)a+=b[d],a=0===
d%2?a+": ":a+"; ";for(d=0;d<c.length;d++)a+=c[d]+" ";return a}};CTAT.Component={};CTAT.Component.Base={};
CTAT.Component.Base.Style=function(a,b,e,f,d,c){CTATCompBase.call(this,a,b,e,f,d,c);var g=new CTATCSS;this.addCSSAttribute=function(a,b){g.addCSSAttribute(a,b);this.render()};this.removeCSSAttribute=function(a){g.removeCSSAttribute(a);this.render()};this.addStringCSS=function(a){g.addStringCSS(a);this.render()};this.removeStringCSS=function(a){g.removeStringCSS(a);this.render()};this.modifyCSSAttribute=function(a,b){g.modifyCSSAttribute(a,b);this.render()};this.getCSS=function(){return g.toCSSString()};
this.render=function(){!0===this.isAbstractComponent()?this.ctatdebug("Component is an abstract component, bump"):this.getInitialized()&&(this.getComponent()?this.ctatdebug(g.toCSSString()):this.ctatdebug("Internal error, html component not available for rendering"))};this.setStyleAll=function(a,b){this.getSubCanvas()&&this.getSubCanvas().setAttribute(a,b);this.modifyCSSAttribute(a,b)}};CTAT.Component.Base.Style.prototype=Object.create(CTATCompBase.prototype);
CTAT.Component.Base.Style.prototype.constructor=CTAT.Component.Base.Style;CTAT.Component.Base.Graphical=function(a,b,e,f,d,c,g){CTAT.Component.Base.Style.call(this,a,b,f,d,c,g);var h=e||(new CTATComponentDescription).setGenericDefaults();this.getGrDescription=function(){return h};this.setGrDescription=function(a){h=a;this.processDescription(h)};var l={},m={};this.getAlign=function(){return this.component?$(this.component).css("text-align"):$(this.getDivWrap()).css("text-align")};this.setAlign=function(a){this.component&&(this.component.style.textAlign=a);return this};this.getBackgroundColor=
function(){return $(this.getComponent()).css("background-color")};this.setBackgroundColor=function(a){a=a?CTATGlobalFunctions.formatColor(a):null;this.component&&(this.component.style.backgroundColor=a);return this};this.setDisabledBGColor=function(a){return this};this.setDisabledTextColor=function(a){return this};this.getBorderColor=function(){return $(this.getComponent()).css("border-color")};this.setBorderColor=function(a){a=CTATGlobalFunctions.formatColor(a);this.getComponent()?$(this.getComponent()).css("border-color",
a):this.getDivWrap().style.borderColor=a;return this};this.getBorderRoundness=function(){return $(this.getComponent()).css("border-radius")};this.setBorderRoundness=function(a){a=parseInt(a,10);isNaN(a)?a=l.roundness=0:l.roundness=a;a+="px";this.component&&this.getBorderRoundness()!==a&&($(this.component).css("border-radius",a),this.component.style.borderRadius=l.roundness);return this};this.getBorderStyle=function(){return $(this.getComponent()).css("borderStyle")};this.setBorderStyle=function(a){this.component&&
(this.component.style.borderStyle=a);return this};this.getBorderWidth=function(){return this.getComponent()?$(this.getComponent()).css("borderWidth"):l.width};this.setBorderWidth=function(a){l.width=a;/(\d*(px)? ?){1,3}(\d*(px)? ?)?/.test(a)||(a="0px",console.log("invalid width string"));this.component&&this.getBorderWidth()!==a&&$(this.component).css("borderWidth",a);return this};this.setPadding=function(a){a=parseInt(a);isNaN(a)&&(a=0);this.component&&(this.component.style.padding=a+"px");return this};
this.getFontColor=function(){if(this.component)return $(this.component).css("color")};this.setFontColor=function(a){console.log("setFontColor( )");m.color=CTATGlobalFunctions.formatColor(a);this.component&&(console.log("got comp"),this.getFontColor()!==m.color&&$(this.component).css("color",m.color));return m.color};this.setFontFamily=function(a){this.component&&(this.component.style.fontFamily=a);return this};this.getFontFamily=function(){if(this.component)return this.component.style.fontFamily;
console.warn("component not found");return null};this.setFontSize=function(a){a=parseInt(a);isNaN(a)?this.component.style.fontSize=null:(m.size=a,this.component&&(this.component.style.fontSize=a+"pt"));return this};this.setShowBorder=function(a){a=CTATGlobalFunctions.toBoolean(a);this.component&&(a?this.setBorderStyle("solid"):this.setBorderStyle("none"));return this};this.setUnderlined=function(a){p_underlined=CTATGlobalFunctions.toBoolean(a);this.component&&(this.component.style.textDecoration=
p_underlined?"underline":null);return this};this.setBolded=function(a){a=CTATGlobalFunctions.stringToBoolean(a);this.component&&(this.component.style.fontWeight=a?"bold":null);return this};this.setItalicized=function(a){CTATGlobalFunctions.toBoolean(a);this.component&&(this.component.style.fontStyle=m.italicized?"italic":null);return this};var r=this;a=function(a){var b=a||{};return{setHandler:function(a,c){b[a]=c},set:function(a){if(b.hasOwnProperty(a)){if(b[a]){var c=Array.prototype.slice.call(arguments,
1);return b[a].apply(r,c)}r.ctatdebug("Error: NULL handler for "+a)}else r.ctatdebug("Error: No handler set for "+a)}}};this.style_handlers=a({BackgroundColor:this.setBackgroundColor,BorderColor:this.setBorderColor,borderRoundness:this.setBorderRoundness,DrawBorder:this.setShowBorder,FontFace:this.setFontFamily,FontSize:this.setFontSize,FontBold:this.setBolded,FontItalic:this.setItalicized,FontUnderlined:this.setUnderlined,labelText:this.setText,padding:this.setPadding,showBorder:this.setShowBorder,
TextAlign:this.setAlign,TextColor:this.setFontColor});this.setStyle=function(a,b){this.style_handlers.set(a,b)};this.setStyleHandler=function(a,b){this.style_handlers.setHandler(a,b)};this.parameter_handlers=a({group:this.setComponentGroup});this.setParameter=function(a,b){this.parameter_handlers.set(a,b)};this.setParameterHandler=function(a,b){this.parameter_handlers.setHandler(a,b)};this.data_ctat_handlers={};this.processAttributes=function(){if(this.getDivWrap()){var a=$(this.getDivWrap()),b=parseInt(a.attr("tabindex"),
10)||parseInt(a.attr("data-ctat-tabindex"),10);isNaN(b)||(this.setTabIndex(b),a.attr("tabindex",null));b=a.attr("name");void 0!==b&&this.setComponentGroup(b);for(var c in this.data_ctat_handlers)b=a.data("ctat-"+c),void 0!==b&&this.data_ctat_handlers[c].apply(this,[b])}};this.data_ctat_handlers.enabled=function(a){this.setEnabled(CTATGlobalFunctions.toBoolean(a))};this.processParameters=function(a){if(a)if(a instanceof CTATComponentDescription){r.setName(a.name);a=a.params;for(var b in a)this.setParameter(b,
a[b])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+a)};this.processStyles=function(a){if(a)if(a instanceof CTATComponentDescription){a=a.styles;for(var b in a)this.setStyle(b,a[b])}else this.ctatdebug("Error: Invalid description sent to CTAT.Components.Hierarchy.Graphical.processDescription: "+a)};this.processDescription=function(a){this.processParameters(a);this.processStyles(a)};this.configFromDescription=function(){this.processParameters(h)};
this.processSerialization=function(){this.processStyles(h)}};CTAT.Component.Base.Graphical.prototype=Object.create(CTAT.Component.Base.Style.prototype);CTAT.Component.Base.Graphical.prototype.constructor=CTAT.Component.Base.Graphical;CTAT.Component.Base.SAIHandler=function(a,b,e,f,d,c,g){CTAT.Component.Base.Graphical.call(this,a,b,e,f,d,c,g);var h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt),l=this.setName;this.setName=function(a){l(a);h.setSelection(this.getName())};this.getSAI=function(){return h};this.setSAI=function(a,b,c){a instanceof CTATSAI?h=a:(a=null===a||void 0===a?this.getName():a,h=new CTATSAI(a,b,c,
CTAT.Component.Base.SAIHandler.DefaultPrompt));return this};this.setInput=function(a){h instanceof CTATSAI?h.setInput(a):h=new CTATSAI(this.getName(),CTAT.Component.Base.SAIHandler.DefaultAction,a,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setAction=function(a){h instanceof CTATSAI?h.setAction(a):h=new CTATSAI(this.getName(),a,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt);return this};this.setActionInput=function(a,b){this.setAction(a);
this.setInput(b);return this};this.setSelection=function(a){h instanceof CTATSAI?h.setSelection(a):h=new CTATSAI(a,CTAT.Component.Base.SAIHandler.DefaultAction,CTAT.Component.Base.SAIHandler.DefaultInput,CTAT.Component.Base.SAIHandler.DefaultPrompt)};this.updateSAI=function(){};this.executeSAI=function(a){this.ctatdebug("executeSAI ()");var b;b=a instanceof CTATMessage?a.getSAI():a;if(b instanceof CTATSAI){var c=b.getAction();this.ctatdebug("Processing "+c+"("+b.getInput()+") on: "+b.getSelection());
if("function"==typeof this[c]){b=b.getArgumentsTyped();this.ctatdebug("JSON args: "+JSON.stringify(b));try{this.ctatdebug("Executing "+c+"("+b+","+typeof a+")..."),b.push(a),this[c].apply(this,b)}catch(x){return this.ctatdebug("ERROR: failed to execute action: "+x.message),!1}this.component&&(a=new CustomEvent("CTAT_EXECUTE_SAI",{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(a));return!0}this.ctatdebug("ERROR: Unsupported action: "+c+" from "+b.toLSxmlString());
return!1}this.ctatdebug("ERROR: Non-SAI sent to executeSAI("+typeof a+")");return!1}};CTAT.Component.Base.SAIHandler.DefaultAction="ButtonPressed";CTAT.Component.Base.SAIHandler.DefaultInput="-1";CTAT.Component.Base.SAIHandler.DefaultPrompt="";CTAT.Component.Base.SAIHandler.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTAT.Component.Base.SAIHandler.prototype.constructor=CTAT.Component.Base.SAIHandler;CTAT.Component.Base.Tutorable=function(a,b,e,f,d,c,g){CTAT.Component.Base.SAIHandler.call(this,a,b,e,f,d,c,g);var h=!0,l=!0,m=!0,r=CTAT.Component.Base.Tutorable.Options.TutorComponent.TUTOR,p=this,x=!1;this.setTutorComponent=function(a){r=a;a=CTAT.Component.Base.Tutorable.Options.TutorComponent;switch(r){case a.TUTOR:m=h=l=!0;break;case a.TUTOR_NO_FEEDBACK:h=l=!0;m=!1;break;case a.DO_NOT_TUTOR:h=!1,l=!0}};this.setParameterHandler("tutorComponent",this.setTutorComponent);this.data_ctat_handlers.tutor=
function(a){h=CTATGlobalFunctions.toBoolean(a)};this.data_ctat_handlers["show-feedback"]=function(a){m=CTATGlobalFunctions.toBoolean(a)};this.getTutorComponent=function(){var a=CTAT.Component.Base.Tutorable.Options.TutorComponent;return h&&l&&m?a.TUTOR:h&&l&&!m?a.TUTOR_NO_FEEDBACK:!h&&l?a.DO_NOT_TUTOR:r};this.getDisableOnCorrect=function(){var a=$(this.getDivWrap()).attr("data-ctat-disable-on-correct");return a?CTATGlobalFunctions.toBoolean(a):!0};this.setDisableOnCorrect=function(a){$(this.getDivWrap()).attr("data-ctat-disable-on-correct",
a)};this.setParameterHandler("DisableOnCorrect",this.setDisableOnCorrect);var q=!0;this.getShowHintHighlight=function(){return q};this.setShowHintHighlight=function(a){q=CTATGlobalFunctions.toBoolean(a)};this.setParameterHandler("ShowHintHighlight",this.setShowHintHighlight);this.data_ctat_handlers["show-hint-highlight"]=function(a){q=CTATGlobalFunctions.toBoolean(a)};var u=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED;this.getComponentStatus=function(){return u};this.setComponentStatus=
function(a){u=a};this.isCorrect=function(){return u===CTAT.Component.Base.Tutorable.Options.Status.CORRECT};this.isIncorrect=function(){return u===CTAT.Component.Base.Tutorable.Options.Status.INCORRECT};this.isNotGraded=function(){return u===CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.setCorrect=function(a){this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(a);u=CTAT.Component.Base.Tutorable.Options.Status.CORRECT;!0===this.getDisableOnCorrect()&&this.setEnabled(!1);
!1===CTATGlobals.suppressStudentFeedback&&m&&this.showCorrect(a);this.ctatdebug("setCorrect() post showCorrect");this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.correct,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))};this.setIncorrect=function(a){this.ctatdebug("setIncorrect()");this.setNotGraded();"CTATTableGoogle"!=this.getClassName()&&this.executeSAI(a);u=CTAT.Component.Base.Tutorable.Options.Status.INCORRECT;!1===CTATGlobals.suppressStudentFeedback&&
m&&this.showInCorrect(a);this.component&&(a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.incorrect,{detail:{sai:a,component:this},bubbles:!0,cancelable:!0}),this.getDivWrap().dispatchEvent(a))};this.setNotGraded=function(){this.ctatdebug("setNotGraded ()");this.setHintHighlight(!1);if(!this.isNotGraded()&&(u=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED,this.removeCorrect(),this.removeInCorrect(),this.component)){var a=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.ungrade,
{detail:{component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(a)}};this.showHintHighlight=function(a,b){this.component.classList.remove("CTAT--correct");this.component.classList.remove("CTAT--incorrect");a?this.component.classList.add("CTAT--hint"):this.component.classList.remove("CTAT--hint")};this.setHintHighlight=function(a,b){this.ctatdebug("setHintHighlight ("+a+")");if(q){var c=CTATGlobalFunctions.toBoolean(a);if(this.component){var d=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,
{detail:{isHighlighted:c,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(d)}c!==x&&(x=c,this.showHintHighlight(c,b))}};this.moveHintHighlight=function(a,b){this.ctatdebug("moveHintHighlight ("+a+")");CTATGlobals.Tab.previousFocus=CTATGlobals.Tab.Focus;CTATGlobals.Tab.Focus=p;p.component.focus?CTATGlobals.Tab.Focus.getComponent().focus():CTATGlobals.Tab.Focus.getDivWrap().focus();if(q){var c=CTATGlobalFunctions.toBoolean(a);if(this.component){var d=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.highlight,
{detail:{isHighlighted:c,component:this},bubbles:!0,cancelable:!0});this.getDivWrap().dispatchEvent(d)}c!==x&&(x=c,this.showHintHighlight(c,b))}};this.highlight=function(a){ctatdebug("highlight ()");this.component.classList.add("CTAT--highlight")};this.unhighlight=function(a){ctatdebug("unhighlight ()");this.component.classList.remove("CTAT--highlight")};this.showCorrect=function(a){this.ctatdebug("showCorrect("+a+")");this.getComponent().classList.remove("CTAT--incorrect");this.getComponent().classList.remove("CTAT--hint");
this.getComponent().classList.add("CTAT--correct")};this.removeCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--correct")};this.showInCorrect=function(a){this.ctatdebug("showInCorrect("+a+")");this.getComponent().classList.remove("CTAT--correct");this.getComponent().classList.remove("CTAT--hint");this.getComponent().classList.add("CTAT--incorrect")};this.removeInCorrect=function(){this.getComponent()&&this.getComponent().classList.remove("CTAT--incorrect")};this.resetTutoring=
function(){this.showHintHighlight(!1);this.removeCorrect();this.removeInCorrect();u=CTAT.Component.Base.Tutorable.Options.Status.NOTGRADED};this.grade=function(){this.updateSAI();this.processAction(!0)};this.processAction=function(a,b){this.ctatdebug("processAction("+a+","+b+")");p.unHighlightAll();var c=CTATShellTools.findComponentByClass("CTATDoneButton");c&&c instanceof CTAT.Component.Base.Tutorable&&c!=this&&c.setNotGraded();this.ctatdebug("processAction() finished checking doneButton");ctatdebug("Clearing hint window ...");
CTATCommShell.commShell&&CTATCommShell.commShell.clearFeedbackComponents();a=void 0===a||null===a?!1:a;b=void 0===b||null===b?!1:b;""!==this.getComponentGroup()?CTATShellTools.findComponent(this.getComponentGroup()).forEach(function(a){a.setNotGraded()}):this.setNotGraded();this.ctatdebug("processAction() finished setNotGraded");CTATCommShell.commShell&&(a?CTATCommShell.commShell.processComponentAction(this.getSAI(),!0,!0):b?CTATCommShell.commShell.processComponentAction(this.getSAI(),!1,!0):CTATCommShell.commShell.processComponentAction(this.getSAI(),
h,l));this.ctatdebug("processAction() finished call to commShell.processComponentAction");this.component&&(c=new CustomEvent(CTAT.Component.Base.Tutorable.EventType.action,{detail:{sai:this.getSAI(),component:this},bubbles:!0,cancelable:!0}),this.component.dispatchEvent(c))}};CTAT.Component.Base.Tutorable.Options={TutorComponent:{TUTOR:"Tutor",TUTOR_NO_FEEDBACK:"Tutor but no visual feedback",DO_NOT_TUTOR:"Do not tutor"},Status:{CORRECT:"CORRECT",INCORRECT:"INCORRECT",NOTGRADED:"NOTGRADED"}};
CTAT.Component.Base.Tutorable.EventType={correct:"CTAT_CORRECT",incorrect:"CTAT_INCORRECT",highlight:"CTAT_HIGHLIGHT",ungrade:"CTAT_NOTGRADED",action:"CTAT_ACTION"};CTAT.Component.Base.Tutorable.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);CTAT.Component.Base.Tutorable.prototype.constructor=CTAT.Component.Base.Tutorable;CTAT.Component.Base.Clickable=function(a,b,e,f,d,c,g){CTAT.Component.Base.Tutorable.call(this,a,b,e,f,d,c,g);var h=this;this.processClick=function(a){h.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===h.getEnabled()?h.processAction():h.ctatdebug("Component is disabled, not grading")};this.setClickable=function(a){h.setEnabled(a)}};CTAT.Component.Base.Clickable.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);
CTAT.Component.Base.Clickable.prototype.constructor=CTAT.Component.Base.Clickable;var CTATButtonBasedComponent=function(a,b,e,f,d,c,g){CTAT.Component.Base.Clickable.call(this,a,b,e,f,d,c,g);var h=this,l="",m="black";this.setActionInput("ButtonPressed","-1");this.setImage=function(a){h.ctatdebug("assignImage ("+a+")");h.getDivWrap().setAttribute("data-ctat-img",a);a&&(a="url('"+a+"')");$(h.getComponent()).css("background-image",a);$(h.getComponent()).css("background-size","cover")};this.assignImage=function(a){h.ctatdebug("assignImage ()");h.assignImages(a,a,a,a)};this.assignImageURL=
function(a){h.ctatdebug("assignImageURL ()");h.assignImages(a,a,a,a)};this.assignImages=function(a,b,c,d){h.ctatdebug("assignImages ()");h.getDivWrap().setAttribute("data-ctat-image-hover",a);h.getDivWrap().setAttribute("data-ctat-image-clicked",b);h.getDivWrap().setAttribute("data-ctat-image-default",c);h.getDivWrap().setAttribute("data-ctat-image-disabled",d);this.setImage(c)};this.processBaseMousedown=function(){h.ctatdebug("processMousedown ()");h.component.classList.add("CTAT-button--clicked");
var a=h.getDivWrap().getAttribute("data-ctat-image-clicked");h.getEnabled()&&a&&void 0!==a&&""!==a&&null!==a&&(h.getComponent().style.backgroundImage="url('"+a+"')")};this.processBaseMouseup=function(){h.ctatdebug("processMouseup ()");h.component.classList.remove("CTAT-button--clicked");var a=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&a&&void 0!==a&&""!==a&&null!==a&&(h.getComponent().style.backgroundImage="url('"+a+"')")};this.processBaseMouseover=function(){h.ctatdebug("processBaseMouseover ()");
h.component.classList.add("CTAT-button--hover");var a=h.getDivWrap().getAttribute("data-ctat-image-hover");h.getEnabled()&&a&&void 0!==a&&""!==a&&(h.getComponent().style.backgroundImage="url('"+a+"')")};this.processBaseMouseout=function(){h.ctatdebug("processBaseMouseout ()");h.component.classList.remove("CTAT-button--hover");h.component.classList.remove("CTAT-button--clicked");var a=h.getDivWrap().getAttribute("data-ctat-image-default");h.getEnabled()&&a&&void 0!==a&&""!==a&&(h.getComponent().style.backgroundImage=
"url('"+a+"')")};this.setText=function(a){h.ctatdebug("setText ("+a+")");l=a;null!==h.getComponent()&&(h.getComponent().innerHTML=l)};this.setFontColor=function(a){m=a;$(h.getComponent()).css("color",a)};this.getFontColor=function(){return m};this.setStyleHandler("labelText",this.setText);this.getText=function(){return l};this.processClick=function(a){h.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===h.getEnabled()?(null!==CTATGlobals.Tab.Focus&&("CTATTextArea"==
CTATGlobals.Tab.Focus.getClassName()||"CTATTextInput"==CTATGlobals.Tab.Focus.getClassName()||"CTATTextField"==CTATGlobals.Tab.Focus.getClassName()?CTATGlobals.Tab.Focus.processAction():h.ctatdebug("Info: CTATGlobals.Tab.Focus==null")),a=$(h.getDivWrap()).attr("value"),h.setInput(a?a:"-1"),h.processAction()):h.ctatdebug("Component is disabled, not grading")};this.ButtonPressed=function(){}};CTATButtonBasedComponent.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);
CTATButtonBasedComponent.prototype.constructor=CTATButtonBasedComponent;CTAT.ComponentRegistry={};CTAT.ComponentRegistry.addComponentType=function(){};Object.defineProperty(CTAT.ComponentRegistry,"addComponentType",{enumerable:!1,value:function(a,b){"string"==typeof a&&(this.hasOwnProperty(a)?alert(a+" is already a registered component"):this[a]=b)}});var CTATAudioButton=function(a,b,e,f,d){CTATButtonBasedComponent.call(this,"CTATAudioButton","audiobutton",a,b,e,f,d);var c=this;c.setActionInput("play","-1");var g=null,h="",l=CTATConfiguration.get("previewMode");this.setSource=function(a){this.getDivWrap().setAttribute("data-ctat-src",a);return this};this.getSource=function(){return this.getDivWrap().getAttribute("data-ctat-src")};this.setParameterHandler("SoundFile",this.setSource);this.init=function(){var a=document.createElement("button");a.value=
"-1";a.name=c.getName();a.setAttribute("id",CTATGlobalFunctions.gensym.div_id());a.setAttribute("onkeypress","return noenter(event)");a.classList.add("CTAT-button");if(this.getDivWrap().getAttribute("data-ctat-label"))a.textContent=this.getDivWrap().getAttribute("data-ctat-label");else if(c.getText())a.textContent=c.getText();else if(c.getDivWrap()&&c.getDivWrap().innerHTML&&!l){var b=c.getDivWrap().innerHTML;c.getDivWrap().innerHTML="";a.innerHTML=b}c.setInitialized(!0);c.setComponent(a);c.addComponentReference(c,
a);c.getDivWrap().appendChild(a);c.ctatdebug("Final location: "+c.getX()+","+c.getY()+" with text: "+c.getText());l||(a.addEventListener("click",c.processClick),a.addEventListener("focus",c.processFocus));g=document.createElement("audio");g.addEventListener("canplay",function(){c.ctatdebug("Audio loaded and ready for play");""!==h&&(c.logAudioEvent(h),h="")},!0);g.onended=function(){c.ctatdebug("Audio ended");c.logAudioEvent("end")};this.getDivWrap().appendChild(g)};this.getConfigurationActions=function(){var a=
[],b;0<this.component.innerHTML.trim().length&&(b=new CTATSAI,b.setSelection(this.getName()),b.setInput(this.component.innerHTML.toString()),b.setAction("setText"),a.push(b));0<this.getSource().trim().length&&(b=new CTATSAI,b.setSelection(this.getName()),b.setInput(this.getSource()),b.setAction("setSource"),a.push(b));return a};this.reset=function(){c.configFromDescription();c.processSerialization();c.setEnabled(!0);h="reset"};this.logAudioEvent=function(a){c.ctatdebug("logAudioEvent ("+a+")");if(void 0!==
g.duration)if(null!==CTATCommShell.commShell){a=new CTATSAI(c.getName(),a,c.toHHMMSS(g.currentTime)+".000","");a.addSelection(encodeURIComponent(g.currentSrc),"media_file");a.addSelection(c.toHHMMSS(g.duration)+".000","clip_length");var b=a.getInputObject();null!==b&&b.setType("time");CTATCommShell.commShell.processComponentAction(a,!1,!0,c,"AUDIO_ACTION","USER")}else c.ctatdebug("Error: commShell is null, can't send untutored tool message");else c.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};
this.processClick=function(a){c.ctatdebug("processClick ("+a.currentTarget.getAttribute("id")+" -> "+a.eventPhase+")");!0===c.getEnabled()?(a=this.getSource(),c.ctatdebug("Playing audio file: "+a),g.setAttribute("src",a),g.play(),h="play",c.processAction()):c.ctatdebug("Component is disabled, not grading")}.bind(this);this.play=function(){c.ctatdebug("play");var a=this.getSource();g.setAttribute("src",a);g.load();g.play();h="play"};this.playClip=function(a){c.ctatdebug("playClip");g.setAttribute("src",
a);g.load();g.play();h="play"};this.pause=function(){c.ctatdebug("pause");g.pause();h="pause"}};CTATAudioButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATAudioButton.prototype.constructor=CTATAudioButton;CTAT.ComponentRegistry.addComponentType("CTATAudioButton",CTATAudioButton);var CTATButton=function(a,b,e,f,d){CTATButtonBasedComponent.call(this,"CTATButton","aButton",a,b,e,f,d);var c=this,g=null,h=CTATConfiguration.get("previewMode");this.init=function(){c.ctatdebug("init ("+c.getName()+")");c.setActionInput("ButtonPressed","-1");g=document.createElement("button");g.type="button";g.name=c.getName();g.value=$(this.getDivWrap()).attr("value")||"-1";this.setInput(g.value);g.id=CTATGlobalFunctions.gensym.div_id();g.setAttribute("onkeypress","return noenter(event)");g.classList.add("CTAT-button");
c.setInitialized(!0);if(c.getDivWrap().getAttribute("data-ctat-label"))g.innerHTML=c.getDivWrap().getAttribute("data-ctat-label");else if(c.getText())g.innerHTML=c.getText();else if(c.getDivWrap()&&c.getDivWrap().innerHTML&&!h){var a=c.getDivWrap().innerHTML;c.getDivWrap().innerHTML="";g.innerHTML=a}c.setComponent(g);c.addComponentReference(c,g);c.getDivWrap().appendChild(g);g.addEventListener("click",c.processClick);g.addEventListener("focus",c.processFocus);g.addEventListener("mousedown",this.processBaseMousedown);
g.addEventListener("mouseup",this.processBaseMouseup);g.addEventListener("mouseover",c.processBaseMouseover);g.addEventListener("mouseout",c.processBaseMouseout)}.bind(this);this.render=function(){};this.getConfigurationActions=function(){var a=[],b;0<g.innerHTML.trim().length&&(b=new CTATSAI,b.setSelection(this.getName()),b.setInput(g.innerHTML.toString()),b.setAction("setText"),a.push(b));return a};this.reset=function(){c.configFromDescription();c.processSerialization();c.setEnabled(!0)}};
CTATButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATButton.prototype.constructor=CTATButton;CTAT.ComponentRegistry.addComponentType("CTATButton",CTATButton);var CTATCheckBox=function(a,b,e,f,d){CTAT.Component.Base.Clickable.call(this,"CTATCheckBox","__undefined__",a,b,e,f,d);var c=null,g=null,h=CTATConfiguration.get("previewMode");this.setStyleHandler("inspBackgroundColor",null);this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("DrawBorder",null);this.setStyleHandler("showBorder",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("TextAlign",null);var l=this;this.setSelection(this.getComponentGroup());this.setAction("UpdateCheckBox");
this.getCheckBox=function(){return c};this.setStyleHandler("labelPlacement",null);var m=function(a){this.updateSAI();this.processClick(a)};this.init=function(){l.setInitialized(!0);c=document.createElement("input");c.type="checkbox";c.setAttribute("id",this.getName()+"_check");c.classList.add("CTATCheckBox--button");this.getText()?c.value=l.getText():this.getDivWrap()&&this.getDivWrap().textContent?c.value=this.getDivWrap().textContent:c.value=c.id;this.getComponentGroup()?c.name=l.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?c.name=$(this.getDivWrap()).attr("name"):c.name="checkBoxGroup";!0===l.getEnabled()?c.disabled=!1:c.disabled=!0;l.ctatdebug("Final location: "+l.getX()+","+l.getY()+" with text: "+l.getText());l.addComponentReference(l,c);if(!h){var a=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML=""}$(l.getDivWrap()).append(c);g=document.createElement("label");g.htmlFor=c.id;g.classList.add("CTATCheckBox--label");this.getText()?g.textContent=this.getText():
a&&!h?g.innerHTML=a:this.getDivWrap().getAttribute("data-ctat-label")&&this.setText(this.getDivWrap().getAttribute("data-ctat-label"));$(this.getDivWrap()).append(g);l.setComponent(c);c.addEventListener("click",m.bind(this));c.addEventListener("focus",l.processFocus);c.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup())};this.resize=function(){var a=$(this.getDivWrap()).height();$(g).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",
a-10+"px")};this.getConfigurationActions=function(){var a=[],b;0<g.innerHTML.trim().length&&(b=new CTATSAI,b.setSelection(this.getName()),b.setInput(g.innerHTML.toString()),b.setAction("setText"),a.push(b));return a};var r=this.setText;this.setText=function(a){l.ctatdebug("setText ("+a+")");r(a);c&&(c.value=a,g.innerHTML=a)};this.setStyleHandler("labelText",this.setText);var p=this.setEnabled;this.setEnabled=function(a){p(a);c&&(c.disabled=!this.getEnabled())};this.getCheckBoxInput=function(){return g.innerHTML+
": "+c.checked};this.reset=function(){c.checked=!1;l.setEnabled(!0)};this.UpdateCheckBox=function(a){var b=new RegExp("(^|;)"+CTATCheckBox.escape(g.innerHTML)+"\\s*:\\s*true");c.checked=0<=a.search(b)};this.SetSelected=function(a){a=CTATGlobalFunctions.toBoolean(a);c.checked=a};this.updateSAI=function(){var a=$('div[data-ctat-component]:has(input[type="checkbox"][name="'+c.name+'"])').sort(function(a,b){var c=a.id,d=b.id;return c>d?1:c<d?-1:0}),a=$.map(a,function(a){a=$(a).data("CTATComponent").getCheckBox();
return a.value+": "+a.checked});this.setSelection(c.name);this.setAction("UpdateCheckBox");this.setInput(a.join(";"))};var x=function(a){g.classList.add(a);c.classList.add(a)},q=function(a){g.classList.remove(a);c.classList.remove(a)};this.showCorrect=function(a){q("CTAT--incorrect");q("CTAT--hint");x("CTAT--correct")};this.removeCorrect=q.bind(this,"CTAT--correct");this.showInCorrect=function(a){q("CTAT--correct");q("CTAT--hint");x("CTAT--incorrect")};this.removeInCorrect=q.bind(this,"CTAT--incorrect");
this.showHintHighlight=function(a){q("CTAT--incorrect");q("CTAT--correct");a?x("CTAT--hint"):q("CTAT--hint")}};CTATCheckBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATCheckBox.prototype.constructor=CTATCheckBox;CTATCheckBox.escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s\/]/g,"\\$&")};CTAT.ComponentRegistry.addComponentType("CTATCheckBox",CTATCheckBox);var CTATComboBox=function(a,b,e,f,d){CTAT.Component.Base.Clickable.call(this,"CTATComboBox","__undefined__",a,b,e,f,d);var c=this,g=null;this.component=null;var h=CTATConfiguration.get("previewMode");this.setAction("UpdateComboBox");var l=",";a=function(a){l=a;g&&(g.innerHTML="",this.addLabels(m,l))}.bind(this);this.setStyleHandler("SplitCharacter",a);this.data_ctat_handlers["split-on"]=a;var m=null;this.setLabels=function(a){m=a;g&&(g.innerHTML="",this.addLabels(m,l))}.bind(this);this.setStyleHandler("Labels",
this.setLabels);this.data_ctat_handlers.labels=this.setLabels;var r=null;a=function(a){a=parseInt(a);r=isNaN(a)?null:a;g&&g.setAttribute("size",r)};this.setStyleHandler("DropDownSize",a);this.data_ctat_handlers.size=a;this.setStyleHandler("DropDownWidth",null);this.setNumOptions=a;this.init=function(){c.setInitialized(!0);g=document.createElement("select");g.name=c.getName();g.setAttribute("id",CTATGlobalFunctions.gensym.div_id());g.setAttribute("onkeypress","return noenter(event)");g.onchange=this.processComboSelection;
g.classList.add("CTAT-combobox");r&&!h&&g.setAttribute("size",r);if(!h){var a=this.getDivWrap().innerHTML;this.getDivWrap().innerHTML="";a.trim()&&(g.innerHTML=a)}m&&this.addLabels(m,l);!0===c.getEnabled()?g.disabled=!1:g.disabled=!0;c.addComponentReference(c,g);c.setComponent(g);c.getDivWrap().appendChild(g);this.component=g;g.addEventListener("focus",c.processFocus)};this.getConfigurationActions=function(){var a=[];if(m){var b=new CTATSAI;b.setSelection(this.getName());b.setInput(m);b.setAction("setLabels");
a.push(b)}return a};this.getHTMLComponent=function(){return g};this.addLabels=function(a,b){for(var c=a.split(b?b:l),d=0;d<c.length;d++)this.addItem(c[d])};this.addBlank=function(a){for(var b=0;b<a;b++)this.addItem("")};this.addItem=function(a){c.ctatdebug("addItem ("+a+")");var b=document.createElement("option");b.setAttribute("value",a);b.textContent=a;g.appendChild(b)};this.setFontSize=function(a){isNaN(a)||($(this.getComponent()).css("font-size",a+"px"),this.getDivWrap().setAttribute("data-ctat-font-size",
a))};this.valid_selection=function(){return 0<=g.selectedIndex&&!CTATGlobalFunctions.isBlank(g.value)};this.processComboSelection=function(){c.ctatdebug("processComboSelection ()");c.setInput(g.options[g.selectedIndex].value);c.valid_selection()?c.processAction():this.ctatdebug("Empty component, nothing to grade")};this.UpdateComboBox=function(a){g.value=a};this.updateSAI=function(){c.setInput(g.value)}};CTATComboBox.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);
CTATComboBox.prototype.constructor=CTATComboBox;CTAT.ComponentRegistry.addComponentType("CTATComboBox",CTATComboBox);var CTATDoneButton=function(a,b,e,f,d){CTAT.Component.Base.Clickable.call(this,"done","CTATDoneButton",a,b,e,f,d);this.setName("done");this.setClassName("CTATDoneButton");this.setText(CTATGlobals.languageManager.getString("DONE"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);var c=this;this.init=function(){this.setInitialized(!0);var a=document.createElement("button");a.classList.add("unselectable");a.classList.add("CTAT-done-button");this.setComponent(a);var b=
document.createElement("div");b.classList.add("CTAT-done-button--content");a.appendChild(b);var c=document.createElement("div");c.textContent="\u2714";c.classList.add("CTAT-done-button--icon");b.appendChild(c);this.getText()&&(c=document.createElement("div"),c.classList.add("CTAT-done-button--text"),c.textContent=this.getText(),b.appendChild(c));this.getDivWrap().appendChild(a);a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-done-button--hover")});a.addEventListener("mouseleave",
function(a){a.target.classList.remove("CTAT-done-button--hover");a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-done-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-done-button--clicked")});a.addEventListener("click",this.processClick);a.addEventListener("focus",this.processFocus)};
this.processClick=function(a){c.getEnabled()&&CTATCommShell.commShell&&CTATCommShell.commShell.processDone()}};CTATDoneButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATDoneButton.prototype.constructor=CTATDoneButton;CTAT.ComponentRegistry.addComponentType("CTATDoneButton",CTATDoneButton);var CTATDragNDrop=function(){CTAT.Component.Base.Tutorable.call(this,"CTATDragNDrop","aDnD");this.setParameterHandler("groupname",function(a){this.getDivWrap()&&$(this.getDivWrap()).attr("name",a)});this.set_child_limit=function(a){a=parseInt(a);isNaN(a)||$(this.component).attr("data-ctat-max-cardinality",a)};this.setParameterHandler("MaxObjects",this.set_child_limit);this.get_child_limit=function(){var a=parseInt($(this.component).attr("data-ctat-max-cardinality"));return isNaN(a)?-1:a};var a=function(a){return a.split("").reduce(function(a,
b){a=(a<<5)-a+b.charCodeAt(0);return a&a},0)},b=function(b){var c=$(this).parent().attr("name"),d=$(this).parent().attr("id");b.dataTransfer.setData("ctat/group",c);b.dataTransfer.setData("ctat/source",d);b.dataTransfer.setData("text",this.id);var e=a(this.id);CTATDragNDrop.dragging[e]={id:this.id,group:c,source:d};b.dataTransfer.setData("ctat/id/"+e,e)},e=function(a){for(var b,c=0;c<a.dataTransfer.types.length;c++)if(b=/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[c]))b=b[1],CTATDragNDrop.dragging.hasOwnProperty(b)&&
delete CTATDragNDrop.dragging[b]},f=null;this.init=function(){f=this.getDivWrap();if(!$(f).attr("name")){var a=CTATDragNDrop.default_groupname;this.getComponentGroup()&&(a=this.getComponentGroup());$(f).attr("name",a)}this.setComponent(f);CTATComponentReference.add(this,f);CTATConfiguration.get("previewMode")||$(f).children().addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}).each(function(){this.id||(this.id=CTATGlobalFunctions.gensym.div_id());this.addEventListener("dragstart",
b,!1);this.addEventListener("dragend",e,!1)});this.component.addEventListener("dragover",function(a){var b=!1;if($(this).data("CTATComponent").getEnabled()){var c=parseInt($(this).attr("data-ctat-max-cardinality"));if((isNaN(c)||0>c||$(this).children().length<c)&&(new Set(a.dataTransfer.types)).has("ctat/group"))if(a.dataTransfer.getData("text"))a.dataTransfer.getData("ctat/group")===$(this).attr("name")&&a.dataTransfer.getData("ctat/source")!==this.id&&(b=!0);else for(var d,c=0;c<a.dataTransfer.types.length;c++)if(d=
/^ctat\/id\/(.+)$/.exec(a.dataTransfer.types[c]))d=d[1],CTATDragNDrop.dragging.hasOwnProperty(d)&&CTATDragNDrop.dragging[d].group===$(this).attr("name")&&CTATDragNDrop.dragging[d].source!==this.id&&(b=!0)}b&&(a.preventDefault(),a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move",this.classList.add("CTATDragNDrop--valid-drop"))},!1);this.component.addEventListener("drop",function(a){a.preventDefault();this.classList.remove("CTATDragNDrop--valid-drop");var b=$(this).data("CTATComponent");
if(b.getEnabled()){var c=a.dataTransfer.getData("text");a.dataTransfer.getData("ctat/source");a=document.getElementById(c);this.appendChild(a);$("#"+c).removeClass("CTAT--correct CTAT--incorrect CTAT--hint");b.setActionInput("Add",c);b.processAction()}},!1);this.component.addEventListener("dragleave",function(a){this.classList.remove("CTATDragNDrop--valid-drop")},!1);this.setInitialized(!0)};this.getConfigurationActions=function(){var a=[],b=[];$(this.component).children().each(function(){b.push($(this).attr("id"))});
if(0<b.length){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("SetChildren");c.setInput(b.sort().join(";"));a.push(c)}return a};var d=this.setEnabled;this.setEnabled=function(a){d(a);f&&($(f).children().attr("draggable",a),this.getDisableOnCorrect()&&$(f).find(".CTAT--correct").attr("draggable",!1))};this.Add=function(a){a=$("#"+a);0<a.length&&a.appendTo(this.getDivWrap());$(a).hasClass("CTATDragNDrop--item")||($(a).addClass("CTATDragNDrop--item").attr({unselectable:"on",draggable:!0}),
a.addEventListener("dragstart",b,!1),a.addEventListener("dragend",e,!1))};this.SetChildren=function(a){a.split(";").forEach(function(a){this.Add(a)},this)};this.updateSAI=function(){var a=[];$(this.component).children().each(function(){a.push($(this).attr("id"))});this.setActionInput("SetChildren",a.sort().join(";"))};var c=this.showCorrect.bind(this);this.showCorrect=function(a){switch(a.getAction()){case "Add":this.setEnabled(!0);a=a.getInput();$("#"+a).addClass("CTAT--correct");this.getDisableOnCorrect()&&
$("#"+a).attr("draggable",!1);break;default:c(a)}};var g=this.showInCorrect.bind(this);this.showInCorrect=function(a){switch(a.getAction()){case "Add":a=a.getInput();$("#"+a).addClass("CTAT--incorrect");break;default:g(a)}}};CTATDragNDrop.dragging={};CTATDragNDrop.default_groupname="DragNDropGroup";CTATDragNDrop.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATDragNDrop.prototype.constructor=CTATDragNDrop;CTAT.ComponentRegistry.addComponentType("CTATDragNDrop",CTATDragNDrop);CTAT.Math={LeastCommonMultiple:function(a,b){return a*b/CTAT.Math.GreatestCommonDivisor(a,b)},GreatestCommonDivisor:function(a,b){if(0>a||0>b)return CTAT.Math.GreatestCommonDivisor(Math.abs(a),Math.abs(b));if(1===a||1===b)return 1;if(0===a)return b;if(0===b)return a;var e=function(a,b){return b?e(b,a%b):a};return e(a,b)},round10:function(a,b){if("undefined"===typeof b||0===Number(b))return Math.round(a);a=Number(a);b=Number(b);if(isNaN(a)||"number"!==typeof b||0!==b%1)return NaN;a=a.toString().split("e");
a=Math.round(Number(a[0])+"e"+(a[1]?Number(a[1])-b:-b));a=a.toString().split("e");return Number(a[0]+"e"+(a[1]?Number(a[1])+b:b))},precision:4,round:function(a){return CTAT.Math.round10(a,-CTAT.Math.precision)},rad2deg:function(a){return CTAT.Math.round(180*a/Math.PI)},deg2rad:function(a){return a*Math.PI/180}};CTAT.Math.Fraction=function(a,b){this._numerator=0;this._denominator=1;this.set(a,b)};
CTAT.Math.Fraction.prototype=Object.create(CTAT.Math.Fraction.prototype,{numerator:{get:function(){return this._numerator},set:function(a){this._numerator=a}},denominator:{get:function(){return this._denominator},set:function(a){this._denominator=a}},toString:{value:function(){return 1===this.denominator?String(this._numerator):String(this._numerator)+"/"+String(this._denominator)}},valueOf:{value:function(){return this.numerator/this.denominator}},fromString:{value:function(a){var b=a.match(/(\d*\.?\d*)\s*\/\s*(\d*\.?\d*)/);
b?(this._numerator=Number(b[1]),this._denominator=Number(b[2])):this.fromValue(a)}},fromValue:{value:function(a){this._numerator=Number(a.valueOf());this._denominator=1}},toMathML:{value:function(){var a=document.createElementNS("http://www.w3.org/1998/Math/MathML","math"),b=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");b.textContent=this.numerator;if(1==this.denominator)a.appendChild(b);else{var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mfrac"),f=document.createElementNS("http://www.w3.org/1998/Math/MathML",
"mrow");f.appendChild(b);e.appendChild(f);b=document.createElementNS("http://www.w3.org/1998/Math/MathML","mrow");f=document.createElementNS("http://www.w3.org/1998/Math/MathML","mn");f.textContent=this.denominator;b.appendChild(f);e.appendChild(b);a.appendChild(e)}return a}},is_proper:{get:function(){return Math.abs(this._numerator)<Math.abs(this._denominator)}},whole_part:{get:function(){return Math.floor(this.valueOf())}},remainder_part:{get:function(){return new CTAT.Math.Fraction(this._numerator%
this._denominator,this._denominator)}},set_denominator:{value:function(a){this._numerator=this.numerator*a/this.denominator;1E-9>Math.abs(this.numerator-Math.round(this.numerator))&&(this.numerator=Math.round(this.numerator));this._denominator=a;return this}},scale:{value:function(a){this._numerator*=a;this._denominator=0===a?1:Math.abs(this._denominator*a)}},set:{value:function(a,b){this._numerator=0;this._denominator=1;"undefined"!==typeof a&&b?(this.numerator="number"===typeof a?a:"string"===typeof a?
Number(a):a?a.valueOf():0,this.denominator="number"===typeof b?b:"string"===typeof b?Number(b):b.valueOf()):a&&(a instanceof CTAT.Math.Fraction?(this.numerator=a.numerator,this.denominator=a.denominator):"number"===typeof a?(this.numerator=a,this.denominator=1):"string"===typeof a?this.fromString(a):(this.numerator=a?a.valueOf():0,this.denominator=1));isNaN(this._numerator)&&(this._numerator=0);isNaN(this._denominator)&&(this._denominator=1);return this}},reduce:{value:function(){var a=CTAT.Math.GreatestCommonDivisor(this.numerator,
this.denominator);this._numerator/=a;this._denominator/=a;return this}},reduced:{value:function(){var a=new CTAT.Math.Fraction(this);a.reduce();return a}},reciprocal:{value:function(){return new CTAT.Math.Fraction(this.denominator,this.numerator)}},negative:{value:function(){return new CTAT.Math.Fraction(-this.numerator,this.denominator)}},add:{value:function(a){var b=new CTAT.Math.Fraction;a instanceof CTAT.Math.Fraction?0===this.numerator||isNaN(this.numerator)?b.set(a.numerator,a.denominator):
0===a.numerator||isNaN(a.numerator)?b.set(this.numerator,this.denominator):this.denominator==a.denominator?b.set(this.numerator+a.numerator,this.denominator):(b.set(this.numerator*a.denominator+a.numerator*this.denominator,this.denominator*a.denominator),b.reduce()):"string"===typeof a?(a=new CTAT.Math.Fraction(a),b=this.add(a)):b.set(a.valueOf()*this.denominator+this.numerator,this.denominator);return b}},subtract:{value:function(a){return a instanceof CTAT.Math.Fraction?this.add(a.negative()):"string"===
typeof a?(a=new CTAT.Math.Fraction(a),this.add(a.negative())):this.add(-a.valueOf())}},multiply:{value:function(a){a instanceof CTAT.Math.Fraction?(a=new CTAT.Math.Fraction(this.numerator*a.numerator,this.denominator*a.denominator),a.reduce()):"string"===typeof a?(a=new CTAT.Math.Fraction(a),a=this.multiply(a)):(a=new CTAT.Math.Fraction(a.valueOf()*this.numerator,this.denominator),a.reduce());return a}},divide:{value:function(a){return a instanceof CTAT.Math.Fraction?this.multiply(a.reciprocal()):
"string"===typeof a?(a=new CTAT.Math.Fraction(a),this.multiply(a.reciprocal())):this.multiply(new CTAT.Math.Fraction(1,a.valueOf()))}},equals:{value:function(a){return CTAT.Math.round(this.valueOf())===CTAT.Math.round(a.valueOf())}},deepEquals:{value:function(a){return a instanceof CTAT.Math.Fraction&&this.numerator===a.numerator&&this.denominator===a.denominator}},clone:{value:function(){return new CTAT.Math.Fraction(this.numerator,this.denominator)}}});
CTAT.Math.Fraction.FromString=function(a){var b=new CTAT.Math.Fraction;b.setFromString(String(a));return b};CTAT.Math.Fraction.FromNumber=function(a){a=new CTAT.Math.Fraction(a);a.reduce();return a};CTAT.Math.Fraction.Sum=function(){for(var a=new CTAT.Math.Fraction,b=0;b<arguments.length;b++)a=a.add(arguments[b]);return a};CTAT.Math.Fraction.Product=function(){for(var a=new CTAT.Math.Fraction(1,1),b=0;b<arguments.length;b++)a=a.multiply(arguments[b]);return a};CTAT.Component.Base.SVG=function(a,b,e,f,d,c,g){CTAT.Component.Base.Clickable.call(this,a,b,e,f,d,c,g);var h=null;this.initSVG=function(){this.setInitialized(!0);var a=CTATGlobals.NameSpace.svg,b=CTATGlobals.NameSpace.xml,c=CTATGlobals.NameSpace.xlink,d=CTATGlobals.NameSpace.ev,e=document.createDocumentFragment();h=document.createElementNS(a,"svg");e.appendChild(h);h.classList.add("CTAT-gen-component");h.classList.add("CTAT-svg");h.classList.add("unselectable");h.setAttributeNS(b,"xmlns",a);h.setAttributeNS(b,
"xmlns:xlink",c);h.setAttributeNS(b,"xmlns:ev",d);a=document.createElementNS(a,"defs");h.appendChild(a);this.getDivWrap().appendChild(e);this.setComponent(h)};this.genName=function(a){return this.getName()+"_"+a};this.getBoundingBox=function(){var a=new DOMRect(0,0,this.getWidth(),this.getHeight()),b=this.getComponent(),c=window.getComputedStyle(b),b=parseInt(c.getPropertyValue("padding-left")),d=parseInt(c.getPropertyValue("padding-right")),e=parseInt(c.getPropertyValue("padding-bottom")),g=parseInt(c.getPropertyValue("padding-right")),
f=parseInt(c.getPropertyValue("border-left-width")),h=parseInt(c.getPropertyValue("border-right-width")),B=parseInt(c.getPropertyValue("border-bottom-width")),c=parseInt(c.getPropertyValue("border-right-width"));a.width-=b+g+f+c;a.height-=d+e+h+B;return a}};CTAT.Component.Base.SVG.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTAT.Component.Base.SVG.prototype.constructor=CTAT.Component.Base.SVG;CTAT.Component.Base.UnitDisplay=function(a,b,e,f,d,c,g){CTAT.Component.Base.SVG.call(this,a,b,e,f,d,c,g);var h="1/2+1/4+(0*1/8)";this.setActionInput("SetPieces",h);var l="#800080";this.color=l;var m=1;this.colorAlpha=m;var r="#800080";this.deselectedColor=r;var p=.3;this.deselectedColorAlpha=p;var x="black";this.piece_border_color=x;this.piece_border_thickness=1;this.getPieceBorderColor=function(){return x};this.setPieceBorderColor=function(a){x=CTATGlobalFunctions.formatColor(a);return this};var q=
[],u=this;this.generateClassname=function(){return this.getName()+" UnitPart"};this.getPieces=function(){return q};var n=function(a){if(a.hasAttributeNS(null,"data-selected"))return CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected"));a.setAttributeNS(null,"data-selected",!0);return!0};this.getPiecesBySelected=function(a){for(var b=this.getPieces(),c=[],d,e=0;e<b.length;e++)d=b[e],n(d)===a&&c.push(d);return c};this.getSelectedPieces=this.getPiecesBySelected.bind(this,!0);this.getDeselectedPieces=
this.getPiecesBySelected.bind(this,!1);this.getColor=function(){return l};this.getColorAlpha=function(){return m};this.getDeselectedColor=function(){return r};this.getDeselectedColorAlpha=function(){return p};this.setColor=function(a){this.color=l=CTATGlobalFunctions.formatColor(a);a=this.getSelectedPieces();for(var b=0;b<a.length;b++)$(a[b]).css("fill",l)};this.setColorAlpha=function(a){m=Number(a);this.colorAlpha=m=isNaN(m)?1:m;a=this.getSelectedPieces();for(var b=0;b<a.length;b++)$(a[b]).css("fill-opacity",
m)};this.setDeselectedColor=function(a){this.deselectedColor=r=CTATGlobalFunctions.formatColor(a);a=this.getDeselectedPieces();for(var b=0;b<a.length;b++)$(a[b]).css("fill",l)};this.setDeselectedColorAlpha=function(a){p=Number(a);isNaN(p)&&(p=.3);this.deselectedColorAlpha=p;a=this.getDeselectedPieces();for(var b=0;b<a.length;b++)$(a[b]).css("fill-opacity",p)};this.valueOf=function(){return this.evaluate()};this.getValue=function(){return h};this.setValue=function(a){h=String(a);this.setInput(h);this.clear();
this.drawPieces();return h};this.setParameterHandler("Value",this.setValue);this.data_ctat_handlers.value=function(a){this.setValue(a)};this.drawPieces=function(){};this.evaluate=function(){return this.parseValue().reduce(function(a,b){return b.selected?a.add(b):a},new CTAT.Math.Fraction)};this.numActive=function(){return this.getSelectedPieces().length};this.parseValue=function(){var a=[];h.split("+").forEach(function(b){var c=!0;-1!=b.search(/(\(\s*0\s*\*)|(\*\s*0\s*\))/)&&(c=!1,b=b.replace(/(\(\s*0\s*\*)|(\*\s*0\s*\))/,
""),b=b.replace(/[() ]/g,""));b=new CTAT.Math.Fraction(b);b.selected=c;0<b&&a.push(b);return b});return a};this.updateValue=function(){return h=this.getPieces().map(function(a){return z(a.getAttributeNS(null,"data-value"),CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected")))}).join("+")};var B=function(a,b){var c=CTATGlobalFunctions.toBoolean(b);CTATGlobalFunctions.toBoolean(a.getAttributeNS(null,"data-selected"));!0===c?(a.setAttributeNS(null,"data-selected",!0),$(a).css("fill",
u.color),$(a).css("fill-opacity",u.colorAlpha)):($(a).css("fill",u.deselectedColor),$(a).css("fill-opacity",u.deselectedColorAlpha),a.setAttributeNS(null,"data-selected",!1))};this.clickHandler=function(a){!0===u.getEnabled()&&(a=CTATGlobalFunctions.toBoolean(this.getAttributeNS(null,"data-selected")),B(this,!a),u.setActionInput("SetPieces",u.updateValue()),u.processAction())};this.updateSAI=function(){u.setActionInput("SetPieces",u.updateValue())};this.addPieceElem=function(a,b,c){a.setAttributeNS(null,
"data-selected",c);a.setAttributeNS(null,"data-value",b.toString());a.dataValue=b;this.getEnabled()&&(a.style.cursor="pointer");a.addEventListener("click",this.clickHandler);q.push(a)};var v=this.setEnabled;this.setEnabled=function(a){v(a);q.forEach(function(b){b.style.cursor=a?"pointer":"default"})};this.clear=function(){q=[]};var z=function(a,b){var c=a.toString();!1===b&&(c="(0*"+c+")");return c};this.AddPiece=function(a,b){if(a){var c=new CTAT.Math.Fraction(a);if(0<CTAT.Math.round(c.valueOf())){var d=
h.split("+");d.push(z(c,b));u.setValue(d.join("+"))}}};this.AddToValue=function(a,b){if(a){var c=new CTAT.Math.Fraction(a);if(0<CTAT.Math.round(c.valueOf())){var d=h.split("+");d.push(z(c,b));h=d.join("+")}}return h};var A=-1,D=function(a){isNaN(a)&&this.get_denominator();a=Math.max(a,1);1<A&&(a=Math.min(a,A));return a}.bind(this);this.set_max_denominator=function(a){a=parseInt(a);isNaN(a)||(A=a)};this.set_denominator=function(a){u.setHintHighlight(!1);var b="string"===typeof a?parseInt(a):a;if(!isNaN(b)&&
(b=D(b),this.get_denominator()!=a)){var c=u.evaluate();u.clear();a=[];c.set_denominator(b);for(var d=new CTAT.Math.Fraction(1,b),e=Math.floor(c.numerator),g=b-e,f=0;f<e;f++)a.push(z(d,!0));b=new CTAT.Math.Fraction(c.numerator-e,b);b.equals(0)||(a.push(z(b,!0)),a.push(z(d.subtract(b),!1)),g--);for(b=0;b<g;b++)a.push(z(d,!1));this.setValue(a.join("+"));u.setActionInput("SetPieces",h);u.processAction();return h}};this.get_denominator=function(){return q.reduce(function(a,b,c,d){return Math.min(a,b.dataValue.denominator)},
Infinity)};this.change_denominator=function(a){return this.set_denominator(this.get_denominator()+Number(a))};this.set_number_pieces=function(a){u.setHintHighlight(!1);a="string"===typeof a?parseInt(a):a;if(!isNaN(a)){a=D(a);var b=u.numActive();u.clear();for(var c=[],d=new CTAT.Math.Fraction(1,a),e=0;e<a;e++)c.push(z(d,0<b)),b--;this.setValue(c.join("+"));u.setActionInput("SetPieces",h);u.processAction();return h}};this.change_number_pieces=function(a){this.set_number_pieces(q.length+a)};this.set_numerator=
function(a){return this.change_numerator(a-this.getSelectedPieces().length)};this.change_numerator=function(a){0!==a&&(0<a?q.every(function(b){!1===n(b)&&(B(b,!0),a--);return 0<a}):(q.reverse(),q.every(function(b){!0===n(b)&&(B(b,!1),a++);return 0>a}),q.reverse()))};this.SetPieces=function(a){u.setValue(a)};e=function(a){return(a=$(this.getDivWrap()).attr(a))?a.split(/\s*;\s*/).map(function(a){return a.trim()}):[]};a=e.bind(this,"data-ctat-ctrl-denominator");b=e.bind(this,"data-ctat-ctrl-partition");
e=e.bind(this,"data-ctat-ctrl-numerator");f=function(a,b){return 0<=a().indexOf(b)};var H=f.bind(null,a),w=f.bind(null,b),E=f.bind(null,e),t=function(a){var b=null;if(a instanceof CTAT.Component.Base.Tutorable)a!=this&&(b=a.getName());else if(a instanceof CTATSAI)a.getSelection()!=u.getName()&&(b=a.getSelection());else if(a instanceof String)a!=u.getName()&&(b=a);else if(a instanceof Element)a!=u.getComponent()&&(b=a.id);else return null;if(b){if(H(b))return C.bind(this,this.change_denominator,this.set_denominator);
if(E(b))return C.bind(this,this.change_numerator,this.set_numerator);if(w(b))return C.bind(this,this.change_number_pieces,this.set_number_pieces)}return null}.bind(this);a=CTAT.Component.Base.Tutorable.EventType;CTATConfiguration.get("previewMode")||document.addEventListener(a.action,function(a){var b=a.detail.sai;a=t(a.detail.component);b&&null!==a&&a(b)},!1);var C=function(a,b,c){var d=parseInt(c.getInput());if(!isNaN(d)){switch(c.getAction()){case "ButtonPressed":a.call(this,d);break;case "Update":case "UpdateTextField":case "UpdateTextArea":b.call(this,
d)}this.updateSAI();this.processAction()}};this.setNumeratorControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-numerator",a);return this};this.setParameterHandler("NumeratorControllers",this.setNumeratorControllers);this.setDenominatorControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-denominator",a);return this};this.setParameterHandler("DenominatorControllers",this.setDenominatorControllers);this.setPartitionControllers=function(a){this.getDivWrap().setAttribute("data-ctat-ctrl-partition",
a);return this};this.setParameterHandler("PartitionControllers",this.setPartitionControllers);this.getConfigurationActions=function(){var a=this.getDivWrap().getAttribute("data-ctat-value");if(a){var b=new CTATSAI;b.setSelection(this.getName());b.setAction("SetPieces");b.setInput(a);return[b]}this.updateSAI();return[this.getSAI()]}};CTAT.Component.Base.UnitDisplay.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTAT.Component.Base.UnitDisplay.prototype.constructor=CTAT.Component.Base.UnitDisplay;var CTATFractionBar=function(a,b,e,f,d){CTAT.Component.Base.UnitDisplay.call(this,"CTATFractionBar","aFractionBar",a,b,e,f,d);var c=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(c,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATFractionBar--container");this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};
this.drawPieces=function(){if(this.baseGroup){this.clear();for(var a=this.parseValue(),b=0,d=document.createDocumentFragment(),e=0;e<a.length;e++){var f=a[e],p=100*f,x=document.createElementNS(c,"rect");x.classList.add("CTATFractionBar--piece");x.setAttributeNS(null,"height","100%");x.setAttributeNS(null,"width",p+"%");x.setAttributeNS(null,"y",0);x.setAttributeNS(null,"x",b+"%");this.addPieceElem(x,f,f.selected);d.appendChild(x);var q=document.createElementNS(c,"text");q.classList.add("CTATFractionBar--label");
q.setAttributeNS(null,"text-anchor","middle");q.setAttributeNS(null,"dominant-baseline","middle");d.appendChild(q);var x=""+String(f.numerator),f=""+String(f.denominator),u=document.createElementNS(c,"tspan"),n=document.createElementNS(c,"tspan");u.appendChild(document.createTextNode(x));n.appendChild(document.createTextNode(f));q.appendChild(u);q.appendChild(n);q=b+p/2;u.setAttributeNS(null,"x",q+"%");u.setAttributeNS(null,"y","60%");u.setAttributeNS(null,"dy","-1em");n.setAttributeNS(null,"x",q+
"%");n.setAttributeNS(null,"y","60%");x.length>f.length?u.style.textDecoration="underline":n.style.textDecoration="overline";b+=p}this.baseGroup.innerHTML="";this.baseGroup.appendChild(d);var B=this.baseGroup.getBBox().width-1;Array.prototype.slice.call(this.baseGroup.childNodes).forEach(function(a){if("rect"==a.nodeName){var b=window.getComputedStyle(a),c=parseFloat(b.getPropertyValue("padding-left")),d=parseFloat(b.getPropertyValue("stroke-width")),b=a.getBBox();a.setAttributeNS(null,"y",b.y+d/
2);a.setAttributeNS(null,"height",b.height-d);var e=b.x+d/2,d=b.width-d;1>b.x?d-=c/2:(e+=c/2,d=b.x+b.width>=B?d-c/2:d-c);a.setAttributeNS(null,"x",e);a.setAttributeNS(null,"width",d)}})}};this.setShowFractionLabel=function(a){};this.setStyleHandler("showFractionLabel",this.setShowFractionLabel)};CTATFractionBar.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);CTATFractionBar.prototype.constructor=CTATFractionBar;CTAT.ComponentRegistry.addComponentType("CTATFractionBar",CTATFractionBar);var CTATGroupingComponent=function(a,b,e,f,d){CTAT.Component.Base.SAIHandler.call(this,"CTATGroupingComponent","__undefined__",a,b,e,f,d);var c=this,g=c.executeSAI;this.isTabIndexable=!1;this.getComponentList=function(){var a=[],b=c.getDivWrap().getAttribute("data-ctat-componentlist");b&&(a=b.split(/\s*[,;]\s*/).map(function(a){return $("#"+a.trim()).data("CTATComponent")}));$(c.getDivWrap()).children(".CTATComponent").each(function(){a.push($(this).data("CTATComponent"))});return[].concat($jscomp.arrayFromIterable(new Set(a)))};
this.init=function(){c.setInitialized(!0)};this.executeSAI=function(a){c.getComponentList().forEach(function(b){b.executeSAI(a)});g.call(c,a)}};CTATGroupingComponent.prototype=Object.create(CTAT.Component.Base.SAIHandler.prototype);CTATGroupingComponent.prototype.constructor=CTATGroupingComponent;CTAT.ComponentRegistry.addComponentType("CTATGroupingComponent",CTATGroupingComponent);var CTATHintButton=function(a,b,e,f,d){CTAT.Component.Base.Clickable.call(this,"hint","CTATHintButton",a,b,e,f,d);this.setName("hint");this.setClassName("CTATHintButton");this.isTabIndexable=!1;this.setText(CTATGlobals.languageManager.getString("HINT"));this.setStyleHandler("BackgroundColor",null);this.setStyleHandler("TextAlign",null);this.setStyleHandler("BorderColor",null);this.setStyleHandler("FontFace",null);this.setStyleHandler("TextColor",null);this.init=function(){this.setInitialized(!0);
var a=document.createElement("button");this.setComponent(a);a.classList.add("unselectable");a.classList.add("CTAT-hint-button");var b=document.createElement("div");b.classList.add("CTAT-hint-button--icon");b.textContent="?";a.appendChild(b);this.getText()&&(b=document.createElement("div"),b.textContent=this.getText(),a.appendChild(b));this.getDivWrap().appendChild(a);a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-hint-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-hint-button--hover");
a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-hint-button--clicked")});a.addEventListener("mouseup",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",this.processClick)};var c=this;this.processClick=function(a){c.getEnabled()&&CTATCommShell.commShell&&CTATCommShell.commShell.requestHint()}};
CTATHintButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATHintButton.prototype.constructor=CTATHintButton;CTAT.ComponentRegistry.addComponentType("CTATHintButton",CTATHintButton);var CTATHintWindow=function(a,b,e,f,d){CTAT.Component.Base.Graphical.call(this,"CTATHintWindow","__undefined__",a,b,e,f,d);var c=this;c.isTabIndexable=!1;var g=null,h=null,l=null,m=null,r=CTATGlobals.languageManager.getString("NEXT"),p=CTATGlobals.languageManager.getString("PREVIOUS"),x=null;this.data_ctat_handlers["next-content"]=function(a){x=a;l&&(l.innerHTML=a)};var q=null;this.data_ctat_handlers["previous-content"]=function(a){q=a;h&&(h.innerHTML=a)};this.getCurrentHint=function(){return g.innerHTML};
this.init=function(){c.ctatdebug("init ("+c.getName()+")");c.setInitialized(!0);c.setIsAbstractComponent(!0);m=this.getDivWrap();m.id||m.setAttribute("id",CTATGlobalFunctions.gensym.div_id());m.setAttribute("onkeypress","return noenter(event)");c.setComponent(m);c.addComponentReference(c,m);g=document.createElement("div");m.appendChild(g);g.classList.add("CTATHintWindow--hint-content");var a=document.createElement("div");a.classList.add("CTATHintWindow--hint-button-area");m.appendChild(a);if(q)h=
document.createElement("button"),h.classList.add("CTATHintWindow--previous"),h.innerHTML=q;else{h=document.createElement("button");h.classList.add("CTATHintWindow--previous");var b=document.createElement("span");b.classList.add("CTATHintWindow--button-icon");b.textContent="\u25c0";h.appendChild(b);p&&(b.style.cssFloat="left",h.appendChild(document.createTextNode(p)))}h.addEventListener("click",function(a){CTATShellTools.showPrevHint()},!1);a.appendChild(h);x?(l=document.createElement("button"),l.classList.add("CTATHintWindow--next"),
l.innerHTML=x):(l=document.createElement("button"),l.classList.add("CTATHintWindow--next"),b=document.createElement("span"),b.classList.add("CTATHintWindow--button-icon"),b.textContent="\u25b6",r&&(b.style.cssFloat="right",l.appendChild(document.createTextNode(r))),l.appendChild(b));l.addEventListener("click",function(a){CTATShellTools.showNextHint()},!1);a.appendChild(l);var d=function(a){this.disabled=!a;a||(this.classList.remove("CTAT-hint-button--hover"),this.classList.remove("CTAT-hint-button--clicked"))};
[h,l].forEach(function(a){a.setEnabled=d.bind(a);a.classList.add("CTATHintWindow--button");a.classList.add("CTAT-hint-button");a.addEventListener("mouseenter",function(a){a.target.classList.add("CTAT-hint-button--hover")});a.addEventListener("mouseleave",function(a){a.target.classList.remove("CTAT-hint-button--hover");a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("mousedown",function(a){a.target.classList.add("CTAT-hint-button--clicked")});a.addEventListener("mouseup",
function(a){a.target.classList.remove("CTAT-hint-button--clicked")});a.addEventListener("click",function(a){a.target.classList.remove("CTAT-hint-button--clicked")})});CTATShellTools.registerFeedbackComponent(this,this.goNext,this.goPrevious,this.showHint,this.showFeedback);c.ctatdebug("Disabling previous and next ...");h.setEnabled(!1);l.setEnabled(!1)};this.setStyleHandler("OuterBorderColor",this.setBorderColor);this.SetText=this.showFeedback=function(a){c.ctatdebug("showFeedback ("+a+")");g&&(g.innerHTML=
CTATGlobals.languageManager.filterString(a));h.setEnabled(!1);l.setEnabled(!1)};this.showHint=function(a){c.ctatdebug("showHint ()");null===a?(hints=a,hintIndex=0,g.innerHTML="",h.setEnabled(!1),l.setEnabled(!1)):(hints=a,hintIndex=0,this.setEnabled(!0),h.setEnabled(!1),l.setEnabled(!1),hints?""===hints[hintIndex]?c.ctatdebug("Empty hint in list, bump"):(g.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]),1<hints.length?(c.ctatdebug("We have more than one hint, enabling next button"),
l.setEnabled(!0)):c.ctatdebug("We only have one hint, leaving next button disabled")):c.ctatdebug("Null hint in list, bump"))};this.setEnabled=function(a){c.assignEnabled(a);null===c.getComponent()?c.ctatdebug("Error pointer.getComponent()==null"):c.getComponent().disabled=!a};this.goPrevious=function(){c.ctatdebug("goPrevious ()");hintIndex--;l.setEnabled(!0);0>=hintIndex?(hintIndex=0,h.setEnabled(!1)):h.setEnabled(!0);g.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]);var a=
new CTATTutoringServiceMessageBuilder,b=CTATGuid.guid(),d=new CTATSAI("previousButton","ButtonPressed","-1");a.createUntutoredActionMessage(b,d);var d=new CTATSAI("previousButton","ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(b,d,"HINT_REQUEST","");a=c.getCurrentHint();d=new CTATMessage;d.setMessageType("AssociatedRules");d.assignSAI(logHintSAI);d.setTransactionID(b);CTATCommShell.commShell.processAssociatedRules(d,"HintWindow",a);CTATCommShell.commShell.propagateShellEvent("PreviousPressed",
null)};this.goNext=function(){c.ctatdebug("goNext ()");hintIndex++;h.setEnabled(!0);hintIndex>hints.length-1&&(hintIndex=hints.length-1);hintIndex>hints.length-2?l.setEnabled(!1):l.setEnabled(!0);g.innerHTML=CTATGlobals.languageManager.filterString(hints[hintIndex]);var a=new CTATTutoringServiceMessageBuilder,b=CTATGuid.guid(),d=new CTATSAI("nextButton","ButtonPressed","-1");a.createUntutoredActionMessage(b,d);var d=new CTATSAI("nextButton","ButtonPressed","hint request");commLoggingLibrary.logSemanticEvent(b,
d,"HINT_REQUEST","");a=c.getCurrentHint();d=new CTATMessage;d.setMessageType("AssociatedRules");d.assignSAI(logHintSAI);d.setTransactionID(b);CTATCommShell.commShell.processAssociatedRules(d,"HintWindow",a);CTATCommShell.commShell.propagateShellEvent("NextPressed",null)}};CTATHintWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATHintWindow.prototype.constructor=CTATHintWindow;CTAT.ComponentRegistry.addComponentType("CTATHintWindow",CTATHintWindow);var CTATIFrameManager=function(){var a={},b=this;this.initFrame=function(b,f,d){var c=b?b.getAttribute("id"):null;c?a[c]={domNode:b,initialDom:f,initialMode:d}:console.error("iFrames managed by CTATIFrameManager must exist and have unique ids");b.setAttribute("data-ctat-target",d);this.writeData(b,f)};this.refresh=function(b){var e=a[b];e.domNode?(e.domNode.setAttribute("src","about:blank"),this.writeData(e.domNode,e.initialDom)):console.warn("CTATIFrameManager: iFrame id "+b+" not found")};this.writeData=
function(a,b){if(a){var d=a.contentDocument||a.contentWindow.document;d.open();d.write(b);d.close()}};document.addEventListener("refreshIframe",function(a){a=a.detail;console.log("refresh event for iframe "+a);b.refresh(a)})};var CTATImageButton=function(a,b,e,f,d){CTATButtonBasedComponent.call(this,"CTATImageButton","__undefined__",a,b,e,f,d);var c=this;this.init=function(){c.setInitialized(!0);c.setComponent(c.getDivWrap());c.addComponentReference(c,c.getDivWrap());c.setImage(c.getDivWrap().getAttribute("data-ctat-image-default"));var a=c.component;a.setAttribute("role","button");a.classList.add("CTAT-button");a.addEventListener("click",c.processClick);a.addEventListener("focus",c.processFocus);a.addEventListener("mousedown",
c.processBaseMousedown);a.addEventListener("mouseup",c.processBaseMouseup);a.addEventListener("mouseover",c.processBaseMouseover);a.addEventListener("mouseout",c.processBaseMouseout)};var g=this.setEnabled;this.setEnabled=function(a){g(a);c.getEnabled()?c.setImage(c.getDivWrap().getAttribute("data-ctat-image-default")):c.setImage(c.getDivWrap().getAttribute("data-ctat-image-disabled"))};this.getConfigurationActions=function(){var a=this.getDivWrap(),b=a.getAttribute("data-ctat-image-hover"),c=a.getAttribute("data-ctat-image-clicked"),
d=a.getAttribute("data-ctat-image-default"),a=a.getAttribute("data-ctat-image-disabled");if(d){var e=new CTATSAI;e.setSelection(this.getName());b||c||a?(e.setAction("assignImages"),e.setInputArray([b,c,d,a])):(e.setAction("assignImage"),e.setInput(d));return[e]}return[]}};CTATImageButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATImageButton.prototype.constructor=CTATImageButton;CTAT.ComponentRegistry.addComponentType("CTATImageButton",CTATImageButton);var CTATJumble=function(a,b,e,f,d){CTAT.Component.Base.Tutorable.call(this,"CTATJumble","aJumble",a,b,e,f,d);var c=this;this.setActionInput("SetOrder","");var g=null;this.init=function(){this.setInitialized(!0);g=this.getDivWrap();this.setComponent(g);this.addComponentReference(this,g);CTATConfiguration.get("previewMode")||$(g).children().addClass("CTATJumble--item").attr({unselectable:"on",draggable:!0}).each(function(){this.addEventListener("dragstart",l,!1);this.addEventListener("dragenter",r,
!1);this.addEventListener("dragover",m,!1);this.addEventListener("dragleave",p,!1);this.addEventListener("drop",x,!1);this.addEventListener("dragend",q,!1)});this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){this.updateSAI();return[this.getSAI()]};var h=null,l=function(a){a.target.classList.add("CTATJumble--item--home");h=a.target;a.dataTransfer.effectAllowed="move";a.dataTransfer.setData("text/html",a.target.innerHTML)},m=function(a){a.preventDefault&&
a.preventDefault();a.dataTransfer.dropEffect="move";return!1},r=function(a){this.classList.add("CTATJumble--item--over")},p=function(a){this.classList.remove("CTATJumble--item--over")},x=function(a){a.stopPropagation&&a.stopPropagation();$(g).children().removeClass("CTATJumble--item--over");if(h!=this){h.innerHTML=this.innerHTML;var b=h.id;h.id=this.id;this.innerHTML=a.dataTransfer.getData("text/html");this.id=b;c.setInput(c.getOrder());c.processAction()}return!1},q=function(a){this.classList.remove("CTATJumble--item--home");
$(g).children().removeClass("CTATJumble--item--over")},u=this.setEnabled;this.setEnabled=function(a){u(a);g&&$(g).children().attr("draggable",a)};this.init_items=function(a){if(g){var b=document.createDocumentFragment();a=a.split(";");for(var c=a.length,d=0;d<c;d++){var e=document.createElement("div");e.textContent=a[d];e.id=this.getName()+d;e.setAttribute("unselectable","on");e.setAttribute("draggable",!0);e.classList.add("CTATJumble--item");e.addEventListener("dragstart",l,!1);e.addEventListener("dragenter",
r,!1);e.addEventListener("dragover",m,!1);e.addEventListener("dragleave",p,!1);e.addEventListener("drop",x,!1);e.addEventListener("dragend",q,!1);b.appendChild(e)}g.innerHTML="";g.appendChild(b)}};this.setParameterHandler("textItems",this.init_items);this.SetOrder=function(a){a.split(";").forEach(function(a){$(g).append($("#"+a))})};this.getOrder=function(){var a=[];$(g).children().each(function(){this.draggable&&(this.id?a.push(this.id):console.log("ERROR: The CTATJumble "+c.getName()+" has a child with no id attribute: "+
this+"!!!"))});return a.join(";")};this.updateSAI=function(){c.setInput(c.getOrder())}};CTATJumble.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATJumble.prototype.constructor=CTATJumble;CTAT.ComponentRegistry.addComponentType("CTATJumble",CTATJumble);var CTATMobileTutorHandler=function(a,b){CTATBase.call(this,"CTATMobileTutorHandler","mobiletutorhandler");this.ctatdebug("CTATMobileTutorHandler ()");var e="",f=b?b:"disabled",d=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(d=!0);this.error=function(a){this.ctatdebug(a);alert(a)};this.processOrientationChange=function(a){this.ctatdebug("processOrientationChange ("+a+")")};this.getEnabled=function(){return"disabled"==f||"auto"==f&&0==d?!1:!0};this.processTextFocus=
function(a,b,h,l,m){this.ctatdebug("processTextFocus ("+a+","+b+","+h+","+l+","+m+")");"disabled"==f||"auto"==f&&0==d||(e="",this.manipulateKeyboard())};this.processEnter=function(){this.ctatdebug("processEnter ()");if("disabled"!=f&&("auto"!=f||0!=d)){var b=getSafeElementById(a);if(null!=b)try{b.processExternalEnter(),this.ctatdebug("Successfully called AS3 method")}catch(g){this.ctatdebug("Error description: "+g.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")}};this.setText=
function(b){this.ctatdebug("setText ("+b+")");if("disabled"!=f&&("auto"!=f||0!=d))if(null!=CTATGlobals.selectedTextInput){this.ctatdebug("Attempting to call HTML5 method on text object ...");var c=CTATGlobals.selectedTextInput.getText();CTATGlobals.selectedTextInput.setText(c+b)}else if(this.ctatdebug("Attempting to call AS3 method ..."),c=getSafeElementById(a),null!=c)try{e+=b,this.ctatdebug(e),c.processExternalKeyboard(e),this.ctatdebug("Successfully called AS3 method")}catch(h){this.ctatdebug("Error description: "+
h.message)}else this.ctatdebug("Error: unable to obtain reference to swf object")};this.manipulateKeyboard=function(){this.ctatdebug("manipulateKeyboard()");if("disabled"!=f&&("auto"!=f||0!=d)){this.hideKeyboard();var a=getSafeElementById("keyboardUI");a&&(a.style.visibility="visible")}};this.hideKeyboard=function(){document.activeElement.blur();var a=getSafeElementById("input");a&&a.blur()};this.hideCustomKeyboard=function(){getSafeElementById("keyboardUI").style.visibility="visible"}};
CTATMobileTutorHandler.prototype=Object.create(CTATBase.prototype);CTATMobileTutorHandler.prototype.constructor=CTATMobileTutorHandler;function processTextFocus(a,b,e,f,d){mobileAPI.processTextFocus(a,b,e,f,d)}function processFocusOut(){closeK()};var CTATMovieClip=function(a,b,e,f,d){CTATBase.call(this,"CTATMovieClip",a);var c=CTATGlobalFunctions.gensym.z_index(),g=CTATGlobalFunctions.gensym.div_id(),h=CTATGlobalFunctions.gensym.z_index();CTATGlobalFunctions.gensym.div_id();var l=[],m=this,r=null;this.wrapComponent=function(a){r=document.createElement("div");r.setAttribute("id",g);r.setAttribute("name",this.getName());r.setAttribute("style","z-index: "+c);r.setAttribute("width",f+"px");r.setAttribute("height",d+"px");r.setAttribute("style",
"border: 0px; position: absolute; left:"+b+"px; top:"+e+"px; z-index:"+h+";");a.appendChild(r);return r};this.getDivWrapper=function(){return r};this.addComponent=function(a){m.ctatdebug("addComponent ("+a+")");l.push(a)};this.isRegistered=function(a){for(var b=0;b<l.length;b++)if(l[b]==a)return!0;return!1}};CTATMovieClip.prototype=Object.create(CTATBase.prototype);CTATMovieClip.prototype.constructor=CTATMovieClip;CTAT.Geom={};CTAT.Geom.Point={};try{new DOMPoint}catch(a){if(console.log("WARNING: new DOMPoint():",a,typeof a),a instanceof ReferenceError||a instanceof TypeError){console.log("   Using shim!");var DOMPoint=function(b,e,f,d){this.z=this.y=this.x=0;this.w=1;if(b instanceof DOMPoint)for(var c in b)this[c]=b[c];else this.x=b||0,this.y=e||0,this.z=f||0,this.w=d||1}}}CTAT.Geom.Point.useDOMMatrix=!0;try{new DOMMatrix}catch(a){a instanceof ReferenceError&&(CTAT.Geom.Point.useDOMMatrix=!1)}
CTAT.Geom.Point.add=function(){if(CTAT.Geom.Point.useDOMMatrix){for(var a=new DOMMatrix,b,e=0;e<arguments.length;e++)b=arguments[e],a.translateSelf(b.x/b.w,b.y/b.w,b.z/b.w);return a.transformPoint(new DOMPoint)}return Array.prototype.reduce.call(arguments,function(a,b){for(var c in a)"w"!=c&&0!==b[c]&&(a[c]+=b[c]/b.w);return a},new DOMPoint)};
DOMPoint.prototype.add||Object.defineProperty(DOMPoint.prototype,"add",{enumerable:!1,value:function(a){return CTAT.Geom.Point.useDOMMatrix?(new DOMMatrix).translate(a.x/a.w,a.y/a.w,a.z/a.w).transformPoint(this):CTAT.Geom.Point.add(this,a)}});CTAT.Geom.Point.angle=function(a,b){return Math.acos(DOMPoint.dot(a,b)/(a.magnitude*b.magnitude))};CTAT.Geom.Point.angle_degrees=function(a,b){return CTAT.Math.rad2deg(CTAT.Geom.Point.angle(a,b))};
CTAT.Geom.Point.angle_between_2d=function(a,b){return CTAT.Math.rad2deg(Math.atan2(b.y,b.x)-Math.atan2(a.y,a.x))};DOMPoint.prototype.clone||Object.defineProperty(DOMPoint.prototype,"clone",{value:function(){return new DOMPoint(this)}});CTAT.Geom.Point.distance=function(a,b){var e=CTAT.Geom.Point.add(a,CTAT.Geom.Point.scale(b,-1));return Math.sqrt(CTAT.Geom.Point.dot(e,e))};
DOMPoint.prototype.distance||Object.defineProperty(DOMPoint.prototype,"distance",{value:function(a){return CTAT.Geom.Point.distance(this,a)}});CTAT.Geom.Point.dot=function(a,b){return(a.x*b.x+a.y*b.y+a.z*b.z)/(a.w*b.w)};CTAT.Geom.Point.equals=function(a,b){var e=!0,f;for(f in a)if(f in b?"w"!=f&&(e&=a[f]/a.w==b[f]/b.w):e=!1,!e)break;return e};CTAT.Geom.Point.interpolate=function(a,b,e){return CTAT.Geom.Point.add(a.scale(e),b.scale(1-e))};
"magnitude"in DOMPoint.prototype||Object.defineProperty(DOMPoint.prototype,"magnitude",{enumerable:!1,get:function(){return CTAT.Math.round(Math.sqrt(CTAT.Geom.Point.dot(this,this)))}});DOMPoint.prototype.normalize||Object.defineProperty(DOMPoint.prototype,"normalize",{value:function(a){return this.scale((a?a:1)/this.magnitude)}});
CTAT.Geom.Point.scale=function(a,b){if(CTAT.Geom.Point.useDOMMatrix)return(new DOMMatrix).scale(b).transformPoint(a);var e=new DOMPoint(a),f;for(f in e)"w"!=f&&(e[f]=CTAT.Math.round(a[f]*b));return e};DOMPoint.prototype.scale||Object.defineProperty(DOMPoint.prototype,"scale",{value:function(a){return CTAT.Geom.Point.scale(this,a)}});CTAT.Geom.Point.polar=function(a,b){return new DOMPoint(CTAT.Math.round(a*Math.cos(b)),CTAT.Math.round(a*Math.sin(b)))};
CTAT.Geom.Point.is_on_line=function(a,b,e){return 1E-4>Math.abs(a.distance(e)+b.distance(e)-a.distance(b))};CTAT.Geom.Point.circle_intersection=function(a,b,e,f){b=b.add(a.scale(-1)).normalize();var d=CTAT.Geom.Point.dot(b,e.add(a.scale(-1))),c=a.add(b.scale(d));e=CTAT.Geom.Point.distance(e,c);return e<f?(f=Math.sqrt(f*f-e*e),[a.add(b.scale(d-f)),a.add(b.scale(d+f))]):e==f?[c]:[]};CTAT.Geom.Point.to2DString=function(a,b){var e=[a.x/a.w,a.y/a.w].join();b&&(e="("+e+")");return e};CTAT.Geom.Rectangle={};try{new DOMRect}catch(a){if(console.log("WARNING: new DOMRect():",a,typeof a),a instanceof ReferenceError||a instanceof TypeError){console.log("    Using shim!");var DOMRect=function(b,e,f,d){this.x=b||0;this.y=e||0;this.width=f||0;this.height=d||0;return this}}}"left"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"left",{get:function(){return Math.min(this.x,this.x+this.width)}});
"right"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"right",{get:function(){return Math.max(this.x,this.x+this.width)}});"top"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"top",{get:function(){return Math.min(this.y,this.y+this.height)}});"bottom"in DOMRect.prototype||Object.defineProperty(DOMRect.prototype,"bottom",{get:function(){return Math.max(this.y,this.y+this.height)}});
CTAT.Geom.Rectangle.contains=function(a,b,e){var f=CTAT.Geom.Rectangle.contains;if(b instanceof DOMRect)return f(a,b.left,b.top)&f(a,b.right,b.bottom);if(b instanceof DOMPoint){var d=!0;if(e instanceof DOMPoint)d=f(a,e.x/e.w,e.y/e.w);else if("number"==typeof e)return f(a,b.x-e,b.y-e)&f(a,b.x+e,b.y+e);return d&f(a,b.x,b.y)}return a.left<=b&a.right>=b&a.top<=e&a.bottom>=e};
DOMRect.prototype.contains||Object.defineProperty(DOMRect.prototype,"contains",{value:function(a,b){return CTAT.Geom.Rectangle.contains(this,a,b)}});DOMRect.prototype.clone||Object.defineProperty(DOMRect.prototype,"clone",{value:function(){return new DOMRect(this.x,this.y,this.width,this.height)}});DOMRect.prototype.copyFrom||Object.defineProperty(DOMRect.prototype,"copyFrom",{value:function(a){this.x=a.x;this.y=a.y;this.width=a.width;this.height=a.height;return this}});
CTAT.Geom.Rectangle.equals=function(a,b){return a.left==b.left&&a.top==b.top&&a.right==b.right&&a.bottom==b.bottom};CTAT.Geom.Rectangle.inflate=function(a,b,e){b=b?b:0;e=e?e:0;b instanceof DOMPoint&&(e=b.y,b=b.x);a=a.clone();a.x-=b;a.y-=e;a.width+=2*b;a.height+=2*e;return a};CTAT.Geom.Rectangle.isEmpty=function(a){return 0===a.width||0===a.height};CTAT.Geom.Rectangle.setEmpty=function(a){a.x=0;a.y=0;a.width=0;a.height=0;return a};
CTAT.Geom.Rectangle.setTo=function(a,b,e,f,d){a.x=b;a.y=e;a.width=f;a.height=d;return a};CTAT.Geom.Rectangle.offset=function(a,b,e){b=b?b:0;e=e?e:0;b instanceof DOMPoint&&(e=b.y,b=b.x);a=a.clone();a.x+=b;a.y+=e;return a};CTAT.Geom.Rectangle.union=function(a,b){var e=new DOMRect;e.x=Math.min(a.x,b.x);e.y=Math.min(a.y,b.y);e.width=Math.max(a.right,b.right)-e.x;e.height=Math.max(a.bottom,b.bottom)-e.y;return e};var CTATNumberLine=function(a,b,e,f,d){CTAT.Component.Base.SVG.call(this,"CTATNumberLine","aNumberLine",a,b,e,f,d);var c=CTAT.Math.Fraction,g=CTATGlobals.NameSpace.svg;a=function(a,b,d,e,f){this.numberline=a;this.step=new c(b);this.size=d;this.origin=new c(0);e=e?e:null;f=f?f:null;this.g=null;this.setStep=function(a){this.step=new c(a)};this.setSize=function(a){a=Number(a);isNaN(a)&&(a=d);this.size=a};this.setOrigin=function(a){this.origin=new c(a)};this.generate=function(){if(this.numberline){var a=
new c,b=document.createDocumentFragment(),d=document.createElementNS(g,"g");d.setAttributeNS(null,"data-step-size",this.step.toString());d.setAttributeNS(null,"pointer-events","none");e&&d.classList.add(e);b.appendChild(d);if(0<this.step){for(a.set(this.origin).reduce();a<=this.numberline.Maximum;)a>=this.numberline.Minimum&&d.appendChild(this.numberline.genTickmark(a,null,this.size)),a=a.add(this.step);a.set(this.origin).reduce();for(a=a.subtract(this.step);a>=this.numberline.Minimum;)a<=this.numberline.Maximum&&
d.appendChild(this.numberline.genTickmark(a,null,this.size)),a=a.subtract(this.step)}f&&$(d).find("text.CTATNumberLine--tickmark-label").each(function(){this.classList.add(f)});return b}}};var h=new a(this,new c(1),30,"CTATNumberLine--large-tickmark","CTATNumberLine--large-tickmark-label");this.setLargeTickSize=function(a){h.setSize(s);this.render();return this};this.setParameterHandler("LargeTickmarkSize",this.setLargeTickSize);this.setParameterHandler("LargeTickmarkStep",function(a){h.setStep(a);
this.render();return this});this.data_ctat_handlers["large-tick-step"]=function(a){h.setStep(a);this.render()};var l=new a(this,new c(1,2),20,"CTATNumberLine--small-tickmark","CTATNumberLine--small-tickmark-label");this.setSmallTickSize=function(a){l.setSize(s);this.render();return this};this.setParameterHandler("SmallTickmarkSize",this.setSmallTickSize);this.setParameterHandler("SmallTickmarkStep",function(a){l.setStep(a);this.render();return this});this.data_ctat_handlers["small-tick-step"]=function(a){l.setStep(a);
this.render()};var m=new a(this,new c(0),25,"CTATNumberLine--denominator-tickmark","CTATNumberLine--denominator-tickmark-label");this.setParameterHandler("DenominatorTickmarkSize",function(a){m.setSize(a);this.render();return this});this.setParameterHandler("DenominatorTickmarkStep",function(a){m.setStep((new c(a)).reciprocal())});this.data_ctat_handlers.denominator=function(a){a=new c(a);m.setStep(a.reciprocal())};this.setColor=function(a){console.log("numberline.setColor");this.color=a=CTATGlobalFunctions.formatColor(a);
for(var b=$(this.getDivWrap()).find("g"),c=0;c<b.length;c++)$(b[c]).css("stroke",a)};this.getColor=function(){console.log("numberline.getColor");return this.color};this.X_Axis=new function(a,b,c,d){var e={};this.svg_group=null;var g=a;Object.defineProperty(this,"start",{get:function(){return g},set:function(a){e={};g=a}});Object.defineProperty(this,"min_loc",{get:function(){if(!e.hasOwnProperty("min_loc")){var a=this.start.clone(),b=CTAT.Geom.Point.polar(20,this.angle()),a=a.add(b);a.x=CTAT.Math.round(a.x);
a.y=CTAT.Math.round(a.y);e.min_loc=a}return e.min_loc}});var f=b;Object.defineProperty(this,"end",{get:function(){return f},set:function(a){e={};f=a}});Object.defineProperty(this,"max_loc",{get:function(){if(!e.hasOwnProperty("max_loc")){var a=this.end.clone(),b=CTAT.Geom.Point.polar(20,this.angle()),a=a.add(b.scale(-1));a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);e.max_loc=a}return e.max_loc}});var h=c;Object.defineProperty(this,"min",{get:function(){return h},set:function(a){e={};h=a}});var l=
d;Object.defineProperty(this,"max",{get:function(){return l},set:function(a){e={};l=a}});Object.defineProperty(this,"length",{get:function(){e.hasOwnProperty("length")||(e.length=CTAT.Math.round(this.min_loc.distance(this.max_loc)));return e.length}});this.isHorizontal=function(){return this.start.y===this.end.y};this.isVertical=function(){return this.start.x===this.end.x};Object.defineProperty(this,"range",{get:function(){return this.max.subtract(this.min)}});Object.defineProperty(this,"step_size",
{get:function(){return CTAT.Geom.Point.equals(this.min_loc,this.max_loc)?this.length:CTAT.Math.round(this.length/this.range)}});this.s_vec=function(){return this.max_loc.add(this.min_loc.scale(-1))};this.slope=function(){var a=this.s_vec();return a.y/a.x};this.step=function(){e.hasOwnProperty("step")||(e.step=this.s_vec().normalize(this.step_size));return e.step};this.scalar=function(){e.hasOwnProperty("scalar")||(e.scalar=this.range/this.length);return e.scalar};this.zero=function(){e.hasOwnProperty("zero")||
(e.zero=this.min_loc.add(this.step().scale(-this.min)),e.zero.x=CTAT.Math.round(e.zero.x),e.zero.y=CTAT.Math.round(e.zero.y));return e.zero};this.angle=function(){if(!e.hasOwnProperty("angle")){var a=this.end.add(this.start.scale(-1));e.angle=Math.atan2(a.y,a.x)}return e.angle};this.angle_deg=function(){return CTAT.Math.rad2deg(this.angle())};this.getPosition=function(a){a=this.zero().add(this.step().scale(1*a));a.x=CTAT.Math.round(a.x);a.y=CTAT.Math.round(a.y);return a};this.projected_point=function(a){var b=
this.s_vec(),c=a.add(this.min_loc.scale(-1)),c=0+(b.y*c.x-b.x*c.y)/(b.y*b.y+b.x*b.x);return a.add(new DOMPoint(-c*b.y,c*b.x))};this.getProjectedPoint=function(a){a=this.projected_point(a);return a.distance(this.max_loc)>this.length?this.min_loc:a.distance(this.min_loc)>this.length?this.max_loc:a};this.getAxisValue=function(a){return CTAT.Math.round(h+this.scalar()*this.min_loc.distance(this.getProjectedPoint(a)))}}(new DOMPoint(0,0),new DOMPoint(0,0),new c(0),new c(3));Object.defineProperty(this,
"Maximum",{get:function(){return this.X_Axis.max},set:function(a){this.X_Axis.max=new c(a)}});this.setMaximum=function(a){this.Maximum=a};this.setParameterHandler("Maximum",this.setMaximum);this.data_ctat_handlers.maximum=this.setMaximum;Object.defineProperty(this,"Minimum",{get:function(){return this.X_Axis.min},set:function(a){this.X_Axis.min=new c(a)}});this.setMinimum=function(a){this.Minimum=a};this.setParameterHandler("Minimum",this.setMinimum);this.data_ctat_handlers.minimum=this.setMinimum;
var r=1;Object.defineProperty(this,"Max_Points",{get:function(){return r},set:function(a){a=parseInt(a);isNaN(a)||(r=a)}});this.setMaxPoints=function(a){this.Max_Points=a};this.setParameterHandler("Max_Points",this.setMaxPoints);this.data_ctat_handlers["max-points"]=this.setMaxPoints;var p=7;this.setPointSize=function(a){p=Number(a);n&&(n.setAttributeNS(null,"r",p),$(this._point_group).find("circle").each(function(){$(this).attr("r",p)}))};this.setStyleHandler("PointSize",this.setPointSize);this.data_ctat_handlers["point-size"]=
this.setPointSize;var x=!1;this.setSnapToTickMark=function(a){x=CTATGlobalFunctions.toBoolean(a)};this.setParameterHandler("SnapToTickmark",this.setSnapToTickMark);this.data_ctat_handlers.snap=this.setSnapToTickMark;this.theta=0;Object.defineProperty(this,"Orientation",{get:function(){return 180*this.theta/Math.PI},set:function(a){a=Number(a);isNaN(a)&&(a=0);this.theta=Math.PI*a/180}});this.setOrientation=function(a){this.Orientation=a;this.render()};this.setParameterHandler("Orientation",this.setOrientation);
this.data_ctat_handlers.rotation=this.setOrientation;this._tickmarks=[];this.genTickmark=function(a,b,c){var d=document.createDocumentFragment();if(!this._tickmarks.some(function(b){return b.data.equals(a)})){var e=document.createElementNS(g,"line"),f=this.X_Axis.getPosition(a),h=CTAT.Geom.Point.polar(c/2,this.theta+Math.PI/2).add(f);c=CTAT.Geom.Point.polar(-c/2,this.theta+Math.PI/2).add(f);e.setAttributeNS(null,"x1",h.x);e.setAttributeNS(null,"y1",h.y);e.setAttributeNS(null,"x2",c.x);e.setAttributeNS(null,
"y2",c.y);e.setAttributeNS(null,"data-value",a.toString());e.data=a;e.location=f;e.label=null;this._tickmarks.push(e);d.appendChild(e);if(""!==b){f=document.createElementNS(g,"text");f.classList.add("CTATNumberLine--tickmark-label");f.setAttributeNS(null,"text-anchor","middle");d.appendChild(f);if(null===b||void 0===b)if(1==a.denominator)f.appendChild(document.createTextNode(String(a.numerator.toPrecision(R)))),f.setAttributeNS(null,"x",c.x),f.setAttributeNS(null,"y",c.y);else{b=""+String(a.numerator);
h=""+String(a.denominator);f.style.fontSize="0.6em";f.setAttributeNS(null,"text-align","center");var l=document.createElementNS(g,"tspan"),m=document.createElementNS(g,"tspan");l.appendChild(document.createTextNode(b));m.appendChild(document.createTextNode(h));f.appendChild(l);f.appendChild(m);l.setAttributeNS(null,"text-anchor","middle");l.setAttributeNS(null,"x",c.x);l.setAttributeNS(null,"y",c.y);l.setAttributeNS(null,"dy","-1em");m.setAttributeNS(null,"text-anchor","middle");m.setAttributeNS(null,
"x",c.x);m.setAttributeNS(null,"y",c.y);b.length>h.length?l.style.textDecoration="underline":m.style.textDecoration="overline"}else f.appendChild(document.createTextNode(b.toString())),d.appendChild(tlabel),f.setAttributeNS(null,"x",c.x),f.setAttributeNS(null,"y",c.y);e.label=f}}return d};var q=function(){if(null!==this.X_Axis&&null!==this.X_Axis.svg_group){var a=this.getBoundingBox(),b=window.getComputedStyle(this._axis_line_group),b=parseInt(b.getPropertyValue("stroke-width")),a=CTAT.Geom.Rectangle.inflate(a,
-b,-b),c=new DOMPoint(a.width/2,a.height/2),d=c.add(CTAT.Geom.Point.polar(Math.min(40,a.height,a.width)/4,this.theta)),e=Math.sin(this.theta),f=-Math.cos(this.theta),n=e*c.x+f*c.y,q=-a.height*f,p=-e*a.width,b=new DOMPoint(a.left,c.y),c=new DOMPoint(a.right,c.y);if(0<Math.abs(CTAT.Math.round(q))){var q=new DOMPoint(a.left,(n-e*a.left)/f),u=new DOMPoint(a.right,(n-e*a.right)/f);if(a.contains(q)||a.contains(u))d.distance(q)<d.distance(u)?(b=u,c=q):(b=q,c=u)}0<Math.abs(CTAT.Math.round(p))&&(p=new DOMPoint((n-
f*a.top)/e,a.top),e=new DOMPoint((n-f*a.bottom)/e,a.bottom),a.contains(p)||a.contains(e))&&(d.distance(p)<d.distance(e)?(b=e,c=p):(b=p,c=e));if(this.X_Axis.start.x!=b.x||this.X_Axis.start.y!=b.y||this.X_Axis.end.x!=c.x||this.X_Axis.end.y!=c.y)this.X_Axis.start=b,this.X_Axis.end=c,this.X_Axis.svg_group.innerHTML="",a=document.createDocumentFragment(),d=document.createElementNS(g,"line"),d.setAttributeNS(null,"x1",b.x),d.setAttributeNS(null,"y1",b.y),d.setAttributeNS(null,"x2",c.x),d.setAttributeNS(null,
"y2",c.y),a.appendChild(d),d=document.createElementNS(g,"path"),d.setAttributeNS(null,"d","M 10,6 L 0,0 L 10,-6"),d.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(b)+") rotate("+this.Orientation+")"),a.appendChild(d),b=document.createElementNS(g,"path"),b.setAttributeNS(null,"d","M -10,6 L 0,0 L -10,-6"),b.setAttributeNS(null,"transform","translate("+CTAT.Geom.Point.to2DString(c)+") rotate("+this.Orientation+")"),a.appendChild(b),this.X_Axis.svg_group.appendChild(a);this._tickmarks=
[];b=document.createDocumentFragment();b.appendChild(h.generate());b.appendChild(l.generate());b.appendChild(m.generate());this._tick_mark_group.innerHTML="";this._tick_mark_group.appendChild(b);b=this._point_group.children;for(c=0;c<b.length;c++)a=b[c],d=this.X_Axis.getPosition(a.value),e=new DOMPoint(a.cx.baseVal.value,a.cy.baseVal.value),1<d.distance(e)&&(a.cx.baseVal.value=d.x,a.cy.baseVal.value=d.y)}}.bind(this),u=0,n=null,B=new DOMPoint(-30,-30),v=!1,z=function(a){B.x=a.clientX;B.y=a.clientY},
A=function(a){cancelAnimationFrame(u);n.style.visibility="hidden";v=!1},D=function(a){if(!0===this.getEnabled()&&0<r){this.setHintHighlight(!1);var b;x?(a=t(a.clientX,a.clientY),b=a.location,a=a.data):(a=w(a.clientX,a.clientY),b=this.X_Axis.getProjectedPoint(a),a=this.X_Axis.getAxisValue(a));var c=document.createElementNS(g,"circle");c.classList.add("CTATNumberLine--point");c.setAttributeNS(null,"cx",b.x);c.setAttributeNS(null,"cy",b.y);c.setAttributeNS(null,"r",p);c.value=a;if(this._point_group.children.length>=
this.Max_Points){b=[].slice.call(this._point_group.children);var d=b.filter(function(a,b,c){return a.classList.contains("CTAT--incorrect")});0<d.length?this._point_group.removeChild(d[0]):(b=b.filter(function(a,b,c){return!a.classList.contains("CTAT--correct")}),0<b.length&&this._point_group.removeChild(b[0]))}this._point_group.appendChild(c);this.setActionInput("AddPoint",a.toString());this.processAction()}}.bind(this);this.init=function(){this.initSVG();this.component.classList.add("CTATNumberLine--container");
this._axis_line_group=document.createElementNS(g,"g");this._axis_line_group.classList.add("CTATNumberLine--axis");this._tick_mark_group=document.createElementNS(g,"g");this._tick_mark_group.classList.add("CTATNumberLine--tickmark");this._point_group=document.createElementNS(g,"g");n=document.createElementNS(g,"circle");n.setAttributeNS(null,"r",p);n.classList.add("CTATNumberLine--cursor");n.setAttributeNS(null,"transform","translate(-30,-30)");this.component.appendChild(this._axis_line_group);this.component.appendChild(this._tick_mark_group);
this.component.appendChild(this._point_group);this.component.appendChild(n);this.X_Axis.svg_group=this._axis_line_group;q();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("mousemove",z);this.component.addEventListener("mouseleave",A);var a=this.getEnabled;this.component.addEventListener("mouseenter",function(){!0===a()&&0<r&&(v=!0,n.style.visibility=null,u=requestAnimationFrame(C))});this.component.addEventListener("click",D);this.component.addEventListener("focus",
this.processFocus)};this.getConfigurationActions=function(){var a=[],b,c=$(this.getDivWrap());c.attr("data-ctat-minimum")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_minimum"),b.setInput(c.attr("data-ctat-minimum")),a.push(b));c.attr("data-ctat-maximum")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_maximum"),b.setInput(c.attr("data-ctat-maximum")),a.push(b));c.attr("data-ctat-max-points")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_max_user_entries"),
b.setInput(c.attr("data-ctat-max-points")),a.push(b));c.attr("data-ctat-large-tick-step")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_large_step"),b.setInput(c.attr("data-ctat-large-tick-step")),a.push(b));c.attr("data-ctat-small-tick-step")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_small_step"),b.setInput(c.attr("data-ctat-small-tick-step")),a.push(b));c.attr("data-ctat-denominator")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_denominator"),
b.setInput(c.attr("data-ctat-denominator")),a.push(b));return a};var H=-1<navigator.userAgent.toLowerCase().indexOf("firefox"),w=function(a,b){this.svgPoint=this.svgPoint?this.svgPoint:this.component.createSVGPoint();this.svgPoint.x=a;this.svgPoint.y=b;var c=this._axis_line_group.getScreenCTM().inverse();this.svgPoint=this.svgPoint.matrixTransform(c);c=new DOMPoint(this.svgPoint.x,this.svgPoint.y);if(H){var d=$(this.component),e=parseInt(d.css("borderLeftWidth"))+parseInt(d.css("paddingLeft"))+parseInt(d.css("marginLeft")),
d=parseInt(d.css("borderTopWidth"))+parseInt(d.css("paddingTop"))+parseInt(d.css("marginTop"));c.x-=e;c.y-=d}return c}.bind(this),E=function(a,b){return this.getProjectedPoint(w(a,b))}.bind(this.X_Axis),t=function(a,b){for(var c=E(a,b),d=null,e=Number.POSITIVE_INFINITY,g,f,h=0;h<this._tickmarks.length;h++)g=this._tickmarks[h],f=c.distance(g.location),f<e&&(d=g,e=f);return d}.bind(this),C=function(){if(v&&!0===this.getEnabled()){if(x){var a=t(B.x,B.y);n.setAttributeNS(null,"transform","translate"+
CTAT.Geom.Point.to2DString(a.location,!0))}else n.setAttributeNS(null,"transform","translate"+CTAT.Geom.Point.to2DString(E(B.x,B.y),!0));u=requestAnimationFrame(C)}}.bind(this);this.render=function(){q()};this.calcXCoordinate=function(a){a=new c(a);var b=this.getWidth()-30,b=Math.abs(b-30),d=max.subtract(min);return 30+a.subtract(min).divide(d)/b};this.calcNum=function(a){var b=this.getWidth()-30,b=Math.abs(b-30);a=max.subtract(min).multiply((a-30)/b);return min.add(a)};var G=function(a,b){switch(b.getClassName()){case "CTATMessage":b=
b.getSAI()}var c=b.clone();c.setAction(a.getSAI().getAction());c.setSelection(a.getName());return c};this.showCorrect=function(a){a.getInput();var b=a.getAction(),c=function(b){b.setCorrect(G(b,a))};switch(b){case "AddPoint":0<this._point_group.children.length&&(b=[].slice.call(this._point_group.children),c=b[b.length-1],c.classList.remove("CTAT--incorrect"),c.classList.remove("CTAT--hint"),c.classList.add("CTAT--correct"),this.getDisableOnCorrect()&&(b.length>=this.Max_Points&&b.every(function(a){return a.classList.contains("CTAT--correct")})?
this.setEnabled(!1):this.setEnabled(!0)));break;case "Points":b=this._point_group.children;for(c=0;c<b.length;c++){var d=b[c];d.classList.remove("CTAT--incorrect");d.classList.remove("CTAT--hint");d.classList.add("CTAT--correct")}break;case "set_minimum":P(O()).forEach(c);break;case "set_maximum":P(N()).forEach(c);break;case "set_large_step":P(K()).forEach(c);break;case "set_small_step":P(S()).forEach(c);break;case "set_denominator":P(T()).forEach(c);break;default:console.log("Unhandled Action in",
this.getName(),b)}};this.showInCorrect=function(a){a.getInput();var b=a.getAction(),c=function(b){b.setIncorrect(G(b,a))};switch(b){case "AddPoint":0<this._point_group.children.length&&(b=[].slice.call(this._point_group.children),b=b[b.length-1],b.classList.remove("CTAT--correct"),b.classList.remove("CTAT--hint"),b.classList.add("CTAT--incorrect"));break;case "Points":b=this._point_group.children;for(c=0;c<b.length;c++){var d=b[c];d.classList.remove("CTAT--correct");d.classList.remove("CTAT--hint");
d.classList.add("CTAT--incorrect")}break;case "set_minimum":P(O()).forEach(c);break;case "set_maximum":P(N()).forEach(c);break;case "set_large_step":P(K()).forEach(c);break;case "set_small_step":P(S()).forEach(c);break;case "set_denominator":P(T()).forEach(c);break;default:console.log("Unhandled Action in",this.getName(),b)}};var y=this.setEnabled;this.setEnabled=function(a){y(a);n&&v&&(n.style.visibility=this.getEnabled()?null:"hidden")};this.set_minimum=function(a){this.Minimum=a;this.render()};
this.change_minimum=function(a){a=new c(a);0!==a.valueOf()&&(this.Minimum=this.Minimum.add(a),this.render())};var I=function(){this.setActionInput("set_minimum",this.Minimum)}.bind(this);this.set_maximum=function(a){this.Maximum=a;this.render()};this.change_maximum=function(a){a=new c(a);0!==a.valueOf()&&(this.Maximum=this.Maximum.add(a),this.render())};var F=function(){this.setActionInput("set_maximum",this.Maximum)}.bind(this);this.set_max_user_entries=function(a){this.setMaxPoints(parseInt(a))};
a=function(a,b){a.setStep(b);this.render()};this.set_large_step=a.bind(this,h);var J=function(){this.setActionInput("set_large_step",h.step.toString())}.bind(this);this.set_small_step=a.bind(this,l);var M=function(){this.setActionInput("set_small_step",l.step.toString())}.bind(this);this.set_denominator=function(a){0===parseInt(a)?m.setStep(0):m.setStep((new c(a)).reciprocal());this.render()};var L=function(){var a=0===m.step.valueOf()?0:m.step.reciprocal();this.setActionInput("set_denominator",a.toString())}.bind(this);
a=function(a,b){if(0!==(new c(b)).valueOf()){var d=a.step.add(b);0>d.valueOf()&&d.set(0,1);a.setStep(d);this.render()}};this.change_large_step=a.bind(this,h);this.change_small_step=a.bind(this,l);this.change_denominator=function(a){a=new c(a);0!==a.valueOf()&&(a=a.add(m.step.denominator),m.setStep(a.reciprocal()),this.render())};var R=void 0;this.set_precision=function(a){R=parseInt(a);this.render()};this.AddPoint=function(a,b){var d=new c(a),e=this.X_Axis.getPosition(d),f=document.createElementNS(g,
"circle");f.classList.add("CTATNumberLine--point");f.setAttributeNS(null,"cx",e.x);f.setAttributeNS(null,"cy",e.y);f.setAttributeNS(null,"r",p);f.value=d;[].slice.call(this._point_group.children).some(function(a){return d.equals(a.value)})||this._point_group.appendChild(f)};this.Points=function(a,b){this._point_group.innerHTML="";var c=a.split(";"),d;for(d in c)this.AddPoint(c[d],b)};var Q=function(a,b,c,d){switch(d.getAction()){case "ButtonPressed":a.call(this,d.getInput());break;case "Update":case "UpdateTextField":case "UpdateTextArea":b.call(this,
d.getInput())}c.call();this.processAction(!1,!0)};a=function(a){return(a=$(this.getDivWrap()).attr(a))?a.split(/\s*;\s*/).map(function(a){return a.trim()}):[]};var N=a.bind(this,"data-ctat-ctrl-max"),O=a.bind(this,"data-ctat-ctrl-min"),K=a.bind(this,"data-ctat-ctrl-large-tick"),S=a.bind(this,"data-ctat-ctrl-small-tick"),T=a.bind(this,"data-ctat-ctrl-denominator"),P=function(a){return a.map(function(a){return $("#"+a).data("CTATComponent")})},Z=function(a){var b=null;if(a instanceof CTAT.Component.Base.Tutorable)a!=
this&&(b=a.getName());else if(a instanceof CTATSAI)a.getSelection()!=pointer.getName()&&(b=a.getSelection());else if(a instanceof String)a!=pointer.getName()&&(b=a);else if(a instanceof Element)a!=pointer.getComponent()&&(b=a.id);else return null;if(b){if(U(b))return Q.bind(this,this.change_denominator,this.set_denominator,L);if(V(b))return Q.bind(this,this.change_small_step,this.set_small_step,M);if(W(b))return Q.bind(this,this.change_large_step,this.set_large_step,J);if(X(b))return Q.bind(this,
this.change_minimum,this.set_minimum,I);if(Y(b))return Q.bind(this,this.change_maximum,this.set_maximum,F)}return null}.bind(this);CTATConfiguration.get("previewMode")||document.addEventListener(CTAT.Component.Base.Tutorable.EventType.action,function(a){var b=a.detail.sai;a=Z(a.detail.component);b&&null!==a&&a(b)},!1);this.setMaxControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-max",a)};this.setParameterHandler("MaxValueControllers",this.setMaxControllers);this.setMinControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-min",
a)};this.setParameterHandler("MinValueControllers",this.setMinControllers);this.setLargeTickControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-large-tick",a)};this.setParameterHandler("LargeTickmarkControllers",this.setLargeTickControllers);this.setSmallTickControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-small-tick",a)};this.setParameterHandler("SmallTickmarkControllers",this.setSmallTickControllers);this.setDenominatorControllers=function(a){$(this.getDivWrap()).attr("data-ctat-ctrl-denominator",
a)};this.setParameterHandler("DenominatorTickmarkControllers",this.setDenominatorControllers);a=function(a,b){return 0<=a().indexOf(b)};var Y=a.bind(null,N),X=a.bind(null,O),W=a.bind(null,K),V=a.bind(null,S),U=a.bind(null,T);this.grade=function(a){a=a.getDivWrap().id;Y(a)?(this.setAction("set_maximum"),this.setInput(this.Maximum.toString())):X(a)?(this.setAction("set_minimum"),this.setInput(this.Minimum.toString())):W(a)?(this.setAction("set_large_step"),this.setInput(h.step.toString())):V(a)?(this.setAction("set_small_step"),
this.setInput(l.step.toString())):U(a)?(this.setAction("set_denominator"),this.setInput(m.step.reciprocal().toString())):this.updateSAI();this.processAction(!0)};this.updateSAI=function(){for(var a=this._point_group.children,b=[],c=0;c<a.length;c++)b.push(a[c].value);b.sort(function(a,b){return a-b});this.setActionInput("Points",b.join(";"))}};CTATNumberLine.prototype=Object.create(CTAT.Component.Base.SVG.prototype);CTATNumberLine.prototype.constructor=CTATNumberLine;
CTAT.ComponentRegistry.addComponentType("CTATNumberLine",CTATNumberLine);var CTATNumericStepper=function(a,b,e,f,d){CTAT.Component.Base.Tutorable.call(this,"CTATNumericStepper","__undefined__",a,b,e,f,d);this.setAction("Update");var c=document.createElement("input");c.type="number";this.set_maximum=function(a){a=Number(a);isNaN(a)||(c.max=a)};this.setParameterHandler("maximum",this.set_maximum);this.set_minimum=function(a){a=Number(a);isNaN(a)||(c.min=a)};this.setParameterHandler("minimum",this.set_minimum);this.set_step=function(a){a=Number(a);isNaN(a)||(c.step=a)};this.setParameterHandler("stepSize",
this.set_step);this.update_value=function(a){a=Number(a);isNaN(a)||(c.value=a,this.setInput(a))};this.setParameterHandler("value",this.update_value);this.updateSAI=function(){this.setInput(c.value)};this.Update=this.update_value;this.init=function(){c.id=this.getName()+"_spinner";this.setComponent(c);this.setInitialized(!0);var a=$(this.getDivWrap()),b=$(c);"autofocus defaultValue placeholder value max min readOnly step".split(" ").forEach(function(c){var d=a.attr(c);d&&b.attr(c,d)});this.getDivWrap().innerHTML=
"";this.getDivWrap().appendChild(c);this.component.addEventListener("focus",this.processFocus);var d=this;c.addEventListener("change",function(a){var b=Number(this.min);isNaN(b)&&(b=0);a=Number(this.value);if(isNaN(a))this.value=b;else if(""!==this.min&&a<b)this.value=b;else if(""!==this.max&&!isNaN(Number(this.max))&&a>Number(this.max))this.value=this.max;else{var c=Number(this.step);if(isNaN(c)||0>=c)c=1;b=(a-b)%c;0!==b&&(this.value=a-b)}d.updateSAI();d.processAction();return!1})};this.getConfigurationActions=
function(){var a=[],b,c=$(this.getDivWrap());c.attr("min")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_minimum"),b.setInput(c.attr("min")),a.push(b));c.attr("max")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_maximum"),b.setInput(c.attr("max")),a.push(b));c.attr("step")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_step"),b.setInput(c.attr("step")),a.push(b));c.attr("value")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("Update"),
b.setInput(c.attr("value")),a.push(b));return a}};CTATNumericStepper.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATNumericStepper.prototype.constructor=CTATNumericStepper;CTAT.ComponentRegistry.addComponentType("CTATNumericStepper",CTATNumericStepper);var CTATPieChart=function(a,b,e,f,d){CTAT.Component.Base.UnitDisplay.call(this,"CTATPieChart","aPieChart",a,b,e,f,d);var c=3,g=3,h=this,l,m,r,p=null,x=CTATGlobals.NameSpace.svg;this.init=function(){this.initSVG();this.baseGroup=document.createElementNS(x,"g");this.getComponent().appendChild(this.baseGroup);this.getComponent().classList.add("CTATPieChart--container");l=document.createElementNS(x,"filter");l.id=this.genName("Shadow");m="#"+l.id;r="url("+m+")";l.setAttributeNS(null,"width","200%");l.setAttributeNS(null,
"height","200%");p=document.createElementNS(x,"feOffset");p.setAttributeNS(null,"in","SourceAlpha");p.setAttributeNS(null,"result","offOut");p.setAttributeNS(null,"dx",g);p.setAttributeNS(null,"dy",g);l.appendChild(p);var a=document.createElementNS(x,"feGaussianBlur");a.setAttributeNS(null,"in","offOut");a.setAttributeNS(null,"result","blurOut");a.setAttributeNS(null,"stdDeviation",4);l.appendChild(a);a=document.createElementNS(x,"feBlend");a.setAttributeNS(null,"in","SourceGraphic");a.setAttributeNS(null,
"in2","blurOut");a.setAttributeNS(null,"mode","normal");l.appendChild(a);this.getComponent().getElementsByTagName("defs")[0].appendChild(l);0<g&&this.baseGroup.setAttributeNS(null,"filter",r);this.drawPieces();this.addComponentReference(this,this.getDivWrap());this.component.addEventListener("focus",this.processFocus)};this.render=function(){this.drawPieces()};this.drawPieces=function(){if(this.baseGroup){this.clear();var a=window.getComputedStyle(this.getComponent()),a=parseFloat(a.getPropertyValue("stroke-width")),
b=this.getBoundingBox(),d=Math.min(b.width/2,b.height/2)-(a+g+4),e=new DOMPoint(b.width/2,b.height/2),a=this.parseValue(),f=document.createDocumentFragment();a.reduce(function(a,b,g,l){if(1<=b.valueOf())g=document.createElementNS(x,"circle"),g.classList.add("CTATPieChart--piece"),g.cx.baseVal.value=e.x,g.cy.baseVal.value=e.y,g.r.baseVal.value=d,this.addPieceElem(g,b,b.selected),f.appendChild(g);else{g=document.createElementNS(x,"path");g.classList.add("CTATPieChart--piece");f.appendChild(g);window.getComputedStyle(g);
var m=2*Math.PI*a.valueOf();l=e.add(CTAT.Geom.Point.polar(d,m));b.reduce();var n=e.add(CTAT.Geom.Point.polar(d,2*Math.PI*b.valueOf()+m)),q=e.clone();if(0<c&&c<d){m=CTAT.Geom.Point.polar(c,m+Math.PI*b.valueOf());q=q.add(m);l=l.add(m);var p=function(a,b,c){return a.distance(b)<a.distance(c)?b:c};l=CTAT.Geom.Point.circle_intersection(q,l,e,d).reduce(p.bind(this,l));n=n.add(m);n=CTAT.Geom.Point.circle_intersection(q,n,e,d).reduce(p.bind(this,n))}m=CTAT.Geom.Point.to2DString;q="M "+m(q);p=new DOMPoint(d,
d);q+=" L "+m(l);q+=" A "+m(p)+" 0 "+(.5<b.valueOf()?1:0)+",1 "+m(n);g.setAttributeNS(null,"d",q+" Z");h.addPieceElem(g,b,b.selected)}return a.add(b)},new CTAT.Math.Fraction);this.baseGroup.innerHTML="";this.baseGroup.appendChild(f)}};this.getExplode=function(){return c};this.getDropShadowDistance=function(){return g};this.setExplode=function(a){a=Number(a);if(!isNaN(a)){var b=a!==c;c=a;b&&this.drawPieces()}return this};this.setStyleHandler("explode",this.setExplode);this.data_ctat_handlers.explode=
function(a){this.setExplode(a)};this.setDropShadowDistance=function(a){g=parseInt(a);g=isNaN(g)?0:g;p&&(p.setAttributeNS(null,"dx",g),p.setAttributeNS(null,"dy",g),0>=g&&this.baseGroup?this.baseGroup.removeAttributeNS(null,"filter"):this.baseGroup.hasAttributeNS(null,"filter")||this.baseGroup.setAttributeNS(null,"filter",r))};this.data_ctat_handlers["shadow-distance"]=function(a){this.setDropShadowDistance(a)}};CTATPieChart.prototype=Object.create(CTAT.Component.Base.UnitDisplay.prototype);
CTATPieChart.prototype.constructor=CTATPieChart;CTAT.ComponentRegistry.addComponentType("CTATPieChart",CTATPieChart);var CTATRadioButton=function(a,b,e,f,d){CTAT.Component.Base.Clickable.call(this,"CTATRadioButton","__undefined__",a,b,e,f,d);var c=CTATConfiguration.get("previewMode"),g=this,h=null,l=null,m="#000000";this.setSelection(this.getComponentGroup());this.setAction("UpdateRadioButton");this.setStyleHandler("BackgroundColor",null);this.init=function(){g.setInitialized(!0);h=document.createElement("input");h.type="radio";h.id=this.getName()+"_radio";h.value=g.getName();this.getComponentGroup()?h.name=g.getComponentGroup():
this.getDivWrap()&&$(this.getDivWrap()).attr("name")?h.name=$(this.getDivWrap()).attr("name"):h.name="radioButtonGroup";!0===g.getEnabled()?h.disabled=!1:h.disabled=!0;g.addComponentReference(g,h);var a;c||(a=this.getDivWrap().innerHTML,this.getDivWrap().innerHTML="");g.getDivWrap().appendChild(h);l=document.createElement("label");l.htmlFor=h.id;this.getText()?l.textContent=g.getText():a&&!c?l.innerHTML=a:this.getDivWrap().getAttribute("data-ctat-label")&&(l.textContent=this.getDivWrap().getAttribute("data-ctat-label"));
g.setComponent(h);this.getDivWrap().appendChild(l);h.addEventListener("click",function(a){g.updateSAI();g.processAction()});h.addEventListener("focus",this.processFocus);h.onfocus=this.processOnFocus;this.setSelection(this.getComponentGroup());this.component.addEventListener("focus",this.processFocus)};this.getConfigurationActions=function(){var a=[];if(0<l.innerHTML.trim().length){var b=new CTATSAI;b.setSelection(this.getName());b.setInput(l.innerHTML.toString());b.setAction("setText");a.push(b)}return a};
this.setFontColor=function(a){m=a;$(l).css("color",a)};this.getFontColor=function(){return m};this.resize=function(){var a=$(this.getDivWrap()).height();$(l).css("font-size",a-5+"px");$(this.getComponent()).css("height",a-10+"px");$(this.getComponent()).css("width",a-10+"px")};var r=this.setText;this.setText=function(a){r(a);null!==l&&(l.innerHTML=this.getText())};this.setStyleHandler("buttonLabel",this.setText);var p=this.setEnabled;this.setEnabled=function(a){p(a);null!==h&&(h.disabled=!this.getEnabled())};
this.setChecked=function(a){null!==h&&(h.checked=a)};this.getChecked=function(){return h.checked};this.getRadioInput=function(){return h.checked?h.value+": "+l.textContent:""};this.setStyleHandler("labelPlacement",null);this.reset=function(){g.ctatdebug(" reset ( "+g.getName()+")");h.checked=!1;g.setEnabled(!0)};this.UpdateRadioButton=function(a){0<=a.indexOf(h.value)&&g.setChecked(!0);g.ctatdebug("UpdateRadioButton ()")};this.updateSAI=function(){var a=$('div[data-ctat-component]:has(input[type="radio"][name="'+
h.name+'"]:checked)'),b="";1===a.length&&(b=$(a[0]).data("CTATComponent").getRadioInput());g.setSelection(h.name);g.setInput(b)};var x=function(a){l&&l.classList.add(a);h&&h.classList.add(a)},q=function(a){l&&l.classList.remove(a);h&&h.classList.remove(a)};this.showCorrect=function(a){q("CTAT--hint");q("CTAT--incorrect");(a?0===a.getInput().indexOf(h.value):1)?x("CTAT--correct"):q("CTAT-correct")};this.removeCorrect=function(){q("CTAT--correct")};this.showInCorrect=function(a){q("CTAT--hint");q("CTAT--correct");
(a?0===a.getInput().indexOf(h.value):1)?x("CTAT--incorrect"):q("CTAT-incorrect")};this.removeInCorrect=q.bind(this,"CTAT--incorrect");this.showHintHighlight=function(a){this.removeCorrect();this.removeInCorrect();a?x("CTAT--hint"):q("CTAT--hint")}};CTATRadioButton.prototype=Object.create(CTAT.Component.Base.Clickable.prototype);CTATRadioButton.prototype.constructor=CTATRadioButton;CTAT.ComponentRegistry.addComponentType("CTATRadioButton",CTATRadioButton);var CTATScrollPaneComponent=function(a,b,e,f,d){CTAT.Component.Base.Tutorable.call(this,"CTATScrollPaneComponent","__undefined__",a,b,e,f,d);var c=0,g=this;g.isTabIndexable=!1;this.getAlpha=function(){return c};this.setAlpha=function(a){c=a};this.init=function(){g.ctatdebug("init ("+g.getName()+")");g.ctatdebug("Final location: "+g.getX()+","+g.getY()+" with text: "+g.getText());g.setInitialized(!0)};this.processCommShellEvent=function(a,b){g.ctatdebug("processCommShellEvent ("+a+")")};this.processSerialization=
function(){g.ctatdebug("processSerialization()")};this.postProcess=function(){g.ctatdebug("postProcess ()");for(var a in this.parameters){var b=this.parameters[a];g.ctatdebug("Checking style name: "+a);if("TargetMovieClip"==a)if(g.ctatdebug("Loading sub element: ["+b.trim()+"] ..."),b=findMovieClip(b.trim()),null!==b){if(g.ctatdebug("Found target movieclip, temporarily removing ..."),null!==b.getDivWrapper().parentNode){try{b.getDivWrapper().parentNode.removeChild(b.getDivWrapper())}catch(p){CTATScrim.scrim.errorScrimUp(p.message);
return}g.getDivWrap().setAttribute("id","scrollsubdiv");g.ctatdebug("Adding ...");g.getDivWrap().appendChild(b.getDivWrapper());var c=b.getDivWrapper().style.left,d=b.getDivWrapper().style.top;b.getDivWrapper().style.left="0px";b.getDivWrapper().style.top="0px";g.ctatdebug("Moving canvas from: "+c+","+d+" to: 0,0");b=b.getDivWrapper().childNodes;for(c=0;c<b.length;c++);}}else g.ctatdebug("Unable to find the target movieclip to reparent the content from")}g.ctatdebug("Final location: "+g.getX()+","+
g.getY()+" with text: "+g.getText());null===CTATCommShell.commShell||void 0===CTATCommShell.commShell?g.ctatdebug("Error: can't add event listener to commshell, pointer is invalid"):CTATCommShell.commShell.addGlobalEventListener(this)};this.configFromDescription()};CTATScrollPaneComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATScrollPaneComponent.prototype.constructor=CTATScrollPaneComponent;CTAT.ComponentRegistry.addComponentType("CTATScrollPaneComponent",CTATScrollPaneComponent);var CTATSkillWindow=function(a,b,e,f,d){CTAT.Component.Base.Graphical.call(this,"CTATSkillWindow","__undefined__",a,b,e,f,d);var c=this;c.isTabIndexable=!1;this.getThreshold=function(){var a=parseFloat($(this.getDivWrap()).attr("data-ctat-threshold"));return isNaN(a)?.95:a};this.setThreshold=function(a){$(this.getDivWrap()).attr("data-ctat-threshold",a)};var g=null;this.init=function(){c.ctatdebug("init ("+c.getName()+")");c.setIsAbstractComponent(!0);c.setInitialized(!0);g=this.getDivWrap();this.setComponent(g);
this.drawComponent();this.component.addEventListener("focus",this.processFocus)};this.assignSkillSet=function(a){CTATSkillSet.skills=a;this.drawComponent()};this.updateSkillSet=function(a){if(CTATSkillSet.skills){c.ctatdebug("updateSkillSet ("+a.getSkillSet().length+")");a=a.getSkillSet();for(var b=0;b<a.length;b++){var d=a[b];c.ctatdebug("Updating skill "+d.getSkillName()+" to level: "+d.getLevel()+" ...");CTATSkillSet.skills.setSkillLevel(d.getSkillName(),d.getLevel(),1)}this.drawComponent()}else c.ctatdebug("Error: updateSkillSet () no initial skill set given, can't update")};
this.drawComponent=function(){c.ctatdebug("drawComponent ()");if(null===CTATSkillSet.skills)ctatdebug("Info: no skillSet object available, bumping out");else{var a=CTATSkillSet.skills.getSkillSet();if(null===a)c.ctatdebug("Error: list of skills is null in skills object");else if(0>=a.length)c.ctatdebug("Error: list of skills is 0 length");else{for(var b=document.createDocumentFragment(),d=this.getThreshold(),e=0;e<a.length;e++){var f=a[e];c.ctatdebug("Drawing skill "+e+" "+f.getDisplayName()+" level: "+
f.getLevel()+" ...");var x=document.createElement("div");x.classList.add("CTATSkillWindow--skill");var q=document.createElement("div");q.classList.add("CTATSkillWindow--bar");var u=document.createElement("div"),n=f.getLevel();n<d?u.classList.add("CTATSkillWindow--bar--nonmastered"):u.classList.add("CTATSkillWindow--bar--mastery");u.style.width=n>d?"100%":100*n+"%";q.appendChild(u);x.appendChild(q);b.appendChild(x);q=document.createElement("div");q.textContent=f.getDisplayName()||"no-name";q.classList.add("CTATSkillWindow--label");
x.appendChild(q)}g.innerHTML="";g.appendChild(b)}}}};CTATSkillWindow.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);CTATSkillWindow.prototype.constructor=CTATSkillWindow;CTAT.ComponentRegistry.addComponentType("CTATSkillWindow",CTATSkillWindow);var CTATSubmitButton=function(a,b,e,f,d){CTATButton.call(this,a,b,e,f,d);this.setClassName("CTATSubmitButton");CTATConfiguration.get("previewMode");var c=this;this.setParameterHandler("target_components",function(a){this.getDivWrap().setAttribute("data-ctat-target",a);return this});var g=this.init;this.init=function(){g();this.setParameter("tutorComponent",CTAT.Component.Base.Tutorable.Options.DO_NOT_TUTOR);this.component.addEventListener("focus",this.processFocus)};var h=function(a){var b=c.getTargets();
return 0===Object.keys(b).length?!1:a===c?!1:a instanceof CTAT.Component.Base.Tutorable?b.hasOwnProperty(a.getName())||b.hasOwnProperty(a.getComponentGroup()):a instanceof CTATSAI?a.getSelection()!=c.getName()&&b.hasOwnProperty(a.getSelection()):a instanceof String?a!=c.getName()&&b.hasOwnProperty(a):a instanceof Element?a!=c.getComponent()&&(b.hasOwnProperty(a.id)||b.hasOwnProperty(a.getAttribute("name"))):!1};a=CTAT.Component.Base.Tutorable.EventType;document.addEventListener(a.correct,function(a){a.detail.sai&&
h(a.detail.component)&&c.isNotGraded()&&c.setCorrect()},!1);document.addEventListener(a.incorrect,function(a){a.detail.sai&&h(a.detail.component)&&(c.setIncorrect(),c.setEnabled(!0))},!1);document.addEventListener(a.ungrade,function(a){(a=a.detail.component)&&h(a)&&c.setNotGraded()},!1);document.addEventListener(a.highlight,function(a){var b=a.detail.component;b&&h(b)&&c.setHintHighlight(a.detail.isHighlighted)},!1);this.getTargets=function(){var a={},b=this.getDivWrap().getAttribute("data-ctat-target");
b&&String(b).split(/\s*[;,]\s*/).forEach(function(b){return a[b.trim()]=1});return a};this.processClick=function(a){if(!0===c.getEnabled()){a=c.getTargets();for(var b in a)a=CTATShellTools.findComponent(b),null!==a&&0<a.length&&(a=a[0],a instanceof CTAT.Component.Base.Tutorable?a.getEnabled()&&a.grade(c):c.ctatdebug("Invalid target component: "+a))}}};CTATSubmitButton.prototype=Object.create(CTATButtonBasedComponent.prototype);CTATSubmitButton.prototype.constructor=CTATSubmitButton;
CTAT.ComponentRegistry.addComponentType("CTATSubmitButton",CTATSubmitButton);var CTATTextBasedComponent=function(a,b,e,f,d,c,g){CTAT.Component.Base.Tutorable.call(this,a,b,e,f,d,c,g);var h=this,l="",m="#000000",r=16,p=!0,x=255,q=!0;this.setAction("UpdateTextField");this.backgrade=!0;this.setFontColor=function(a){m=a;$(h.getComponent()).css("color",a)};this.getFontColor=function(){return m};this.setFontSize=function(a){a.includes("px")||(a+="px");r=a;$(h.getComponent()).css("font-size",a)};this.getFontSize=function(){return r};this.assignText=function(a){l=a;this.setInput(a)};
this.UpdateTextArea=this.UpdateTextField=function(a){this.setText(a)};this.setTabOnEnter=function(a){p=CTATGlobalFunctions.toBoolean(a)};this.setStyleHandler("TabOnEnter",this.setTabOnEnter);this.data_ctat_handlers["tab-on-enter"]=this.setTabOnEnter;this.assignEditable=function(a){q=a};this.setMaxCharacters=function(a){x=a};this.setStyleHandler("MaxCharacters",this.setMaxCharacters);this.getText=function(){return l};this.getEditable=function(){return q};this.getTabOnEnter=function(){return p};this.getMaxCharacters=
function(){return x};this.setEditable=function(a){h.assignEditable(CTATGlobalFunctions.toBoolean(a));null!==h.getComponent()&&(!0===h.getEditable()?h.getComponent().contentEditable="true":h.getComponent().contentEditable="false")};this.setStyleHandler("Enabled",this.setEditable);this.setEnabled=function(a){h.assignEnabled(a);null!==h.getComponent()&&(h.getComponent().disabled=!a,this.setEditable(a))};var u=this.processAction.bind(this);this.processAction=function(a,b){h.ctatdebug("processAction ()");
this.updateSAI();CTATGlobalFunctions.isBlank(this.getValue())||u(a,b)};this.processKeypress=function(a){h.ctatdebug("processKeypress ()");var b=a.target.getAttribute("id");h.ctatdebug(b);var c=h.getComponentFromID(b);if(null===c)h.ctatdebug("Error: component reference is null");else switch(h.ctatdebug(c.getName()+" keydown ("+("google"==CTATConfig.platform?0:window.event?window.event.keyCode:a.which)+" -> "+a.eventPhase+") ID: "+b),a.which){case 37:h.ctatdebug("left arrow key pressed!");break;case 39:h.ctatdebug("right arrow key pressed!");
break;case 13:return p?(h.component.blur(),CTATGlobals.Tab.Focus=null,h.processAction(),!1):!0;case 0:h.component.blur();CTATGlobals.Tab.Focus=null;h.processAction();break;default:h.ctatdebug('Key pressed! "'+a.which+'"')}};this.updateSAI=function(){h.ctatdebug("updateSAI ()");this.setInput(this.getValue());var a=this.getSAI();h.ctatdebug("SAI: "+a.toTSxmlString())};this.addEventScreen=function(a){var b=document.createElement("div");b.style.position="absolute";b.style.top="0";b.style.left="0";b.style.bottom=
"0";b.style.right="0";a&&b.addEventListener("dblclick",function(){setTimeout(function(){var a=h.getDivWrap().getAttribute("data-ctat-enabled");h.setEnabled(!0);var b=h.getComponent();b.hasEditListeners||(b.addEventListener("blur",function(){h.setEnabled(!1);h.getDivWrap().setAttribute("data-ctat-enabled",a);h.getDivWrap().setAttribute("value",b.value)}),"CTATTextArea"===h.getClassName()&&b.addEventListener("keydown",function(a){13==(a.keyCode||a.charCode)&&(a.preventDefault(),this.value+="\n")}),
b.hasEditListeners=!0);b.focus()},410)});this.getDivWrap().appendChild(b)}};CTATTextBasedComponent.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATTextBasedComponent.prototype.constructor=CTATTextBasedComponent;var CTATTextArea=function(a,b,e,f,d){CTATTextBasedComponent.call(this,"CTATTextArea","__undefined__",a,b,e,f,d);this.setDefaultWidth(100);this.setDefaultHeight(44);var c=this,g=null,h=null,l=CTATConfiguration.get("previewMode");this.setAction("UpdateTextArea");this.init=function(b){g=document.createElement("textarea");a&&(g.name=a.name);g.setAttribute("id",CTATGlobalFunctions.gensym.div_id());var d=this.getDivWrap();d&&$(d).attr("maxlength")&&(g.maxlength=$(d).attr("maxlength"));d&&$(d).attr("rows")&&
(g.rows=$(d).attr("rows"));d&&$(d).attr("cols")&&(g.cols=$(d).attr("cols"));c.setComponent(g);d&&$(d).attr("value")?this.setText($(d).attr("value")):g.value=this.getText();c.setInitialized(!0);c.addComponentReference(c,g);d.appendChild(g);$(g).keypress(c.processKeypress);g.addEventListener("focus",c.processFocus);$(g).on("input",function(a){c.setNotGraded()});l&&this.addEventScreen(!b)};this.processBlur=function(a){c.processAction()};this.setCellContainer=function(a){h=a};this.getCellContainer=function(){return h};
this.setText=function(a){c.ctatdebug("setText ("+a+")");c.assignText(a);g.value=a};this.getValue=function(){return g.value};this.reset=function(){c.configFromDescription();c.processSerialization();g.value=""}};CTATTextArea.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextArea.prototype.constructor=CTATTextArea;CTAT.ComponentRegistry.addComponentType("CTATTextArea",CTATTextArea);var CTATTable=function(a,b,e,f,d){CTAT.Component.Base.Tutorable.call(this,"CTATTable","__undefined__",a,b,e,f,d);var c=this,g=[],h=[],l=0;this.get_first_row_is_header=function(){return CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-has-header"))};this.set_first_row_is_header=function(a){$(this.getDivWrap()).attr("data-ctat-has-header",a);this.get_first_row_is_header()?(p(),l=1):(x(),l=0)};this.setParameterHandler("FirstRowIsHeader",this.set_first_row_is_header);a=function(a){a=
parseInt($(this.getDivWrap()).attr(a));return isNaN(a)?2:a};var m=a.bind(this,"data-ctat-num-rows");this.get_row_count=m;this.set_row_count=function(a){$(this.getDivWrap()).attr("data-ctat-num-rows",a)};this.setNumRows=function(a){a=Number(a);if(!isNaN(a)){for(;this.get_row_count()<a;)this.addRow();for(;this.get_row_count()>a;)this.deleteRow()}};var r=a.bind(this,"data-ctat-num-cols");this.get_col_count=r;this.set_col_count=function(a){$(this.getDivWrap()).attr("data-ctat-num-cols",a)};this.setNumCols=
function(a){a=Number(a);if(!isNaN(a)){for(;this.get_col_count()<a;)this.addColumn();for(;this.get_col_count()>a;)this.deleteColumn()}};this.super_setName=this.setName;this.setName=function(a){this.super_setName(a);if(g&&g[0])for(var b=0;b<g.length;b++)for(var c=0;c<g[0].length;c++)g[b][c].setAttribute("id",a+".R"+b+"C"+c)};this.init=function(){c.ctatdebug("init ("+c.getName()+")");c.setInitialized(!0);var a=c.getDivWrap();c.setComponent(a);c.addComponentReference(c,a);c.render();console.log("table name = "+
this.getName());this.adjustTableContents();this.get_first_row_is_header()?(p(),l=1):l=0};this.getConfigurationActions=function(){var a=[],b,c=$(this.getDivWrap());c.attr("data-ctat-num-rows")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setNumRows"),b.setInput(c.attr("data-ctat-num-rows")),a.push(b));c.attr("data-ctat-num-cols")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setNumCols"),b.setInput(c.attr("data-ctat-num-cols")),a.push(b));c.attr("data-ctat-has-header")&&
(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("set_first_row_is_header"),b.setInput(c.attr("data-ctat-has-header")),a.push(b));return a};var p=function(){$(this.getDivWrap()).children().first().addClass("CTATTable--headers").children().addClass("CTATTable--header")}.bind(this),x=function(){$(this.getDivWrap()).children().first().removeClass("CTATTable--headers").children().removeClass("CTATTable--header")}.bind(this),q=function(a,b){var c=document.createElement("div"),d=this.getName()+
".R"+a+"C"+b;c.id=d;c.classList.add("CTATTable--cell");c.classList.add("CTATTextArea");var e=new CTATTextArea;e.setName(d);e.setDivWrapper(c);e.processAttributes();e.init(!0);e.processTabOrder();e.setEnabled(this.getEnabled());$(c).data("CTATComponent",e);return c}.bind(this);this.addRow=function(){var a=document.createElement("div");a.classList.add("CTATTable--row");var b=m();parseInt(b,10);g[b]=[];for(var c=0;c<r();c++){var d=q(b,c);g[b].push(d);a.appendChild(d)}$(this.getDivWrap()).append(a);h.push(a);
this.set_row_count(b+1)};this.deleteRow=function(){var a=this.getDivWrap();a.removeChild(a.lastChild);h.pop();g.pop();this.set_row_count(this.get_row_count()-1)};this.addColumn=function(){var a=r(),b=0;h.forEach(function(c){var d=q(b,a);g[b].push(d);b<l&&d.classList.add("CTATTable--header");c.appendChild(d);b++});this.set_col_count(a+1)};this.deleteColumn=function(){this.getDivWrap();for(var a=h.length,b=0;b<a;b++)h[b].removeChild(h[b].lastChild),g[b].pop();this.set_col_count(this.get_col_count()-
1)};this.adjustTableContents=function(){c.ctatdebug("adjustTableContents()");for(var a=m(),b=0;b<a;b++){var d=document.createElement("div");d.classList.add("CTATTable--row");$(this.getDivWrap()).append(d);h.push(d);for(var e=0;e<r();e++){var f=c.getName()+".R"+b+"C"+e,l=CTATShellTools.findComponent(f);l&&0!==l.length&&l[0].getName()===f?(f=l[0].getDivWrap(),f.classList.add("CTATTable--cell")):f=q(b,e);d.appendChild(f);g[b]||(g[b]=[]);g[b].push(f)}}}};CTATTable.prototype=Object.create(CTAT.Component.Base.Graphical.prototype);
CTATTable.prototype.constructor=CTATTable;CTAT.ComponentRegistry.addComponentType("CTATTable",CTATTable);var CTATTextField=function(a,b,e,f,d){CTATTextBasedComponent.call(this,"CTATTextBasedComponent","__undefined__",a,b,e,f,d);var c=this,g=null;this.setAction("UpdateTextArea");this.init=function(){g=this.getDivWrap();c.setComponent(g);this.getText()&&(g.innerHTML=c.getText());c.setInitialized(!0);c.addComponentReference(c,g);c.setEditable(!1);c.setEnabled(!1);c.render();c.addSafeEventListener("focus",c.processFocus,g)};this.getConfigurationActions=function(){return 0<g.innerHTML.trim().length?(console.log(g.innerHTML),
this.setInput(g.innerHTML.toString()),[this.getSAI()]):[]};this.setText=function(a){c.ctatdebug("setText ("+a+")");c.assignText(a);null!==g&&(g.innerHTML=a)};this.getValue=function(){return this.getDivWrap().innerHTML};this.setStyleHandler("ShowScrollbars",function(a){!0===CTATGlobalFunctions.toBoolean(a)?c.modifyCSSAttribute("overflow","scroll"):c.modifyCSSAttribute("overflow","hidden")})};CTATTextField.prototype=Object.create(CTATTextBasedComponent.prototype);
CTATTextField.prototype.constructor=CTATTextField;CTAT.ComponentRegistry.addComponentType("CTATTextField",CTATTextField);var CTATTextInput=function(a,b,e,f,d){CTATTextBasedComponent.call(this,"CTATTextInput","__undefined__",a,b,e,f,d);var c=this,g=null,h=null,l=CTATConfiguration.get("previewMode");this.init=function(){this.ctatdebug("init ("+c.getName()+")");g=document.createElement("input");g.type="text";a&&(g.name=a.name);g.setAttribute("maxlength",c.getMaxCharacters());g.setAttribute("id",CTATGlobalFunctions.gensym.div_id());c.setComponent(g);this.ctatdebug("Final location: "+c.getX()+","+c.getY()+" with text: "+
c.getText());var b=$(this.getDivWrap());b.attr("value")&&this.setText(b.attr("value"));var d=$(g);"autofocus defaultValue maxLength pattern placeholder readOnly size title".split(" ").forEach(function(a){var c=b.attr(a);c&&d.attr(a,c)});c.setInitialized(!0);c.addComponentReference(c,g);c.getDivWrap().appendChild(g);c.addSafeEventListener("keypress",c.processKeypress,g);c.addSafeEventListener("focus",c.processFocus,g);$(g).on("input",function(a){c.setNotGraded()});l&&this.addEventScreen(!0)};this.getConfigurationActions=
function(){var a=[],b=$(this.getDivWrap());if(b.attr("value")){var c=new CTATSAI;c.setSelection(this.getName());c.setAction("UpdateTextField");c.setInput(b.attr("value"));a.push(c)}return a};this.setCellContainer=function(a){h=a};this.getCellContainer=function(){return h};this.setText=function(a){c.ctatdebug("setText ("+a+")");c.assignText(a);g.value=a};this.getValue=function(){return g.value};this.reset=function(){c.configFromDescription();c.processSerialization();g.value=""};this.setStyleHandler("DrawBorder",
null)};CTATTextInput.prototype=Object.create(CTATTextBasedComponent.prototype);CTATTextInput.prototype.constructor=CTATTextInput;CTAT.ComponentRegistry.addComponentType("CTATTextInput",CTATTextInput);var CTATVideo=function(a,b,e,f,d){CTAT.Component.Base.Tutorable.call(this,"CTATVideo","__undefined__",a,b,e,f,d);var c=0,g=this,h=null;this.getAlpha=function(){return c};this.setAlpha=function(a){c=a};this.ctatdebug(this.getClassName()+" ("+this.getX()+","+this.getY()+","+this.getWidth()+","+this.getHeight()+")");this.setTutorComponent(!1);this.configFromDescription();this.init=function(){g.ctatdebug("init ("+g.getName()+")");g.addCSSAttribute("z-index",CTATGlobalFunctions.gensym.z_index());h=document.createElement("video");
this.getDivWrap()&&$(this.getDivWrap()).attr("src")?h.src=$(this.getDivWrap()).attr("src"):h.src="http://augustus.pslc.cs.cmu.edu/ProportionalDistanceExercise.mp4";this.getDivWrap()&&$(g.getDivWrap()).attr("data-ctat-controls")?h.controls=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-controls")):h.controls=!0;h.autocontrols=!1;g.ctatdebug("Auto play: "+$(g.getDivWrap()).attr("data-ctat-autoplay"));this.getDivWrap()&&$(g.getDivWrap()).attr("data-ctat-autoplay")?h.autoplay=CTATGlobalFunctions.toBoolean($(this.getDivWrap()).attr("data-ctat-autoplay")):
h.autoplay=!0;g.setComponent(h);g.ctatdebug("Auto play: "+h.autoplay);h.name=g.getName();h.setAttribute("id",CTATGlobalFunctions.gensym.div_id());h.setAttribute("onkeypress","return noenter(event)");g.addComponentReference(g,h);g.ctatdebug("Final location: "+g.getX()+","+g.getY()+" with text: "+g.getText());g.setInitialized(!0);g.getDivWrap().appendChild(h);g.ctatdebug("Resizing component to: "+$(g.getDivWrap()).width()+","+$(g.getDivWrap()).height());h.addEventListener("focus",this.processFocus);
h.addEventListener("canplay",function(){g.ctatdebug("Video loaded and ready for play")},!0);h.addEventListener("play",function(){g.ctatdebug("Video loaded and ready for play");g.logVideoEvent("play")},!0);h.addEventListener("pause",function(){g.ctatdebug("Video loaded and ready for play");g.logVideoEvent("pause")},!0);h.setAttribute("width",$(g.getDivWrap()).width());h.setAttribute("height",$(g.getDivWrap()).height())};this.getConfigurationActions=function(){var a=[],b;$(g.getDivWrap()).attr("data-ctat-controls")&&
(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("showControls"),b.setInput($(g.getDivWrap()).attr("data-ctat-controls")),a.push(b));$(g.getDivWrap()).attr("data-ctat-autoplay")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setAutoplay"),b.setInput($(g.getDivWrap()).attr("data-ctat-autoplay")),a.push(b));$(this.getDivWrap()).attr("src")&&(b=new CTATSAI,b.setSelection(this.getName()),b.setAction("setURL"),b.setInput($(this.getDivWrap()).attr("src")),a.push(b));return a};this.logVideoEvent=
function(a){g.ctatdebug("logVideoEvent ("+a+")");if(void 0!==h.duration)if(null!==CTATCommShell.commShell){a=new CTATSAI(g.getName(),a,g.toHHMMSS(h.currentTime)+".000","");a.addSelection(encodeURIComponent(h.currentSrc),"media_file");a.addSelection(g.toHHMMSS(h.duration)+".000","clip_length");var b=a.getInputObject();null!==b&&b.setType("time");CTATCommShell.commShell.processComponentAction(a,g.getTutorComponent,!0,g,"VIDEO_ACTION","USER")}else g.ctatdebug("Error: commShell is null, can't send untutored tool message");
else g.ctatdebug("Error: audio file not loaded yet, can't obtain duration")};this.PlayMedia=function(a){h.src=a};this.showControls=function(a){a=CTATGlobalFunctions.toBoolean(a);$(g.getDivWrap()).attr("data-ctat-controls",a);h.controls=a};this.setAutoplay=function(a){a=CTATGlobalFunctions.toBoolean(a);$(g.getDivWrap()).attr("data-ctat-autoplay",a);h.autoplay=a};this.setURL=function(a){$(this.getDivWrap()).attr("src",a);h.src=a};this.play=function(a){g.ctatdebug("play ()");var b="0";a&&(b="number"===
typeof a?String(a):"string"===typeof a?a:"0");h.currentTime=b;h.play()};this.pause=function(a){g.ctatdebug("pause ()");h.pause();var b="0";a&&(b="number"===typeof a?String(a):"string"===typeof a?a:"0");h.currentTime=b};this.stop=function(){g.ctatdebug("stop ()");g.pause()}};CTATVideo.prototype=Object.create(CTAT.Component.Base.Tutorable.prototype);CTATVideo.prototype.constructor=CTATVideo;CTAT.ComponentRegistry.addComponentType("CTATVideo",CTATVideo);var CTATAssistments={},assistmentsTimerVar,assistmentsJSONpreface='{ "version" : "AS.1", "action" : ';function iframeToParent(a){window.parent.postMessage(a,"https://test1.assistments.org")}function iframeLoaded(){iframeToParent(assistmentsJSONpreface+'"loaded" }');assistmentsTimerVar=window.setInterval("iframeHeartbeat()",1E4)}function iframeHeartbeat(){iframeToParent(assistmentsJSONpreface+'"heartbeat"}')}
function iframeCompleted(){var a=document.getElementById("MyScore").value;iframeToParent(assistmentsJSONpreface+'"completed", "answer" : "<b>Student worked hard on this problem.</b>","score" : '+a+" }");window.clearTimeout(assistmentsTimerVar)};var CTATEnabledInPreview={},ctatEnabledInPreview={CTATButton:!0,CTATComboBox:!0,CTATAudioButton:!0,CTATSubmitButton:!0,CTATTextArea:!0,CTATTextInput:!0,CTATTable:!0,CTATHintButton:!0,CTATDoneButton:!0};var CTATTutor={drawing:!1,onMobile:!1,tutorInitialized:!1,flashVars:null};Object.defineProperty(CTATTutor,"parser",{get:function(){this._parser||(CTATConfig.parserType_is_XML()?(ctatdebug("Creating XML parser ..."),this._parser=new CTATXML):CTATConfig.parserType_is_JSON()&&(this._parser=new CTATJSON));return this._parser}});
CTATTutor.initializeHTMLComponents=function(){for(var a in CTAT.ComponentRegistry){var b=CTAT.ComponentRegistry[a];$("."+a).each(function(){if(!$(this).data("CTATComponent")){var a=new b;$(this).attr("id")?a.setName($(this).attr("id")):(this.setAttribute("id",CTATGlobalFunctions.gensym.div_id()),a.setName(this.getAttribute("id")));a.setDivWrapper(this);a.processAttributes();a.init();a.processTabOrder();a.setEnabled(a.getEnabled());if(0==a.isFeedbackComponent()){var f=new CTATComponentDescription;
f.type=a.getClassName();f.name=a.getName();f.setComponentPointer(a);CTATShellTools.registerComponentDescription(f)}$(this).data("CTATComponent",a);if(CTATConfiguration.get("previewMode")){var f=a.getDivWrap().getAttribute("data-ctat-enabled"),d=ctatEnabledInPreview[a.getClassName()];d||(d=!1);a.setEnabled(d);a.getDivWrap().setAttribute("data-ctat-enabled",f)}}})}CTATShellTools.listComponents();ctatdebug("initializeHTMLComponents () done")};
CTATTutor.callComponentFunction=function(a,b,e){if((a=CTATShellTools.findComponent(a.id))&&0<a.length){a=a[0];var f=null;b&&(f=b(a,e));return f}};function assignNameTranslator(a){nameTranslator=a}CTATTutor.drawTutor=function(){if(!0!==this.drawing){this.drawing=!0;for(var a in CTATShellTools.component_descriptions){var b=CTATShellTools.component_descriptions[a].getComponentPointer();null!==b&&b.drawComponent()}this.drawing=!1}};
CTATTutor.initialize=function(){var a=navigator.userAgent.toLowerCase();0<a.search("iphone")?CTATTutor.onMobile=!0:0<a.search("ipod")?CTATTutor.onMobile=!0:0<a.search("android")&&(CTATTutor.onMobile=!0);a=getSafeElementById("pageor");null!==a&&!1===CTATTutor.onMobile&&(a.style.display="none");ctatdebug("initialize ()");this.initializeHTMLComponents();flashVars.getRawFlashVars();a=!0;CTATConfiguration.get("previewMode")&&(ctatdebug("In preview mode..."),a=!1);1==a?(CTATCommShell.commShell=new CTATCommShell,
CTATCommShell.commShell.init(CTATTutor)):CTATScrim.scrim.scrimDown()};
CTATTutor.createInterface=function(){ctatdebug("createInterface ("+Object.keys(CTATShellTools.component_descriptions).length+")");if(1==CTATGlobals.ignoreInterfaceDescriptions)ctatdebug("No need to process interface description messages, the interface should already be ready."),this.postProcess(),this.drawTutor();else{if(CTATGlobals.interfaceElement){ctatdebug("Re-creating interface ...");var a=CTATTutor.parser.getElementChildren(CTATGlobals.interfaceElement);CTATTutor.createStaticInterface(null,
a,null)}for(var b in CTATShellTools.component_descriptions){a=CTATShellTools.component_descriptions[b];if(!a){alert("Internal error parsing component at index "+b);return}if(!a.name){alert("Internal error parsing component at index "+b+" (no name attribute available)");return}if(-1==a.name.indexOf("null."))if(ctatdebug("Component: "+a.name+", type: "+a.type),"CTATCommShell"==a.type){if(CTATCommShell.commShell&&CTATCommShell.commShell.setName(a.name),"CTATCommShell"==a.type){ctatdebug("Tutor dimensions: "+
a.width+"x"+a.height);var e=getSafeElementById(ctatcontainer);null!==e?(ctatdebug("Setting canvas dimensions from: "+e.width+"px, "+e.height+"px, to: "+a.width+"px, "+a.height+"px"),e.width=a.width,e.height=a.height,e.style.width=a.width,e.style.height=a.height,ctatdebug("Canvas dimensions now: "+e.width+"px, "+e.height+"px")):ctatdebug("Error: tutor canvas is null, can't adjust size");e=getSafeElementById(ctatcontainer);null!==e?(e.style.width=a.width+"px",e.style.height=a.height+"px"):ctatdebug("Error: tutor container is null, can't adjust size")}}else CTAT.ComponentRegistry.hasOwnProperty(a.type)?
(ctatdebug("Creating ("+a.type+") :"+a.name),e=new CTAT.ComponentRegistry[a.type](a,a.x,a.y,a.width,a.height),e.setName(a.name),"CTATTextInput"!=a.type&&"CTATTextArea"!=a.type||e.setEnabled(!0),e.setTabIndex(a.tabIndex),a.setComponentPointer(e),e.initialize(),ctatdebug(e.getDivWrap())):ctatdebug("ERROR: Unrecognized component type "+a.type+" for "+a.name)}this.postProcess();this.drawTutor();ctatdebug("Tutor has been intialized from BRD, recalculating canvas position and size ...")}};
CTATTutor.postProcess=function(){ctatdebug("postProcess ()");for(var a in CTATShellTools.component_descriptions){var b=CTATShellTools.component_descriptions[a].getComponentPointer();null!==b?(b.getClassName(),b.postProcess&&b.postProcess()):ctatdebug("Error: component pointer "+a+" is null")}};
CTATTutor.createStaticInterface=function(a,b,e){ctatdebug("createStaticInterface ()");var f=getSafeElementById(ctatcontainer);null!==a&&(f=a);for(a=0;a<b.length;a++){var d=b[a];ctatdebug(this.parser.getElementName(d));if("timeline"==this.parser.getElementName(d)){ctatdebug("Timeline node found, obtaining visual elements ...");b=this.parser.getElementChildren(d);this.createStaticInterface(null,b,null);break}if("ctatcomponent"==this.parser.getElementName(d)){var c=this.parser.getElementAttr("instance");
e&&(ctatdebug("Registering existence of CTAT component on MovieClip container: "+c),e.addComponent(c))}var g,h,l,m;"shape"==this.parser.getElementName(d)&&(g=this.parser.getElementAttr(d,"x"),h=this.parser.getElementAttr(d,"y"),l=this.parser.getElementAttr(d,"width"),m=this.parser.getElementAttr(d,"height"),c=this.parser.getElementAttr(d,"instance"),ctatdebug("Creating shape: "+c+" at: "+g+","+h+","+l+","+m),l="data:image/png;base64, "+this.parser.getNodeTextValue(d),m=new Image,m.setAttribute("style",
"position: absolute; top: "+h+"px; left:"+g+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),m.setAttribute("id",c),m.setAttribute("src",l),f.appendChild(m));"statictext"==this.parser.getElementName(d)&&(g=this.parser.getElementAttr(d,"x"),h=this.parser.getElementAttr(d,"y"),l=this.parser.getElementAttr(d,"width"),m=this.parser.getElementAttr(d,"height"),c=this.parser.getElementAttr(d,"instance"),ctatdebug("Creating static text: "+c+" at: "+g+","+h+","+l+","+m),l="data:image/png;base64, "+
this.parser.getNodeTextValue(d),m=new Image,m.setAttribute("style","position: absolute; top: "+h+"px; left:"+g+"px; z-index:"+CTATGlobalFunctions.gensym.z_index()+";"),m.setAttribute("id",c),m.setAttribute("src",l),f.appendChild(m));"statictext"==this.parser.getElementName(d)&&(c=this.parser.getElementAttr("instance"),ctatdebug("Creating movieclip: "+c),g=this.parser.getElementAttr(d,"x"),h=this.parser.getElementAttr(d,"y"),l=this.parser.getElementAttr(d,"width"),m=this.parser.getElementAttr(d,"height"),
g=new CTATMovieClip(c,g,h,l,m),h=g.wrapComponent(f),ctatdebug("Created movieclip: "+c+" at: "+g.x+","+g.y+","+g.width+","+g.height),movieclips.push(g),d=this.parser.getElementChildren(d),this.createStaticInterface(h,d,g))}};
CTATTutor.runTutor=function(){ctatdebug("runTutor ()");!0===CTATGlobals.tutorRunning?ctatdebug("The tutor is already running"):(null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet),window.onerror=function(a,b,e){var f=new CTATHTMLManager;ctatdebug(f.htmlEncode(a)+" in "+b+", line "+e);ctatdebug(f.htmlEncode(a)+" in "+b+", line "+e)},centerTutorContainer(),CTATTutor.initialize(),CTATGlobals.tutorRunning=!0,ctatdebug("runTutor () ... all set"))};
CTATTutor.initTutor=function(a,b,e,f){ctatdebug("initTutor() #aFlashVars "+(a?a.length:null)+", usingFlash "+f);1==CTATTutor.tutorInitialized?(ctatdebug("Tutor already initialized, probably in author mode"),a.previewMode&&(CTATScrim.scrim.scrimDown(),ctatdebug("In preview mode..."))):(CTATConfiguration.generateDefaultConfigurationObject(),CTATConfiguration.setParams(a),"true"==CTATConfiguration.get("show_debug_traces")&&(useDebuggingBasic=!0),null==f&&(f=CTATConfiguration.usingFlash()),f&&CTATScrim.scrim.scrimDown(),
CTATCommLibrary.setAuthenticityToken(CTATConfiguration.get("authenticity_token")),b&&(ctatcontainer=b),(a=document.getElementById(ctatcontainer))&&a.classList.add("CTATTutorContainer"),a=getSafeElementById("debugtraces"),null!==a&&(useDebugging=!0===a.checked?!0:!1),ctatdebug("initTutor() CTATConfiguration.get('mode')="+CTATConfiguration.get("mode")+", window.sendToTutor="+window.sendToTutor),CTATConfiguration.get("swf_name")&&!window.sendToTutor&&(window.sendToTutor=function(a){ctatdebug("window.sendToTutor("+
a+") CTAT.ToolTutor.tutor "+CTAT.ToolTutor.tutor);return CTAT.ToolTutor.tutor?CTAT.ToolTutor.tutor.receiveFromInterface(a):CTAT.ToolTutor.tutorMessages.push(a)},window.registerInterface=function(a){CTAT.ToolTutor.registerInterfaceMessageHandler(a)}),"javascript"==String(CTATConfiguration.get("tutoring_service_communication")).toLowerCase()&&("undefined"!=typeof CTATExampleTracer&&CTATExampleTracer?CTAT.ToolTutor.registerTutor(new CTATExampleTracer):CTATScrim.scrim.warningScrimUp('Tutoring service communication parameter is "JavaScript" but class\nCTATExampleTracer is missing. Use a different ctat-*.js script.')),
ctatdebug("initTutor ()"),"applet"==CTATConfiguration.get("tutoring_service_communication")&&deployJava.runApplet({id:"TSApplet",width:150,height:10},{jnlp_href:"/ctat_applet/TSApplet.jnlp"},"1.6"),f||CTATTutor.runTutor(),CTATTutor.tutorInitialized=!0)};window.hasOwnProperty("initTutor")||(window.initTutor=CTATTutor.initTutor);function receiveFromTutor(){ctatdebug("receiveFromTutor ()")}function saveAndQuit(){ctatdebug("saveAndQuit ()")}function prepTutorArea(){initTutor()}window.prepTutorArea=prepTutorArea;
function assignAnonymousGradingProcessor(a){CTATCommShell.commShell.assignAnonymousGradingProcessor(a)}function gradeAnonymousComponent(a,b,e){ctatdebug("gradeAnonymousComponent ()");a=new CTATSAI(a,b,e);CTATCommShell.commShell.processComponentAction(a)}
function testTutor(a){ctatdebug("testTutor ()");window.onerror=function(a,e,f){var b=new CTATHTMLManager;ctatdebug(b.htmlEncode(a)+" in "+e+", line "+f)};null==CTATSkillSet.skills&&(CTATSkillSet.skills=new CTATSkillSet);(new CTATCommLibrary).send("http://augustus.pslc.cs.cmu.edu/crossdomain.xml")}
function centerTutorContainer(){ctatdebug("centerTutorContainer ()");var a=getSafeElementById(ctatcontainer);if(null==a)ctatdebug("Tutor container not found, bump");else{var b;if(flashVars){b=flashVars.getRawFlashVars();var e,f;e=a.offsetWidth;f=a.offsetHeight;b&&b.width&&b.height&&(ctatdebug("We have raw width and height variables in our flashvars: "+b.width+","+b.height),e=b.width,f=b.height);b.centerTutor?1==b.centerTutor&&(ctatdebug("Moving tutor over by: "+("-"+Number(e/2)+"px 0 0 -"+Number(f/
2)+"px;")),a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.right="0",a.style.bottom="0",a.style.margin="auto"):ctatdebug("The tutor is not configured to center the container, bump")}else ctatdebug("No flashvars yet, bump")}}
function checkTutorCanvas(){ctatdebug("checkTutorCanvas ()");var a=getSafeElementById(ctatcontainer),b=getSafeElementById("main-canvas"),e=flashVars.getRawFlashVars(),f="550",d="450";a&&(ctatdebug("Recording the actual CSS width and height: "+a.offsetWidth+" , "+a.offsetHeight),f=a.offsetWidth,d=a.offsetHeight);e&&e.width&&e.height&&(ctatdebug("We have tutor size flashvars, using those instead: "+e.width+" , "+e.height),f=e.width,d=e.height);null===b?(ctatdebug("No canvas available, creating ..."),
b=document.createElement("canvas"),b.id="main-canvas",b.innerHTML="Your browser does not support CTAT. Please update or use another browser.",ctatdebug("Setting canvas to: 0,0,"+f+" , "+d),getSafeElementById(ctatcontainer).appendChild(b)):(ctatdebug("Setting canvas to: 0 , 0, "+f+" , "+d),b.style.top="0",b.style.left="0");b.style.width=f+"px";b.style.height=d+"px";return b};(function(a){function b(){var a=arguments[0],c=b.cache;c[a]&&c.hasOwnProperty(a)||(c[a]=b.parse(a));return b.format.call(null,c[a],arguments)}function e(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}var f=/[^s]/,d=/[def]/,c=/^[^\x25]+/,g=/^\x25{2}/,h=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/,l=/^([a-z_][a-z_\d]*)/i,m=/^\.([a-z_][a-z_\d]*)/i,r=/^\[(\d+)\]/,p=/^[\+\-]/;b.format=function(a,c){var g=1,h=a.length,l,m=[],q,r,u,x,E=!0,
t="";for(q=0;q<h;q++)if(l=e(a[q]),"string"===l)m[m.length]=a[q];else if("array"===l){u=a[q];if(u[2])for(l=c[g],r=0;r<u[2].length;r++){if(!l.hasOwnProperty(u[2][r]))throw Error(b("[sprintf] property '%s' does not exist",u[2][r]));l=l[u[2][r]]}else l=u[1]?c[u[1]]:c[g++];"function"==e(l)&&(l=l());if(f.test(u[8])&&"number"!=e(l)&&isNaN(l))throw new TypeError(b("[sprintf] expecting number but found %s",e(l)));d.test(u[8])&&(E=0<=l);switch(u[8]){case "b":l=l.toString(2);break;case "c":l=String.fromCharCode(l);
break;case "d":l=parseInt(l,10);break;case "e":l=u[7]?l.toExponential(u[7]):l.toExponential();break;case "f":l=u[7]?parseFloat(l).toFixed(u[7]):parseFloat(l);break;case "o":l=l.toString(8);break;case "s":l=(l=String(l))&&u[7]?l.substring(0,u[7]):l;break;case "u":l>>>=0;break;case "x":l=l.toString(16);break;case "X":l=l.toString(16).toUpperCase()}if(!E||d.test(u[8])&&u[3])t=E?"+":"-",l=l.toString().replace(p,"");r=u[4]?"0"==u[4]?"0":u[4].charAt(1):" ";x=u[6]-(t+l).length;x=u[6]?Array(x+1).join(r):
"";m[m.length]=u[5]?t+l+x:0==r?t+x+l:x+t+l}return m.join("")};b.cache={};b.parse=function(a){for(var b,d=[],e=0;a;){if(null!==(b=c.exec(a)))d[d.length]=b[0];else if(null!==(b=g.exec(a)))d[d.length]="%";else if(null!==(b=h.exec(a))){if(b[2]){var e=e|1,f=[],q=b[2],p;if(null!==(p=l.exec(q)))for(f[f.length]=p[1];""!==(q=q.substring(p[0].length));)if(null!==(p=m.exec(q)))f[f.length]=p[1];else if(null!==(p=r.exec(q)))f[f.length]=p[1];else throw new SyntaxError("[sprintf] failed to parse named argument key");
else throw new SyntaxError("[sprintf] failed to parse named argument key");b[2]=f}else e|=2;if(3===e)throw Error("[sprintf] mixing positional and named placeholders is not (yet) supported");d[d.length]=b}else throw new SyntaxError("[sprintf] unexpected placeholder");a=a.substring(b[0].length)}return d};var x=function(a,c,d){d=(c||[]).slice(0);d.splice(0,0,a);return b.apply(null,d)};"undefined"!==typeof exports?(exports.sprintf=b,exports.vsprintf=x):(a.sprintf=b,a.vsprintf=x,"function"===typeof define&&
define.amd&&define(function(){return{sprintf:b,vsprintf:x}}))})("undefined"===typeof window?this:window);var CTATHintPolicyEnum=function(){};Object.defineProperty(CTATHintPolicyEnum,"HINTS_UNBIASED",{enumerable:!0,configurable:!1,writable:!1,value:"Always Follow Best Path"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_CURRENT_SELECTION_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Current Selection Only"});Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_PRIOR_ERROR_ONLY",{enumerable:!0,configurable:!1,writable:!1,value:"Bias Hints by Prior Error Only"});
Object.defineProperty(CTATHintPolicyEnum,"HINTS_BIASED_BY_ALL",{enumerable:!0,configurable:!1,writable:!1,value:"Use Both Kinds of Bias"});Object.defineProperty(CTATHintPolicyEnum,"DEFAULT",{enumerable:!0,configurable:!1,writable:!1,value:CTATHintPolicyEnum.HINTS_BIASED_BY_ALL});CTATHintPolicyEnum.prototype=Object.create(Object.prototype);CTATHintPolicyEnum.prototype.constructor=CTATHintPolicyEnum;
CTATHintPolicyEnum.lookup=function(a){for(policy in CTATHintPolicyEnum)if(CTATHintPolicyEnum[policy]==a)return CTATHintPolicyEnum[policy];return CTATHintPolicyEnum.DEFAULT};"undefined"!==typeof module&&(module.exports=CTATHintPolicyEnum);var CTATMsgType=function(){CTATBase.call(this,"CTATMsgType","")};CTATMsgType.findProperty=function(a,b){var e=a.toLowerCase(),f="<"+b.toLowerCase()+">",d=e.indexOf(f)+f.length,e=e.indexOf("</"+b.toLowerCase()+">");if(d<f.length||0>e)return null;f={};f.start=d;f.end=e;return f};
CTATMsgType.makeValues=function(a){if(null==a)return"";if("string"==typeof a)return a;if(a.constructor&&"Array"==a.constructor.name){if(!a.length)return"";for(var b=0,e,f="<value>"+(null==(e=a[b++])?"":e.toString());b<a.length;)f+="</value><value>"+(null==(e=a[b++])?"":e.toString());return f+"</value>"}return a.outerHTML?a.outerHTML:a.toString()};
CTATMsgType.setProperty=function(a,b,e){var f=CTATMsgType.findProperty(a,b),d;f?(d=a.slice(0,f.start),d+=CTATMsgType.makeValues(e),d+=a.slice(f.end,a.length)):(f=a.indexOf("</properties>"),d=a.slice(0,f),d+="<"+b+">"+CTATMsgType.makeValues(e)+"</"+b+">",d+=a.slice(f,a.length));return d};CTATMsgType.getProperty=function(a,b){var e=CTATMsgType.findProperty(a,b);return e?a.slice(e.start,e.end):""};
CTATMsgType.valueToArray=function(a){if(!a.startsWith("<value>"))return null;var b=a.substring(7);if(!a.endsWith("</value>"))return null;b=b.substring(0,b.length-8);b=b.split("</value><value>");ctatdebug("valueToArray("+a+") returns "+b);return b};CTATMsgType.getValue=function(a,b){var e=CTATMsgType.valueToArray(a);return!e||e.length<=b?null:e[b]};CTATMsgType.getMessageType=function(a){return CTATMsgType.getProperty(a,"MessageType")};
CTATMsgType.getTransactionID=function(a){return CTATMsgType.getProperty(a,CTATMessage.TRANSACTION_ID_TAG)};CTATMsgType.setTransactionID=function(a,b){return CTATMsgType.setProperty(a,CTATMessage.TRANSACTION_ID_TAG,b)};CTATMsgType.isCorrectOrIncorrect=function(a){return"string"==typeof a?CTATMsgType.CorrectTypes[a.toLowerCase()]?!0:!1:!1};CTATMsgType.hasTextFeedback=function(a){return"string"==typeof a?CTATMsgType.TextFeedbackTypes[a.toLowerCase()]?!0:!1:!1};
CTATMsgType.isHintResponse=function(a){return"string"==typeof a?CTATMsgType.HintResponseTypes[a.toLowerCase()]?!0:!1:!1};CTATMsgType.isDoneMessage=function(a){var b=CTATMsgType.getProperty(a,"Selection");a=CTATMsgType.getProperty(a,"Action");if(!b||!a)return!1;b=b.toString().toLowerCase();a=a.toString().toLowerCase();var e=CTATMsgType.DONE.toLowerCase();if(e!=b&&e!=CTATMsgType.getValue(b,0))return!1;b=CTATMsgType.BUTTON_PRESSED.toLowerCase();return b!=a&&b!=CTATMsgType.getValue(a,0)?!1:!0};
CTATMsgType.getSAIArraysFromElement=function(a,b){for(var e={selection:[],action:[],input:[]},f=b.getElementChildren(a),d=0;d<f.length;d++){var c=f[d];switch(b.getElementName(c)){case "Selection":for(var c=b.getElementChildren(c),g=0;g<c.length;g++)e.selection.push(b.getNodeTextValue(c[g]));break;case "Action":c=b.getElementChildren(c);for(g=0;g<c.length;g++)e.action.push(b.getNodeTextValue(c[g]));break;case "Input":c=b.getElementChildren(c);for(g=0;g<c.length;g++)e.input.push(b.getNodeTextValue(c[g]));
break;case "properties":return CTATMsgType.getSAIArraysFromElement(c,b)}}return e};Object.defineProperty(CTATMsgType,"CorrectTypes",{enumerable:!1,configurable:!1,writable:!1,value:{correctaction:1,incorrectaction:1,lispcheckaction:1}});Object.defineProperty(CTATMsgType,"TextFeedbackTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,successmessage:1,buggymessage:1,wrongusermessage:1,nohintmessage:1,highlightmsg:1,showhintsmessagefromlisp:1}});
Object.defineProperty(CTATMsgType,"HintResponseTypes",{enumerable:!1,configurable:!1,writable:!1,value:{showhintsmessage:1,nohintmessage:1,showhintsmessagefromlisp:1}});Object.defineProperty(CTATMsgType,"BUGGY_MSG",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMsg"});Object.defineProperty(CTATMsgType,"DONE",{enumerable:!1,configurable:!1,writable:!1,value:"Done"});Object.defineProperty(CTATMsgType,"BUTTON_PRESSED",{enumerable:!1,configurable:!1,writable:!1,value:"ButtonPressed"});
Object.defineProperty(CTATMsgType,"DEFAULT_STUDENT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Student"});Object.defineProperty(CTATMsgType,"DEFAULT_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor"});Object.defineProperty(CTATMsgType,"UNGRADED_TOOL_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Tutor (unevaluated)"});Object.defineProperty(CTATMsgType,"DEFAULT_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:CTATMsgType.DEFAULT_STUDENT_ACTOR});
Object.defineProperty(CTATMsgType,"ANY_ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Any"});Object.defineProperty(CTATMsgType,"SHOW_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Show All Feedback"});Object.defineProperty(CTATMsgType,"DELAY_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Delay Feedback"});Object.defineProperty(CTATMsgType,"HIDE_ALL_FEEDBACK",{enumerable:!1,configurable:!1,writable:!1,value:"Hide All Feedback"});
Object.defineProperty(CTATMsgType,"HIDE_BUT_COMPLETE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but require all steps"});Object.defineProperty(CTATMsgType,"HIDE_BUT_ENFORCE",{enumerable:!1,configurable:!1,writable:!1,value:"Hide feedback but enforce constraints"});Object.defineProperty(CTATMsgType,"DEFAULT_OUT_OF_ORDER_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("HIGHLIGHTEDSTEP")});
Object.defineProperty(CTATMsgType,"NOT_DONE_MSG",{enumerable:!1,configurable:!1,writable:!1,value:CTATLanguageManager.theSingleton.filterString("NOTDONE")});Object.defineProperty(CTATMsgType,"PREVIOUS_FOCUS",{enumerable:!1,configurable:!1,writable:!1,value:"PreviousFocus"});Object.defineProperty(CTATMsgType,"ASSOCIATED_RULES",{enumerable:!1,configurable:!1,writable:!1,value:"AssociatedRules"});Object.defineProperty(CTATMsgType,"BEGIN_RESTORE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginRestore"});
Object.defineProperty(CTATMsgType,"BEGIN_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"BeginGoToState"});Object.defineProperty(CTATMsgType,"END_GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"EndGoToState"});Object.defineProperty(CTATMsgType,"BUGGY_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"BuggyMessage"});Object.defineProperty(CTATMsgType,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"CorrectAction"});
Object.defineProperty(CTATMsgType,"HINT_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"HintRequest"});Object.defineProperty(CTATMsgType,"INCORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InCorrectAction"});Object.defineProperty(CTATMsgType,"INTERFACE_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceAction"});Object.defineProperty(CTATMsgType,"INTERFACE_IDENTIFICATION",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceIdentification"});
Object.defineProperty(CTATMsgType,"PROBLEM_RESTORE_END",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemRestoreEnd"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_REQUEST",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryRequest"});Object.defineProperty(CTATMsgType,"PROBLEM_SUMMARY_RESPONSE",{enumerable:!1,configurable:!1,writable:!1,value:"ProblemSummaryResponse"});Object.defineProperty(CTATMsgType,"SET_PREFERENCES",{enumerable:!1,configurable:!1,writable:!1,value:"SetPreferences"});
Object.defineProperty(CTATMsgType,"SHOW_HINTS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"ShowHintsMessage"});Object.defineProperty(CTATMsgType,"SUCCESS_MESSAGE",{enumerable:!1,configurable:!1,writable:!1,value:"SuccessMessage"});Object.defineProperty(CTATMsgType,"START_STATE_END",{enumerable:!1,configurable:!1,writable:!1,value:"StartStateEnd"});Object.defineProperty(CTATMsgType,"STATE_GRAPH",{enumerable:!1,configurable:!1,writable:!1,value:"StateGraph"});
Object.defineProperty(CTATMsgType,"UNTUTORED_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"UntutoredAction"});Object.defineProperty(CTATMsgType,"GO_TO_STATE",{enumerable:!1,configurable:!1,writable:!1,value:"GoToState"});Object.defineProperty(CTATMsgType,"INTERFACE_REBOOT",{enumerable:!1,configurable:!1,writable:!1,value:"InterfaceReboot"});Object.defineProperty(CTATMsgType,"CompletionValue",{enumerable:!1,configurable:!1,writable:!1,value:["incomplete","complete"]});
CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=CTATMsgType;"undefined"!==typeof module&&(module.exports=CTATMsgType);var CTATVersionComparator=function(){CTATBase.call(this,"CTATVersionComparator","");this.compare=function(a,b){if(null===a||"undefined"===typeof a)return null===b||"undefined"===typeof b?0:-1;if(null===b||"undefined"===typeof b)return 1;var e=0,f=a.split("."),d=b.split("."),c;for(c=0;c<Math.min(f.length,d.length);c++)try{var g=parseInt(f[c]),h=parseInt(d[c]),e=g<h?-1:g>h?1:0;if(0!==e)return e}catch(l){if(e=f[c].toString()<d[c].toString()?-1:f[c].toString()>d[c].toString()?1:0,0!==e)return e}return c<
f.length?1:c<d.length?-1:a.toString()<b.toString()?-1:a.toString()>b.toString()?1:0}};CTATVersionComparator.prototype=Object.create(CTATBase.prototype);CTATVersionComparator.prototype.constructor=CTATVersionComparator;CTATVersionComparator.vc=new CTATVersionComparator;"undefined"!==typeof module&&(module.exports=CTATVersionComparator);var CTATExampleTracerSkill=function(a,b,e,f,d,c,g){CTATBase.call(this,"CTATExampleTracerSkill",b);var h=null==a||""==a.trim()?b:b+" "+a,l=Number(e);Number.isNaN(l)&&(l=CTATExampleTracerSkill.DEFAULT_P_GUESS);var m=Number(f);Number.isNaN(m)&&(m=CTATExampleTracerSkill.DEFAULT_P_KNOWN);var r=Number(c);Number.isNaN(r)&&(r=CTATExampleTracerSkill.DEFAULT_P_LEARN);var p=Number(d);Number.isNaN(p)&&(p=CTATExampleTracerSkill.DEFAULT_P_SLIP);var x=/^0*[xX]([0-9a-fA-F]+)$/.test(g)?parseInt(g,16):/^(\-|\+)?[0-9]+$/.test(g)?
parseInt(g,10):CTATExampleTracerSkill.DEFAULT_HISTORY,q=0,u=0,n=CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11,B=CTATExampleTracerSkill.DEFAULT_MASTERY_THRESHOLD,v=null,z=null,A=this;this.getSkillName=function(){return h};this.getCategory=function(){var a=h.indexOf(" ");return 0>a?"":h.substring(a+1)};this.setTransactionNumber=function(a){q=a};this.updatePKnown=function(a){return m=CTATExampleTracerSkill.updatePKnownStatic(a,l,m,p,r)};this.updateHistory=function(a){return x=CTATExampleTracerSkill.updateHistoryStatic(a,
x)};this.changeOpportunityCount=function(a){return u+=a};this.getTransactionNumber=function(){return q};this.getSkillBarString=function(a){var b=this.getSkillName(),b=b+this.getSkillBarDelimiter()+m,b=b+this.getSkillBarDelimiter()+(this.hasReachedMastery()?"1":"0");!0===a&&(b=b+this.getSkillBarDelimiter()+this.getLabel());return b.toString()};this.getSkillBarDelimiter=function(){return n};this.toXML=function(a){var b;b=""+(' name="'+CTATExampleTracerSkill.getName(h)+'"');b+=' category="'+A.getCategory()+
'"';b+=' label="'+A.getLabel()+'"';b+=' description="'+A.getDescription()+'"';b+=' pKnown="'+Number(m).toFixed(2)+'"';b+=' pLearn="'+Number(r).toFixed(2)+'"';b+=' pGuess="'+Number(l).toFixed(2)+'"';b+=' pSlip="'+Number(p).toFixed(2)+'"';b+=' history="'+x+'"';b+=' opportunityCount="'+u+'"';return a?"&lt;Skill"+b+" /&gt;":"<Skill"+b+" />"};this.hasReachedMastery=function(){return null===m||"undefined"===typeof m?!1:m>=B};this.getLabel=function(){return!v||1>v.length?CTATExampleTracerSkill.getName(h):
v};this.getDescription=function(){return!z||1>z.length?h:z};this.setVersion=function(a){null!==a&&"undefined"!==typeof a&&0<a.length&&(n=CTATExampleTracerSkill.versionToSkillBarDelimiter(a))};this.setLabel=function(a){v=a};this.setDescription=function(a){z=a};CTATExampleTracerSkill.makeStepID=function(a,b){for(var c="",d=0,e=a;2>d++;e=b)if(!(null===e||"undefined"===typeof e||1>e.length)){for(var g=!1,f=0;f<e.length;f++)if(null!==e[f]&&"undefined"!==typeof e[f]){var h=e[f].toString();1>h.length||e===
a&&("hint".toString().toUpperCase()===h.toString().toUpperCase()||"help".toString().toUpperCase()===h.toString().toUpperCase())||e===b&&CTATMsgType.PREVIOUS_FOCUS.toString().toUpperCase()===h.toString().toUpperCase()||(c=c+(g?",":"[")+h,g=!0)}!0===g&&(c+="]")}return c.toString()};CTATExampleTracerSkill.updateHistoryStatic=function(a,b){var c,d=1<<CTATExampleTracerSkill.MAX_INTEGER_SHIFT;c=b<<1|(a.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase()?1:0);return c&d?c^
d:c};CTATExampleTracerSkill.updatePKnownStatic=function(a,b,c,d,e){var g=0;if(a.toString().toUpperCase()===CTATExampleTracerSkill.CORRECT.toString().toUpperCase())b=+(b*(1-c)).toFixed(2),c=+(c*(1-d)).toFixed(2),g=+(c/(c+b)).toFixed(2);else if(a.toString().toUpperCase()===CTATExampleTracerSkill.INCORRECT.toString().toUpperCase()||a.toString().toUpperCase()===CTATExampleTracerSkill.HINT.toString().toUpperCase())d=+(c*d).toFixed(2),c=+((1-c)*(1-b)).toFixed(2),g=+(d/(d+c)).toFixed(2);return+(g+e*(1-g)).toFixed(2)};
CTATExampleTracerSkill.getName=function(a){var b=a.indexOf(" ");return 0>b?a:a.substring(0,b)};CTATExampleTracerSkill.versionToSkillBarDelimiter=function(a){return null===a||"undefined"===typeof a?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10:0<=CTATVersionComparator.vc.compare(a,"2.11")?CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_11:CTATExampleTracerSkill.SKILL_BAR_DELIMITER_v2_10}};Object.defineProperty(CTATExampleTracerSkill,"MAX_INTEGER_SHIFT",{enumerable:!1,configurable:!1,writable:!1,value:31});
Object.defineProperty(CTATExampleTracerSkill,"HINT",{enumerable:!1,configurable:!1,writable:!1,value:"hint"});Object.defineProperty(CTATExampleTracerSkill,"CORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"correct"});Object.defineProperty(CTATExampleTracerSkill,"INCORRECT",{enumerable:!1,configurable:!1,writable:!1,value:"incorrect"});Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_10",{enumerable:!1,configurable:!1,writable:!1,value:"="});
Object.defineProperty(CTATExampleTracerSkill,"SKILL_BAR_DELIMITER_v2_11",{enumerable:!1,configurable:!1,writable:!1,value:"`"});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_MASTERY_THRESHOLD",{enumerable:!1,configurable:!1,writable:!1,value:.95});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_GUESS",{enumerable:!1,configurable:!1,writable:!1,value:.2});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_KNOWN",{enumerable:!1,configurable:!1,writable:!1,value:.3});
Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_SLIP",{enumerable:!1,configurable:!1,writable:!1,value:.3});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_P_LEARN",{enumerable:!1,configurable:!1,writable:!1,value:.15});Object.defineProperty(CTATExampleTracerSkill,"DEFAULT_HISTORY",{enumerable:!1,configurable:!1,writable:!1,value:0});CTATExampleTracerSkill.prototype=Object.create(CTATBase.prototype);CTATExampleTracerSkill.prototype.constructor=CTATExampleTracerSkill;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerSkill);var CTATVariableTableCount=0,CTATVariableTable=function(){function a(b){var d={},c;for(c in b)!0===b.hasOwnProperty(c)&&(d[c]="object"!==typeof b[c]?b[c]:a(b[c]));return d}CTATBase.call(this,"CTATVariableTable","");CTATVariableTableCount++;var b={},e=this;this.toString=function(){var a="",d;for(d in b)0<a.length&&(a+=", "),a=a+d+"="+b[d];return"{ "+a+" }"};this.clone=function(){ctatdebug("CTATVariableTable --\x3e in clone; this "+this+", this.getTable() "+this.getTable);var e=new CTATVariableTable;
ctatdebug("CTATVariableTable --\x3e in clone; copy "+e+", copy.setTable() "+e.setTable);e.setTable(a(b));ctatdebug("CTATVariableTable --\x3e out of clone");return e};this.put=function(a,d){e.ctatdebug("CTATVariableTable.put("+a+", "+d+") typeof value "+typeof d);var c;if(a)if(0>a.indexOf("."))b[a]=d;else{var g=a.split(".");if("object"!==typeof b[g[0]]||null===b[g[0]])b[g[0]]={};c=b[g[0]];for(var f=1;f<g.length-1;f++)if("object"!==typeof c[g[f]]||null===c[g[f]])c[g[f]]={},c=c[g[f]];c[g[f]]=d}else console.log("CTATVariableTable.put() warning: null or empty variable name '"+
a+"'");return e};this.getTable=function(){return b};this.setTable=function(a){b=a};this.get=function(a){if(0>a.indexOf("."))return null===b[a]||"undefined"===typeof b[a]?null:b[a];var d=a.split(".");if(null===b[d[0]]||"undefined"===typeof b[d[0]])return null;a=b[d[0]];for(var c=1;c<d.length-1;c++){if(null===a[d[c]]||"undefined"===typeof a[d[c]])return null;a=a[d[c]]}return null===a[d[c]]||"undefined"===typeof a[d[c]]?null:a[d[c]]}};
Object.defineProperty(CTATVariableTable,"serialVersionUID",{enumerable:!1,configurable:!1,writable:!1,value:"201403071830L"});CTATVariableTable.standardizeType=function(a){if("string"!=typeof a||1>a.trim().length)return a;if((!0).toString()==a)return!0;if((!1).toString()==a)return!1;if("null"==a)return null;var b=Number(a);return isNaN(b)?a:b};CTATVariableTable.valueAsString=function(a){return"string"==typeof a?a:String(a)};CTATVariableTable.nameAsString=function(a){return a?a+"_String":null};
CTATVariableTable.prototype=Object.create(CTATBase.prototype);CTATVariableTable.prototype.constructor=CTATVariableTable;"undefined"!==typeof module&&(module.exports=CTATVariableTable);var CTATMatcher=function(a,b,e){CTATBase.call(this,"CTATMatcher","");this.lastResult=null;var f=new CTATSAI("","",""),d=e,c=CTATMsgType.DEFAULT_ACTOR,g=!1,h=this;this.resetMatcher=function(){};this.getSelection=function(){return h.getDefaultSelection()};this.getAction=function(){return h.getDefaultAction()};this.getInput=function(){return h.getDefaultInput()};this.getActor=function(){return c};this.setCaseInsensitive=function(a){d=a};this.getEvaluatedInput=function(a,b){return h.getInput()};this.getTraversalIncrement=
function(){return 1};this.getTutorSAI=function(a,b,c){a=String(c).toLowerCase()==CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()?a:h.getDefaultSAI();console.log("CTATMatcher.getTutorSAI() superclass method called, should be subclass;\n  returning: "+a);return a};this.getDefaultSelection=function(){return h.getDefaultSAI().getSelection()};this.getDefaultAction=function(){return h.getDefaultSAI().getAction()};this.getDefaultInput=function(){return h.getDefaultSAI().getInput()};this.getDefaultSAI=
function(){return f};this.setDefaultSAI=function(a){f=a};this.getDefaultActor=function(){switch(String(getActor()).toLowerCase()){case CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_STUDENT_ACTOR;case CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;case CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;case CTATMsgType.ANY_ACTOR.toLowerCase():return CTATMsgType.DEFAULT_TOOL_ACTOR;default:return console.log("CTATMatcher.getDefaultActor() unexpected value for actor: "+
c+"; returning "+CTATMsgType.DEFAULT_ACTOR),CTATMsgType.DEFAULT_ACTOR}};this.getInput=function(){return h.getDefaultInput()};this.getCaseInsensitive=function(){return d};this.match=function(a,b,c,d,e){console.log("CTATMatcher superclass method called: match("+a+", "+b+", "+c+", "+d+")");return!1};this.matchForHint=function(a,b,c,d){console.log("CTATMatcher superclass method called: matchForHint("+a+", "+b+", "+c+", vt)");return!1};this.matchActor=function(a){a=String(a).toUpperCase();var b=String(h.getActor()).toUpperCase();
ctatdebug("CTATMatcher.matchActor("+a+") myActor is "+b);return CTATMsgType.ANY_ACTOR.toString().toUpperCase()==b||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==b&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==a||CTATMsgType.UNGRADED_TOOL_ACTOR.toString().toUpperCase()==a&&CTATMsgType.DEFAULT_TOOL_ACTOR.toString().toUpperCase()==b?!0:b==a};this.getDefaultSelectionArray=function(){return h.getDefaultSAI().getSelectionArray()};this.getDefaultActionArray=function(){return h.getDefaultSAI().getActionArray()};
this.getDefaultInputArray=function(){return h.getDefaultSAI().getInputArray()};this.getLastResult=function(){return null===h.lastResult||"undefined"===typeof h.lastResult?"":h.lastResult.toString()};this.setActor=function(a){ctatdebug("CTATMatcher --\x3e in setActor("+a+")");if(null===a||"undefined"===typeof a)a=CTATMsgType.DEFAULT_ACTOR;a=String(a).toLowerCase().trim();c="tool"==a?CTATMsgType.DEFAULT_TOOL_ACTOR:a==CTATMsgType.DEFAULT_STUDENT_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_STUDENT_ACTOR:
a==CTATMsgType.DEFAULT_TOOL_ACTOR.toLowerCase()?CTATMsgType.DEFAULT_TOOL_ACTOR:a==CTATMsgType.UNGRADED_TOOL_ACTOR.toLowerCase()?CTATMsgType.UNGRADED_TOOL_ACTOR:a==CTATMsgType.ANY_ACTOR.toLowerCase()?CTATMsgType.ANY_ACTOR:CTATMsgType.DEFAULT_ACTOR};this.array2ConcatString=function(a){var b="";if(null==a)return b;if(!Array.isArray(a))return a.toString();a.forEach(function(a){null!=a&&(b+=a.toString()+"\n")});return b.substring(0,0<b.length?b.length-1:0)};this.matchConcatenation=function(a){return h.matchSingle(h.array2ConcatString(a))};
this.isLinkTriggered=function(){return g};this.setLinkTriggered=function(a){g=a};this.evaluateReplacement=function(a,b,c){return""};this.replaceInput=function(){return!!h.getReplacementFormula()};this.getReplacementFormula=function(){return""}};CTATMatcher.prototype.toString=function(){console.log("Error: CTATMatcher.toString() called; should be overridden in subclass");return"This is CTATMatcher."};CTATMatcher.prototype.setParameter=function(a,b,e){};
CTATMatcher.isTutorActor=function(a,b){return CTATMsgType.DEFAULT_TOOL_ACTOR.toUpperCase()===a.toUpperCase()||CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()===a.toUpperCase()||b&&CTATMsgType.ANY_ACTOR.toUpperCase()===a.toUpperCase()?!0:!1};Object.defineProperty(CTATMatcher,"NON_SINGLE",{enumerable:!1,configurable:!1,writable:!1,value:-1});Object.defineProperty(CTATMatcher,"SELECTION",{enumerable:!1,configurable:!1,writable:!1,value:0});
Object.defineProperty(CTATMatcher,"ACTION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATMatcher,"INPUT",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATMatcher,"VECTOR",{enumerable:!1,configurable:!1,writable:!1,value:3});Object.defineProperty(CTATMatcher,"ACTOR",{enumerable:!1,configurable:!1,writable:!1,value:"Actor"});CTATMatcher.prototype=Object.create(CTATBase.prototype);CTATMatcher.prototype.constructor=CTATMatcher;
"undefined"!==typeof module&&(module.exports=CTATMatcher);var CTATTreeNode={};
(function(){var a;a=function(){function a(){}a.operators=[["CONST"],["VAR"],["EXP","SQRT"],["UPLUS","UMINUS"],["ITIMES","TIMES","DIVIDE"],["IDIVIDE","REM"],["PLUS","MINUS"],"LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ")];a.relationalOperators="LESS LESSEQUAL EQUAL NOTEQUAL GREATEREQUAL GREATER".split(" ");a.operatorPrecedence=function(a,b){return Math.sign(this.operators.findIndex(function(b){return b.includes(a)})-this.operators.findIndex(function(a){return a.includes(b)}))};a.operatorStrings=
{EXP:"^",SQRT:"|",UPLUS:"+",UMINUS:"-",ITIMES:"",TIMES:"*",DIVIDE:"/",IDIVIDE:"//",REM:"%",PLUS:"+",MINUS:"-",LESS:"<",LESSEQUAL:"<=",EQUAL:"=",NOTEQUAL:"!=",GREATEREQUAL:">=",GREATER:">"};a.toOperatorString=function(a){return this.operatorStrings[a]||""};a.diff=function(a,b){return a.filter(function(a){return!b.includes(a)})};a.prototype.addParens=function(){this.parens++;return this};a.prototype.toString=function(a){var b,d;this.negated()&&this.setParens("MINUS");this.inverted()&&this.setParens("DIVIDE");
this.inverted()&&(a="1/"+a);this.negated()&&(a="-"+a);b=0;for(d=this.parens;0<=d?b<d:b>d;0<=d?++b:--b)a="("+a+")";return a};a.prototype.setParens=function(b,f){var d;null==f&&(f=!1);d=this.negated()?"UMINUS":this.inverted()?"DIVIDE":this.operator;d=a.operatorPrecedence(b,d);if(0>d||0===d&&f)this.parens=1;return this};a.prototype.evaluate=function(a){return this.sign*Math.pow(a,this.exp)};a.prototype.equals=function(a){return a&&this.operator===a.operator&&this.sign===a.sign&&this.exp===a.exp&&this.parens===
a.parens};a.prototype.simplify=function(a){this.methods=a;return this.simplifyNode(this.methods)};a.prototype.simplifyNode=function(a){var b,d,c,e;this.methods=a;e=this;c=this.methods;a=0;for(b=c.length;a<b;a++)d=c[a],e=e[d].call(e),e.methods=this.methods;delete e.methods;return e};a.prototype.simpleFlatten=function(){return this};a.prototype.flatten=function(){this.parens=0;return this};a.prototype.computeConstants=function(){return this};a.prototype.combineSimilar=function(){return this};a.prototype.expand=
function(){return this};a.prototype.distribute=function(){return this};a.prototype.removeIdentity=function(){return this};a.prototype.sort=function(){return this};a.prototype.spreadIdentity=function(){return this};a.prototype.stripIdentity=function(){return this};a.prototype.multiplyOne=function(){return(new CTATMultiplicationNode("TIMES",[new CTATConstantNode(1),this])).popNegation().pushNegation()};a.prototype.powerOne=function(){return(new CTATPowerNode("EXP",this,new CTATConstantNode(1))).popInversion().pushInversion().popNegation()};
a.prototype.compare=function(b,f){return a.operatorPrecedence(this.operator,b.operator)};a.prototype.compareSigns=function(a,b){return(Math.sign(this.sign-a.sign)||Math.sign(this.exp-a.exp))*b};a.prototype.countVariables=function(){return 0};a.prototype.pushNegation=function(){return this};a.prototype.popNegation=function(){return this};a.prototype.pushInversion=function(){return this};a.prototype.popInversion=function(){return this};a.prototype.negate=function(){this.sign=-this.sign;return this};
a.prototype.invert=function(){this.exp=-this.exp;return this};a.prototype.addition=function(){return"PLUS"===this.operator};a.prototype.subtraction=function(){return"MINUS"===this.operator};a.prototype.multiplication=function(){return"TIMES"===this.operator};a.prototype.division=function(){return"DIVIDE"===this.operator};a.prototype.intDivision=function(){return"IDIVIDE"===this.operator};a.prototype.power=function(){return"EXP"===this.operator};a.prototype.root=function(){return"SQRT"===this.operator};
a.prototype.negation=function(){return"UMINUS"===this.operator};a.prototype.constant=function(a){return!1};a.prototype.integer=function(){return!1};a.prototype.negated=function(){return 0>this.sign};a.prototype.inverted=function(){return 0>this.exp};a.prototype.parented=function(){return 0<this.parens};a.prototype.even=function(){return!1};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATTreeNode=a}).call(this);var CTATRelationNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},e={}.hasOwnProperty;a=function(a){function d(a,b,d,e,f,r){this.operator=a;this.left=b;this.right=d;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=r?r:1}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.left.clone(),this.right.clone(),this.parens,this.sign,this.exp)};d.prototype.toString=
function(){var a;this.left.setParens(this.operator);this.right.setParens(this.operator);a=CTATTreeNode.toOperatorString(this.operator);return d.__super__.toString.call(this,""+this.left.toString()+a+this.right.toString())};d.prototype.evaluate=function(){var a,b;a=this.left.evaluate();b=this.right.evaluate();switch(this.operator){case "LESS":return a<b;case "GREATER":return a>b;case "LESSEQUAL":return a<=b;case "GREATEREQUAL":return a>=b;case "EQUAL":return a===b;case "NOTEQUAL":return a!==b}};d.prototype.equals=
function(a){return d.__super__.equals.call(this,a)&&this.left.equals(a.left)&&this.right.equals(a.right)};d.prototype.simplify=function(a){this.methods=a;this.left=this.left.simplify(this.methods);this.right=this.right.simplify(this.methods);return d.__super__.simplify.apply(this,arguments)};d.prototype.computeConstants=function(){return this.left.constant()&&this.right.constant()?new CTATConstantNode(this.evaluate()):this};d.prototype.sort=function(){var a;switch(this.operator){case "GREATER":this.operator=
"LESS";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "GREATEREQUAL":this.operator="LESSEQUAL";a=[this.right,this.left];this.left=a[0];this.right=a[1];break;case "EQUAL":case "NOTEQUAL":0>this.left.compare(this.right)&&(a=[this.right,this.left],this.left=a[0],this.right=a[1])}return this};d.prototype.countVariables=function(){return this.left.countVariables()+this.right.countVariables()};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATRelationNode=
a}).call(this);var CTATAdditionNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},e={}.hasOwnProperty;a=function(a){function d(a,b,d,e,f){this.operator=a;this.terms=b;this.parens=null!=d?d:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1;this.subtraction()&&this.terms[1].negate();this.operator="PLUS"}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.terms.map(function(a){return a.clone()}),this.parens,
this.sign,this.exp)};d.prototype.toString=function(){return d.__super__.toString.call(this,this.terms.reduce(function(a){return function(b,c){c.setParens(a.operator);return""+b+(b&&!c.negated()?"+":"")+c.toString()}}(this)))};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,this.terms.reduce(function(a,b){return a+b.evaluate()},0))};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.terms.length===a.terms.length&&this.terms.every(function(b,c){return b.equals(a.terms[c])})};
d.prototype.simplify=function(a){this.methods=a;this.terms=this.terms.map(function(a){return function(b){return b.simplify(a.methods)}}(this));return d.__super__.simplify.apply(this,arguments)};d.prototype.simpleFlatten=function(){this.terms=this.terms.reduce(function(a,b){b.inverted()||b.parented()||!b.addition()?a.push(b):a.push.apply(a,b.pushNegation().terms);return a},[]);return this};d.prototype.flatten=function(){d.__super__.flatten.apply(this,arguments);this.simpleFlatten();return this.pushNegation()};
d.prototype.computeConstants=function(){var a;a=0;this.terms=this.terms.filter(function(b){return b.constant()?(a+=b.evaluate(),!1):!0});0===a&&0!==this.terms.length||this.terms.unshift(new CTATConstantNode(a));return 1<this.terms.length?this:this.pushInversion().terms[0]};d.prototype.combineSimilar=function(){var a;a=[];this.terms.forEach(function(b){var c,d;d=b.constant()?[null,b]:(b=b.multiplyOne(),[b,b.factors.shift()]);return(c=a.find(function(a){var b;return null!=(b=a[0])?b.equals(d[0]):void 0}))?
c[1]+=d[1].evaluate():a.push([d[0],d[1].evaluate()])});this.terms=a.reduce(function(a,b){0!==b[1]&&(b[1]=(new CTATConstantNode(b[1])).popNegation(),b[0]?(b[0].factors.unshift(b[1]),a.push(b[0].removeIdentity())):a.push(b[1]));return a},[]);if(1<this.terms.length)return this;1!==this.terms.length&&(this.terms[0]=new CTATConstantNode(0));return this.pushInversion().terms[0]};d.prototype.removeIdentity=function(){var a;a=this.terms.filter(function(a){return!a.constant(0)});this.terms=a.length?a:this.terms.slice(0,
1);return 1<this.terms.length?this:this.pushInversion().terms[0]};d.prototype.sort=function(){this.spreadIdentity();this.terms=this.terms.sort(function(a,b){return-a.compare(b,!0)});return this.stripIdentity()};d.prototype.spreadIdentity=function(){this.terms=this.terms.map(function(a){return a.multiplyOne()});return this};d.prototype.stripIdentity=function(){this.terms=this.terms.map(function(a){return a.removeIdentity()});return this};d.prototype.compare=function(a,b){var c;return(c=d.__super__.compare.apply(this,
arguments))||this.countVariables()-a.countVariables()||this.terms.some(function(d,e){return c=d.compare(a.terms[e],b)})&&c||this.compareSigns(a,b)};d.prototype.countVariables=function(){return this.terms.reduce(function(a,b){return a+b.countVariables()},0)};d.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));return this};d.prototype.popNegation=function(){this.terms[0].negated()&&(this.negate(),this.terms.forEach(function(a){return a.negate()}));
return this};d.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.terms[0].invert());return this};d.prototype.even=function(){return!this.inverted&&this.terms.every(function(a){return a.even()})};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATAdditionNode=a}).call(this);var CTATMultiplicationNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},e={}.hasOwnProperty;a=function(a){function d(a,b,d,e,f){this.operator=a;this.factors=b;this.parens=null!=d?d:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1;this.division()&&this.factors[1].invert();this.operator="TIMES"}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.factors.map(function(a){return a.clone()}),this.parens,
this.sign,this.exp)};d.prototype.toString=function(){return d.__super__.toString.call(this,this.factors.reduce(function(a){return function(b,c){var d;c.setParens(a.operator);d=c.inverted()?(c.invert(),"/"):/^\d/.test(c=c.toString())&&/\d$/.test(b)?"*":"";return""+b+d+c}}(this),this.factors[0].inverted()?"1":""))};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,this.factors.reduce(function(a,b){return a*b.evaluate()},1))};d.prototype.equals=function(a){return d.__super__.equals.call(this,
a)&&this.factors.length===a.factors.length&&this.factors.every(function(b,c){return b.equals(a.factors[c])})};d.prototype.simplify=function(a){this.methods=a;this.factors=this.factors.map(function(a){return function(b){return b.simplify(a.methods)}}(this));return d.__super__.simplify.apply(this,arguments)};d.prototype.simpleFlatten=function(){this.factors=this.factors.reduce(function(a,b){b.parented()||!b.multiplication()?a.push(b):a.push.apply(a,b.pushNegation().pushInversion().factors);return a},
[]);return this};d.prototype.flatten=function(){d.__super__.flatten.apply(this,arguments);this.simpleFlatten();return this.popNegation()};d.prototype.computeConstants=function(){var a;a=1;this.factors=this.factors.filter(function(b){return b.constant()?(a*=b.evaluate(),!1):!0});1===a&&0!==this.factors.length||this.factors.unshift(new CTATConstantNode(a));return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};d.prototype.combineSimilar=function(){var a;a=[];this.factors.forEach(function(b){var c,
d,e,g;g=b.constant()?[null,b]:b.power()?b.exponent.constant()?(b.pushInversion(),[b.base,b.exponent]):(b.exponent=b.exponent.multiplyOne(),[b,b.exponent.factors.shift()]):(b=b.powerOne(),[b.base,b.exponent]);return(c=a.find(function(a){var b;return null!=(b=a[0])?b.equals(g[0]):void 0}))?c[1]+=(null!=(d=g[1])?d.evaluate():void 0)||1:a.push([g[0],(null!=(e=g[1])?e.evaluate():void 0)||1])});this.factors=a.reduce(function(a,b){0!==b[1]&&(b[1]=(new CTATConstantNode(b[1])).popNegation(),b[0]?b[1].constant(1)?
a.push(b[0]):b[0].power()?(b[0].exponent.factors.unshift(b[1]),a.push(b[0])):a.push(new CTATPowerNode("EXP",b[0],b[1])):a.push(b[1]));return a},[]);if(1<this.factors.length)return this;1!==this.factors.length&&(this.factors[0]=new CTATConstantNode(1));return this.pushNegation().pushInversion().factors[0]};d.prototype.distribute=function(){var a,b;a=this.factors.filter(function(a){return!a.inverted()});b=this.factors.filter(function(a){return a.inverted()});return!this.distributedOrSingle(a)||!this.distributedOrSingle(b)||
this.single(a)&&b.length&&this.distributed(b)?(this.distributed(b)?(a=this.distributeFactors(this.factors),b=[]):this.distributed(a)?(b=this.distributeFactors(this.factors),a=[]):(a=this.distributeFactors(a),b=this.distributeFactors(b)),this.factors=b.length?a.length?[this.packTerms(a),this.packTerms(b).invert()]:[this.packTerms(b).invert()]:[this.packTerms(a)],1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]):this};d.prototype.distributedOrSingle=function(a){return this.distributed(a)||
this.single(a)};d.prototype.distributed=function(a){return a.every(function(a){return!a.addition()})};d.prototype.single=function(a){return 1===a.length&&a[0].addition()};d.prototype.distributeFactors=function(a){var b;b=a[0].addition()?a[0].terms.map(function(a){return a.multiplication()?a.pushNegation().factors:[a]}):[[a[0]]];a.slice(1).forEach(function(a){var c;return a.addition()?1===b.length?b=a.terms.map(function(a){var c;c=b[0].map(function(a){return a.clone()});a.multiplication()?c.push.apply(c,
a.pushNegation().factors):c.push(a);return c}):b=b.reduce(function(b,c){b.push.apply(b,a.terms.map(function(a){var b;b=c.map(function(a){return a.clone()});a.multiplication()?b.push.apply(b,a.pushNegation().factors.map(function(a){return a.clone()})):b.push(a.clone());return b}));return b},[]):1===b.length?a.multiplication()?(c=b[0]).push.apply(c,a.pushNegation().factors):b[0].push(a):b.forEach(function(c,d){var e;return a.multiplication()?(e=b[d]).push.apply(e,a.pushNegation().factors.map(function(a){return a.clone()})):
b[d].push(a.clone())})});return b};d.prototype.packTerms=function(a){var b;b=["computeConstants","combineSimilar","expand","removeIdentity","sort"];return(new CTATAdditionNode("PLUS",a.map(function(a){return(new d("TIMES",a)).popNegation().simplifyNode(b)}))).popNegation().simplifyNode(b)};d.prototype.removeIdentity=function(){var a;this.popNegation();a=this.factors.filter(function(a){return!a.constant(1)});this.factors=a.length?a:this.factors.slice(0,1);(a=this.factors.find(function(a){return a.constant(0)}))&&
this.factors.every(function(a){return!a.inverted()&&(!a.power()||a.exponent.constant())})&&(this.factors=[a]);return 1<this.factors.length?this:this.pushNegation().pushInversion().factors[0]};d.prototype.sort=function(){this.spreadIdentity();this.factors=this.factors.sort(function(a,b){return a.compare(b)});return this.stripIdentity()};d.prototype.spreadIdentity=function(){this.factors=this.factors.map(function(a){return a.powerOne()});return this};d.prototype.stripIdentity=function(){this.factors=
this.factors.map(function(a){return a.removeIdentity()});return this.popNegation()};d.prototype.multiplyOne=function(){this.factors[0].constant()||this.factors.unshift(new CTATConstantNode(1));return this.pushNegation()};d.prototype.compare=function(a,b){var c,e;return(e=d.__super__.compare.apply(this,arguments))||this.countVariables()-a.countVariables()||(c=a.factors.slice(0).reverse())&&this.factors.slice(0).reverse().some(function(a,d){return e=a.compare(c[d],b)})&&e||this.compareSigns(a,b)};d.prototype.countVariables=
function(){return this.factors.reduce(function(a,b){return a+b.countVariables()},0)};d.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.factors[0].negate());return this};d.prototype.popNegation=function(){this.factors.forEach(function(a){return function(b){if(b.negated())return a.negate(),b.negate()}}(this));return this};d.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.factors.forEach(function(a){return a.invert()}));return this};d.prototype.even=function(){return!this.inverted()&&
this.factors.every(function(a){return a.integer()})&&this.factors.some(function(a){return a.even()})};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATMultiplicationNode=a}).call(this);var CTATIntDivisionNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},e={}.hasOwnProperty;a=function(a){function d(a,b,d,e,f,r){this.operator=a;this.dividend=b;this.divisor=d;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=r?r:1}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.dividend.clone(),this.divisor.clone(),this.parens,this.sign,this.exp)};d.prototype.toString=
function(){this.dividend.setParens(this.operator);this.divisor.setParens(this.operator,!0);return d.__super__.toString.call(this,""+this.dividend.toString()+CTATTreeNode.toOperatorString(this.operator)+this.divisor.toString())};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,function(){switch(this.operator){case "REM":return this.dividend.evaluate()%this.divisor.evaluate();case "IDIVIDE":return Math.floor(this.dividend.evaluate()/this.divisor.evaluate())}}.call(this))};d.prototype.equals=
function(a){return d.__super__.equals.call(this,a)&&this.dividend.equals(a.dividend)&&this.divisor.equals(a.divisor)};d.prototype.simplify=function(a){this.methods=a;this.dividend=this.dividend.simplify(this.methods);this.divisor=this.divisor.simplify(this.methods);return d.__super__.simplify.apply(this,arguments)};d.prototype.computeConstants=function(){return this.dividend.constant()&&this.divisor.constant()?new CTATConstantNode(this.evaluate()):this};d.prototype.removeIdentity=function(){return this.divisor.constant(1)?
(this.intDivision()||(this.dividend=new CTATConstantNode(0)),this.pushNegation().pushInversion().dividend):this.popNegation()};d.prototype.compare=function(a,b){return d.__super__.compare.apply(this,arguments)||this.dividend.compare(a.dividend,b)||this.divisor.compare(a.divisor,b)||this.operator!==a.operator&&(this.intDivision()&&-1||1)||this.compareSigns(a,b)};d.prototype.countVariables=function(){return this.dividend.countVariables()+divisor.countVariables()};d.prototype.pushNegation=function(){this.intDivision()&&
this.negated()&&(this.negate(),this.dividend.negate());return this};d.prototype.pushInversion=function(){this.intDivision()&&this.inverted()&&(this.invert(),this.dividend.invert());return this};d.prototype.popNegation=function(){this.divisor.negated()&&(this.divisor.negate(),this.intDivision()&&this.dividend.negate());return this};d.prototype.even=function(){return!this.inverted&&"REM"===this.operator&&this.dividend.even()&&this.divisor.even()};return d}(CTATTreeNode);"undefined"!==typeof module&&
null!==module?module.exports=a:this.CTATIntDivisionNode=a}).call(this);var CTATUnaryNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},e={}.hasOwnProperty;a=function(a){function d(a,b,d,e,f){this.operator=a;this.base=b;this.parens=null!=d?d:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.base,this.parens,this.sign,this.exp)};d.prototype.toString=function(){return d.__super__.toString.call(this,""+
CTATTreeNode.toOperatorString(this.operator)+this.base.toString())};d.prototype.evaluate=function(){this.negation()&&(this.sign=-this.sign);return d.__super__.evaluate.call(this,this.base.evaluate())};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.base.equals(a.base)};d.prototype.simplify=function(a){this.methods=a;this.base=this.base.simplify(this.methods);return d.__super__.simplify.apply(this,arguments)};d.prototype.flatten=function(){d.__super__.flatten.apply(this,
arguments);this.negation()&&this.negate();return this.pushNegation().pushInversion().base};d.prototype.compare=function(a,b){return d.__super__.compare.apply(this,arguments)||this.compareSigns(a,b)};d.prototype.countVariables=function(){return this.base.countVariables()};d.prototype.pushNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};d.prototype.pushInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};return d}(CTATTreeNode);"undefined"!==
typeof module&&null!==module?module.exports=a:this.CTATUnaryNode=a}).call(this);var CTATPowerNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},e={}.hasOwnProperty;a=function(a){function d(a,b,d,e,f,r){this.operator=a;this.base=b;this.exponent=d;this.parens=null!=e?e:0;this.sign=null!=f?f:1;this.exp=null!=r?r:1}b(d,a);d.prototype.clone=function(){return new d(this.operator,this.base.clone(),this.exponent.clone(),this.parens,this.sign,this.exp)};d.prototype.toString=
function(){this.base.setParens(this.operator);this.exponent.setParens(this.operator);return d.__super__.toString.call(this,""+this.base.toString()+CTATTreeNode.toOperatorString(this.operator)+this.exponent.toString())};d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,Math.pow(this.base.evaluate(),this.exponent.evaluate()))};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.base.equals(a.base)&&this.exponent.equals(a.exponent)};d.prototype.simplify=function(a){this.methods=
a;this.base=this.base.simplify(this.methods);this.exponent=this.exponent.simplify(this.methods);return d.__super__.simplify.apply(this,arguments)};d.prototype.flatten=function(){var a,b;d.__super__.flatten.apply(this,arguments);this.operator="EXP";this.popNegation().popInversion();return this.base.power()?(b=CTATTreeNode.diff(this.methods,["flatten"]),a=this.base.exponent.multiplication()?this.base.exponent.pushNegation().pushInversion().factors:[this.base.exponent],this.exponent.multiplication()?
a.push.apply(a,this.exponent.pushNegation().pushInversion().factors):a.push(this.exponent),this.base.exponent=(new CTATMultiplicationNode("TIMES",a)).simplifyNode(b),this.pushBaseNegation().pushBaseInversion().base):this};d.prototype.computeConstants=function(){return this.base.constant()&&(this.exponent.constant()||this.exponent.multiplication()&&this.exponent.factors[0].constant())?(this.exponent.constant()?(this.base=new CTATConstantNode(this.evaluate()),this.exponent=null):(this.base=new CTATConstantNode((new d("EXP",
this.base,this.exponent.factors.shift())).evaluate()),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0])),this.exponent?this:this.pushBaseNegation().pushBaseInversion().base):this};d.prototype.powerOne=function(){this.exponent=this.exponent.multiplyOne();return this.pushInversion()};d.prototype.expand=function(){var a,b,d;if(this.base.addition()&&(this.exponent.integer()&&1<this.exponent.value||this.exponent.multiplication()&&this.exponent.factors[0].integer()&&
1<this.exponent.factors[0].value)){this.exponent.integer()?(a=this.exponent,this.exponent=null):(a=this.exponent.factors.shift(),1===this.exponent.factors.length&&(this.exponent=this.exponent.pushNegation().pushInversion().factors[0]));b=[this.base];d=1;for(a=a.evaluate();1<=a?d<a:d>a;1<=a?++d:--d)b.push(this.base.clone());this.base=(new CTATMultiplicationNode("TIMES",b)).simplifyNode(["distribute"]);return this.exponent?this:this.pushBaseNegation().pushBaseInversion().base}return this};d.prototype.distribute=
function(){var a;return this.base.multiplication()||this.exponent.addition()?(a=this.base.multiplication()?this.base.pushNegation().pushInversion().factors:[this.base],a=this.exponent.addition()?a.reduce(function(a){return function(b,c){b.push.apply(b,a.exponent.terms.map(function(a){return[c.clone(),a.clone()]}));return b}}(this),[]):a.map(function(a){return function(b){return[b,a.exponent.clone()]}}(this)),this.base=this.packFactors(a),this.pushBaseNegation().pushBaseInversion().base):this};d.prototype.packFactors=
function(a){var b;b=CTATTreeNode.diff(this.methods,["flatten"]);return new CTATMultiplicationNode("TIMES",a.map(function(a){return(new d("EXP",a[0],a[1])).simplifyNode(b)}))};d.prototype.removeIdentity=function(){this.popInversion();if(this.exponent.constant(0))return this.base=new CTATConstantNode(1),this.pushBaseNegation().base;if(this.base.constant(0))return this.pushBaseInversion().base;if(this.exponent.constant(1))return this.pushBaseNegation().pushBaseInversion().base;this.exponent=this.exponent.removeIdentity();
return this};d.prototype.compare=function(a,b){return d.__super__.compare.apply(this,arguments)||(this.countVariables()-a.countVariables())*(b?-1:1)||this.exponent.compare(a.exponent,b)||this.base.compare(a.base,b)||this.compareSigns(a,b)};d.prototype.countVariables=function(){return this.base.countVariables()*(this.exponent.constant()?Math.abs(this.exponent.evaluate()):Infinity)};d.prototype.pushBaseNegation=function(){this.negated()&&(this.negate(),this.base.negate());return this};d.prototype.pushInversion=
function(){this.inverted()&&(this.invert(),this.exponent.negate());return this};d.prototype.pushBaseInversion=function(){this.inverted()&&(this.invert(),this.base.invert());return this};d.prototype.popNegation=function(){this.base.negated()&&this.exponent.constant()&&(this.base.negate(),this.exponent.even()||this.negate());return this};d.prototype.popInversion=function(){this.exponent.negated()&&(this.invert(),this.exponent.negate());this.base.inverted()&&(this.invert(),this.base.invert());return this};
d.prototype.even=function(){return!this.inverted()&&this.base.even()&&this.exponent.integer()};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATPowerNode=a}).call(this);var CTATVariableNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},e={}.hasOwnProperty;a=function(a){function d(a,b,d,e,f){this.variableTable=a;this.variable=b;this.parens=null!=d?d:0;this.sign=null!=e?e:1;this.exp=null!=f?f:1;this.operator="VAR"}b(d,a);d.prototype.clone=function(){return new d(this.variableTable,this.variable,this.parens,this.sign,this.exp)};d.prototype.toString=function(){return d.__super__.toString.call(this,
this.variable)};d.prototype.evaluate=function(){var a;return d.__super__.evaluate.call(this,(null!=(a=this.variableTable)?a.get(this.variable):void 0)||function(){try{return eval(this.variable)}catch(g){return NaN}}.call(this))};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.variable===a.variable};d.prototype.compare=function(a,b){b=null!=b?-1:1;return d.__super__.compare.apply(this,arguments)||this.variable>a.variable&&b||this.variable<a.variable&&-b||this.compareSigns(a,
b)};d.prototype.countVariables=function(){return 1};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATVariableNode=a}).call(this);var CTATConstantNode={};
(function(){var a,b=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},e={}.hasOwnProperty;a=function(a){function d(a,b,d,e){this.value=a;this.parens=null!=b?b:0;this.sign=null!=d?d:1;this.exp=null!=e?e:1;this.operator="CONST"}b(d,a);d.prototype.clone=function(){return new d(this.value,this.parens,this.sign,this.exp)};d.prototype.toString=function(){return d.__super__.toString.call(this,this.value.toString())};
d.prototype.evaluate=function(){return d.__super__.evaluate.call(this,this.value)};d.prototype.equals=function(a){return d.__super__.equals.call(this,a)&&this.value===a.value};d.prototype.multiplyOne=function(){return this};d.prototype.powerOne=function(){return this};d.prototype.compare=function(a,b){b=null!=b?1:-1;return d.__super__.compare.apply(this,arguments)||Math.sign(Math.abs(this.evaluate())-Math.abs(a.evaluate()))*b||this.compareSigns(a,b)};d.prototype.popNegation=function(){0>this.value&&
(this.negate(),this.value=-this.value);return this};d.prototype.constant=function(a){return null==a||this.evaluate()===a};d.prototype.integer=function(){return Math.floor(this.evaluate())===this.value};d.prototype.even=function(){return 0===this.evaluate()%2};return d}(CTATTreeNode);"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATConstantNode=a}).call(this);var CTATAlgebraGrammar={},parser=function(){function a(){this.yy={}}var b=function(a,b,c,d){c=c||{};for(d=a.length;d--;c[a[d]]=b);return c},e=[1,6],f=[1,7],d=[1,10],c=[1,11],g=[1,12],h=[1,13],l=[1,21],m=[1,22],r=[5,7,8,9,10,11,12,13,15,26],p=[1,23],x=[1,24],q=[1,26],u=[1,27],n=[5,7,8,9,10,11,12,13,15,16,18,20,21,24,25,26,27,28],B=[5,7,8,9,10,11,12,13,15,16,18,20,21,23,24,25,26,27,28],b={trace:function(){},yy:{},symbols_:{error:2,expression:3,relational:4,EOF:5,arithmetic:6,LESS:7,GREATER:8,LESSEQUAL:9,
GREATEREQUAL:10,EQUAL:11,NOTEQUAL:12,PLUS:13,term:14,MINUS:15,TIMES:16,signedfactor:17,DIVIDE:18,factor:19,IDIVIDE:20,REM:21,atom:22,EXP:23,SQRT:24,LPAREN:25,RPAREN:26,VARIABLE:27,NUMBER:28,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"LESS",8:"GREATER",9:"LESSEQUAL",10:"GREATEREQUAL",11:"EQUAL",12:"NOTEQUAL",13:"PLUS",15:"MINUS",16:"TIMES",18:"DIVIDE",20:"IDIVIDE",21:"REM",23:"EXP",24:"SQRT",25:"LPAREN",26:"RPAREN",27:"VARIABLE",28:"NUMBER"},productions_:[0,[3,2],[4,3],[4,3],[4,3],[4,3],[4,
3],[4,3],[4,1],[6,3],[6,3],[6,1],[14,3],[14,3],[14,2],[14,3],[14,3],[14,1],[17,2],[17,2],[17,1],[19,3],[19,2],[19,1],[22,3],[22,1],[22,1]],performAction:function(a,b,c,d,e,f,g){b=f.length-1;switch(e){case 1:return f[b-1];case 2:this.$=new d.CTATRelationNode("LESS",f[b-2],f[b]);break;case 3:this.$=new d.CTATRelationNode("GREATER",f[b-2],f[b]);break;case 4:this.$=new d.CTATRelationNode("LESSEQUAL",f[b-2],f[b]);break;case 5:this.$=new d.CTATRelationNode("GREATEREQUAL",f[b-2],f[b]);break;case 6:this.$=
new d.CTATRelationNode("EQUAL",f[b-2],f[b]);break;case 7:this.$=new d.CTATRelationNode("NOTEQUAL",f[b-2],f[b]);break;case 8:case 11:case 17:case 20:case 23:this.$=f[b];break;case 9:this.$=new d.CTATAdditionNode("PLUS",[f[b-2],f[b]]);break;case 10:this.$=new d.CTATAdditionNode("MINUS",[f[b-2],f[b]]);break;case 12:this.$=new d.CTATMultiplicationNode("TIMES",[f[b-2],f[b]]);break;case 13:this.$=new d.CTATMultiplicationNode("DIVIDE",[f[b-2],f[b]]);break;case 14:this.$=new d.CTATMultiplicationNode("ITIMES",
[f[b-1],f[b]]);break;case 15:this.$=new d.CTATIntDivisionNode("IDIVIDE",f[b-2],f[b]);break;case 16:this.$=new d.CTATIntDivisionNode("REM",f[b-2],f[b]);break;case 18:this.$=new d.CTATUnaryNode("UPLUS",f[b]);break;case 19:this.$=new d.CTATUnaryNode("UMINUS",f[b]);break;case 21:this.$=new d.CTATPowerNode("EXP",f[b-2],f[b]);break;case 22:this.$=new d.CTATPowerNode("SQRT",f[b],new d.CTATConstantNode(.5));break;case 24:this.$=f[b-1].addParens();break;case 25:this.$=new d.CTATVariableNode(d.variableTable,
a);break;case 26:this.$=new d.CTATConstantNode(Number(a))}},table:[{3:1,4:2,6:3,13:e,14:4,15:f,17:5,19:8,22:9,24:d,25:c,27:g,28:h},{1:[3]},{5:[1,14]},{5:[2,8],7:[1,15],8:[1,16],9:[1,17],10:[1,18],11:[1,19],12:[1,20],13:l,15:m},b(r,[2,11],{22:9,19:25,16:p,18:x,20:q,21:u,24:d,25:c,27:g,28:h}),b(n,[2,17]),{13:e,15:f,17:28,19:8,22:9,24:d,25:c,27:g,28:h},{13:e,15:f,17:29,19:8,22:9,24:d,25:c,27:g,28:h},b(n,[2,20]),b(n,[2,23],{23:[1,30]}),{13:e,15:f,17:31,19:8,22:9,24:d,25:c,27:g,28:h},{6:32,13:e,14:4,15:f,
17:5,19:8,22:9,24:d,25:c,27:g,28:h},b(B,[2,25]),b(B,[2,26]),{1:[2,1]},{6:33,13:e,14:4,15:f,17:5,19:8,22:9,24:d,25:c,27:g,28:h},{6:34,13:e,14:4,15:f,17:5,19:8,22:9,24:d,25:c,27:g,28:h},{6:35,13:e,14:4,15:f,17:5,19:8,22:9,24:d,25:c,27:g,28:h},{6:36,13:e,14:4,15:f,17:5,19:8,22:9,24:d,25:c,27:g,28:h},{6:37,13:e,14:4,15:f,17:5,19:8,22:9,24:d,25:c,27:g,28:h},{6:38,13:e,14:4,15:f,17:5,19:8,22:9,24:d,25:c,27:g,28:h},{13:e,14:39,15:f,17:5,19:8,22:9,24:d,25:c,27:g,28:h},{13:e,14:40,15:f,17:5,19:8,22:9,24:d,
25:c,27:g,28:h},{13:e,15:f,17:41,19:8,22:9,24:d,25:c,27:g,28:h},{13:e,15:f,17:42,19:8,22:9,24:d,25:c,27:g,28:h},b(n,[2,14]),{13:e,15:f,17:43,19:8,22:9,24:d,25:c,27:g,28:h},{13:e,15:f,17:44,19:8,22:9,24:d,25:c,27:g,28:h},b(n,[2,18]),b(n,[2,19]),{13:e,15:f,17:45,19:8,22:9,24:d,25:c,27:g,28:h},b(n,[2,22]),{13:l,15:m,26:[1,46]},{5:[2,2],13:l,15:m},{5:[2,3],13:l,15:m},{5:[2,4],13:l,15:m},{5:[2,5],13:l,15:m},{5:[2,6],13:l,15:m},{5:[2,7],13:l,15:m},b(r,[2,9],{22:9,19:25,16:p,18:x,20:q,21:u,24:d,25:c,27:g,
28:h}),b(r,[2,10],{22:9,19:25,16:p,18:x,20:q,21:u,24:d,25:c,27:g,28:h}),b(n,[2,12]),b(n,[2,13]),b(n,[2,15]),b(n,[2,16]),b(n,[2,21]),b(B,[2,24])],defaultActions:{14:[2,1]},parseError:function(a,b){if(b.recoverable)this.trace(a);else{var c=function(a,b){this.message=a;this.hash=b};c.prototype=Error;throw new c(a,b);}},parse:function(a){var b=[0],c=[null],d=[],e=this.table,f="",g=0,h=0,l=0,m=d.slice.call(arguments,1),q=Object.create(this.lexer),n={},p;for(p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,
p)&&(n[p]=this.yy[p]);q.setInput(a,n);n.lexer=q;n.parser=this;"undefined"==typeof q.yylloc&&(q.yylloc={});p=q.yylloc;d.push(p);var u=q.options&&q.options.ranges;this.parseError="function"===typeof n.parseError?n.parseError:Object.getPrototypeOf(this).parseError;for(var r,x,v,B,N={},O,K;;){v=b[b.length-1];if(this.defaultActions[v])B=this.defaultActions[v];else{if(null===r||"undefined"==typeof r)r=q.lex()||1,"number"!==typeof r&&(r=this.symbols_[r]||r);B=e[v]&&e[v][r]}if("undefined"===typeof B||!B.length||
!B[0]){var S;K=[];for(O in e[v])this.terminals_[O]&&2<O&&K.push("'"+this.terminals_[O]+"'");S=q.showPosition?"Parse error on line "+(g+1)+":\n"+q.showPosition()+"\nExpecting "+K.join(", ")+", got '"+(this.terminals_[r]||r)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==r?"end of input":"'"+(this.terminals_[r]||r)+"'");this.parseError(S,{text:q.match,token:this.terminals_[r]||r,line:q.yylineno,loc:p,expected:K})}if(B[0]instanceof Array&&1<B.length)throw Error("Parse Error: multiple actions possible at state: "+
v+", token: "+r);switch(B[0]){case 1:b.push(r);c.push(q.yytext);d.push(q.yylloc);b.push(B[1]);r=null;x?(r=x,x=null):(h=q.yyleng,f=q.yytext,g=q.yylineno,p=q.yylloc,0<l&&l--);break;case 2:K=this.productions_[B[1]][1];N.$=c[c.length-K];N._$={first_line:d[d.length-(K||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(K||1)].first_column,last_column:d[d.length-1].last_column};u&&(N._$.range=[d[d.length-(K||1)].range[0],d[d.length-1].range[1]]);v=this.performAction.apply(N,[f,h,
g,n,B[1],c,d].concat(m));if("undefined"!==typeof v)return v;K&&(b=b.slice(0,-2*K),c=c.slice(0,-1*K),d=d.slice(0,-1*K));b.push(this.productions_[B[1]][0]);c.push(N.$);d.push(N._$);B=e[b[b.length-2]][b[b.length-1]];b.push(B);break;case 3:return!0}}}},e=function(){return{EOF:1,parseError:function(a,b){if(this.yy.parser)this.yy.parser.parseError(a,b);else throw Error(a);},setInput:function(a,b){this.yy=b||this.yy||{};this._input=a;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=
this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var a=this._input[0];this.yytext+=a;this.yyleng++;this.offset++;this.match+=a;this.matched+=a;a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return a},unput:function(a){var b=
a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:
0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-b};this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-b]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),
{text:"",token:null,line:this.yylineno});return this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;20>a.length&&(a+=this._input.substr(0,20-a.length));return(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+
"\n"+b+"^"},test_match:function(a,b){var c,d;this.options.backtrack_lexer&&(d={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(d.yylloc.range=
this.yylloc.range.slice(0)));if(c=a[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=c.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length};this.yytext+=a[0];this.match+=a[0];this.matches=a;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=
this._input.slice(a[0].length);this.matched+=a[0];c=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(c)return c;if(this._backtrack)for(var e in d)this[e]=d[e];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c;this._more||(this.match=this.yytext="");for(var d=this._currentRules(),e=0;e<d.length;e++)if((b=this._input.match(this.rules[d[e]]))&&(!a||b[0].length>a[0].length))if(a=
b,c=e,this.options.backtrack_lexer){a=this.test_match(b,d[e]);if(!1!==a)return a;if(this._backtrack)a=!1;else return!1}else if(!this.options.flex)break;return a?(a=this.test_match(a,d[c]),!1!==a?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<
this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){a=this.conditionStack.length-1-Math.abs(a||0);return 0<=a?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},
options:{},performAction:function(a,b,c,d){switch(c){case 1:return 25;case 2:return 26;case 3:return 23;case 4:return 23;case 5:return 24;case 6:return 24;case 7:return 16;case 8:return 20;case 9:return 18;case 10:return 21;case 11:return 15;case 12:return 13;case 13:return 9;case 14:return 10;case 15:return 7;case 16:return 8;case 17:return 11;case 18:return 12;case 19:return 28;case 20:return 28;case 21:return 27;case 22:return 5}},rules:[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:\*\*)/,/^(?:\^)/,/^(?:\|)/,
/^(?:\u221a)/,/^(?:\*)/,/^(?:\/\/)/,/^(?:\/)/,/^(?:%)/,/^(?:-)/,/^(?:\+)/,/^(?:<=)/,/^(?:>=)/,/^(?:<)/,/^(?:>)/,/^(?:==)/,/^(?:!=)/,/^(?:(([0-9])+\.?([0-9])*|\.([0-9])+)([Ee][+-]?([0-9])+)?)/,/^(?:(0[Bb]([0-1])+|0[Oo]([0-7])+|0[Xx]([0-9A-Fa-f])+))/,/^(?:([A-Za-z]))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],inclusive:!0}}}}();b.lexer=e;a.prototype=b;b.Parser=a;return new a}();
"undefined"!==typeof require&&"undefined"!==typeof exports&&(exports.parser=parser,exports.Parser=parser.Parser,exports.parse=function(){return parser.parse.apply(parser,arguments)},exports.main=function(a){a[1]||(console.log("Usage: "+a[0]+" FILE"),process.exit(1));a=require("fs").readFileSync(require("path").normalize(a[1]),"utf8");return exports.parser.parse(a)},"undefined"!==typeof module&&require.main===module&&exports.main(process.argv.slice(1)));var CTATAlgebraParser={};
(function(){var a;a=function(){function a(a){this.parser=new parser.Parser;this.parser.yy={CTATRelationNode:CTATRelationNode,CTATAdditionNode:CTATAdditionNode,CTATMultiplicationNode:CTATMultiplicationNode,CTATIntDivisionNode:CTATIntDivisionNode,CTATUnaryNode:CTATUnaryNode,CTATPowerNode:CTATPowerNode,CTATVariableNode:CTATVariableNode,CTATConstantNode:CTATConstantNode,CTATTreeNode:CTATTreeNode};this.parser.yy.variableTable=a}a.none=["simpleFlatten"];a.partial=["flatten","removeIdentity","sort"];a.full=
"flatten computeConstants combineSimilar expand distribute removeIdentity sort".split(" ");a.prototype.algParse=function(b){try{return this.parser.parse(String(b)).simplify(a.none)}catch(f){return null}};a.prototype.algEvaluate=function(a){try{return this.parser.parse(String(a)).evaluate()}catch(f){return null}};a.prototype.algPartialSimplify=function(b){try{return this.parser.parse(String(b)).simplify(a.partial).toString()}catch(f){return null}};a.prototype.algSimplify=function(b){try{return this.parser.parse(String(b)).simplify(a.full).toString()}catch(f){return null}};
a.prototype.algValid=function(a){return null!=this.algParse(a)};a.prototype.algValued=function(a){var b;return null!=(b=this.algEvaluate(a))?!isNaN(b):null};a.prototype.algPartialSimplified=function(a){var b,d;return null!=(b=this.algPartialSimplify(a))&&null!=(d=this.algParse(a))?b.toString()===d.toString():null};a.prototype.algSimplified=function(a){var b,d;return null!=(b=this.algSimplify(a))&&null!=(d=this.algParse(a))?b.toString()===d.toString():null};a.prototype.algIdentical=function(a,b){var d,
c;return null!=(d=this.algParse(a))&&null!=(c=this.algParse(b))?d.equals(c):null};a.prototype.algEqual=function(a,b){var d,c;return null!=(d=this.algEvaluate(a))&&null!=(c=this.algEvaluate(b))?d===c:null};a.prototype.algPartialEquivalent=function(a,b){var d,c;return null!=(d=this.algPartialSimplify(a))&&null!=(c=this.algPartialSimplify(b))?d===c:null};a.prototype.algEquivalent=function(a,b){var d,c;return null!=(d=this.algSimplify(a))&&null!=(c=this.algSimplify(b))?d===c:null};a.prototype.isAlgValid=
a.prototype.algValid;a.prototype.algEval=a.prototype.algEvaluate;a.prototype.algStrictEquivTermsSameOrder=a.prototype.algPartialEquivalent;a.prototype.algEquivTermsSameOrder=a.prototype.algPartialEquivalent;a.prototype.algStrictEquivTerms=a.prototype.algPartialEquivalent;a.prototype.algEquivTerms=a.prototype.algPartialEquivalent;a.prototype.algEquiv=a.prototype.algEquivalent;a.prototype.isSimplified=a.prototype.algSimplified;a.prototype.calc=a.prototype.algEvaluate;a.prototype.calca=function(a){return(+this.algEvaluate(a)).toFixed(2)};
a.prototype.simplify=a.prototype.algSimplify;a.prototype.algebraicEqual=a.prototype.algEqual;a.prototype.patternMatches=a.prototype.algIdentical;a.prototype.polyTermsEqual=function(b,f){return this.parser.parse(b).simplify(a.partial).equals(this.parser.parse(f).simplify(a.partial))};a.prototype.algebraicMatches=a.prototype.algEquivalent;a.prototype.expressionMatches=a.prototype.algEquivalent;return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATAlgebraParser=a}).call(this);var CTATFormulaFunctions={};
(function(){var a,b,e,f,d,c,g,h,l,m,r,p=[].slice;d=/^(\d+)?(?:$|(?:\s|^)(\d+)\/(\d+)$)/;f=/^\d+(\.\d\d)?$/;c=RegExp("((\\d+)\\.?(\\d+)?|\\.(\\d+))([Ee]([+-]?\\d+))?","g");m=/^[+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?$/;l=/^\s*\(\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\,\s*([+-]?((\d+)\.?(\d+)?|\.(\d+))([Ee]([+-]?\d+))?)\s*\)\s*$/;h=/([bcdfghjklmnpqrstvwxz]|qu)y$/;g=/([bcdfghjklmnpqrstvwxz]o|[sc]h|s)$/;r=function(a,b){var c;null==b&&(b=!1);var d,e,f,g;f=null!=(c=a[4])?c:a[2]+(a[3]||
"");g=[];d=0;for(e=f.length;d<e;d++)c=f[d],(b||(b="0"!==c))&&g.push(c);return g.length};e=function(a){return(a[4]||a[3]||"").length-+(a[6]||0)};b=function(a,b,c){var d,e;return isNaN(d=+a)||isNaN(e=+b)?c(String(a).toLowerCase(),String(b).toLowerCase()):c(d,e)};a=function(){function a(){}a.printf=("undefined"!==typeof window&&null!==window?window:global).sprintf;a.sum=function(){return(1<=arguments.length?p.call(arguments,0):[]).reduce(function(a,b){return a+ +b},0)};a.mod=function(a,b){return Math.round(a)%
Math.round(b)};a.modf=function(a,b){return a%b};a.IEEEremainder=a.modf;a.isFactor=function(a,b){return 1!==+a&&0===b%a};a.isMultiple=function(a,b){return 0===a%b};a.isUnit=function(a){return 1===+a};a.isAny=function(a,b){return this.isFactor(a,b)||this.isMultiple(a,b)||this.isUnit(a)};a.gcf=function(a,b){var c;c=[Math.abs(a),Math.abs(b)];a=c[0];for(b=c[1];0<b;)c=[b,a%b],a=c[0],b=c[1];return a};a.lcm=function(a,b){return Math.abs(a*b)/this.gcf(a,b)};a.integerInRange=function(a,b,c){var d;null==b&&
(b=-Infinity);null==c&&(c=Infinity);return Math.round(b)<=(d=Math.round(a))&&d<=Math.round(c)};a.fmtDecimal=function(a,b){null==b&&(b=2);return(+a).toFixed(Math.round(+b))};a.fmtNormal=function(a,b){null==b&&(b=6);return this.fmtDecimal(a,b).replace(/\.0+$|(\..+?)0+$/,"$1")};a.fmtDollar=function(a,b){null==b&&(b="");a=this.fmtDecimal(a);b=b.toLowerCase();0<=b.indexOf("i")&&(a=a.replace(/\.00$/,""));return 0<=b.indexOf("d")?"$"+a:a};a.dollarEquals=function(){var a,b;a=arguments[0];b=2<=arguments.length?
p.call(arguments,1):[];a=this.fmtDollar(a,"i");return b.some(function(b){return function(c){return a===b.fmtDollar(c,"i")}}(this))};a.matchWithPrecision=function(a,c){var d,e;return(d=String(a).match(m))&&(e=String(c).match(m))&&r(d)===r(e)&&b(a,c,function(a,b){return a===b})};a.matchWithoutPrecision=function(a,c){var d,f;return(d=String(a).match(m))&&(f=String(c).match(m))&&(a=r(d)>r(f)?(+a).toFixed(e(f)):String(a))&&b(a,c,function(a,b){return a===b})};a.constantsConform=function(){var a,b;a=arguments[0];
b=2<=arguments.length?p.call(arguments,1):[];b=b.map(function(a){return"string"===typeof a?new RegExp("^"+a+"$","i"):a});return(a.match(c)||[]).every(function(a){return b.some(function(b){return b.test(a)})})};a.constantsDollar=function(a){return this.constantsConform(a,f)};a.isNumber=function(a,b,c){null==b&&(b=!0);return(b||"number"===typeof a)&&!isNaN(a=+a)&&(!c||a===Math.round(a))};a.isInteger=function(a,b){return this.isNumber(a,b,!0)};a.isVar=function(a){return/^\s*[a-zA-Z]\s*$/.test(a)};a.makeFraction=
function(a,b,c){null!=b&&null==c&&(c=[0,a,b],a=c[0],b=c[1],c=c[2]);a=+a||0;b=+b||0;c=+c||1;return this.isInteger(a)&&this.isInteger(b)&&this.isInteger(c)?(a?a+(b?" ":""):"")+(b?b+(1===c?"":"/"+c):""):null};a.fractionMake=a.makeFraction;a.getWhole=function(a){return null!=(a=a.match(d))?a[1]||"0":null};a.getNumerator=function(a){return null!=(a=a.match(d))?a[2]||"0":null};a.getDividend=a.getNumerator;a.getDenominator=function(a){return null!=(a=a.match(d))?a[3]||"1":null};a.getDivisor=a.getDenominator;
a.convertToMixed=function(a){return null!=(a=a.match(d))?(a[1]=(+a[1]||0)+Math.floor((+a[2]||0)/(+a[3]||1)),a[2]=(+a[2]||0)%(+a[3]||1),this.makeFraction(a[1],a[2],a[3])):null};a.convertToImproper=function(a){return null!=(a=a.match(d))?(a[2]=(+a[1]||0)*(+a[3]||1)+(+a[2]||0),a[1]=0,null==a[3]&&(a[3]=1),this.makeFraction(a[1],a[2],a[3])):null};a.evaluateFraction=function(a){return null!=(a=a.match(d))?((+a[1]||0)*(+a[3]||1)+(+a[2]||0))/(+a[3]||1):null};a.divEvaluate=a.evaluateFraction;a.simplifyFraction=
function(a){var b;return null!=(a=a.match(d))?(null!=a[1]&&null!=a[2]&&(a[1]=+a[1]+Math.floor(+a[2]/+a[3]),a[2]=+a[2]%+a[3]),b=null!=a[2]?this.gcf(+a[2],+a[3]):1,this.makeFraction(a[1],a[2]/b,a[3]/b)):null};a.fractionsimplify=a.simplifyFraction;a.simplifyMixed=a.simplifyFraction;a.simplifiedFraction=function(a){var b;return null!=(b=this.simplifyFraction(a))?b===a:null};a.isSimplifiedMixed=a.simplifiedFraction;a.fractionEquals=function(a,b){var c,d;return null!=(c=this.evaluateFraction(a))&&null!=
(d=this.evaluateFraction(b))?c===d:null};a.simplifiedFractionEquals=function(a,b){var c,d;return null!=(c=this.simplifiedFraction(a))&&null!=(d=this.simplifiedFraction(b))?c&&d&&this.fractionEquals(a,b):null};a.rationalEquals=function(a,b){return this.matchWithoutPrecision(+b||this.evaluateFraction(b),+a||this.evaluateFraction(a))};a.quote=function(a){return'"'+a+'"'};a.compact=function(a){return a.replace(/\s*/g,"")};a.replaceAll=function(a,b,c){return a.replace(new RegExp(b,"g"),c)};a.regExMatch=
function(a,b,c){return("string"===typeof a?new RegExp(a,c):a).test(b)};a.rm1coeff=function(a){if(null!=a)return a.replace(/(^|[^0-9])1([a-zA-Z])/g,"$1$2")};a.setMatches=function(a,b,c){var d,e;d=a.split(c);e=b.split(c);return e.every(function(a){return d.includes(a)})&&d.every(function(a){return e.includes(a)})};a.pointInRange=function(a,b,c,d,e){var f,g,h;if(f=null!=b?"function"===typeof b.match?b.match(l):void 0:void 0)e=[f[1],f[8],c,d],b=e[0],c=e[1],d=e[2],e=e[3];null==d&&(d=0);null==e&&(e=d);
return(f=a.match(l))&&b-d<=(g=f[1])&&g<=+b+ +d&&c-e<=(h=f[8])&&h<=+c+ +e};a.plural=function(a,b,c,d){var e;if(!b||2>a)return b;null==c&&(c=h.test(e=b.toLowerCase())?"y":"");if(!b.endsWith(c))return b;null==d&&(d=h.test(e)?"ies":g.test(e)?"es":"s");c.length&&(b=b.split(c)[0]);return b+(/[A-Z]/.test(b[b.length-1])?d.toUpperCase():d)};a.totalTableDec=function(a,b,c,d){return 1E3*(+a||0)+100*(+b||0)+10*(+c||0)+(+d||0)};a.columnCell=function(a,b,c,d,e,f,g,h,l,m){switch(l){case "r1c1":case "r2c1":case "r3c1":return m?
a:e;case "r1c2":case "r2c2":case "r3c2":return m?b:f;case "r1c3":case "r2c3":case "r3c3":return m?c:g;case "r1c4":case "r2c4":case "r3c4":return m?d:h;default:return 0}};a.first=function(){return(1<=arguments.length?p.call(arguments,0):[])[0]};a.last=function(){var a;a=1<=arguments.length?p.call(arguments,0):[];return a[a.length-1]};a.chooseRandomly=function(){var a;a=1<=arguments.length?p.call(arguments,0):[];return a[Math.floor(Math.random()*a.length)]};a.firstNonNull=function(){var a;return null!=
(a=(1<=arguments.length?p.call(arguments,0):[]).find(function(a){return null!=a}))?a:null};a.valueOrZero=function(){var a;return null!=(a=(1<=arguments.length?p.call(arguments,0):[]).find(function(a){return null!=a}))?a:0};a.hasValue=function(){return(1<=arguments.length?p.call(arguments,0):[]).every(function(a){return null!=a})};a.equals=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?p.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.every(function(a){return b===(null!=a?
a:void 0)}):c.every(function(b){return a===+(null!=b?b:NaN)})};a.memberOf=function(){var a,b,c;b=arguments[0];c=2<=arguments.length?p.call(arguments,1):[];null==b&&(b=void 0);return isNaN(a=+b)?c.some(function(a){return b===(null!=a?a:void 0)}):c.some(function(b){return a===+(null!=b?b:NaN)})};a.greaterThan=function(a,c){return b(a,c,function(a,b){return a>b})};a.lessThan=function(a,c){return b(a,c,function(a,b){return a<b})};a.greaterThanOrEqual=function(a,c){return b(a,c,function(a,b){return a>=
b})};a.lessThanOrEqual=function(a,c){return b(a,c,function(a,b){return a<=b})};a.equal=function(a,c){return b(a,c,function(a,b){return a===b})};a.notEqual=function(a,c){return b(a,c,function(a,b){return a!==b})};a.and=function(){return(1<=arguments.length?p.call(arguments,0):[]).reduce(function(a,b){return a&&b},!0)};a.or=function(){return(1<=arguments.length?p.call(arguments,0):[]).reduce(function(a,b){return a||b},!1)};a.not=function(a){return!a};a.ifThen=function(a,b,c){return a?b:c};a.assign=
function(a,b){var c,d,e,f,g,h;h="undefined"!==typeof window&&null!==window?window:global;d=a.split(".");e=2<=d.length?p.call(d,0,c=d.length-1):(c=0,[]);f=d[c++];c=0;for(g=e.length;c<g;c++)d=e[c],h=null!=h[d]?h[d]:h[d]={};return h[f]=b};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaFunctions=a}).call(this);var CTATFormulaActions={};
(function(){var a;a=function(){function a(){}a.goToState=function(a){return CTAT.ToolTutor.tutor.goToState(a)};a.goToStartState=function(){return CTAT.ToolTutor.tutor.goToStartState()};a.performInterfaceAction=function(a,b,d){return CTAT.ToolTutor.sendToInterface((new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(CTATMessage.makeTransactionId(),new CTATSAI(a,b,d)))};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaActions=a}).call(this);var CTATFormulaParser={};
(function(){var a,b,e,f,d=[].slice,c=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};f=/"(?:[^\\"]|\\\")*"|'(?:[^\\'']|\\\')*'/;b=/[A-Za-z_][\w._]*(?![\w(._])/g;e="abstract await boolean break byte case catch char class const continue debugger default delete do double else enum export extends false final finally float for function goto if implements import in instanceof int interface let long native new null of package private protected public return short static super switch synchronized this throw throws transient true try typeof var void volatile while with yield Array Date eval function global hasOwnProperty Infinity isFinite isNaN isPrototypeOf length Math NaN name Number Object prototype String toString undefined valueOf window".split(" ");a=
function(){function a(a){var b,c,e;this.variableTable=a;this.algebraParser=new CTATAlgebraParser;this.keys=[];this.values=[];e="EPSILON MAX_VALUE MIN_VALUE POSITIVE_INFINITY NEGATIVE_INFINITY isFinite isInteger isNaN parseFloat parseInt".split(" ");a=0;for(c=e.length;a<c;a++)b=e[a],this.keys.push(b),this.values.push(Number[b]);e="toExponential toFixed toLocaleString toPrecision toString valueOf".split(" ");a=0;for(c=e.length;a<c;a++)b=e[a],this.keys.push(b),this.values.push(function(a){return function(){var b,
c;c=arguments[0];b=2<=arguments.length?d.call(arguments,1):[];return a.apply(c,b)}}(Number.prototype[b]));e="E LN10 LN2 LOG10E LOG2E PI SQRT1_2 SQRT2 abs acos acosh asin asinh atan atanh atan2 cbrt ceil clz32 cos cosh exp expm1 floor fround hypot imul log log10 log1p log2 max min pow random round sign sin sinh sqrt tan tanh trunc".split(" ");a=0;for(c=e.length;a<c;a++)b=e[a],this.keys.push(b),this.values.push(Math[b]);e=["fromCharCode","fromCodePoint"];a=0;for(c=e.length;a<c;a++)b=e[a],this.keys.push(b),
this.values.push(String[b]);e="charAt charCodeAt codePointAt concat contains endsWith indexOf lastIndexOf localeCompare match repeat replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toUpperCase trim valueOf".split(" ");c=0;for(a=e.length;c<a;c++)b=e[c],this.keys.push(b),this.values.push(function(a){return function(){var b,c;c=arguments[0];b=2<=arguments.length?d.call(arguments,1):[];return a.apply(c,b)}}(String.prototype[b]));this.keys.push("length");
this.values.push(function(a){return a.length});e="algParse algEvaluate algPartialSimplify algSimplify algValid algValued algPartialSimplified algSimplified algIdentical algEqual algPartialEquivalent algEquivalent isAlgValid algEval algStrictEquivTermsSameOrder algEquivTermsSameOrder algStrictEquivTerms algEquivTerms algEquiv isSimplified calc calca simplify algebraicEqual patternMatches polyTermsEqual algebraicMatches expressionMatches".split(" ");c=0;for(a=e.length;c<a;c++)b=e[c],this.keys.push(b),
this.values.push(function(a,b){return function(){var c;c=1<=arguments.length?d.call(arguments,0):[];return a.apply(b,c)}}(this.algebraParser[b],this.algebraParser));for(b in CTATFormulaFunctions)this.keys.push(b),this.values.push(function(a,b){return function(){var c;c=1<=arguments.length?d.call(arguments,0):[];return a.apply(b,c)}}(CTATFormulaFunctions[b],CTATFormulaFunctions));for(b in CTATFormulaActions)this.keys.push(b),this.values.push(function(a,b){return function(){var c;c=1<=arguments.length?
d.call(arguments,0):[];return a.apply(b,c)}}(CTATFormulaActions[b],CTATFormulaActions))}a.prototype.evaluate=function(a,g,m,r){var h,l,q,u,n,B,v,z,A,D,H,w;try{z="undefined"!==typeof window&&null!==window?window:global;h=function(){var a;a=[];for(u in z)a.push(u);return a}().concat(["selection","action","input"]);A=a.split(f);l=0;for(n=A.length;l<n;l++)for(v=A[l],H=null!=(D=v.match(b))?D:[],q=0,B=H.length;q<B;q++)u=H[q],0>c.call(e,u)&&0>c.call(h,u)&&0>c.call(this.keys,u)&&CTATFormulaFunctions.assign(u,
void 0);for(u in w=this.variableTable.getTable())z[u]=w[u];return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(Function,["selection","action","input"].concat(d.call(this.keys),["return "+a.trim()]),function(){}).apply(z,[g,m,r].concat(d.call(this.values)))}catch(E){return console.log(E),null}finally{for(u in z)null!=u&&0>c.call(h,u)&&(w[u]=z[u],delete z[u])}};a.prototype.interpolateSplitPattern=/<%=|%>/;a.prototype.interpolate=function(a,b,c,d){var e,f,
g,h,l;h=a.split(this.interpolateSplitPattern);l=[];a=f=0;for(g=h.length;f<g;a=++f)e=h[a],l.push(a%2?this.evaluate(e,b,c,d):e);return l.join("")};return a}();"undefined"!==typeof module&&null!==module?module.exports=a:this.CTATFormulaParser=a}).call(this);var CTATSingleMatcher=function(a,b){CTATMatcher.call(this,!0,a,b);var e=this,f="",d="";this.getSingle=function(a){return f};this.setSingle=function(a){null===a||"undefined"===typeof a?e.ctatdebug('CTATSingleMatcher --\x3e bad argument "'+a+'" to setSingle()'):f=a};this.toString=function(){console.log("Error: CTATSingleMatcher.toString() called: should be overridden")};this.matchSingle=function(a){console.log("Error: CTATSingleMatcher.matchSingle("+a+") called: should be overridden");return!1};this.getReplacementFormula=
function(){return d};this.setReplacementFormula=function(a){d=a?a:""};this.evaluateReplacement=function(a,b,f){f=null;if(!d)return f;e.ctatdebug("CTATSingleMatcher.evaluateReplacement("+a+", "+b+")");var c=a.getSelection(),g=a.getAction();a=CTATVariableTable.standardizeType(a.getInput());b||(b=new CTATVariableTable);b=new CTATFormulaParser(b);e.ctatdebug("CTATSingleMatcher calling CTATFormulaParser.evaluate("+d+", "+c+", "+g+", "+a+")");try{f=b.evaluate(d,c,g,a)}catch(r){e.ctatdebug("CTATSingleMatcher error from CTATFormulaParser.evaluate("+
d+") "+r.name+": "+r.message),f=null}e.ctatdebug("CTATSingleMatcher.evaluateReplacement() returns "+f+", type "+typeof f);return f}};CTATSingleMatcher.prototype=Object.create(CTATMatcher.prototype);CTATSingleMatcher.prototype.constructor=CTATSingleMatcher;CTATSingleMatcher.prototype.matchConcatenation=function(a){a=this.array2ConcatString(a);return this.matchSingle(a)};CTATSingleMatcher.prototype.match=function(a,b,e,f){return this.matchConcatenation(a)};
CTATSingleMatcher.prototype.setParameter=function(a,b,e){this.ctatdebug("CTATSingleMatcher.setParameter("+a+", "+b+", "+e+") calling\n  "+this.setSingle.toString());this.setSingle(a)};"undefined"!==typeof module&&(module.exports=CTATSingleMatcher);var CTATAnyMatcher=function(a,b){CTATSingleMatcher.call(this,a,!0);this.toString=function(){return"*"};this.matchSingle=function(a){return!0}};CTATAnyMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATAnyMatcher.prototype.constructor=CTATAnyMatcher;"undefined"!==typeof module&&(module.exports=CTATAnyMatcher);var CTATExactMatcher=function(a,b){CTATSingleMatcher.call(this,a,!0);var e=this;this.toString=function(){return e.getSingle().toString()};this.matchSingle=function(a){var b=e.getSingle();ctatdebug("CTATExactMatcher --\x3e in matchSingle: s = "+a+", singleval = "+b+", caseInsensitive "+e.getCaseInsensitive()+", "+typeof e.getCaseInsensitive());return e.getCaseInsensitive()?String(a).toUpperCase()==String(b).toUpperCase():String(a)==String(b)}};CTATExactMatcher.prototype=Object.create(CTATSingleMatcher.prototype);
CTATExactMatcher.prototype.constructor=CTATExactMatcher;"undefined"!==typeof module&&(module.exports=CTATExactMatcher);var CTATExampleTracerException=function(a){CTATBase.call(this,"CTATExampleTracerException","");this.toString=function(){return a}};CTATExampleTracerException.prototype=Object.create(CTATBase.prototype);CTATExampleTracerException.prototype.constructor=CTATExampleTracerException;"undefined"!==typeof module&&(module.exports=CTATExampleTracerException);var CTATExpressionMatcher=function(a,b){function e(a,b,d,e,g){h.ctatdebug("CTATExpressionMatcher.testVector["+e+"]("+a+", "+b+", "+d+", "+g+") to call evaluate");var l=CTATVariableTable.standardizeType(d);h.ctatdebug("CTATExpressionMatcher.testVector typeof input "+typeof d+"; inputConv "+l+", typeof "+typeof l);d=h.evaluate(a,b,l,g);h.ctatdebug("CTATExpressionMatcher.testVector evaluate("+a+", "+b+", "+l+", "+g+") returned "+d+", type "+typeof d);g=null;switch(e){case CTATMatcher.SELECTION:g=a;break;
case CTATMatcher.ACTION:g=b;break;case CTATMatcher.INPUT:case CTATMatcher.NON_SINGLE:g=l}c=g;h.ctatdebug("CTATExpressionMatcher.testVector comparee "+g+", type "+typeof g+", relation "+f+"( "+CTATExpressionMatcher.RELATIONS[f]+" )");try{switch(f){case CTATExpressionMatcher.BOOL_RELATION:return!!d;case CTATExpressionMatcher.EQ_RELATION:if(null==g)return null==d;if(null==d)break;return h.compareNumberOrString(g,d,f);case CTATExpressionMatcher.NOT_EQ_RELATION:return null==g?null!=d:null==d?!0:h.compareNumberOrString(g,
d,f);case CTATExpressionMatcher.LT_RELATION:case CTATExpressionMatcher.GT_RELATION:if(null==g||null==d)break;return h.compareNumberOrString(g,d,f);case CTATExpressionMatcher.LTE_RELATION:case CTATExpressionMatcher.GTE_RELATION:if(null==g)return null==d;if(null!=d)return h.compareNumberOrString(g,d,f)}}catch(u){}return!1}CTATSingleMatcher.call(this,a,b);var f=CTATExpressionMatcher.EQ_RELATION,d=b,c=null,g=!1,h=this;this.getLastInput=function(){h.ctatdebug("CTATExpressionMatcher.getLastInput() returns "+
c);return c};this.isEqualRelation=function(){h.ctatdebug("CTATExpressionMatcher --\x3e in isEqualRelation");return f===CTATExpressionMatcher.EQ_RELATION};this.getEvaluatedInput=function(a,b){h.ctatdebug("CTATExpressionMatcher --\x3e in getEvaluatedInput("+a+", "+b+")");var c=CTATVariableTable.standardizeType(a.getInput()),c=h.evaluate(a.getSelection(),a.getAction(),c,b);h.ctatdebug("CTATExpressionMatcher.getEvaluatedInput() returns "+c);return c};this.toString=function(){return CTATExpressionMatcher.RELATIONS[f]+
' "'+d+'"'};this.matchSingle=function(a){throw new CTATExampleTracerException("UnsupportedOperationException");};this.setInputExpression=function(a){d=a};this.setRelation=function(a){f=a};this.interpolate=function(a,b,c,d){try{var e=new CTATVariableTable;return(new CTATFormulaParser(e)).interpolate(a,b,c,d)}catch(q){return null}};this.evaluate=function(a,b,c,d){if("undefined"==typeof d||null==d)d=new CTATVariableTable;h.ctatdebug("CTATExpressionMatcher.evaluate(..., vt="+d+") creating CTATFormulaParser");
d=new CTATFormulaParser(d);h.ctatdebug("calling CTATFormulaParser.evaluate("+h.getInputExpression()+", "+a+", "+b+", "+c+")");try{return d.evaluate(h.getInputExpression(),a,b,c)}catch(x){return h.ctatdebug("CTATExpressionMatcher --\x3e "+x.name+": "+x.message),null}};this.matchConcatenation=function(b,c,d,f){b=h.array2ConcatString(b);null===c||"undefined"===typeof c||null===d||"undefined"===typeof d?g=e(b,null,null,a,f):(c=h.array2ConcatString(c),d=h.array2ConcatString(d),g=e(b,c,d,a,f));return g};
this.match=function(a,b,c,d,e){return h.matchConcatenation(a,b,c,e)};this.getInputExpression=function(){return d};(function(){if(null!==b&&"undefined"!==typeof b){var a;a=b.indexOf('"');var c=b.lastIndexOf('"');0<=a&&0<=c?(a=b.substring(a+1,c),c=b.substring(0,b.indexOf(" ")),f=CTATExpressionMatcher.nameToRelation(c)):a=b;h.setInputExpression(a)}})()};Object.defineProperty(CTATExpressionMatcher,"EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:0});
Object.defineProperty(CTATExpressionMatcher,"LT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:1});Object.defineProperty(CTATExpressionMatcher,"GT_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:2});Object.defineProperty(CTATExpressionMatcher,"NOT_EQ_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:3});Object.defineProperty(CTATExpressionMatcher,"GTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:4});
Object.defineProperty(CTATExpressionMatcher,"LTE_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:5});Object.defineProperty(CTATExpressionMatcher,"BOOL_RELATION",{enumerable:!1,configurable:!1,writable:!1,value:6});Object.defineProperty(CTATExpressionMatcher,"RELATIONS",{enumerable:!1,configurable:!1,writable:!1,value:"= < > != >= <= boolean".split(" ")});
CTATExpressionMatcher.nameToRelation=function(a){for(var b=0;b<CTATExpressionMatcher.RELATIONS.length;b++)if(a==CTATExpressionMatcher.RELATIONS[b])return b;return CTATExpressionMatcher.EQ_RELATION};CTATExpressionMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATExpressionMatcher.prototype.constructor=CTATExpressionMatcher;
CTATExpressionMatcher.prototype.setParameter=function(a,b,e){a&&b&&e&&(a=e.getNodeTextValue(a),this.ctatdebug("CTATExpressionMatcher.setParameter("+b+", "+a+")"),"InputExpression"==b?this.setInputExpression(a):"relation"==b&&this.setRelation(CTATExpressionMatcher.nameToRelation(a)))};
CTATExpressionMatcher.prototype.compareNumberOrString=function(a,b,e){a=String(a);b=String(b);var f=Number(a),d=Number(b);if(isNaN(f)||isNaN(d))switch(e){case CTATExpressionMatcher.EQ_RELATION:return a==b;case CTATExpressionMatcher.NOT_EQ_RELATION:return a!=b;case CTATExpressionMatcher.LT_RELATION:return a.toLowerCase()<b.toLowerCase();case CTATExpressionMatcher.GT_RELATION:return a.toLowerCase()>b.toLowerCase();case CTATExpressionMatcher.LTE_RELATION:return a.toLowerCase()<=b.toLowerCase();case CTATExpressionMatcher.GTE_RELATION:return a.toLowerCase()>=
b.toLowerCase();case CTATExpressionMatcher.BOOL_RELATION:return!!b;default:return!1}else switch(e){case CTATExpressionMatcher.EQ_RELATION:return f==d;case CTATExpressionMatcher.NOT_EQ_RELATION:return f!=d;case CTATExpressionMatcher.LT_RELATION:return f<d;case CTATExpressionMatcher.GT_RELATION:return f>d;case CTATExpressionMatcher.LTE_RELATION:return f<=d;case CTATExpressionMatcher.GTE_RELATION:return f>=d;case CTATExpressionMatcher.BOOL_RELATION:return!!d;default:return!1}};
"undefined"!==typeof module&&(module.exports=CTATExpressionMatcher);var CTATRangeMatcher=function(a,b){CTATSingleMatcher.call(this,a,!0);var e=0,f=0;this.toString=function(){return"[ "+e+" , "+f+" ]"};this.setMinimum=function(a){try{e=parseFloat(a)}catch(c){throw new CTATExampleTracerException('Number format exception while parsing minimum value "'+a+'": '+c);}};this.setMaximum=function(a){try{f=parseFloat(a)}catch(c){throw new CTATExampleTracerException('Number format exception while parsing maximum value "'+a+'": '+c);}};this.matchSingle=function(a){var b;try{b=
parseFloat(a)}catch(g){throw new CTATExampleTracerException("Number format exception while parsing .");}return e<=b&&b<=f?!0:!1}};CTATRangeMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRangeMatcher.prototype.constructor=CTATRangeMatcher;
CTATRangeMatcher.prototype.setParameter=function(a,b){switch((b?b:"").toString().trim().toLowerCase()){case "minimum":this.setMinimum(a);break;case "maximum":this.setMaximum(a);break;default:console.log('CTATRangeMatcher.setParameter() undefined parameter name "'+b+'"'),this.setMinimum(a),this.setMaximum(a)}};CTATRangeMatcher.prototype.match=function(a,b,e,f){return this.matchSingle(a,b,e,f)};"undefined"!==typeof module&&(module.exports=CTATRangeMatcher);var CTATRegexMatcher=function(a,b){CTATSingleMatcher.call(this,a,!0);var e=null,f=null,d=this;this.toString=function(){return e};this.setSinglePattern=function(a){"undefined"===typeof a||null===a?console.log("CTATRegexMatcher: null or undefined pattern"):(e=a,f=d.getCaseInsensitive()?new RegExp(a,"i"):new RegExp(a))};this.setSingle=function(a){d.setSinglePattern(a)};this.matchSingle=function(a){if(null==a)return null==getSingle();if(null==f)return console.log("Error: CTATRegexMatcher.matchSingle called before pattern has been set"),
!1;var b=f.exec(a);return null!=b&&b[0]==a}};CTATRegexMatcher.prototype=Object.create(CTATSingleMatcher.prototype);CTATRegexMatcher.prototype.constructor=CTATRegexMatcher;"undefined"!==typeof module&&(module.exports=CTATRegexMatcher);var CTATWildcardMatcher=function(a,b){function e(a){if(null==a||"undefined"===typeof a)return null;var b=(new String(a)).replace(RegExp("\\?","g"),"."),d=b.replace(RegExp("\\*","g"),".*"),e=d.replace(RegExp("\\[\\!","g"),"[^");f.ctatdebug("CTATWildcardMatcher.convertToFullRegex("+a+") after qm: "+b+"; after aster: "+d+"; after negate: "+e+";");return e}CTATRegexMatcher.call(this,a,b);var f=this;this.toString=function(){return null};this.setSingle=function(a){f.simpleSinglePattern=a;f.setSinglePattern.call(f,
e(a))};this.setSingle(b);this.simpleSinglePattern=b};CTATWildcardMatcher.prototype=Object.create(CTATRegexMatcher.prototype);CTATWildcardMatcher.prototype.constructor=CTATWildcardMatcher;"undefined"!==typeof module&&(module.exports=CTATWildcardMatcher);var CTATVectorMatcher=function(a,b,e,f){function d(a,b,d,e,f){m.ctatdebug("CTATVectorMatcher --\x3e in _match("+a+", "+b+", "+d+", "+e+")");if(0===c.length||0===g.length||0===h.length)c.push(new CTATExactMatcher(CTATMatcher.SELECTION,m.array2ConcatString(m.getDefaultSelectionArray()))),g.push(new CTATExactMatcher(CTATMatcher.ACTION,m.array2ConcatString(m.getDefaultActionArray()))),h.push(new CTATExactMatcher(CTATMatcher.INPUT,m.array2ConcatString(m.getDefaultInputArray())));var p=[];p[CTATMatcher.SELECTION]=
a;p[CTATMatcher.ACTION]=b;p[CTATMatcher.INPUT]=d;for(var n=0;3>n;n++){var r=l[n][0],q=r instanceof CTATExpressionMatcher?r.matchConcatenation(a,b,d,e):r.matchConcatenation(p[n]);m.ctatdebug("CTATVectorMatcher --\x3e in _match["+n+"] after "+r+".concat returns: "+q);if(f)f.push(q);else if(!1===q)return!1}if(f)for(a=0;a<f.length;++a)if(!f[a])return!1;return!0}CTATMatcher.call(this,!0,CTATMatcher.VECTOR,!0);var c=a instanceof Array?a:[],g=b instanceof Array?b:[],h=e instanceof Array?e:[],l=[];l[CTATMatcher.SELECTION]=
c;l[CTATMatcher.ACTION]=g;l[CTATMatcher.INPUT]=h;var m=this;this.match=function(a,b,c,e,f){return!1!==d(a,b,c,f)&&m.matchActor(e)?!0:!1};this.getMatchers=function(a){return l[a]};this.getTutorSAI=function(a,b,c){m.ctatdebug("CTATVectorMatcher.getTutorSAI("+a+", vt, "+c+")");if(c&&CTATExampleTracerLink.CORRECT_ACTION.toLowerCase()==c.toLowerCase())return a;var e=[];if(d(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,e))return c=a.clone(),a=m.evaluateReplacement(a,b,null),null!=a&&c.setInput("object"==
typeof a?a.toString():a),c;c=a.clone();for(a=0;a<e.length;a++)switch(a){case CTATMatcher.SELECTION:if(e[a])continue;c.setSelection(m.getDefaultSelection());c.setSelectionArray(m.getDefaultSelectionArray());break;case CTATMatcher.ACTION:if(e[a])continue;c.setAction(m.getDefaultAction());c.setActionArray(m.getDefaultActionArray());break;case CTATMatcher.INPUT:if(e[a])continue;c.setInput(m.getDefaultInput());c.setInputArray(m.getDefaultInputArray());break;default:console.log("CTATVectorMatcher.getTutorSAI() unexpected no. of details: "+
a)}return c};this.getInputMatcher=function(){var a=h[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?m.getDefaultInput():a.toString()};this.getActionMatcher=function(){var a=g[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?m.getDefaultAction():a.toString()};this.getSelectionMatcher=function(){var a=c[0];return a instanceof CTATExactMatcher&&a.toString()==="".toString()?m.getDefaultSelection():a.toString()};this.getSingleMatcher=function(a){return"selection".toString().toUpperCase()===
a.toString().toUpperCase()?c[0]:"action".toString().toUpperCase()===a.toString().toUpperCase()?g[0]:h[0]};var r=m.getDefaultSAI;this.getDefaultSAI=function(){var a=r.apply(m),b=0<c.length&&c[0]instanceof CTATExactMatcher?c[0].getSingle():a.getSelection(),d=0<g.length&&g[0]instanceof CTATExactMatcher?g[0].getSingle():a.getAction(),a=0<h.length&&h[0]instanceof CTATExactMatcher?h[0].getSingle():a.getInput();return new CTATSAI(b,d,a)};this.getSelection=function(){return 0===c.length?m.getDefaultSelection():
c[0].toString()};this.getAction=function(){return 0===g.length?m.getDefaultAction():g[0].getAction()};this.setDefaultSelection=function(a){return 0===c.length?m.internalSetDefaultSelection(a):c[0].setDefaultSelection(a)};this.setDefaultAction=function(a){return 0===g.length?m.internalSetDefaultAction(a):g[0].setDefaultAction(a)};this.setDefaultInput=function(a){return 0===h.length?m.internalSetDefaultInput(a):h[0].setDefaultInput(a)};this.getEvaluatedInput=function(a,b){if(0===h.length)return m.getInput();
var c=h[0];return!1===c instanceof CTATExpressionMatcher?m.getInput():!0===c.isEqualRelation()?c.getEvaluatedInput(a,b):m.getInput()};this.matchForHint=function(a,b,d,e){ctatdebug("CTATVectorMatcher.matchForHint("+a+", "+b+", "+d+", vt)");if(!m.matchActor(d))return!1;b=c[0];return Array.isArray(a)?b.matchConcatenation(a,m.getDefaultActionArray(),m.getDefaultInputArray(),e):b.matchConcatenation([a],m.getDefaultActionArray(),m.getDefaultInputArray(),e)};this.setCaseInsensitive=function(a){ctatdebug("CTATVectorMatcher.setCaseInsensitive("+
a+")");for(var b=0;b<l.length;++b)if(Array.isArray(l[b]))for(var c=0;c<l[b].length;++c)l[b][c].setCaseInsensitive(a);else l[b]instanceof CTATMatcher&&l[b].setCaseInsensitive(a)};this.toString=function(){return"this is CTATVectorMatcher"};this.getReplacementFormula=function(){var a=h[0];return null===a||"undefined"===typeof a?null:a.getReplacementFormula()};this.evaluateReplacement=function(a,b,c){return h[0].evaluateReplacement(a,b,c)};this.setActor(f)};CTATVectorMatcher.prototype=Object.create(CTATMatcher.prototype);
CTATVectorMatcher.prototype.constructor=CTATVectorMatcher;"undefined"!==typeof module&&(module.exports=CTATVectorMatcher);var CTATExampleTracerNodeVisualData=function(){CTATBase.call(this,"ExampleTracerNodeVisualData","visualdata");var a="****",b="undefined",e=-1,f=-1,d=null;this.setID=function(b){a=b};this.getID=function(){return a};this.setLabel=function(a){b=a};this.getLabel=function(){return b};this.setX=function(a){e=a};this.getX=function(){return e};this.setY=function(a){f=a};this.getY=function(){return f};this.setVizReference=function(a){d=a};this.getVizReference=function(){return d}};
CTATExampleTracerNodeVisualData.prototype=Object.create(CTATBase.prototype);CTATExampleTracerNodeVisualData.prototype.constructor=CTATExampleTracerNodeVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNodeVisualData);var CTATExampleTracerNode=function(a,b){CTATBase.call(this,"CTATExampleTracerNode",a);var e=null,f="",d=b?b:new Set,c=new Set;d.forEach(function(a,b,d){b.isCorrect()&&c.add(b)});var g=new Set,h=this;this.toString=function(){return"node"+a};this.getNodeID=function(){return a};this.getNodeName=function(){return f};this.setNodeName=function(a){h.ctatdebug("CTATExampleTracerGraph --\x3e in setNodeName("+a+")");f=a};this.getOutLinks=function(){ctatdebug("CTATExampleTracerNode --\x3e getOutLinks");return d};
this.getCorrectOutLinks=function(){return c};this.addOutLink=function(a){ctatdebug("CTATExampleTracerNode --\x3e addOutLink( "+a+" )");d.add(a);a.isCorrect()&&c.add(a)};this.clearInLinks=function(){g=new Set};this.addInLink=function(a){g.add(a)};this.getInLinks=function(){return g};this.getOutDegree=function(){return d.size};this.getCorrectOutDegree=function(){return c.size};this.setVisualData=function(a){e=a};this.getVisualData=function(){return e}};CTATExampleTracerNode.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerNode.prototype.constructor=CTATExampleTracerNode;"undefined"!==typeof module&&(module.exports=CTATExampleTracerNode);var CTATExampleTracerLinkVisualData=function(){CTATBase.call(this,"CTATExampleTracerLinkVisualData","visualdata");var a="****",b="undefined",e="****",f="****";this.setID=function(b){a=b};this.getID=function(){return a};this.setLabel=function(a){b=a};this.getLabel=function(){return b};this.setSource=function(a){e=a};this.getSource=function(){return e};this.setDestination=function(a){f=a};this.getDestination=function(){return f}};CTATExampleTracerLinkVisualData.prototype=Object.create(CTATBase.prototype);
CTATExampleTracerLinkVisualData.prototype.constructor=CTATExampleTracerLinkVisualData;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkVisualData);var CTATExampleTracerLink=function(a,b,e){CTATBase.call(this,"CTATExampleTracerLink","("+b+"-"+e+")");var f="undefined"===typeof a||null===a?null:a,d=null,c="undefined"===typeof b||null===b?null:b,g="undefined"===typeof e||null===e?null:e,h=null,l=1,m=1,r="CORRECT_ACTION",p=[],x=!1,q=null,u="",n=null,B=null,v=this;this.getUniqueID=function(){return f};this.getMatcher=function(){v.ctatdebug("CTATExampleTracerLink --\x3e in getMatcher");return h};this.isCorrect=function(){return r==CTATExampleTracerLink.CORRECT_ACTION};
this.matchesSAI=function(a,b,c){var d=v.getMatcher();v.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAI(); matcher "+d+", typeof "+typeof d+", sai "+a);a=d.match(a.getSelectionArray(),a.getActionArray(),a.getInputArray(),b,c);v.ctatdebug("CTATExampleTracerLink --\x3e out of matchesSAI: result = "+a);return a};this.matchesSAIforHint=function(a,b,c,d){v.ctatdebug("CTATExampleTracerLink --\x3e in matchesSAIforHint("+a+", "+b+") selectionArray "+a.getSelectionArray());if(!1===v.getMatcher().matchForHint(a.getSelectionArray(),
a.getActionArray(),b,d))return v.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false because no match"),!1;if(null!==c&&"undefined"!==typeof c&&!0===c.getWantReportableHints()&&(a=null===v.getAllHints()||"undefined"===typeof v.getAllHints()?0:v.getAllHints().length,1>a))return v.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning false nStaticHints "+a+"< 1"),!1;v.ctatdebug("CTATExampleTracerLink --\x3e matchesSAIforHint() returning true");return!0};this.getDepth=
function(){return d};this.getBuggyMsg=function(){return u};this.getSuccessMsg=function(){return q};this.getType=function(){return r};this.getPrevNode=function(){return c};this.getNextNode=function(){return g};this.setPrevNode=function(a){c=a};this.setNextNode=function(a){g=a};this.toString=function(){var a;a="[link "+v.getUniqueID();a+=" ("+v.getPrevNode()+"-"+v.getNextNode();a+=") "+v.getType();return a+"]"};this.getTutorSAI=function(a,b){return v.getMatcher().getTutorSAI(a,b,v.getActionType())};
this.getEvaluatedInput=function(a,b){return v.getMatcher().getEvaluatedInput(a,b)};this.setDepth=function(a){d=a};this.getMaxTraversals=function(){return l};this.isDone=function(){var a=String(v.getDefaultSAI().getSelection()).toLowerCase(),b=String(v.getDefaultSAI().getAction()).toLowerCase(),a=CTATMsgType.DONE.toLowerCase()==a&&CTATMsgType.BUTTON_PRESSED.toLowerCase()==b;v.ctatdebug("CTATExampleTracerLink.isDone() returns "+a);return a};this.interpolateHints=function(a){v.ctatdebug("CTATExampleTracerLink --\x3e interpolateHints("+
a+")");var b=[];if(null===p||"undefined"===typeof p||0===p.length)return b;null==a&&(a=new CTATVariableTable);var c=new CTATFormulaParser(a);p.forEach(function(a){if(!(1>String(a).trim().length)){var d=v.getDefaultSAI().getSelection(),e=v.getDefaultSAI().getAction(),f=CTATVariableTable.standardizeType(v.getDefaultSAI().getInput());v.ctatdebug("CTATExampleTracerLink.interpolateHints() calling fp.interpolate("+a+", "+d+", "+e+", "+f+")");a=c.interpolate(a,d,e,f);v.ctatdebug("CTATExampleTracerLink.interpolateHints() calling fp.interpolate() returns "+
a);b.push(a)}});v.ctatdebug("CTATExampleTracerLink --\x3e out of interpolateHints "+b);return b};this.getHints=function(){v.ctatdebug("CTATExampleTracerLink --\x3e in getHints");var a=[];v.interpolateHints(null).forEach(function(b){v.ctatdebug("CTATExampleTracerLink --\x3e in getHints loop");b.toString()!=="".toString()&&a.push(b)});v.ctatdebug("CTATExampleTracerLink --\x3e out of getHints");return a};this.getAllNonEmptyHints=function(){var a=[];p.forEach(function(b){b.trim().toString()!=="".toString()&&
a.push(b)});return a};this.isTraversable=function(){return 1>v.getMaxTraversals()?!1:CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()==v.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()==v.getActionType().toString().toUpperCase()?!0:!1};this.replaceInput=function(){return CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()!==v.getActionType().toString().toUpperCase()&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()!==
v.getActionType().toString().toUpperCase()?!1:v.getMatcher().replaceInput()};this.evaluateReplacement=function(a,b,c){return v.getMatcher().evaluateReplacement(a,b,c)};this.getActor=function(){return v.getMatcher().getActor()};this.getDefaultSAI=function(){v.ctatdebug(v.toString()+".getSAI(): "+(h?h.getDefaultSAI():"(matcher null)"));return h.getDefaultSAI()};this.getActionType=function(){return r};this.getMinTraversals=function(){return m};this.getIsPreferredLink=function(){return x};this.getAllHints=
function(){return p};this.setMatcher=function(a){h=a};this.addHint=function(a){null!==a&&"undefined"!==typeof a&&a.toString()!=="".toString()&&p.push(a)};this.setSelection=function(a){v.getMatcher().setDefaultSelection(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setAction=function(a){v.getMatcher().setDefaultAction(null===a[0]||"undefined"===typeof a[0]?"":a[0].toString())};this.setActionType=function(a){if(null===a||"undefined"===typeof a||a.toString()!==CTATExampleTracerLink.CORRECT_ACTION.toString()&&
a.toString()!==CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.HINT_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.UNTRACEABLE_ERROR.toString()&&a.toString()!==CTATExampleTracerLink.CLT_ERROR_ACTION.toString()&&a.toString()!==CTATExampleTracerLink.GIVEN_ACTION.toString())throw new CTATExampleTracerException("invalid action type "+r);r=a};this.setBuggyMsg=function(a){u=a};this.setSuccessMsg=
function(a){q=a};this.setMinTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)m=1;else try{m=parseInt(a.trim()),isNaN(m)&&(m=1)}catch(A){m=1}};this.setMaxTraversalsStr=function(a){if(null===a||"undefined"===typeof a||1>a.length)l=m;else try{l=parseInt(a.trim()),isNaN(l)&&(l=1)}catch(A){l=m}};this.setUniqueID=function(a){f=a};this.addSkillName=function(a){v.ctatdebug("ETLink["+f+"].addSkillName("+a+")");if("unnamed"!==a){if(null===B||"undefined"===typeof B)B=[];-1<B.indexOf(a)||
(B.push(a),v.ctatdebug("ETLink.addSkillName() return with skillNames "+B))}};this.getSkillNames=function(){if(null===B||"undefined"===typeof B)B=[];return B};this.isTutorPerformed=function(a){if(CTATExampleTracerLink.CORRECT_ACTION.toUpperCase()!==v.getActionType().toUpperCase())return!1;var b=v.getMatcher();if(null===b||"undefined"===typeof b||null!==a&&"undefined"!==typeof a&&a!==b.isLinkTriggered())return!1;a=v.getActor();return CTATMatcher.isTutorActor(a,!0)?!0:!1};this.setIsPreferredLink=function(a){v.ctatdebug("ETLink.setIsPreferredLink() was "+
x+", now "+a);x=a};this.setVisualData=function(a){n=a};this.getVisualData=function(){return n}};
CTATExampleTracerLink.compareLinkTypes=function(a,b){ctatdebug("CTATExampleTracerLink --\x3e in compareLinkTypes("+a+", "+b+")");return null===a||"undefined"===typeof a?null===b||"undefined"===typeof b?0:1:null===b||"undefined"===typeof b?-1:a.toString()===b.toString()?0:a.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?-1:b.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()?1:a.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?-1:b.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()?
1:a.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?-1:b.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()?1:0};Object.defineProperty(CTATExampleTracerLink,"BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Buggy Action"});Object.defineProperty(CTATExampleTracerLink,"FIREABLE_BUGGY_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Fireable Buggy Action"});
Object.defineProperty(CTATExampleTracerLink,"CORRECT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Correct Action"});Object.defineProperty(CTATExampleTracerLink,"NO_MODEL",{enumerable:!1,configurable:!1,writable:!1,value:"NO-MODEL"});Object.defineProperty(CTATExampleTracerLink,"HINT_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Hint Action"});Object.defineProperty(CTATExampleTracerLink,"UNTRACEABLE_ERROR",{enumerable:!1,configurable:!1,writable:!1,value:"Untraceable Error"});
Object.defineProperty(CTATExampleTracerLink,"CLT_ERROR_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Error Action"});Object.defineProperty(CTATExampleTracerLink,"GIVEN_ACTION",{enumerable:!1,configurable:!1,writable:!1,value:"Given Action"});Object.defineProperty(CTATExampleTracerLink,"SUCCESS",{enumerable:!1,configurable:!1,writable:!1,value:"SUCCESS"});CTATExampleTracerLink.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLink.prototype.constructor=CTATExampleTracerLink;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerLink);var CTATExampleTracerPathComparator=function(){CTATBase.call(this,"CTATExampleTracerPathComparator","");var a=this;this.compare=function(b,e){a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare");a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isDonePath(): "+b.isDonePath());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isDonePath(): "+e.isDonePath());if(!0===b.isDonePath()&&!1===e.isDonePath())return-1;if(!0===e.isDonePath()&&!1===b.isDonePath())return 1;
a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.isIncorrectPath(): "+e.isIncorrectPath());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.isIncorrectPath()(): "+b.isIncorrectPath());if(!0===e.isIncorrectPath()&&!1===b.isIncorrectPath())return-1;if(!0===b.isIncorrectPath()&&!1===e.isIncorrectPath())return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredPrefixLinks(): "+b.getNumberOfPreferredPrefixLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredPrefixLinks(): "+
e.getNumberOfPreferredPrefixLinks());var f=b.getNumberOfPreferredPrefixLinks(),d=e.getNumberOfPreferredPrefixLinks();if(f>d)return-1;if(f<d)return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfSuboptimalLinks(): "+b.getNumberOfSuboptimalLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfSuboptimalLinks(): "+e.getNumberOfSuboptimalLinks());f=b.getNumberOfSuboptimalLinks();d=e.getNumberOfSuboptimalLinks();if(f<d)return-1;if(f>d)return 1;
a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getNumberOfPreferredLinks(): "+b.getNumberOfPreferredLinks());a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p2.getNumberOfPreferredLinks(): "+e.getNumberOfPreferredLinks());f=b.getNumberOfPreferredLinks();d=e.getNumberOfPreferredLinks();if(f>d)return-1;if(f<d)return 1;f=b.getLinks().size;d=e.getLinks().size;a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+f);a.ctatdebug("CTATExampleTracerPathComparator --\x3e in compare p1.getLinks().size: "+
d);if(f<d)return-1;if(f>d)return 1;a.ctatdebug("CTATExampleTracerPathComparator --\x3e out of comapre, about to call breakByLowerLinkID");return a.breakByLowerLinkID(b,e)};this.breakByLowerLinkID=function(b,e){a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID");var f=b.getSortedLinks(),d=e.getSortedLinks(),c=null,g=null,h=0,l=0;do a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID in do while"),l>=f.length?(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 1 is shorter"),
h=-1):l>=d.length?(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path 2 is shorter"),h=1):(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID path are same, compare IDS"),c=f[l],g=d[l]),l++;while(0===h&&c.getUniqueID()===g.getUniqueID());0===h&&(a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+c.getUniqueID()),a.ctatdebug("CTATExampleTracerPathComparator --\x3e in breakByLowerLinkID result is zero: "+g.getUniqueID()),
h=c.getUniqueID()<g.getUniqueID()?-1:1);return h}};CTATExampleTracerPathComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPathComparator.prototype.constructor=CTATExampleTracerPathComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPathComparator);var CTATExampleTracerPath=function(a){CTATBase.call(this,"CTATExampleTracerPath","");var b=new Set;"undefined"!==typeof a&&null!==a&&a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in constructor building links with "+a);b.add(a)});var e=null,f=null,d=null,c=null,g=null,h=null,l=this;this.isIncorrectPath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isIncorrectPath");if(null!==h&&"undefined"!==typeof h)return h;var a=!1;l.getLinks().forEach(function(b){!0!==a&&b.getType().toString()===
CTATExampleTracerLink.BUGGY_ACTION.toString()&&(a=h=!0)});if(!0===a)return!0;h=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isIncorrectPath");return!1};this.getNumberOfSuboptimalLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfSuboptimalLinks");l.getSortedLinks();if(null!==c&&"undefined"!==typeof c)return c;var a=0;l.getLinks().forEach(function(b){CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()===b.getType().toString()&&a++});c=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfSuboptimalLinks");
return a};this.getNumberOfPreferredPrefixLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredPrefixLinks");if(null!==f&&"undefined"!==typeof f)return f;var a=0,b=!1;l.getSortedLinks().forEach(function(c){!0!==b&&(!0===c.getIsPreferredLink()?a++:b=!0)});f=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredPrefixLinks");return a};this.size=function(){return b.size};this.containsAll=function(a){var b=!0;if(a)for(var c=0;b&&c<a.length;++c)b=l.getLinks().has(a[c]);
l.ctatdebug("CTATExampleTracerPath containsAll(testLinks.length "+a.length+") returning "+b);return b};this.getLinksRestricted=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getLinksRestricted");var c=CTATExampleTracerPath.getDeepestLink(a),d=new Set;b.forEach(function(a){a.getDepth()<=c.getDepth()&&d.add(a)});ctatdebug("CTATExampleTracerPath --\x3e out of getLinksRestricted");return d};this.getLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getLinks");return b};this.getSortedLinks=
function(){ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks that.getLinks(): "+l.getLinks());e=[];l.getLinks().forEach(function(a){e.push(a)});ctatdebug("CTATExampleTracerPath --\x3e in getSortedLinks sortedLinks.length(): "+e.length);e.sort(function(a,b){return a.getDepth()-b.getDepth()});ctatdebug("CTATExampleTracerPath --\x3e out of getSortedLinks, returning "+e);return e};this.isDonePath=function(){ctatdebug("CTATExampleTracerPath --\x3e in isDonePath");if(null!==g&&"undefined"!==typeof g)return g;
var a=!1;l.getLinks().forEach(function(b){!0!==a&&!0===b.isDone()&&(a=g=!0)});if(!0===a)return!0;g=!1;ctatdebug("CTATExampleTracerPath --\x3e out of isDonePath");return!1};this.addLink=function(a){ctatdebug("CTATExampleTracerPath --\x3e in addLink ("+a+")");b.add(a);h=g=c=d=f=e=null;ctatdebug("CTATExampleTracerPath --\x3e out of addLink")};this.getNumberOfPreferredLinks=function(){ctatdebug("CTATExampleTracerPath --\x3e in getNumberOfPreferredLinks");if(null!==d&&"undefined"!==typeof d)return d;var a=
0;l.getLinks().forEach(function(b){!0===b.getIsPreferredLink()&&a++});d=a;ctatdebug("CTATExampleTracerPath --\x3e out of getNumberOfPreferredLinks");return a};this.subpath=function(a){for(var b=new CTATExampleTracerPath,c=l.getSortedLinks(),d=0;d<c.length;++d)if(b.addLink(c[d]),c[d].getNextNode()==a.getNodeID())return b;return null};this.toString=function(){var a="CTATExampleTracerPath: links";l.getSortedLinks().forEach(function(b){a+=" "+b});return a};CTATExampleTracerPath.getDeepestLink=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getDeepestLink");
var b=null;a.forEach(function(a){if(null===b||"undefined"===typeof b||b.getDepth()<a.getDepth())b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getDeepestLink");return b};CTATExampleTracerPath.getBestPath=function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath");var b=null,c=new CTATExampleTracerPathComparator;a.forEach(function(a){ctatdebug("CTATExampleTracerPath --\x3e in getBestPath loop");if(null===b||"undefined"===typeof b||0<c.compare(b,a))b=a});ctatdebug("CTATExampleTracerPath --\x3e out of getBestPath");
return b}};CTATExampleTracerPath.prototype=Object.create(CTATBase.prototype);CTATExampleTracerPath.prototype.constructor=CTATExampleTracerPath;"undefined"!==typeof module&&(module.exports=CTATExampleTracerPath);var CTATLinkGroup=function(){CTATBase.call(this,"CTATLinkGroup","")};CTATLinkGroup.prototype=Object.create(CTATBase.prototype);CTATLinkGroup.prototype.constructor=CTATLinkGroup;"undefined"!==typeof module&&(module.exports=CTATLinkGroup);var CTATDefaultLinkGroup=function(a,b,e,f){CTATLinkGroup.call(this,"CTATDefaultLinkGroup",a);var d=a,c=b,g=e,h=new Set;null!==f&&"undefined"!==typeof f&&f.forEach(function(a){h.add(a)});var l=new Set,m=null,r=null,p=this;p.ctatdebug("CTATDefaultLinkGroup constructor group name: "+a);p.ctatdebug("CTATDefaultLinkGroup constructor group isOrdered: "+b);p.ctatdebug("CTATDefaultLinkGroup constructor group isReenterable: "+e);this.setOrdered=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered group name: "+
d);p.ctatdebug("CTATDefaultLinkGroup --\x3e in setOrdered:: "+a);c=a};this.setName=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setName: "+a);d=a};this.containsLink=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in containsLink: "+a.getUniqueID());return h.has(a)};this.removeLink=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in removeLink: "+a.getUniqueID());return h["delete"](a)};this.getParent=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getParent");return m};this.addLink=
function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in addLink: "+a.getUniqueID());h.add(a)};this.getIsOrdered=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsOrdered: "+c);return c};this.getIsReenterable=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getIsReenterable: "+g);return g};this.getSubgroups=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getSubgroups");return l};this.getLinks=function(){p.ctatdebug("CTATDefaultLinkGroup --\x3e in getLinks");return h};this.setReenterable=
function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setReenterable: "+a);g=a};this.setParent=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in setParent: "+a.getName());m=a};this.addSubgroup=function(a){p.ctatdebug("CTATDefaultLinkGroup --\x3e in addSubgroup groupName: "+a.getName());l.add(a)};this.getName=function(){return d};this.getDefaultBuggyMsg=function(){return r};this.setDefaultBuggyMsg=function(a){r=""==a?null:a};this.toString=function(){return"Group Name: "+this.getName()}};
CTATDefaultLinkGroup.prototype=Object.create(CTATLinkGroup.prototype);CTATDefaultLinkGroup.prototype.constructor=CTATDefaultLinkGroup;"undefined"!==typeof module&&(module.exports=CTATDefaultLinkGroup);var InternalGroupIterator=function(a,b){CTATBase.call(this,"InternalGroupIterator",a);var e=this,f=b.length,d=[],c=0;a.getSubgroups().forEach(function(a){a&&d.push(a)});b.push(e);e.ctatdebug("InternalGroupIterator() constructor group "+a+", stack.length "+b.length+", sgList.length "+d.length);this.toString=function(){return"{"+a+" at "+f+" with "+d.length+" subgroups}"};this.next=function(){return c>=d.length?(b.pop(),e.ctatdebug("InternalGroupIterator at deepest next() returning "+a+" with stack.length "+
b.length),{value:a,done:!1}):(new InternalGroupIterator(d[c++],b)).next()}};InternalGroupIterator.prototype=Object.create(CTATBase.prototype);InternalGroupIterator.prototype.constructor=InternalGroupIterator;var CTATGroupIterator=function(a){CTATBase.call(this,"CTATGroupIterator",a);this.ctatdebug("CTATGroupIterator("+a+") begin constructor");var b=null;this.next=function(){null===b&&(b=[],new InternalGroupIterator(a,b));return 0>=b.length?{value:null,done:!0}:b[b.length-1].next()}};
CTATGroupIterator.prototype=Object.create(CTATBase.prototype);CTATGroupIterator.prototype.constructor=CTATGroupIterator;"undefined"!==typeof module&&(module.exports=CTATGroupIterator);var CTATGroupModel=function(){CTATBase.call(this,"CTATGroupModel","");var a=this;this.clear=function(){};this.setDefaultReenterable=function(a){};this.setGroupOrdered=function(a,e){};this.getTopLevelGroup=function(){};this.setGroupName=function(a,e){};this.addLinkToGroup=function(a,e){};this.isGroupOrdered=function(a){};this.isGroupReenterable=function(a){};this.isLinkInGroup=function(){};this.getGroupsContainingLink=function(a){};this.getGroupLinkCount=function(b){return a.getGroupLinks(b).size};
this.getLowestLevelGroupOfLink=function(a){};this.getGroupSubgroups=function(a){};this.getUniqueLinks=function(a){};this.getGroupLinks=function(a){};this.removeLinkFromGroup=function(a,e){};this.getGroupParent=function(a){};this.addGroup=function(a,e,f){};this.setGroupReenterable=function(a,e){}};CTATGroupModel.prototype=Object.create(CTATBase.prototype);CTATGroupModel.prototype.constructor=CTATGroupModel;"undefined"!==typeof module&&(module.exports=CTATGroupModel);var CTATDefaultGroupModel=function(){function a(a,c,d){l.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroupRecursive");!0===a.containsLink(c)&&(l.getGroupSubgroups(a).forEach(function(a){l.removeLinkFromGroup(a,c)}),(a!==g||d)&&b(a,c))}function b(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in internalRemoveLinkFromGroup");return a.removeLink(b)}function e(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in getImmediateGroupOfLink");var c=null,d=!1,f=null;l.getGroupSubgroups(b).forEach(function(b){!0!==
d&&!0===l.isLinkInGroup(b,a)&&(c=e(a,b),f=null!==c&&"undefined"!==typeof c?c:b,d=!0)});return!0===d?f:null}function f(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in getNaturalContainingGroup");if(b.size===l.getGroupLinks(a).size)throw l.getGroupLinks(a).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}),new CTATExampleTracerException("Group containing this set of links already exists: "+a);if(b.size>=l.getGroupLinks(a).size)throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+
a);var c=!1,d=null;b.forEach(function(e){if(!0!==c){if(!1===l.isLinkInGroup(a,e))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);l.getGroupSubgroups(a).forEach(function(g){!0!==c&&!0===l.isLinkInGroup(g,e)&&(l.getGroupLinkCount(g)>=b.size?(d=f(g,b),c=!0):l.getGroupLinks(g).forEach(function(c){if(!1===b.has(c))throw new CTATExampleTracerException("Invalid link selection: Partial overlap with existing group: "+a);}))})}});return!0===c?d:a}function d(a,
b){l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity parent: "+a.getName());l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity child: "+b.getName());l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroupPreserveSanity size: "+l.getGroupSubgroups(a).size);l.getGroupSubgroups(a).forEach(function(d){var e=l.getGroupLinks(d);if(0===e.size)l.getGroupSubgroups(a)["delete"](d),c(b,d);else{var f=null,g=!1;e.forEach(function(a){!1===g&&(f=a,g=!0)});!0===l.isLinkInGroup(b,
f)&&(l.getGroupSubgroups(a)["delete"](d),c(b,d))}});c(a,b)}function c(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in addSubgroup");a.addSubgroup(b);b.setParent(a)}CTATGroupModel.call(this);var g=null,h=!1,l=this;this.clear=function(){l.ctatdebug("CTATDefaultGroupModel --\x3e in clear");g=new CTATDefaultLinkGroup("defaultName",!0,h,null)};this.setDefaultReenterable=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in setDefaultReenterable");h=a};this.setGroupOrdered=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupOrdered");
a.setOrdered(b)};this.getTopLevelGroup=function(){ctatdebug("CTATDefaultGroupModel --\x3e in getTopLevelGroup");return g};this.setGroupName=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupName");a.setName(b)};this.addLinkToGroup=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in addLinkToGroup");for(l.removeLinkFromGroup(g,b);null!==a&&"undefined"!==typeof a;a=l.getGroupParent(a)){var c=a,d=b;l.ctatdebug("CTATDefaultGroupModel --\x3e in internalAddLinkToGroup");c.addLink(d)}};
this.isGroupOrdered=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered group name: "+a.getName());l.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupOrdered: "+a.getIsOrdered());return a.getIsOrdered()};this.isGroupReenterable=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in isGroupReenterable");return a.getIsReenterable()};this.isLinkInGroup=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in isLinkInGroup");return a.containsLink(b)};this.getGroupsContainingLink=
function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink("+a+"): TopLevel "+g+", typeof(TopLevel) "+typeof g);var b=new Set,c=new CTATGroupIterator(g);l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink before loop: groupIter "+c+", typeof(groupIter) "+typeof c);for(var d=c.next();!d.done;d=c.next())d=d.value,!0===l.isLinkInGroup(d,a)&&b.add(d);l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupsContainingLink returning groups.size "+b.size);return b};this.getLowestLevelGroupOfLink=
function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getLowestLevelGroupOfLink");var b=e(a,g);return null!==b&&"undefined"!==typeof b?b:!0===l.isLinkInGroup(g,a)?g:null};this.getGroupSubgroups=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupSubgroups");return null!==a&&"undefined"!==typeof a?a.getSubgroups():null};this.getUniqueLinks=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getUniqueLinks");var b=new Set;l.getGroupLinks(a).forEach(function(a){b.add(a)});l.getGroupSubgroups(a).forEach(function(a){l.getGroupLinks(a).forEach(function(a){b["delete"](a)})});
return b};this.getGroupLinks=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupLinks: "+a.getName());return a.getLinks()};this.removeLinkFromGroup=function(b,c){l.ctatdebug("CTATDefaultGroupModel --\x3e in removeLinkFromGroup");a(b,c,!1)};this.getGroupParent=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupParent");return a.getParent()};this.addGroup=function(a,b,c){l.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup");var e=null;try{e=f(g,c)}catch(q){return q.toString()}a=
new CTATDefaultLinkGroup(a,b,h,c);l.ctatdebug("CTATDefaultGroupModel --\x3e in addGroup after creating new group");d(e,a);return""};this.setGroupReenterable=function(a,b){l.ctatdebug("CTATDefaultGroupModel --\x3e in setGroupReenterable");a.setReenterable(b)};this.createIdToLinkMap=function(){l.ctatdebug("CTATDefaultGroupModel --\x3e in createIdToLinkMap");var a={};l.getGroupLinks(g).forEach(function(b){a[b.getUniqueID()]=b});return a};this.getGroupByName=function(a){l.ctatdebug("CTATDefaultGroupModel --\x3e in getGroupByName TopLevel has: "+
g.getSubgroups().size);for(var b=new CTATGroupIterator(g),c=b.next();!c.done;c=b.next())if(c=c.value,l.getGroupName(c).toString()===a.toString())return c;return null};this.getGroupName=function(a){return a.getName()};l.clear()};CTATDefaultGroupModel.prototype=Object.create(CTATGroupModel.prototype);CTATDefaultGroupModel.prototype.constructor=CTATDefaultGroupModel;"undefined"!==typeof module&&(module.exports=CTATDefaultGroupModel);var CTATMatcherComparator=function(){CTATBase.call(this,"CTATMatcherComparator","");CTATMatcherComparator.compare=function(a,b){ctatdebug("CTATMatcherComparator--\x3e in compare");var e=CTATMatcherComparator.compareBasedOnType(a,b);if(0!==e||!1===a instanceof CTATVectorMatcher&&!1===b instanceof CTATVectorMatcher)return e;e=CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("input"),b.getSingleMatcher("input"));if(0!==e)return e;e=CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("selection"),
b.getSingleMatcher("selection"));return 0!==e?e:CTATMatcherComparator.compareBasedOnType(a.getSingleMatcher("action"),b.getSingleMatcher("action"))};CTATMatcherComparator.compareBasedOnType=function(a,b){ctatdebug("CTATMatcherComparator --\x3e in compareBasedOnType");for(var e in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(e)&&a instanceof CTATMatcherComparator.matcherPrecedenceOrder[e])break;for(var f in CTATMatcherComparator.matcherPrecedenceOrder)if(CTATMatcherComparator.matcherPrecedenceOrder.hasOwnProperty(f)&&
b instanceof CTATMatcherComparator.matcherPrecedenceOrder[f])break;return e<f?1:e>f?-1:0}};Object.defineProperty(CTATMatcherComparator,"matcherPrecedenceOrder",{enumerable:!1,configurable:!1,writable:!1,value:{0:CTATExactMatcher,1:CTATRangeMatcher,2:CTATExpressionMatcher,3:CTATWildcardMatcher,4:CTATRegexMatcher,5:CTATAnyMatcher}});CTATMatcherComparator.prototype=Object.create(CTATBase.prototype);CTATMatcherComparator.prototype.constructor=CTATMatcherComparator;
"undefined"!==typeof module&&(module.exports=CTATMatcherComparator);new CTATMatcherComparator;var CTATExampleTracerLinkComparator=function(a,b){CTATBase.call(this,"CTATExampleTracerLinkComparator","");this.compare=function(e,f){ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+e.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+f.getUniqueID());var d=e.getType(),c=f.getType(),d=CTATExampleTracerLink.compareLinkTypes(d,c);if(0!==d)return ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare m: "+d),d;d=b.nonEmptyHints(e,
a.getVariableTable());c=b.nonEmptyHints(f,a.getVariableTable());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare h1, h2: "+d+", "+c);if(0<d&&0>=c)return-1;if(0>=d&&0<c)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getDepth(), l2.getDepth(): "+e.getDepth()+", "+f.getDepth());if(e.getDepth()<f.getDepth())return-1;if(e.getDepth()>f.getDepth())return 1;d=a.getTraversalCount(e)-e.getMinTraversals();c=a.getTraversalCount(f)-f.getMinTraversals();ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare tc1, tc2: "+
d+", "+c);if(0>d&&0<=c)return-1;if(0<=d&&0>c)return 1;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getIsPreferredLink(): "+e.getIsPreferredLink());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getIsPreferredLink(): "+f.getIsPreferredLink());if(e.getIsPreferredLink())return-1;if(f.getIsPreferredLink())return 1;if(0!==(d=CTATMatcherComparator.compare(e.getMatcher(),f.getMatcher())))return d;ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l1.getUniqueID(): "+
e.getUniqueID());ctatdebug("CTATExampleTracerLinkComparator --\x3e in compare l2.getUniqueID(): "+f.getUniqueID());return e.getUniqueID()<f.getUniqueID()?-1:1}};CTATExampleTracerLinkComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerLinkComparator.prototype.constructor=CTATExampleTracerLinkComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerLinkComparator);var CTATExampleTracerEvent=function(a,b,e){CTATBase.call(this,"CTATExampleTracerEvent",b?b.toString():"null");var f="",d=!1,c=CTATExampleTracerLink.NO_MODEL,g=!1,h=null,l=null,m="student",r=null,p=null,x="",q=null,u=null,n=null,B=null,v=null,z=[],A=!1,D=null,H=null,w=this;this.getActor=function(){return m};this.setActor=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e setActor("+a+")");m=a};this.getStudentSAI=function(){w.ctatdebug("CTATExampleTracerEvent.getStudentSAI() returning type "+typeof h+
", value "+h);return h};this.setStudentSAI=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setStudentSAI("+a+")");null!==a&&"undefined"!==typeof a&&(h=a);w.ctatdebug("CTATExampleTracerEvent --\x3e out of setStudentSAI")};this.getPreloadedLinkMatches=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getPreloadedLinkMatches");return u};this.setTutorSAI=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setTutorSAI");null!==a&&"undefined"!==typeof a&&(l=a);w.ctatdebug("CTATExampleTracerEvent --\x3e out of setTutorSAI")};
this.setNumberOfInterpretations=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setNumberOfInterpretations( "+a+" )")};this.getTransactionID=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getTransactionID() returning "+f);return f};this.setTransactionID=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setTransactionID( "+a+" )");f=a};this.setDoneStepFailed=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setDoneStepFailed( "+a+" )");d=a};this.setHintRequest=function(a){g=
a};this.getHintRequest=function(){return g};this.setResult=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setResult( "+a+" )");c=a};this.isSolverResult=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in isSolverResult");return!1};this.getResult=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getResult() returning "+c);return c};this.setReportableLink=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableLink("+a+")");r=a};this.setReportableInterpretation=
function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableInterpretation("+a+")");p=a};this.setStepID=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setStepID("+a+")");x=a?a.toString():""};this.setReportableVariableTable=function(a){B=a.clone()};this.setSuccessOrBuggyMsg=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setSuccessOrBuggyMsg("+a+")");v=a};this.setReportableHints=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setReportableHints("+a+")");z=
Array.isArray(a)&&0<a.length?a:[]};this.getWantReportableHints=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getWantReportableHints() returning "+A);return A};this.setOutOfOrder=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setOutOfOrder("+a+")");q=a};this.isOutOfOrder=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getOutOfOrder() returning "+q);return q};this.setEvaluatedInput=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setEvaluatedInput("+a+")");if(null===
n||"undefined"===typeof n)n=[];n.push(a)};this.addPreloadedLinkMatch=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in addPreloadedLinkMatch("+a+")");if(null===u||"undefined"===typeof u)u=[];u.push(a)};this.setInterpolatedSAI=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedSAI("+a+")");a&&(D=a)};this.getInterpolatedSAI=function(){return D?D:w.getStudentSAI()};this.setInterpolatedHints=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setInterpolatedHints("+
a+")");null!==H&&"undefined"!==typeof H&&(H.length=0);null!==a&&"undefined"!==typeof a&&(H=a.slice(0));w.ctatdebug("CTATExampleTracerEvent --\x3e out of setInterpolatedHints")};this.setWantReportableHints=function(a){w.ctatdebug("CTATExampleTracerEvent --\x3e in setWantReportableHints("+a+")");A=a};this.getSuccessOrBuggyMsg=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getSuccessOrBuggyMsg() returning "+v);return v};this.getReportableHints=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableHints() returning "+
z);return z};this.getReportableLink=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableLink() returning "+r);return r};this.getReportableVariableTable=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableVariableTable() returning "+B);return B};this.getReportableInterpretation=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getReportableInterpretation() returning "+p);return p};this.getStepID=function(){w.ctatdebug("CTATExampleTracerEvent --\x3e in getStepID() returning "+
x);return x};this.getTutorSelection=function(){return null===l||"undefined"===typeof l?null:l.getSelectionArray()};this.getTutorAction=function(){return null===l||"undefined"===typeof l?null:l.getActionArray()};this.getTutorInput=function(){return null!==n&&"undefined"!==typeof n?w.getEvaluatedInputArray():null!==l&&"undefined"!==typeof l?l.getInputArray():null};this.getEvaluatedInputArray=function(){return n};this.toString=function(){var a;a="["+w.getResult();null!==w.getStudentSAI()&&"undefined"!==
typeof w.getStudentSAI()&&(a+=", StudentSAI "+w.getStudentSAI());null!==w.getReportableLink()&&"undefined"!==typeof w.getReportableLink()&&(a+=", reportableLink "+w.getReportableLink());!0===w.isDoneStepFailed()&&(a+=", doneStepFailed");null!==w.getTutorSAI()&&"undefined"!==typeof w.getTutorSAI()&&(a+=", TutorSAI "+w.getTutorSAI());return a+"]"};this.isDoneStepFailed=function(){return d};this.getTutorSAI=function(){return l};this.setStudentSAI(b);this.setActor(e)};
CTATExampleTracerEvent.prototype=Object.create(CTATBase.prototype);CTATExampleTracerEvent.prototype.constructor=CTATExampleTracerEvent;"undefined"!==typeof module&&(module.exports=CTATExampleTracerEvent);var CTATExampleTracerInterpretation=function(a){CTATBase.call(this,"CTATExampleTracerInterpretation","");var b=[],e={},f=new CTATVariableTable,d=new Set;a.forEach(function(a){d.add(a)});var c=CTATExampleTracerLink.CORRECT_ACTION,g=null,h=this;this.getVariableTable=function(){return f};this.setVariableTable=function(a){f=a};this.setLatestHints=function(a,b){h.ctatdebug("In evaluate after calling setInterpolatedHints");if(!Array.isArray(a)||1>a.length)a=b;!Array.isArray(a)||1>a.length||f.put("hints",
a)};this.getLatestHints=function(){return f.get("hints")};this.setLatestBuggyMessage=function(a){!a||1>(a=String(a)).length||f.put("buggy_message",a)};this.setLatestSuccessMessage=function(a){!a||1>(a=String(a)).length||f.put("success_message",a)};this.getLatestBuggyMessage=function(){return f.get("buggy_message")};this.getLatestSuccessMessage=function(){return f.get("success_message")};this.getTraversalCount=function(a){a=e[a.getUniqueID()];return"undefined"===typeof a||null===a?0:a[0]};this.getPaths=
function(){return d};this.clone=function(){var a=new CTATExampleTracerInterpretation(d);a.addTraversedLinks(b);for(var h in e)e.hasOwnProperty(h)&&a.putInlinkIdTraversalCountMap(h,e[h].slice());a.setWorstLinkType(c);h=f.clone();a.setVariableTable(h);g&&a.setPathToDone(new CTATExampleTracerPath(g.getLinks()));ctatdebug("CTATExampleTracerInterpretation --\x3e out of clone");return a};this.addTraversedLinks=function(a){b=b.concat(a)};this.putInlinkIdTraversalCountMap=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap");
ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap key: "+a);ctatdebug("CTATExampleTracerInterpretation --\x3e in putInlinkIdTraversalCountMap value: "+b);e[a]=b};this.setWorstLinkType=function(a){c=a};this.addLink=function(a){!a.isTraversable()||g&&g.getLinks().has(a)||(g=null);ctatdebug("CTATExampleTracerInterpretation.addLink("+(a&&a.getUniqueID())+") pathToDone "+(g&&g.size()));b.push(a);var d=a.getMatcher(),d=null===d||"undefined"===typeof d?1:d.getTraversalIncrement(),
f=e[a.getUniqueID()];null!==f&&"undefined"!==typeof f?f[0]+=d:(f=[],f.push(d),e[a.getUniqueID()]=f);a=a.getType();0>CTATExampleTracerLink.compareLinkTypes(c,a)&&(c=a)};this.setPathToDone=function(a){g=a};this.getPathToDone=function(a){if(g)return g;var c=a.getStartNode();c&&a.getDoneStates().forEach(function(d){g||(g=a.getBestSubpath(c,d,b))});return g};this.countStepsForScore=function(a){var b=Number.MAX_VALUE;(a=h.getPathToDone(a))&&a.getLinks()&&(b=0,a.getLinks().forEach(function(a){if(!CTATMatcher.isTutorActor(a.getActor(),
!0)){var c=h.getTraversalCount(a);a=a.getMinTraversals();b=c>a?b+c:b+a}}));return b};this.updateVariableTable=function(a,b,c){var d=a,e=a.getInput();null!==b&&"undefined"!==typeof b&&(e=b,d=new CTATSAI(a.getSelection(),a.getAction(),e));f.put("link"+c.getUniqueID()+".selection",a.getSelection());f.put("link"+c.getUniqueID()+".action",a.getAction());b="link"+c.getUniqueID()+".input";f.put(b,e);f.put(CTATVariableTable.nameAsString(b),CTATVariableTable.valueAsString(e));if(CTATExampleTracerLink.CORRECT_ACTION.toString().toUpperCase()===
c.getActionType().toString().toUpperCase()||CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString().toUpperCase()===c.getActionType().toString().toUpperCase())a=a.getSelection(),null!==a&&"undefined"!==typeof a&&0<a.length&&f.put(a,e);return d};this.getLastMatchedLink=function(){return 0===b.length?null:b[b.length-1]};this.getMatchedLinks=function(){return b};this.getType=function(){return c};this.isTraversed=function(a,b){ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed: "+a.getUniqueID());
var c=e[a.getUniqueID()];if(null===c||"undefined"===typeof c)return ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (traversalCount === null): "+(null===c)),ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed in if condition (typeof(traversalCount) === 'undefined'): "+("undefined"===typeof c)),!0===b?0>=a.getMinTraversals():!1;ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition traversalCount[0]: "+c[0]);ctatdebug("CTATExampleTracerInterpretation --\x3e in isTraversed out of if condition link.getMinTraversals(): "+
a.getMinTraversals());return c[0]>=a.getMinTraversals()};this.toString=function(){var a="{";b.forEach(function(b){a+=b.getUniqueID()+", "});a.substring(a.length-2,a.length).toString()===", ".toString()&&(a=a.substring(0,a.length-2));a+=" ("+(null===d||"undefined"===typeof d?-1:d.size)+" paths)";a+=" var tbl "+f;return a+="}"}};CTATExampleTracerInterpretation.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretation.prototype.constructor=CTATExampleTracerInterpretation;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretation);var CTATExampleTracerInterpretationComparator=function(){CTATBase.call(this,"CTATExampleTracerInterpretationComparator","");var a=this;this.compare=function(b,e){a.ctatdebug("CTATExampleTracerInterpretationComparator --\x3e in compare");var f=b.getType(),d=CTATExampleTracerLink.compareLinkTypes(f,e.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i1Type: "+b.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing i2Type: "+e.getType());ctatdebug("CTATExampleTracerInterpretationComparator comparing link types result: "+
d);if(0!==d)return ctatdebug("CTATExampleTracerInterpretationComparator result is not equal to 0"),0>d?1:-1;if(CTATExampleTracerLink.BUGGY_ACTION.toString().toUpperCase()===f.toString().toUpperCase()&&(ctatdebug("CTATExampleTracerInterpretationComparator checking for buggy actions"),f=b.getLastMatchedLink(),d=e.getLastMatchedLink(),f=CTATMatcherComparator.compare(f.getMatcher(),d.getMatcher()),0!==f))return f;var d=CTATExampleTracerPath.getBestPath(b.getPaths()),f=CTATExampleTracerPath.getBestPath(e.getPaths()),
c=new Set;c.add(d);c.add(f);d=CTATExampleTracerPath.getBestPath(c);ctatdebug("CTATExampleTracerInterpretationComparator found best path: "+(d===f));d.getLinks().forEach(function(b){a.ctatdebug("My best link==: "+b.getUniqueID())});return d===f?-1:1}};CTATExampleTracerInterpretationComparator.prototype=Object.create(CTATBase.prototype);CTATExampleTracerInterpretationComparator.prototype.constructor=CTATExampleTracerInterpretationComparator;"undefined"!==typeof module&&(module.exports=CTATExampleTracerInterpretationComparator);var CTATExampleTracerTracer_count=0,CTATExampleTracerTracer=function(a,b){function e(a,b,c){if(!a)return a;b=new CTATFormulaParser(b);t.ctatdebug("CTATETT.interpolate("+a+",vt,"+c+")");var d=c.getSelection(),e=c.getAction();c=c.getInput();c=CTATVariableTable.standardizeType(c);t.ctatdebug("CTATETT.interpolate() calling CTATFP.interpolate("+a+", "+d+", "+e+", "+c);a=b.interpolate(a,d,e,c);t.ctatdebug("CTATETT.interpolate() returning "+a);return a}function f(a,b,c,d,f,g){t.ctatdebug("finishEvaluate() doUpdate "+
b+", link "+d+", bestInterp.getLastMatchedLink() "+f.getLastMatchedLink());null==d&&(d=f.getLastMatchedLink());(b||a.getWantReportableHints())&&g.forEach(function(b){var c=b.getLastMatchedLink();c&&(c.getActionType()==CTATExampleTracerLink.CORRECT_ACTION?a.getHintRequest()?a.getWantReportableHints()&&b.setLatestHints(d.interpolateHints(b.getVariableTable()),c.getHints()):b.setLatestSuccessMessage(e(c.getSuccessMsg(),b.getVariableTable(),a.getStudentSAI())):b.setLatestBuggyMessage(e(c.getBuggyMsg(),
b.getVariableTable(),a.getStudentSAI())))});if(b){A.push(a.getStudentSAI());d!=f.getLastMatchedLink()&&(f.addLink(d),a.setResult(d.getActionType()));if(c.toString()===CTATExampleTracerLink.CORRECT_ACTION.toString()||c.toString()===CTATExampleTracerLink.FIREABLE_BUGGY_ACTION.toString()){t.ctatdebug("In evaluate -- in first branch doUpdate()");g.forEach(function(a){a.getLastMatchedLink().getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&(t.ctatdebug("In evaluate -- deleting an incorrect interp"),
g["delete"](a))});t.ctatdebug("In evaluate -- to call setInterpretations(), if 0 < newInterps.size "+g.size);0<g.size&&(p(g),w=f);for(var h in z)z.hasOwnProperty(h)&&delete z[h];t.ctatdebug("In evaluate -- out of DoUpdate if branch")}else{t.ctatdebug("In evaluate -- in else branch of doUpdate");a.setNumberOfInterpretations(0);for(var l in z)z.hasOwnProperty(l)&&delete z[l];g.forEach(function(a){z[a.getLastMatchedLink().getUniqueID()]=a.getLastMatchedLink()})}c.toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()&&
A.splice(A.length-1,1)}a.isSolverResult()||(t.ctatdebug("In evaluate inside the solver result if condition + "+c),a.setResult(c));t.ctatdebug("In evaluate out the solver result if condition");a.setReportableLink(d);a.setReportableInterpretation(f);a.setReportableVariableTable(f.getVariableTable());a.getHintRequest()||(b=d.getTutorSAI(a.getInterpolatedSAI(),f.getVariableTable()),t.ctatdebug("In evaluate -- TUTORSAI: "+b+", studentSAI was "+a.getStudentSAI()),a.setTutorSAI(b));b=c==CTATExampleTracerLink.CORRECT_ACTION?
f.getLatestSuccessMessage():f.getLatestBuggyMessage();t.ctatdebug('ETT.finishEvaluate() successOrBuggyMsg "'+b+'"');a.setSuccessOrBuggyMsg(b);a.getHintRequest()&&(a.setReportableHints(f.getLatestHints()),t.ctatdebug("In evaluate --\x3e after setReportableHints"));t.ctatdebug("In evaluate after fireExampleTracerEvent");t.ctatdebug("CTATExampleTracerTracer --\x3e out of finishEvaluate");return c.toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()}function d(a,b,c,d){t.ctatdebug("checkDoneStep() hintTrace "+
b+", sai "+a.getStudentSAI()+", exitOnIncorrectDone "+D.exitOnIncorrectDone()+", hideButRequireSteps "+D.hideButRequireSteps()+", nInterps "+d.size);if(!a.getStudentSAI().isDone())return t.ctatdebug("checkDoneStep() not isDone(), so setDoneStepFailed(false) & return null "),null;if(D.exitOnIncorrectDone())return a.setDoneStepFailed(!1),t.ctatdebug("checkDoneStep() exitOnIncorrectDone() with setDoneStepFailed(false), so return null "),null;if(!b&&D.hideButRequireSteps()){b=D.getDoneLinks();t.ctatdebug("checkDoneStep getDoneLinks().size "+
b.size);b=b.values();for(var e;!(e=b.next()).done;)if(D.pathToLinkIsSubset(e.value,E))return a.setDoneStepFailed(!1),1>d.size?f(a,c,CTATExampleTracerLink.CORRECT_ACTION,e.value,t.getBestInterpretation(),t.getInterpretationsInternal()):f(a,c,CTATExampleTracerLink.CORRECT_ACTION,e.value,r(d),d)}1>d.size&&a.setDoneStepFailed(!0);return null}function c(a,b,c){t.ctatdebug("CTATExampleTracerTracer --\x3e _evaluate("+a+", "+b+", "+c+")");H=a;var e=new Set,n=a.getPreloadedLinkMatches();t.ctatdebug("interps # : "+
v.length);t.ctatdebug("interps: "+v);v.forEach(function(d){t.ctatdebug("In evaluate -- entered the interpretations loop");if("undefined"===typeof n||null===n)t.ctatdebug("In evaluate -- entered if check for saiLinkMatches"),n=h(a.getStudentSAI(),a.getActor(),b,d.getVariableTable(),a),t.ctatdebug("In evaluate -- exiting if check for saiLinkMatches");else for(var f=0;f<n.length;++f)g(a.getStudentSAI(),!0,n[f],n[f].getActor(),d.getVariableTable());t.ctatdebug("Link matches # : "+n.length);n.forEach(function(b){t.ctatdebug("In evaluate -- entered the saiLinkMatches loop + "+
b);if(!D.relaxOrderConstraints()&&d.getTraversalCount(b)>=b.getMaxTraversals())return t.ctatdebug("In evaluate -- skipped a saiLinkMatches loop \n Skipped due to max traversals"+b.getMaxTraversals()),!1;var f=d.clone();t.ctatdebug("In evaluate size of getPaths "+f.getPaths().size);f.getPaths().forEach(function(c){t.ctatdebug("In evaluate -- looping through the newInterp.getPaths()\n Examining path: "+c);!1===l(b,f,c,!1,a)&&(t.ctatdebug("In evaluate -- in if condition, checking if isPathOK"),f.getPaths()["delete"](c),
t.ctatdebug("In evaluate -- out of if condition, checking if isPathOK\n Tried to delete path."))});t.ctatdebug("In evaluate -- done looping through the newInterp.getPaths(), size "+f.getPaths().size);if(0<f.getPaths().size){t.ctatdebug("In evaluate -- if number of paths is greater than 0");f.addLink(b);t.ctatdebug("In evaluate -- new link added");if(!0===c){t.ctatdebug("In evaluate -- we are in the doUpdate if condition");var g=m(b,a.getStudentSAI(),f);t.ctatdebug("In evaluate -- updatingVariable table");
a.setInterpolatedSAI(f.updateVariableTable(a.getStudentSAI(),g,b));t.ctatdebug("In evaluate -- done updatingVariable table: "+f.getVariableTable())}e.add(f);t.ctatdebug("In evaluate -- added new interp")}t.ctatdebug("In evaluate -- out of saiLinkMatches loop")});t.ctatdebug("In evaluate -- out of interpretation loops")});a.setNumberOfInterpretations(e.size);t.ctatdebug("In evaluate -- number of interpretations "+e.size+" set");var q=d(a,b,c,e);if(null!==q)return q;if(0===e.size)return t.ctatdebug("In evaluate -- if condition no new interpretations"),
0!==n.length&&!0===n[0].isDone()&&a.setDoneStepFailed(!0),a.setResult(CTATExampleTracerLink.NO_MODEL),t.ctatdebug("In evaluate -- if condition no new interpretations returning false"),!1;q=r(e);t.ctatdebug("In evaluate -- just found bestInterp");var p=null;!0===a.isSolverResult()?(t.ctatdebug("In evaluate -- in if branch of isSolverResult"),p=CTATExampleTracerLink.NO_MODEL.toString().toUpperCase()===a.getResult().toString().toUpperCase()?CTATExampleTracerLink.BUGGY_ACTION.toString():a.getResult().toString()):
(t.ctatdebug("In evaluate -- in else branch of isSolverResult"),p=q.getLastMatchedLink().getType());return f(a,c,p,null,q,e)}function g(a,b,c,d,e){var f=b&&c.isCorrect();if("undefined"!=typeof E[c.getUniqueID()]||c.matchesSAIforHint(a,d,null,e))E[c.getUniqueID()]=f;t.ctatdebug("updateMatchedSelections(): link "+c.getUniqueID()+", matched "+b+", newResult "+f+", matchedSelections[link] "+E[c.getUniqueID()])}function h(a,b,c,d,e){t.ctatdebug("CTATExampleTracerTracer --\x3e in findSAIMatchingLinks("+
a+", "+b+", "+c+")");var f=[];D.getLinks().forEach(function(h){if(!1===c){t.ctatdebug("Calling link.matchesSAI() on link "+h+", sai "+a);var l=h.matchesSAI(a,b,d);t.ctatdebug("Result from link.matchesSAI() on link "+h+": "+l+", typeof "+typeof l);!0===l&&f.push(h);D.hideButRequireSteps()&&g(a,l,h,b,d)}else!0===h.matchesSAIforHint(a,b,e,d)&&f.push(h)});t.ctatdebug("CTATExampleTracerTracer --\x3e out of findSAIMatchingLinks: #matchingLinks "+f.length);return f}function l(a,b,c,d,e){t.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK");
var f=null;if(!0===d){t.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK in demonstrate mode");var g=b.getMatchedLinks().slice();g.push(a);f=c.getLinksRestricted(g)}else t.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK NOT in demonstrate mode"),f=c.getLinks();t.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK path.getLinks() "+c.getLinks().size);t.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK pathLinks "+f.size);if(!0===d){var h=[],l=!0;b.getMatchedLinks().forEach(function(a){!1!==
l&&(!1===D.observesOrderingConstraints(h,a,f,e)||!1===q(b,a,f)?(t.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false1"),l=!1):h.push(a))});if(!1===l)return t.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false2"),!1}if(a.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString()){if(!1===D.isIncorrectLinkOK(b.getMatchedLinks(),a,f,b))return t.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false3"),!1}else{if(!1===D.observesOrderingConstraints(b.getMatchedLinks(),
a,f,e))return t.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false4"),!1;if(!1===q(b,a,f))return t.ctatdebug("CTATExampleTracerTracer --\x3e in isPathOK returning false5"),!1}t.ctatdebug("CTATExampleTracerTracer --\x3e out of isPathOK returning true");return!0}function m(a,b,c){t.ctatdebug("CTATExampleTracerTracer.replaceInput("+a+", "+b+", ...)");if(null===a||"undefined"===typeof a||!1===a.replaceInput())return t.ctatdebug("replaceInput false, returning null"),null;a=a.evaluateReplacement(b,
c.getVariableTable(),t);t.ctatdebug("CTATExampleTracerTracer.replaceInput() returning "+a);return a}function r(a){t.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation");var b=new CTATExampleTracerInterpretationComparator,c=null;a.forEach(function(a){t.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation iteration");null===c||"undefined"===typeof c?(t.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation first if condition"),c=a):(t.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation else of first if condition"),
0<b.compare(a,c)&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in findBestInterpretation second if condition"),c=a))});t.ctatdebug("CTATExampleTracerTracer --\x3e out of findBestInterpretation");return c}function p(a){t.ctatdebug("CTATExampleTracerTracer --\x3e in setInterpretations");v.length=0;0===a.size?t.ctatdebug("CTATExampleTracerTracer --\x3e returning from setInterpretations"):(t.ctatdebug("CTATExampleTracerTracer --\x3e setInterpretations c.size: "+a.size),a.forEach(function(a){v.push(a)}),
w=null,t.ctatdebug("CTATExampleTracerTracer --\x3e out of setInterpretations"))}function x(){t.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths");var a=D.findAllPaths();t.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths: #paths "+a.size);a.forEach(function(a){t.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths loopring through paths");t.ctatdebug("CTATExampleTracerTracer --\x3e in getAllPaths size of path"+a.getLinks().size)});return a}function q(a,b,c){t.ctatdebug("CTATExampleTracerTracer --\x3e in doneStepOK: link "+
b+", isDone() "+b.isDone());if(null===b||"undefined"===typeof b||!1===b.isDone())return t.ctatdebug("doneStepOK in first if condition"),!0;if(b.isDone()&&D.exitOnIncorrectDone())return!0;if(b.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return t.ctatdebug("doneStepOK in second if condition"),!0;t.ctatdebug("doneStepOK before loop");var d=!0;c.forEach(function(c){if(!1===d)t.ctatdebug("CTATExampleTracerTracer --\x3e we are breaking from the loop");else if(c.getUniqueID()===
b.getUniqueID())t.ctatdebug("CTATExampleTracerTracer --\x3e inside second if condition");else{var e=a.getTraversalCount(c);D.hideButRequireSteps()&&(0<e||1>c.getMinTraversals())||!(e<c.getMinTraversals())||(t.ctatdebug("CTATExampleTracerTracer --\x3e we should return false from the second if condition"),d=!1)}});if(!1===d)return t.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning false"),!1;t.ctatdebug("CTATExampleTracerTracer --\x3e out of doneStepOK returning true");return!0}
function u(a,b){t.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink");var c=null!==b&&"undefined"!==typeof b&&null!==b[0]&&"undefined"!==typeof b[0]?b[0]:null;if(null===c||"undefined"===typeof c)t.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink first if condition"),c=t.getBestInterpretation();null!==b&&"undefined"!==typeof b&&(b[0]=c);t.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink interp.getPaths(): "+c.getPaths().size);var d=CTATExampleTracerPath.getBestPath(c.getPaths());
t.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink path: "+d);var e=n(c,d,a,!1);t.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink highestLink: "+e);if(null!==e&&"undefined"!==typeof e)return t.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning highestLink"),e;var f=null;t.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getLinks() "+d.getLinks().size);t.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink returning path.getSortedLinks() "+
d.getSortedLinks());var g=!1,h=null;d.getSortedLinks().forEach(function(b){!0!==g&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in for loop"+b),f=b,c.getTraversalCount(b)<b.getMaxTraversals()&&(!1===a||0<t.nonEmptyHints(b,c.getVariableTable()))&&D.observesOrderingConstraints(c.getMatchedLinks(),b,d.getLinks(),null)&&q(c,b,d.getLinks())&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in _getBestNextLink in link: "+b),h=b,g=!0))});if(!0===g)return h;t.ctatdebug("CTATExampleTracerTracer --\x3e out of _getBestNextLink, returning: "+
f);return null}function n(a,b,c,d){t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink");var e=new CTATExampleTracerEvent(t,null,CTATMsgType.DEFAULT_STUDENT_ACTOR),f=!0,g=[];b.getSortedLinks().forEach(function(b){t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop link.getUniqueID(): "+b.getUniqueID());t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop interp.isTraversed(link, countOptionalAsTraversed): "+a.isTraversed(b,
d));t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in loop isNoOp(link): "+B(b));!0===a.isTraversed(b,d)||!0===B(b)?(t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in if condition"),f=!0):(!0===f&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink in second if condition"),D.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){c&&1>t.nonEmptyHints(b,a.getVariableTable())||a.getTraversalCount(b)>=b.getMaxTraversals()||
(t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink pushing outlink: "+b.getUniqueID()),g.push(b))})),f=null===b||"undefined"===typeof b?!1:b.getMinTraversals()<=a.getTraversalCount(b))});g.sort(function(b,c){return(new CTATExampleTracerLinkComparator(a,t)).compare(b,c)});t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink before sorting");var h=!1,n=null;g.forEach(function(c){!0!==h&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in fro loop"),
!0===l(c,a,b,!1,e)?(t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting first if"),n=c,h=!0):a.getPaths().forEach(function(d){!0!==h&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting in inner loop"),b!==d&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting second if"),!0===l(c,a,d,!1,e)&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink after sorting third if"),n=
c,h=!0)))}))});if(!0===h)return t.ctatdebug("CTATExampleTracerTracer --\x3e in getHighestUntraversedLink returning: "+n.getUniqueID()),n;t.ctatdebug("CTATExampleTracerTracer --\x3e out of getHighestUntraversedLink");return null}function B(a){return null===a||"undefined"===typeof a?!1:1>a.getMinTraversals()&&1>a.getMaxTraversals()}CTATBase.call(this,"CTATExampleTracerTracer",a);var v=null,z=null,A=null,D=a,H=null;CTATExampleTracerTracer_count++;var w=null,E={},t=this;this.goToDone=function(a,b,c){return(a=
a.getPathToDone(b))?c.traceLinks(a.getSortedLinks()):!1};this.getMatchedSelections=function(){return E};this.getLastResult=function(){t.ctatdebug("CTATExampleTracerTracer --\x3e in getResult");return H};this.resetTracer=function(){t.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer entering");null===v||"undefined"===typeof v?(t.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer making interpretations array"),v=[]):(t.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer clearing interpretations array"),
v.length=0);var a=new CTATExampleTracerInterpretation(x());t.ctatdebug("CTATExampleTracerTracer tempInterp--\x3e in resetTracer tempInterp "+a);null!==b&&"undefined"!==typeof b&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer startStateVT if condition"),a.setVariableTable(b));v.push(a);w=a;if(null===z||"undefined"===typeof z)t.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer incorrectActionMatches if condition"),z={};else{t.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of incorrectActionMatches if condition");
for(var c in z)z.hasOwnProperty(c)&&delete z[c]}E={};null===A||"undefined"===typeof A?(t.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer last if condition"),A=[]):(t.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer else branch of last if condition"),A.length=0);t.ctatdebug("CTATExampleTracerTracer --\x3e in resetTracer before iterating over all the links in the graphs");D.getLinks().forEach(function(a){a.getMatcher().resetMatcher()});t.ctatdebug("CTATExampleTracerTracer --\x3e out of resetTracer")};
this.evaluate=function(a){t.ctatdebug("CTATExampleTracerTracer --\x3e in public evaluate(), calling private _evaluate; given event "+a);return c(a,!1,!0)};this.nonEmptyHints=function(a,b){t.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints");if(null===a||"undefined"===typeof a)return 0;var c=a.interpolateHints(b);t.ctatdebug("CTATExampleTracerTracer --\x3e in nonEmptyHints: link.interpolateHints() "+a.interpolateHints().length);if(null===c||"undefined"===typeof c||1>c.length)return 0;for(var d=
0,e=0;e<c.length;++e)0<String(c[e]).trim().length&&d++;t.ctatdebug("CTATExampleTracerTracer --\x3e returning from nonEmptyHints "+d);return d};this.traceForHint=function(a){t.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint");var b=c(a,!0,!1);t.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint return from evaluate "+b);t.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint result from evaluate "+a.getResult().toString());t.ctatdebug("CTATExampleTracerTracer --\x3e in traceForHint link   from evaluate "+
a.getReportableLink());if(a.getResult().toString()===CTATExampleTracerLink.CORRECT_ACTION.toString())return b=a.getReportableLink(),a.setTutorSAI(new CTATSAI(a.getStudentSAI().getSelection(),b.getDefaultSAI().getAction(),b.getDefaultSAI().getInput())),a.setActor(CTATMsgType.DEFAULT_STUDENT_ACTOR),t.ctatdebug("CTATExampleTracerTracer --\x3e traceForHint returning hintLink "+b+", result "+a),b;t.ctatdebug("CTATExampleTracerTracer --\x3e out of traceForHint, returning null");return null};this.matchForHint=
function(a){t.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint");a.setWantReportableHints(!0);var b;b=null===a.getStudentSAI()||"undefined"===typeof a.getStudentSAI()?null:a.getStudentSAI().getSelectionArray();if(null!==b&&"undefined"!==typeof b&&0<b.length&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in matchForHint first if"),b=t.traceForHint(a),null!==b&&"undefined"!==typeof b&&0<a.getReportableHints().length))return t.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint via traceForHint returning "+
b+", result "+a),b;b=t.getBestNextLink(!0,a);t.ctatdebug("CTATExampleTracerTracer --\x3e matchForHint() traceForHint via getBestNextLink returning "+b);return b};this.getBestNextLink=function(a,b){t.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink");var c=[],d=u(a,c);if(null===d||"undefined"===typeof d)return t.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink returning null"),null;if(d.getType().toString()===CTATExampleTracerLink.BUGGY_ACTION.toString())return t.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return null no correct suboptimal step"),
null;t.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink else branch");t.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink got interp "+(null==c?"null":c[0]));if(b){var e=d.interpolateHints(c[0].getVariableTable());b.setInterpolatedHints(e);t.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink setInterpolatedHints");Array.isArray(e)&&0<e.length?b.setReportableHints(e):b.setReportableHints(d.getHints());t.ctatdebug("In evaluate --\x3e after setReportableHints");c&&c[0]&&
c[0].setLatestHints(e,d.getHints());b.setReportableLink(d);b.setReportableInterpretation(c[0]);b.setResult(d.getType());b.setTutorSAI(d.getDefaultSAI())}t.ctatdebug("CTATExampleTracerTracer --\x3e in getBestNextLink return etLink");return d};this.doHint=function(a,b,c,d,e,f){t.ctatdebug("CTATExampleTracerTracer --\x3e in doHint");var g=c=null;if(f&&null!==b&&"undefined"!==typeof b&&1<b.length&&b[1].toString()===CTATMsgType.PREVIOUS_FOCUS.toString()&&null!==a&&"undefined"!==typeof a&&1<a.length&&null!==
a[1]&&"undefined"!==typeof a[1]&&a[1].toString()!=="null".toString()&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in doHint first if condition"),c=[],c.push(a[1]),2<b.length))for(t.ctatdebug("CTATExampleTracerTracer --\x3e in doHint inner if condition"),g=[],a=2;a<b.length;a++)t.ctatdebug("CTATExampleTracerTracer --\x3e in doHint for loop "+a),g.push(b[a]);t.ctatdebug("CTATExampleTracerTracer --\x3e in doHint out of if condition");d=new CTATExampleTracerEvent(t,new CTATSAI(c,g,null),d);d.setHintRequest(!0);
t.ctatdebug("CTATExampleTracerTracer --\x3e in doHint result: "+d);b=t.matchForHint(d);Array.isArray(e)&&(t.ctatdebug("CTATExampleTracerTracer --\x3e in doHint last if condition"),e.push(d));t.ctatdebug("CTATExampleTracerTracer --\x3e returning from doHint: "+b);return b};this.getBestInterpretation=function(){t.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation");if(null===w||"undefined"===typeof w)t.ctatdebug("CTATExampleTracerTracer --\x3e in getBestInterpretation in if condition"),
w=r(t.getInterpretationsInternal());t.ctatdebug("CTATExampleTracerTracer --\x3e out of getBestInterpretation "+(null===w||void 0===w));return w};this.getInterpretationsInternal=function(){t.ctatdebug("CTATExampleTracerTracer --\x3e in getInterpretationsInternal");return v};this.toString=function(){var a="TracerState\n";null===v?a+="(no interpretations)\n":v.forEach(function(b){a+=b.toString()+"\n"});return a};this.addInterfaceVariablesFromEvent=function(a){if(a){var b=a.getTutorSelection();a=a.getTutorInput();
t.addInterfaceVariables(b,a)}};this.addInterfaceVariables=function(a,c){t.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables("+a+", "+c+")");if(a&&c){var d=a.length;d>c.length&&(d=c.length);for(var e=0;e<d;e++)a[e]&&(b.put(a[e],CTATVariableTable.standardizeType(c[e])),b.put(CTATVariableTable.nameAsString(a[e]),CTATVariableTable.valueAsString(c[e])));t.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables() startStateVT "+b);v&&v.forEach(function(b){if(b=b.getVariableTable()){for(var e=0;e<
d;e++)a[e]&&(b.put(a[e],CTATVariableTable.standardizeType(c[e])),b.put(CTATVariableTable.nameAsString(a[e]),CTATVariableTable.valueAsString(c[e])));t.ctatdebug("CTATExampleTracerTracer.addInterfaceVariables() interp.vt "+b)}})}};this.findCurrentState=function(){t.ctatdebug("Entering findCurrentState");var a=t.getBestInterpretation();return a&&a.getLastMatchedLink()&&a.getLastMatchedLink().isDone()?a.getLastMatchedLink().getNextNode():(a=u(!1,[a]))?a.getPrevNode():D?D.getStartNode():null}};
CTATExampleTracerTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracerTracer.prototype.constructor=CTATExampleTracerTracer;"undefined"!==typeof module&&(module.exports=CTATExampleTracerTracer);var CTATExampleTracerGraph=function(a,b,e){function f(a,b,d){y.ctatdebug("CTATExampleTracerGraph --\x3e in isOrderOK");if(y.relaxOrderConstraints()||b.isDone()&&y.exitOnIncorrectDone())return!0;for(var e=c(b),f=0;f<e.length;f++){var l=e[f];if(!0===C.isGroupOrdered(l))if(f!==e.length-1){if(!1===g(l,h(e[f+1],d),a,d))return!1}else if(!1===g(l,b,a,d))return!1}y.ctatdebug("CTATExampleTracerGraph --\x3e out of isOrderOK");return!0}function d(a,b,d){y.ctatdebug("CTATExampleTracerGraph --\x3e in isReenteringOK");
if(y.relaxOrderConstraints()||b.isDone()&&y.exitOnIncorrectDone())return!0;b=c(b);for(var e=!0,f=0;f<b.length;f++)if(!0===e&&!1===C.isGroupReenterable(b[f]))for(var e=!1,g=0;g<a.length;g++)if(!0===C.isLinkInGroup(b[f],a[g]))e=!0;else{if(!0===e)return!1}else if(!1===e)break;if(0!==a.length){var h=c(a[a.length-1]);y.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups null? "+(null===h));y.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups undefined? "+("undefined"===
typeof h));y.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups last traversedLink "+a[a.length-1].getUniqueID());y.ctatdebug("CTATExampleTracerGraph --\x3e in isReentrableOK: exitedGroups length "+(h?h.length:null));b.forEach(function(a){a=h.indexOf(a);0<=a&&h.splice(a,1)});y.ctatdebug("CTATETGraph.isReentrableOK: exitedGroups.length after removing newLink's groups: "+h.length);for(k=h.length-1;0<=k;k--)C.isGroupReenterable(h[k])&&h.splice(k,1);y.ctatdebug("CTATETGraph --\x3e in isReentrableOK: exitedGroups after removing reenterables: "+
h.length);y.ctatdebug("CTATETGraph --\x3e in isReentrableOK: traversedLinks: "+a+", path: "+d);var n=!0;h.forEach(function(b){!1!==n&&d.forEach(function(c){!1!==n&&l(a,c)<c.getMinTraversals()&&!0===C.isLinkInGroup(b,c)&&(n=!1)})});if(!1===n)return!1}y.ctatdebug("CTATExampleTracerGraph --\x3e out of isReenteringOK");return!0}function c(a){y.ctatdebug("in findGroupsOfLink(link "+a+"): typeof(groupModel) "+typeof C);a=C.getGroupsContainingLink(a);y.ctatdebug("in findGroupsOfLink groupsSet.size "+a.size);
var b=[];a.forEach(function(a){y.ctatdebug("in findGroupsOfLink group element "+a.getName());b.push(a)});b.sort(function(a,b){return C.getGroupLinkCount(b)-C.getGroupLinkCount(a)});return b}function g(a,b,c,d){var e=-1,f=null,g=Number.MAX_VALUE,n=null;C.getGroupSubgroups(a).forEach(function(a){if(!1===C.isLinkInGroup(a,b)&&0!==C.getGroupLinkCount(a)){var l=h(a,d);null!==l&&"undefined"!==typeof l&&(l=l.getDepth(),l<b.getDepth()&&l>e&&(!1===r(a)||!0===p(a,c))&&(e=l,f=a),l>b.getDepth()&&l<g&&(!1===r(a)||
!0===p(a,c))&&(g=l,n=a))}});C.getUniqueLinks(a).forEach(function(a){if(!0===d.has(a)){var h=a.getDepth();h<b.getDepth()&&h>e&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(e=h,f=a);h>b.getDepth()&&h<g&&(0<a.getMinTraversals()||-1<c.indexOf(a))&&(g=h,n=a)}});if(null!==f&&"undefined"!==typeof f)if(f instanceof CTATExampleTracerLink){if(l(c,f)<f.getMinTraversals())return!1}else if(f instanceof CTATLinkGroup&&!1===x(f,c,d))return!1;return null!==n&&"undefined"!==typeof n&&(n instanceof CTATExampleTracerLink&&
-1<c.indexOf(n)||n instanceof CTATLinkGroup&&!0===p(n,c))?!1:!0}function h(a,b){var c=Number.MAX_VALUE,d=null;C.getGroupLinks(a).forEach(function(a){a.getDepth()<c&&!0===b.has(a)&&(c=a.getDepth(),d=a)});return d}function l(a,b){for(var c=0,d=0;d<a.length;d++)b===a[d]&&c++;y.ctatdebug("CTATETGraph.getTraversalCount("+b+"): "+c);return c}function m(a,b,c){var d=!1,e=!0,f=!1;(new CTATExampleTracerPath(b)).getSortedLinks().forEach(function(b){if(!1!==e&&!0!==f){if(!1===d)!0===C.isLinkInGroup(a,b)&&(d=
!0);else if(!1===C.isLinkInGroup(a,b)){f=!0;return}c.getTraversalCount(b)<b.getMaxTraversals()&&(e=!1)}});return!1===e?!1:!0}function r(a){var b=!0;C.getGroupLinks(a).forEach(function(a){!1!==b&&0!==a.getMinTraversals()&&(b=!1)});return!1===b?!1:!0}function p(a,b){for(var c=0;c<b.length;c++)if(!0===C.isLinkInGroup(a,b[c]))return!0;return!1}function x(a,b,c){var d=!0;C.getGroupLinks(a).forEach(function(a){!1!==d&&!0===c.has(a)&&l(b,a)<a.getMinTraversals()&&(d=!1)});return!1===d?!1:!0}function q(){for(var a=
0;a<v.length;a++)v[a].clearInLinks();var b=y.getStartNode();null!==b&&"undefined"!==typeof b&&null!==b.getOutLinks()&&"undefined"!==typeof b.getOutLinks()&&(a=0,b.getOutLinks().forEach(function(b){u(b,a++)}))}function u(a,b){ctatdebug("updateInLinkSubGraph("+a+", "+b+")");var c=y.getNode(a.getNextNode());if(null!==c&&"undefined"!==typeof c){c.addInLink(a);var d=0;c.getOutLinks().forEach(function(a){u(a,d++)})}}function n(a){var b=y.getNode(a.getPrevNode());if(null!==b&&"undefined"!==typeof b){var c=
-1;b.getInLinks().forEach(function(a){-1===a.getDepth()&&n(a);a.getDepth()>c&&(c=a.getDepth())});a.setDepth(c+1)}}CTATBase.call(this,"CTATExampleTracerGraph","visualdata");var B=null,v=null,z=null,A=null,D=null,H=null,w=new Set,E=new Set,t=null,C=null,G=CTATMsgType.SHOW_ALL_FEEDBACK,y=this;this.getFeedbackPolicy=function(){return G};this.setFeedbackPolicy=function(a){y.ctatdebug("Graph.setFeedbackPolicy("+a+") old policy "+G);G="false"===a?CTATMsgType.SHOW_ALL_FEEDBACK:"true"===a?CTATMsgType.HIDE_ALL_FEEDBACK:
a};this.hideButRequireSteps=function(){return G==CTATMsgType.HIDE_BUT_COMPLETE};this.hideAllFeedback=function(){return G==CTATMsgType.HIDE_ALL_FEEDBACK};this.relaxOrderConstraints=function(){return y.hideAllFeedback()||y.hideButRequireSteps()||G==CTATMsgType.DELAY_FEEDBACK};this.exitOnIncorrectDone=function(){switch(G){case CTATMsgType.HIDE_ALL_FEEDBACK:case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}};this.getDefaultBuggyMsg=function(){return C.getTopLevelGroup()?C.getTopLevelGroup().getDefaultBuggyMsg():
null};this.getLinks=function(){y.ctatdebug("CTATExampleTracerGraph --\x3e in getLinks");return z};this.addLink=function(a,b){y.ctatdebug("CTATExampleTracerGraph --\x3e in addLink");z.push(a);a.isDone()?E.add(a):E["delete"](a);null===b||"undefined"===typeof b?C.addLinkToGroup(C.getTopLevelGroup(),a):C.addLinkToGroup(b,a);y.ctatdebug("CTATExampleTracerGraph --\x3e out of addLink")};this.addNode=function(a){y.ctatdebug("CTATExampleTracerGraph --\x3e in addNode");v.push(a);A[a.getNodeID()]=a;y.ctatdebug("CTATExampleTracerGraph --\x3e out of addNode")};
this.findAllPaths=function(){ctatdebug("CTATExampleTracerGraph --\x3e in findAllPaths "+y.getStartNode().getNodeID());return y.findPathsFromNode(y.getStartNode())};this.pathToLinkIsSubset=function(a,b){var c=y.getNode(a.getPrevNode());y.ctatdebug("pathToLinkIsSubset("+a+") sourceNode "+c.getNodeID());if(0<a.getMinTraversals()&&"undefined"==typeof b[a.getUniqueID()])return!1;if(c==y.getStartNode())return!0;for(c=c.getInLinks().values();!(c=c.next()).done;)return y.pathToLinkIsSubset(c.value,b);return!1};
this.observesOrderingConstraints=function(a,b,c,e){y.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints");null!==e&&"undefined"!==typeof e&&(y.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints initializing out of order false"),e.setOutOfOrder(!1));if(null===c||"undefined"===typeof c||0===c.size||null===b||"undefined"===typeof b)return y.ctatdebug("CTATExampleTracerGraph --\x3e returning first true observesOrderingConstraints"),!0;if(b.isDone()&&y.exitOnIncorrectDone())return y.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning true for doneStep && exitOnIncorrectDone"),
!0;if(!0===c.has(b)&&!0===f(a,b,c)&&!0===d(a,b,c))return y.ctatdebug("CTATExampleTracerGraph.observesOrderingConstraints --\x3e returning isOrderOK true && isisReenteringOK() true"),!0;null!==e&&"undefined"!==typeof e&&(y.ctatdebug("CTATExampleTracerGraph --\x3e in observesOrderingConstraints setting out of order true"),e.setOutOfOrder(!0));y.ctatdebug("CTATExampleTracerGraph --\x3e returning false observesOrderingConstraints");return!1};this.isIncorrectLinkOK=function(a,b,c,d){y.ctatdebug("CTATExampleTracerGraph --\x3e in isIncorrectLinkOK");
var e=!1,g=null,h=!0,l=!1;y.getNode(b.getPrevNode()).getOutLinks().forEach(function(b){!0!==l&&!1!==h&&b.getType().toString()!==CTATExampleTracerLink.BUGGY_ACTION.toString()&&!0===c.has(b)&&(e=!0,!1===f(a,b,c)?h=!1:(g=b,l=!0))});if(!1===h||null===g||"undefined"===typeof g)return!1;if(!1===e)return y.ctatdebug("isIncorrectLinkOK(): no siblings of link in path"),!1;if(!0===e&&(b=y.getSmallestContainingGroup(b),!0===C.isLinkInGroup(b,g)&&!1===C.isGroupOrdered(b)&&!0===m(b,c,d)))return!1;y.ctatdebug("CTATExampleTracerGraph --\x3e out of isIncorrectLinkOK");
return!0};this.getNode=function(a){y.ctatdebug("CTATExampleTracerGraph --\x3e in getNode("+a+") returning "+A[a]);return A[a]};this.findNode=function(a){if(a){a=a.toLowerCase();for(var b in A)if(A[b].getNodeName().toLowerCase()==a)return y.getNode(b);if("start"==a)return y.getStudentStartsHereNode()||y.getStartNode()}return null};this.findPathsFromNode=function(a){y.ctatdebug("CTATExampleTracerGraph --\x3e in findPathsFromNode outlinks "+a.getOutLinks().size);var b=new Set;if(!a||0===a.getOutLinks().size)return b.add(new CTATExampleTracerPath(null)),
b;y.ctatdebug("CTATExampleTracerGraph --\x3e before forEach ");a.getOutLinks().forEach(function(a){y.ctatdebug("CTATExampleTracerGraph --\x3e in forEach "+a.getType().toString());if(a.getType().toString()!=CTATExampleTracerLink.BUGGY_ACTION.toString()){var c=y.findPathsFromNode(y.getNode(a.getNextNode()));y.ctatdebug("findPathsFromNode childPaths.size "+c.size);c.forEach(function(c){y.ctatdebug("findPathsFromNode childPath.size "+c.size+", outLink "+a);c.addLink(a);b.add(c)})}},a);0===b.size&&b.add(new CTATExampleTracerPath(null));
y.ctatdebug("CTATExampleTracerGraph --\x3e out of findPathsFromNode "+b.size);return b};this.getDoneStates=function(){return w};this.checkForDoneState=function(a){if(a.isDone()&&a.isTraversable()){var b=y.getNode(a.getNextNode());y.ctatdebug("CTATExampleTracerGraph.addDoneState(linkID "+a.getUniqueID()+") adding destNode "+b);w.add(b)}};this.getBestSubpath=function(a,b,c){if(!a||!b)return null;var d=y.findPathsFromNode(a),e=new Set;d.forEach(function(a){a=a.subpath(b);!a||c&&!a.containsAll(c)||e.add(a)});
y.ctatdebug("CTATExampleTracerGraph.getBestSubpath("+a+", "+b+", ["+(c?c.length:-1)+"]) pathsFrom "+d.size+", pathsFromTo "+e.size);return 1>e.size?null:CTATExampleTracerPath.getBestPath(e)};this.getStartNode=function(){y.ctatdebug("CTATExampleTracerGraph --\x3e in getStartNode() returning "+D);return D};this.getLinkByID=function(a){y.ctatdebug("CTATExampleTracerGraph --\x3e in getLinkByID");for(var b=0;b<z.length;b++)if(z[b].getUniqueID()===a)return z[b];y.ctatdebug("CTATExampleTracerGraph --\x3e out of getLinkByID");
return null};this.setStartNode=function(a){y.ctatdebug("CTATExampleTracerGraph --\x3e in setStartNode("+a+")");D=a};this.getStudentStartsHereNode=function(){y.ctatdebug("CTATExampleTracerGraph --\x3e getStudentStartsHereNode() returns "+H);return H};this.setStudentStartsHereNode=function(a){y.ctatdebug("CTATExampleTracerGraph --\x3e in setStudentStartsHereNode("+a+")");H=a};this.getExampleTracer=function(){y.ctatdebug("CTATExampleTracerGraph --\x3e in getExampleTracer() returning "+B);return B};this.forDebugging=
function(){y.ctatdebug("CTATExampleTracerGraph --\x3e in forDebugging");y.ctatdebug("Nodes in the graph -- ids");v.forEach(function(a){y.ctatdebug(a.getNodeID())});y.ctatdebug("Links in the graph -- ids, from, to");z.forEach(function(a){y.ctatdebug(a)})};this.getSmallestContainingGroup=function(a){return C.getLowestLevelGroupOfLink(a)};this.redoLinkDepths=function(){q();y.getLinks().forEach(function(a){a.setDepth(-1)});y.getLinks().forEach(function(a){-1===a.getDepth()&&n(a)})};this.getGroupModel=
function(){return C};this.setVisualData=function(a){y.ctatdebug("CTATExampleTracerGraph --\x3e in setVisualData");t=a};this.getVisualData=function(){y.ctatdebug("CTATExampleTracerGraph --\x3e in getVisualData() returning "+t);return t};this.getDoneLinks=function(){return E};(function(a,b){y.ctatdebug("CTATExampleTracerGraph --\x3e in initGraph ("+a+" , "+b);z=[];v=[];A={};if(null===C||"undefined"===typeof C)C=new CTATDefaultGroupModel,y.ctatdebug("CTATExampleTracerGraph --\x3e created a group model from here");
C.clear();C.setDefaultReenterable(!b);C.setGroupOrdered(C.getTopLevelGroup(),a);C.setGroupName(C.getTopLevelGroup(),CTATExampleTracerGraph.TOP_LEVEL);B=new CTATExampleTracerTracer(y,e);y.ctatdebug("CTATExampleTracerGraph --\x3e out of initGraph")})(!a,b)};Object.defineProperty(CTATExampleTracerGraph,"TOP_LEVEL",{enumerable:!1,configurable:!1,writable:!1,value:"Top Level"});CTATExampleTracerGraph.prototype=Object.create(CTATBase.prototype);CTATExampleTracerGraph.prototype.constructor=CTATExampleTracerGraph;
"undefined"!==typeof module&&(module.exports=CTATExampleTracerGraph);var CTATGraphParser=function(){function a(a){ctatdebug("processEdge()");for(var d=new CTATExampleTracerLink(null,null,null),e=g.getElementChildren(a),f,h,l,m,p,q=a=-1,w=CTATMsgType.DEFAULT_ACTOR,x=!1,t=0;t<e.length;t++){"sourceID"===g.getElementName(e[t])&&(a=parseInt(g.getNodeTextValue(e[t])),d.setPrevNode(a));"destID"===g.getElementName(e[t])&&(q=parseInt(g.getNodeTextValue(e[t])),d.setNextNode(q));if("rule"===g.getElementName(e[t]))for(var C=g.getElementChildren(e[t]),G=0;G<C.length;G++)"text"===
g.getElementName(C[G])&&d.addSkillName(g.getNodeTextValue(C[G]).toString());if("actionLabel"===g.getElementName(e[t]))for(d.setIsPreferredLink("false"!=g.getElementAttr(e[t],"preferPathMark")),d.setMinTraversalsStr(g.getElementAttr(e[t],"minTraversals")),d.setMaxTraversalsStr(g.getElementAttr(e[t],"maxTraversals")),C=g.getElementChildren(e[t]),G=0;G<C.length;G++){"uniqueID"===g.getElementName(C[G])&&(p=g.getNodeTextValue(C[G]),d.setUniqueID(parseInt(g.getNodeTextValue(C[G]))));"message"===g.getElementName(C[G])&&
(m=new CTATMessage(C[G]));"actionType"===g.getElementName(C[G])&&d.setActionType(g.getNodeTextValue(C[G]));"buggyMessage"===g.getElementName(C[G])&&d.setBuggyMsg(g.getNodeTextValue(C[G]));"successMessage"===g.getElementName(C[G])&&d.setSuccessMsg(g.getNodeTextValue(C[G]));"hintMessage"===g.getElementName(C[G])&&d.addHint(g.getNodeTextValue(C[G]));if("matchers"===g.getElementName(C[G]))for(var y=g.getElementChildren(C[G]),I=0;I<y.length;I++)"Selection"===g.getElementName(y[I])&&(f=b(y[I],0)),"Action"===
g.getElementName(y[I])&&(h=b(y[I],1)),"Input"===g.getElementName(y[I])&&(l=b(y[I],2)),"Actor"===g.getElementName(y[I])&&(w=g.getNodeTextValue(y[I]),x=(x=g.getElementAttr(y[I],"linkTriggered"))&&"false"!=x.toLowerCase().trim()?!0:!1);if("matcher"===g.getElementName(C[G])){h=C[G];f=g.getElementAttr(h,"replacementFormula");h=g.getElementChildren(h);var I=y=void 0,F,J=void 0,M=CTATMsgType.DEFAULT_ACTOR;l=new CTATExactMatcher(CTATMatcher.SELECTION,null);for(var w=new CTATExactMatcher(CTATMatcher.ACTION,
null),L=0;L<h.length;L++)"matcherType"===g.getElementName(h[L])&&(F=g.getNodeTextValue(h[L]),"ExactMatcher"===F&&(I=CTATExactMatcher),"RegexMatcher"===F&&(I=CTATRegexMatcher),"AnyMatcher"===F&&(I=CTATAnyMatcher),"RangeMatcher"===F&&(I=CTATRangeMatcher),"WildcardMatcher"===F&&(I=CTATWildcardMatcher),"ExpressionMatcher"===F&&(I=CTATExpressionMatcher)),"matcherParameter"===g.getElementName(h[L])&&(F=g.getElementAttr(h[L],"name"),J=g.getNodeTextValue(h[L]),"selection"==F&&l.setParameter(J),"action"==
F&&w.setParameter(J),"input"==F&&(y=y?y:new I(CTATMatcher.INPUT,null),y.setParameter(J)),"actor"==F&&(M=J),"minimum"==F&&(y=y?y:new I(CTATMatcher.INPUT,null),y.setParameter(J,"minimum")),"maximum"==F&&(y=y?y:new I(CTATMatcher.INPUT,null),y.setParameter(J,"maximum")),"InputExpression"==F&&(y=y?y:new I(CTATMatcher.INPUT,null),y.setParameter(h[L],F,g)),"relation"==F&&(y=y?y:new I(CTATMatcher.INPUT,null),y.setParameter(h[L],F,g)));y||(y=I?new I(CTATMatcher.INPUT,null):new CTATExactMatcher(CTATMatcher.INPUT,
null),y.setParameter(J?J:""));y.setReplacementFormula(f);w=[[l],[w],[y],M];f=w[0];h=w[1];l=w[2];w=w[3]}}}c.getStartNode()&&q==c.getStartNode().getNodeID()&&console.log("***WARNING*** edge "+p+" destination is graph startNode "+c.getStartNode());p=new CTATVectorMatcher(f,h,l,w);p.setDefaultSAI(m.getSAI());p.setCaseInsensitive(r);p.setLinkTriggered(x);d.setMatcher(p);ctatdebug("GraphParser.processEdge() "+a+"->"+q+", edge "+d);c.getNode(a).addOutLink(d);c.checkForDoneState(d);return d}function b(a,
b){f.ctatdebug("processMatchers()");for(var c=g.getElementChildren(a),d=[],e=0;e<c.length;e++)if("matcher"===g.getElementName(c[e])){for(var h=null,l=g.getElementAttr(c[e],"replacementFormula"),m=g.getElementChildren(c[e]),p=0;p<m.length;p++){if("matcherType"===g.getElementName(m[p]))switch(h=g.getNodeTextValue(m[p]),f.ctatdebug("CTATGraphParser.processMatchers() matcherType["+p+"] = "+h),h){case "ExactMatcher":h=new CTATExactMatcher(b,null);break;case "RegexMatcher":h=new CTATRegexMatcher(b,null);
break;case "AnyMatcher":h=new CTATAnyMatcher(b,null);break;case "RangeMatcher":h=new CTATRangeMatcher(b,null);break;case "WildcardMatcher":h=new CTATWildcardMatcher(b,null);break;case "ExpressionMatcher":h=new CTATExpressionMatcher(b,null);break;default:console.log("CTATGraphParser.processMatchers() unknown matcherType["+p+"] = "+h+"; using CTATExactMatcher"),h=new CTATExactMatcher(b,null)}if("matcherParameter"===g.getElementName(m[p])){var q=g.getElementAttr(m[p],"name");"single"===q?h.setParameter(g.getNodeTextValue(m[p])):
"minimum"===q?h.setParameter(g.getNodeTextValue(m[p]),"minimum"):"maximum"===q?h.setParameter(g.getNodeTextValue(m[p]),"maximum"):h.setParameter(m[p],q,g)}}h&&h.setReplacementFormula(l);d.push(h)}return d}function e(a,b){var c=new Set;if("group"!==g.getElementName(a))return c;var d=g.getElementAttr(a,"name");ctatdebug("readGroupFromXML group name: "+d);var f="true"===g.getElementAttr(a,"ordered"),h="true"===g.getElementAttr(a,"reenterable");ctatdebug("readGroupFromXML group isOrdered typeof: "+typeof f);
ctatdebug("readGroupFromXML group isOrdered: "+f);for(var l=function(a){c.add(a)},p=g.getElementChildren(a),q=0;q<p.length;q++){if("link"===g.getElementName(p[q])){var r=Number(g.getElementAttr(p[q],"id")),u=b[r];if(null!==u||void 0!==u)ctatdebug("Added link ID : "+r),c.add(u)}"group"===g.getElementName(p[q])&&(ctatdebug("encountered a subgroup"),e(p[q],b).forEach(l))}m.addGroup(d,f,c);m.setGroupReenterable(m.getGroupByName(d),h);return c}CTATBase.call(this,"CTATGraphParser","__undefined__");var f=
this,d,c,g=new CTATXML,h=null,l=[];new XMLSerializer;var m,r=!0,p=!0,x=[];this.getLockWidget=function(){return p};this.parseGraph=function(b,f){ctatdebug("parseBRD()");var n=0,q=g.getElementAttr(b,"startStateNodeName"),u="true"===g.getElementAttr(b,"unordered");r="false"!=String(g.getElementAttr(b,"caseInsensitive")).toLowerCase();p=g.getElementAttr(b,"lockWidget");var z=new CTATVariableTable;c=new CTATExampleTracerGraph(u,!1,z);var A=g.getElementChildren(b),z=g.getElementAttr(b,"suppressStudentFeedback");
if(null===z||void 0===z)z=CTATMsgType.SHOW_ALL_FEEDBACK;c.setFeedbackPolicy(z);f.setFeedbackSuppressed(z);z=g.getElementAttr(b,"highlightRightSelection");f.setHighlightRightSelection("false"!=z);var D=g.getElementAttr(b,"confirmDone");"true"!==D&&"false"!==D&&(D=c.getFeedbackPolicy()===CTATMsgType.HIDE_ALL_FEEDBACK?"true":"false");f.setHintPolicy(g.getElementAttr(b,"hintPolicy"));f.setOutOfOrderMessage(g.getElementAttr(b,"outOfOrderMessage"));for(var H=null,w=0;w<A.length;w++)switch(g.getElementName(A[w])){case "startNodeMessages":l=
g.getElementChildren(A[w]);break;case "node":n++;var E;E=A[w];ctatdebug("processNode("+E+")");var t=g.getElementChildren(E),C=-1;E="";for(var G=0;G<t.length;G++)switch(g.getElementName(t[G])){case "uniqueID":C=parseInt(g.getNodeTextValue(t[G]));break;case "text":E=g.getNodeTextValue(t[G])}t=new CTATExampleTracerNode(C,new Set);""!==E&&t.setNodeName(E);E=t;c.addNode(E);1==n&&(c.setStartNode(E),c.setStudentStartsHereNode(E));E.getNodeName()==q&&c.setStudentStartsHereNode(E);break;case "edge":c.addLink(a(A[w]));
break;case "EdgesGroups":H=A[w];break;case "productionRule":var y=A[w];ctatdebug("processSkill()");for(var t=E="",G=C=null,y=g.getElementChildren(y),I=0;I<y.length;I++){var F=g.getElementName(y[I]);"ruleName"==F&&(E=g.getNodeTextValue(y[I]),ctatdebug("ruleName="+E));"productionSet"==F&&(t=g.getNodeTextValue(y[I]),ctatdebug("productionSet="+t));"label"==F&&(C=g.getNodeTextValue(y[I]),ctatdebug("label="+C));"description"==F&&(G=g.getNodeTextValue(y[I]),ctatdebug("description="+G))}E&&(y=new CTATExampleTracerSkill(t,
E,CTATExampleTracerSkill.DEFAULT_P_GUESS,CTATExampleTracerSkill.DEFAULT_P_KNOWN,CTATExampleTracerSkill.DEFAULT_P_SLIP,CTATExampleTracerSkill.DEFAULT_P_LEARN,CTATExampleTracerSkill.DEFAULT_HISTORY),null!=C?y.setLabel(C):y.setLabel(E),null!=G?y.setDescription(G):y.setDescription(E+(t?" "+t:"")),x.push(y))}if(H){n=g.getElementAttr(H,"ordered");if(null===n||"undefined"==typeof isordered)n=!u;ctatdebug("parseGraph() value of isOrdered = "+n);ctatdebug("parseGraph() value of isUnordered = "+u);ctatdebug("parseGraph() typeof isOrdered: "+
typeof n);ctatdebug("parseGraph()typeof isUnordered: "+typeof u);q=H;A=n;ctatdebug("processGroup()");m=c.getGroupModel();n=m.createIdToLinkMap();m.setGroupOrdered(m.getTopLevelGroup(),A);ctatdebug("processGroup() name of group: "+m.getGroupName(m.getTopLevelGroup()));ctatdebug("processGroup() group isOrdered?: "+m.isGroupOrdered(m.getTopLevelGroup()));ctatdebug("processGroup() order of group: isOrdered= "+A);ctatdebug("processGroup() order of group: isOrdered typeof= "+typeof A);q=g.getElementChildren(q);
for(A=0;A<q.length;A++)switch(g.getElementName(q[A])){case "group":e(q[A],n);break;case "outOfOrderMessage":m.getTopLevelGroup().setDefaultBuggyMsg(g.getNodeTextValue(q[A]))}}n=f.getSkillBarVector(!1,!0);if(!n||1>n.length)ctatdebug("No existing skills. Add skills from BRD."),f.addGraphSkills(x),n=f.getSkillBarVector();h=(new CTATTutorMessageBuilder).createStateGraphMessage(r,u,p,f.isSourceFlash()?c.exitOnIncorrectDone():f.isFeedbackSuppressed(),z,D,n);c.redoLinkDepths();d=c.getExampleTracer();d.resetTracer();
c.forDebugging();ctatdebug("Graph loaded.");return{gr:c,tracer:d,ssm:l,sgMsg:h}}};CTATGraphParser.prototype=Object.create(CTATBase.prototype);CTATGraphParser.prototype.constructor=CTATGraphParser;"undefined"!==typeof module&&(module.exports=CTATGraphParser);var CTATProblemStateStatus=function(){var a="empty";this.getStatus=function(){return a};this.setStatus=function(b){a=b}};Object.defineProperty(CTATProblemStateStatus,"empty",{enumerable:!1,configurable:!1,writable:!1,value:"empty"});Object.defineProperty(CTATProblemStateStatus,"incompleteStartState",{enumerable:!1,configurable:!1,writable:!1,value:"incompleteStartState"});Object.defineProperty(CTATProblemStateStatus,"startState",{enumerable:!1,configurable:!1,writable:!1,value:"startState"});
Object.defineProperty(CTATProblemStateStatus,"incomplete",{enumerable:!1,configurable:!1,writable:!1,value:"incomplete"});Object.defineProperty(CTATProblemStateStatus,"goingToState",{enumerable:!1,configurable:!1,writable:!1,value:"goingToState"});Object.defineProperty(CTATProblemStateStatus,"normalFeedback",{enumerable:!1,configurable:!1,writable:!1,value:"normalFeedback"});Object.defineProperty(CTATProblemStateStatus,"complete",{enumerable:!1,configurable:!1,writable:!1,value:"complete"});
Object.defineProperty(CTATProblemStateStatus,"completedEarlier",{enumerable:!1,configurable:!1,writable:!1,value:"completedEarlier"});CTATProblemStateStatus.prototype=Object.create(CTATBase.prototype);CTATProblemStateStatus.prototype.constructor=CTATProblemStateStatus;CTATProblemStateStatus.prototype.isSendingSavedMsgsForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.normalFeedback:case CTATProblemStateStatus.complete:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustSaveForRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.goingToState:case CTATProblemStateStatus.completedEarlier:return!1;default:return!0}};CTATProblemStateStatus.prototype.isOutputSuppressed=function(){switch(this.getStatus()){case CTATProblemStateStatus.goingToState:return!0;default:return!1}};
CTATProblemStateStatus.prototype.isComplete=function(){switch(this.getStatus()){case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};CTATProblemStateStatus.prototype.canRestore=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.mustRetrieveProblemState=function(){switch(this.getStatus()){case CTATProblemStateStatus.incompleteStartState:case CTATProblemStateStatus.incomplete:case CTATProblemStateStatus.complete:case CTATProblemStateStatus.completedEarlier:return!0;default:return!1}};
CTATProblemStateStatus.prototype.transition=function(a,b){var e=this.getStatus();if(CTATProblemStateStatus.completedEarlier!=e)if(CTATProblemStateStatus.complete==e&&b==CTATProblemStateStatus.completedEarlier)this.setStatus(CTATProblemStateStatus.completedEarlier);else{switch(a){case CTATMsgType.SET_PREFERENCES:CTATProblemStateStatus[b]&&(CTATProblemStateStatus.incomplete==CTATProblemStateStatus[b]?this.setStatus(CTATProblemStateStatus.incompleteStartState):CTATProblemStateStatus.complete==CTATProblemStateStatus[b]?
this.setStatus(CTATProblemStateStatus.completedEarlier):this.setStatus(CTATProblemStateStatus.startState));break;case CTATMsgType.STATE_GRAPH:this.getStatus()==CTATProblemStateStatus.incomplete||this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incompleteStartState):this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.START_STATE_END:this.getStatus()==CTATProblemStateStatus.incompleteStartState?this.setStatus(CTATProblemStateStatus.incomplete):
this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.PROBLEM_RESTORE_END:case CTATMsgType.END_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.normalFeedback);break;case CTATMsgType.BEGIN_GO_TO_STATE:this.setStatus(CTATProblemStateStatus.startState);break;case CTATMsgType.BEGIN_RESTORE:this.getStatus()!=CTATProblemStateStatus.incompleteStartState&&this.setStatus(CTATProblemStateStatus.incomplete)}ctatdebug("CTATProblemStateStatus.transition("+a+", "+b+") old "+e+" => new "+
this.getStatus());return this.getStatus()}};CTATProblemStateStatus.prototype.toString=function(){return"{"+this.getStatus()+"}"};var CTATMessageTank=function(a,b){function e(a){p.ctatdebug("entering updateProblemSummary()");a&&g.forEach(function(b){if(b.msgType==CTATMsgType.ASSOCIATED_RULES){var d=b.evt;p.ctatdebug("entering updateProblemSummaryWithEvent("+d+")");if(d)if(c&&c.getOutputStatus().isComplete())a.setCompletionStatus(CTATMsgType.CompletionValue[1],!1),a.setShowCounts(!1);else{b=d.getResult();d.getHintRequest()&&(b=CTATExampleTracerLink.HINT_ACTION);var e=CTATMsgType.CompletionValue[0],f=b&&b==CTATExampleTracerLink.CORRECT_ACTION,
g=!1,h=null,l=null,m=d.getStudentSAI();m&&(h=m.getSelection())&&(l=m.getAction())&&(g="done"==String(h).toLowerCase()&&"buttonpressed"==String(l).toLowerCase());a.setCompletionStatus(e,CTATGlobals.confirmDone);p.ctatdebug("updateProblemSummary() Completion status "+e+", doneStep "+g+", correct "+f);g&&(e=f?CTATMsgType.CompletionValue[1]:CTATMsgType.CompletionValue[0],a.setCompletionStatus(e,!0));e==CTATMsgType.CompletionValue[1]?(a.stopTimer(),c&&c.setOutputStatus(CTATProblemStateStatus.complete)):
a.restartTimer();e=d.getActor();p.ctatdebug("updateProblemSummmary() actor "+e+", indicatorObj "+b);CTATMatcher.isTutorActor(e)||(d=d.getStepID(),CTATTutorMessageBuilder.isHint(b)?a.addHint(d):CTATTutorMessageBuilder.isCorrect(b)?null!==b&&"undefined"!==typeof b&&a.addCorrect(d):a.addError(d))}}})}function f(a){switch(p.suppressFeedback(a,c.getFeedbackPolicy())){case CTATMsgType.SHOW_ALL_FEEDBACK:return!1;case CTATMsgType.DELAY_FEEDBACK:a=a.msg;var b=CTATMsgType.getProperty(a,"Selection");p.ctatdebug("CTATMessageTank.addToDelayedFeedbackTank(\n  "+
a+") selection "+b);b&&(c.getDelayedFeedback()[b.toLowerCase()]=a);return!0;case CTATMsgType.HIDE_ALL_FEEDBACK:return!0;case CTATMsgType.HIDE_BUT_COMPLETE:return!0;case CTATMsgType.HIDE_BUT_ENFORCE:return!0;default:return!1}}function d(a,b){for(var c=new CTATMessageTank(a,null),d=0;d<b.length;++d){var e=b[d];p.ctatdebug("sendNewTankful() mto["+d+"] msgType "+e.msgType);c.addToMessageTank(e.msgType,e.msg,e.evt,null)}c.flushMessageTank(null,!0)}CTATBase.call(this,"CTATMessageTank",b);var c=a,g=null,
h=null,l=null,m=new Set;m.add("SuccessMessage");m.add("BuggyMessage");m.add("HighlightMsg");m.add("NotDoneMessage");var r=b,p=this,x=/^([^:]+):([0-9]+)$/;this.toString=function(){p.ctatdebug("toString tank "+g);if(!g||1>g.length)return"MessageTank empty";var a="";g.forEach(function(b){a+=b.msgType+", "});return"MessageTank["+a.substr(0,a.length-2)+"]"};this.setTransaction_id=function(a){r=a};this.enqueueToolActionToStudent=function(a,b,d,e){p.ctatdebug("Entering enqueueToolActionToStudent("+a+", "+
b+", "+d+", "+e+")");var f=CTATMsgType.INTERFACE_ACTION;p.ctatdebug("entering enqueueMessageToStudent()");var g=CTATMessage.makeTransactionId();a=new CTATSAI(a,b,d);b=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage(g,a);b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.TRIGGER,"DATA");b=CTATMsgType.setProperty(b,CTATTutorMessageBuilder.SUBTYPE,null===e||"undefined"===typeof e||1>e.length?CTATTutorMessageBuilder.TUTOR_PERFORMED:e);e=new CTATExampleTracerEvent(c,a,CTATMsgType.DEFAULT_TOOL_ACTOR);
e.setTransactionID(g);p.addToMessageTank(f,b,e,a);return g};this.addToMessageTank=function(a,b,c,d){p.ctatdebug("Entering addToMessageTank("+a+", "+b+", "+c+")");if(b){g||(g=[],h={},l={});var e={};e.msgType=a;e.msg=b;e.evt=c;e.sai=d;g.push(e);h[a]=h[a]?h[a]+1:1;a=c.getResult();c.getHintRequest()&&(a=CTATExampleTracerLink.HINT_ACTION);l[a]=l[a]?l[a]+1:1;p.ctatdebug("Exiting addToMessageTank() this "+p.toString())}};this.flushMessageTank=function(a,b){p.ctatdebug("Entering flushMessageTank("+a+", "+
b+")");if(g&&!(1>g.length)){e(a);p.ctatdebug("flushMessageTank() after updateProblemSummary; messageTank.length "+g.length+", transaction_id "+r);for(var m=[],q=[],u=0;u<g.length;++u){var z=g[u];if(z.msg){var A=z.msgType,D=z.evt;p.ctatdebug("entering processInterfaceVariables() msgType "+A+", evt "+D);A&&(p.ctatdebug("entering processInterfaceVariables() et "+c+", tracer "+(c?c.getTracer():null)),A=A.toLowerCase(),0!==A.indexOf("correct")&&0!==A.indexOf("interfaceaction")||c.getTracer().addInterfaceVariablesFromEvent(D));
if(!(A=f(z)))if(A=z,D=q,CTATConfiguration.usingFlash()){var H=void 0,w=void 0;if(!(A&&A.sai&&(H=A.sai.getAction())&&(w=x.exec(H)))||3>w.length||1>=w[2])A=!1;else{var E=D.length-1,E=0>E?null:D[E];A.msg=A.msg.replace(H,w[1]);E&&E.timeout==w[2]?E.msgTuples.push(A):D.push({timeout:Number(w[2]),msgTuples:[A]});A=!0}}else A=!1;A||m.push(z.msg)}}p.ctatdebug("flushMessageTank(): msgBundle.length "+m.length+", delayedMsgsBundle.length "+q.length);for(u=0;u<q.length;++u)z=q[u],p.ctatdebug("processDelayedMsgs() delayedMsgs.timeout "+
z.timeout+", .msgTuples.length "+z.msgTuples.length),setTimeout(d,z.timeout,c,z.msgTuples);0<m.length&&(p.ctatdebug("Bottom of flushMessageTank(); to send bundle of length "+m.length+" via "+c),c.sendBundle(m)&&(p.ctatdebug("CTATMessageTank.shouldSaveNow() resultTypes "+l+", msgTypes "+h),(l[CTATExampleTracerLink.CORRECT_ACTION]||l[CTATExampleTracerLink.FIREABLE_BUGGY_ACTION]||h.CorrectAction||h.InterfaceAction||h.UntutoredAction||c.isFeedbackSuppressed()&&h.AssociatedRules)&&c.isSendingSavedMsgsForRestore()&&
(CTATGlobalFunctions.isInstructorMode()?p.ctatdebug("We're in reviewer mode: we shouldn't save as we go"):c.getProblemStateSaver().saveAsYouGo(a))),p.ctatdebug("Exiting flushMessageTank() #CorrectAction "+h.CorrectAction+", #InterfaceAction "+h.InterfaceAction+", #UntutoredAction "+h.UntutoredAction));h=g=r=null}};this.flushDelayedFeedback=function(){p.ctatdebug("Entering flushDelayedFeedback()");var a=c.getDelayedFeedback(),b;for(b in a)a.hasOwnProperty(b)&&CTAT.ToolTutor.sendToInterface(a[b]);c.clearDelayedFeedback()};
this.suppressFeedback=function(a,b){p.ctatdebug("CTATMessageTank.suppressFeedback("+a.msgType+", "+b+")");var c;b==CTATMsgType.SHOW_ALL_FEEDBACK?(p.ctatdebug("if.1"),c=b):CTATMsgType.hasTextFeedback(a.msgType)?(p.ctatdebug("if.2"),b==CTATMsgType.HIDE_ALL_FEEDBACK||b==CTATMsgType.HIDE_BUT_ENFORCE?(p.ctatdebug("if.2.1"),c=b):(p.ctatdebug("if.2.2"),(c=CTATMsgType.getProperty(a.msg,CTATMsgType.BUGGY_MSG))&&-1!=c.toLowerCase().indexOf(CTATMsgType.NOT_DONE_MSG.toLowerCase())?(p.ctatdebug("if.2.2.1"),c=
CTATMsgType.SHOW_ALL_FEEDBACK):(p.ctatdebug("if.2.2.2"),c=CTATMsgType.HIDE_ALL_FEEDBACK))):CTATMsgType.isCorrectOrIncorrect(a.msgType)?(p.ctatdebug("if.3: "+a.msg),CTATMsgType.isDoneMessage(a.msg)?(p.ctatdebug("if.3.1"),c=CTATMsgType.SHOW_ALL_FEEDBACK):(p.ctatdebug("if.3.2"),c=b)):(p.ctatdebug("if.4"),c=CTATMsgType.SHOW_ALL_FEEDBACK);p.ctatdebug("CTATMessageTank.suppressFeedback() returning "+c);return c}};
Object.defineProperty(CTATMessageTank,"END_OF_TRANSACTION",{enumerable:!1,configurable:!1,writable:!1,value:"end_of_transaction"});CTATMessageTank.prototype=Object.create(CTATBase.prototype);CTATMessageTank.prototype.constructor=CTATMessageTank;"undefined"!==typeof module&&(module.exports=CTATMessageTank);var CTATStep=function(a,b){CTATBase.call(this,"CTATStep",a);var e=0,f=null,d=0,c=0;this.ctatdebug("entering CTATStep("+a+", "+b+") constructor");this.incrementFirstHints=function(){e++};this.incrementNCorrect=function(){d++};this.incrementErrors=function(){c++};this.setLastResult=function(a){f=a};this.getLastResult=function(){return f};this.getResult=function(){return b};this.getNCorrect=function(){return d};this.getNErrors=function(){return c};this.getNFirstHints=function(){return e};this.ctatdebug("in CTATStep("+
a+", "+b+") constructor");switch(b){case CTATStep.StepResult[3]:this.incrementNCorrect();break;case CTATStep.StepResult[1]:this.incrementErrors();break;case CTATStep.StepResult[2]:this.incrementFirstHints()}this.ctatdebug("exiting CTATStep constructor")};Object.defineProperty(CTATStep,"StepResult",{enumerable:!1,configurable:!1,writable:!1,value:["UNTRIED","INCORRECT","HINT","CORRECT"]});CTATStep.prototype=Object.create(CTATBase.prototype);CTATStep.prototype.constructor=CTATStep;
"undefined"!==typeof module&&(module.exports=CTATStep);var CTATProblemSummary=function(a,b,e){CTATBase.call(this,"CTATProblemSummary","");if(null===a||"undefined"===typeof a||1>a.length)throw new CTATExampleTracerException("problemName null or empty");var f=!0,d=Number.MAX_VALUE,c=b,g=e,h=0,l=new Date,m={},r=0,p=0,x=0,q=0,u=0,n=0,B=0,v=CTATMsgType.CompletionValue[0],z=this;this.getCountOnlyLastResults=function(){return g};this.setCountOnlyLastResults=function(a){g=a};this.getTimeElapsed=function(){return h};this.getUniqueErrors=function(){if(!z.getCountOnlyLastResults())return B;
var a=0,b;for(b in m)m[b].getLastResult()==CTATStep.StepResult[1]&&a++;return a};this.getUniqueCorrect=function(){if(!z.getCountOnlyLastResults())return u;var a=0,b;for(b in m)m[b].getLastResult()==CTATStep.StepResult[3]&&a++;return a};this.getUniqueCorrectUnassisted=function(){return n};this.getHintsOnly=function(){var a=0,b;for(b in m)CTATStep.StepResult[2]==m[b].getResult()&&1>m[b].getNErrors()&&++a;return a};this.getErrorsOnly=function(){var a=0,b;for(b in m)CTATStep.StepResult[1]==m[b].getResult()&&
1>m[b].getNFirstHints()&&++a;return a};this.getUniqueSteps=function(){var a=0,b;for(b in m)a++;return a};this.getRequiredSteps=function(){return d==Number.MAX_VALUE?0:d};this.setRequiredSteps=function(a){d=a};this.getCorrect=function(){return r};this.toXML=function(b){var c,d="";c=""+(' ProblemName="'+a+'"');c+=' CompletionStatus="'+v+'"';f&&(c+=' Correct="'+r+'"',c+=' UniqueCorrect="'+z.getUniqueCorrect()+'"',c+=' UniqueCorrectUnassisted="'+n+'"',c+=' Hints="'+p+'"',c+=' UniqueHints="'+q+'"',c+=
' HintsOnly="'+z.getHintsOnly()+'"',c+=' Errors="'+x+'"',c+=' UniqueErrors="'+z.getUniqueErrors()+'"',c+=' ErrorsOnly="'+z.getErrorsOnly()+'"',c+=' UniqueSteps="'+z.getUniqueSteps()+'"',c+=' RequiredSteps="'+z.getRequiredSteps()+'"');c+=' TimeElapsed="'+h+'"';f&&(d=z.getSkills()?z.getSkills().toXML(b):"");return b?"&lt;ProblemSummary"+c+"&gt;"+d+"&lt;/ProblemSummary&gt;":"<ProblemSummary"+c+">"+d+"</ProblemSummary>"};this.getSkills=function(){return c};this.setSkills=function(a){c=a};this.stopTimer=
function(){var a=new Date;h+=a.getTime()-l.getTime();return a};this.restartTimer=function(){l=z.stopTimer();return h};this.addHint=function(a){z.ctatdebug("addHint("+a+")");var b=m[a];null!==b&&"undefined"!==typeof b?(1>b.getNFirstHints()&&++q,b.incrementFirstHints()):(b=new CTATStep(a,CTATStep.StepResult[2]),m[a]=b,q++);p++;b.setLastResult(CTATStep.StepResult[2]);z.ctatdebug("exiting addHint() hint count "+p+", trial "+b)};this.addError=function(a){z.ctatdebug("addError("+a+")");var b=m[a];null!==
b&&"undefined"!==typeof b?(1>b.getNCorrect()&&1>b.getNErrors()&&++B,b.incrementErrors()):(b=new CTATStep(a,CTATStep.StepResult[1]),m[a]=b,B++);x++;b.setLastResult(CTATStep.StepResult[1]);z.ctatdebug("exiting addError() error count "+x+", trial "+b)};this.addCorrect=function(a){var b=m[a];z.ctatdebug("entering addCorrect("+a+") trial "+b);b?(1>b.getNCorrect()&&1>b.getNErrors()&&(++u,1>b.getNFirstHints()&&n++),b.incrementNCorrect()):(z.ctatdebug("to call CTATStep("+a+", StepResult "+CTATStep.StepResult[3]),
b=new CTATStep(a,CTATStep.StepResult[3]),m[a]=b,u++,n++);r++;b.setLastResult(CTATStep.StepResult[3]);z.ctatdebug("exiting addCorrect() correct count "+r+", trial "+b)};this.setShowCounts=function(a){f=a};this.setCompletionStatus=function(a,b){z.ctatdebug("setCompletionStatus("+a+", "+b+")");if(CTATMsgType.CompletionValue[1]!=v||b)v=a};this.getCompletionStatus=function(){return v}};CTATProblemSummary.prototype=Object.create(CTATBase.prototype);CTATProblemSummary.prototype.constructor=CTATProblemSummary;
"undefined"!==typeof module&&(module.exports=CTATProblemSummary);var CTATSkills=function(a){CTATBase.call(this,"CTATSkills",a?String(a.length):"");var b={},e=0;a.forEach(function(a){b[a.getSkillName().toLowerCase()]=a});var f=new Set,d=this;this.toXML=function(a,d){d||(d="");var c=a?"&lt;Skills&gt;":"<Skills>",e=c.length,f;for(f in b)b.hasOwnProperty(f)&&b[f]&&(c+=d+b[f].toXML(a));c+=d&&c.length>e?"\n":"";return c+(a?"&lt;/Skills&gt;":"</Skills>")};this.updateSkill=function(a,b,h){var c=null,g=d.getSkill(b);null!==g&&"undefined"!==typeof g&&(g.setTransactionNumber(e),
b=h+" "+b,f.has(b)||(f.add(b),g.updatePKnown(a),g.updateHistory(a),g.changeOpportunityCount(1)),CTATExampleTracerSkill.CORRECT.toString().toUpperCase()===a.toString().toUpperCase()&&f["delete"](b),c=g);return c};this.startTransaction=function(){++e};this.getSkill=function(a){var c=null===a||"undefined"===typeof a?null:a.toLowerCase(),c=b[c];d.ctatdebug("CTATSkills.getSkill("+a+") returns "+c);return c};this.getSkillBarVector=function(a,d){var c=[],f;for(f in b)!0===b.hasOwnProperty(f)&&(!0!==d&&b[f].getTransactionNumber()!==
e||c.push(b[f].getSkillBarString(a)));return c};this.setExternallyDefined=function(a){};this.setVersion=function(a){for(var c in b)!0===b.hasOwnProperty(c)&&b[c].setVersion(a)}};CTATSkills.prototype=Object.create(CTATBase.prototype);CTATSkills.prototype.constructor=CTATSkills;"undefined"!==typeof module&&(module.exports=CTATSkills);var ProblemStateSaver=function(a){CTATBase.call(this,"ProblemStateSaver",a);this.tracer=a;var b=this,e=[],f=null,d="",c="",g=0;this.saveAsYouGo=function(f){b.ctatdebug("saveAsYouGo() curriculum_service_url "+d+", tracer "+a);if(a&&f){var h={};h.session_id=a.getSessionID();h.authenticity_token=c;h.summary=f.toXML(!1);h.problem_state=ProblemStateSaver.MESSAGES_TAG;for(var m=0;m<e.length;++m)e[m]&&(h.problem_state+=e[m]);h.problem_state+=ProblemStateSaver.MESSAGES_TAG.replace("<","</");++g;b.ctatdebug("saveAsYouGo["+
g+"] to send problem_state length "+h.problem_state.length);CTATLMS.saveProblemState&&CTATLMS.saveProblemState(h);CTATLMS.gradeStudent&&CTATLMS.gradeStudent(parseInt(f.getCorrect()),parseInt(f.getRequiredSteps()));CTATLMS.commit&&CTATLMS.commit()}else b.ctatdebug("Error: no tracer or no problem summary available, aborting save as you go")};this.setCurriculumServiceUrl=function(a){b.ctatdebug("ProblemStateSaver.setCurriculumServiceUrl() old "+d+", new "+a);d=a};this.setAuthenticityToken=function(a){b.ctatdebug("ProblemStateSaver.setAuthenticityToken() old "+
c+", new "+a);a&&(c=a)};this.getStepToIndexMap=function(){null===f&&(f=new Map);return f};this.getProblemState=function(){return e};this.getProblemStateLength=function(){return e.length}};ProblemStateSaver.prototype=Object.create(CTATBase.prototype);ProblemStateSaver.prototype.constructor=ProblemStateSaver;
ProblemStateSaver.prototype.replaceInProblemState=function(a,b,e,f){this.ctatdebug("PSS.replaceInProblemState("+CTATMsgType.getMessageType(a)+", "+e+", "+f+")");if(b.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(a))){b=this.getProblemState();a=this.editForProblemState(a);if(!f){e=ProblemStateSaver.makeStepKey(e);f=this.getStepToIndexMap();this.ctatdebug("PSS.replaceInProblemState() stepKey"+e+", index "+f.get(e)+")");if(f.has(e)){var d=f.get(e);b[d]=null}f.set(e,
b.length)}b.push(a)}};ProblemStateSaver.prototype.appendToProblemState=function(a,b,e){if(e||b.mustSaveForRestore()&&ProblemStateSaver.mustSaveForRestore(CTATMsgType.getMessageType(a)))b=this.getProblemState(),a=this.editForProblemState(a),b.push(a)};Object.defineProperty(ProblemStateSaver,"XML_PROLOGUE",{enumerable:!1,configurable:!1,writable:!1,value:/<\? *[xX][mM][lL][^?]*\?>/});Object.defineProperty(ProblemStateSaver,"LEADING_WHITE_SPACE",{enumerable:!1,configurable:!1,writable:!1,value:/^\s+</m});
Object.defineProperty(ProblemStateSaver,"MESSAGES_TAG",{enumerable:!1,configurable:!1,writable:!1,value:"<messages>"});
ProblemStateSaver.prototype.editForProblemState=function(a){var b=a.split(ProblemStateSaver.XML_PROLOGUE),e=b[0],f;for(f=1;f<b.length;++f)e+=b[f];b=e.split(ProblemStateSaver.LEADING_WHITE_SPACE);e=b[0];for(f=1;f<b.length;++f)e.endsWith("\n")&&(e=e.slice(0,-1)),e.endsWith("\r")&&(e=e.slice(0,-1)),e+="<"+b[f];this.ctatdebug("ProblemStateSaver.editForProblemState("+a+")\n returns "+e);return e};ProblemStateSaver.omitFromRestore={init:!1};
ProblemStateSaver.mustSaveForRestore=function(a){ProblemStateSaver.omitFromRestore.init||(ProblemStateSaver.omitFromRestore[CTATMsgType.ASSOCIATED_RULES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.BUGGY_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.CORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INCORRECT_ACTION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.INTERFACE_IDENTIFICATION.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_RESTORE_END.toLowerCase()]=
!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_REQUEST.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.PROBLEM_SUMMARY_RESPONSE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SET_PREFERENCES.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SHOW_HINTS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore[CTATMsgType.SUCCESS_MESSAGE.toLowerCase()]=!0,ProblemStateSaver.omitFromRestore.init=!0);return a&&ProblemStateSaver.omitFromRestore[a.toLowerCase()]?
!1:!0};ProblemStateSaver.prototype.forwardToInterface=function(a,b,e){var f=CTATMsgType.getMessageType(a);this.ctatdebug("PSS.forwardToInterface("+f+") problemState.length "+this.getProblemState().length+", outputStatus "+e);if(e&&e.isOutputSuppressed())return!1;CTAT.ToolTutor.sendToInterface(a,b);e&&e.transition(CTATMsgType.getMessageType(a));return!0};ProblemStateSaver.prototype.processMessage=function(a){this.ctatdebug("ProblemStateSaver.processMessage("+a+")")};
ProblemStateSaver.makeStepKey=function(a){if(!a)return" ";var b=a.getSelection();a=a.getAction();b="string"!=typeof b||1>b.length?" ":b;a="string"!=typeof a||1>a.length?" ":a;return b+" "+a};"undefined"!==typeof module&&(module.exports=ProblemStateSaver);var ProblemStateRestorer=function(a){CTATBase.call(this,"ProblemStateRestorer",a);var b=this,e=null;this.getRestoreProblemUrl=function(){return e};this.setRestoreProblemUrl=function(a){e=a};this.toString=function(){return"["+e+": 0]"};this.retrieveMessages=function(e){console.log("retrieveMessages("+e+", ...)");e.mustRetrieveProblemState()?(a.stopWorking(1),CTATLMS.getProblemState&&CTATLMS.getProblemState(b.process)):console.log("Retrieval status indicates that we should not retrieve")};this.process=
function(e){a.getOutputStatus().transition(CTATMsgType.BEGIN_RESTORE);if("string"!=typeof e)console.log("ProblemStateRestorer.process() called with parameter not a string: ",typeof e),a.enqueueForRestore([]);else{if(e.slice(0,ProblemStateSaver.MESSAGES_TAG.length)!=ProblemStateSaver.MESSAGES_TAG){console.log("ProblemStateRestorer.process() called with unrecognized string, to try htmlDecode(): ",e.slice(0,20));var d=e;e=(new DOMParser).parseFromString(d,"text/html").documentElement.textContent;if(e.slice(0,
ProblemStateSaver.MESSAGES_TAG.length)!=ProblemStateSaver.MESSAGES_TAG){console.log("ProblemStateRestorer.process() called with unrecognized string: ",e.slice(0,20));a.enqueueForRestore([]);return}}d=[];if("string"==typeof e&&(e=e.split(/<\/?messages>/),b.ctatdebug("msgsArr.length "+e.length+", msgsArr[1].length "+(e[1]?e[1].length:-1)),!(2>e.length))){e=e[1].split("<message>");b.ctatdebug("problemStateArr.length "+e.length);for(var c=0,f=!1,h=1;h<e.length;++h){var l="<message>"+e[h],m=CTATMsgType.getMessageType(l);
CTATMsgType.STATE_GRAPH==m?f=!0:CTATMsgType.START_STATE_END==m?f=!1:f?c++:CTATMsgType.INTERFACE_ACTION==m&&h==e.length-1&&CTATMsgType.isDoneMessage(l)&&a.getOutputStatus().isComplete()||(a.getProblemStateSaver().appendToProblemState(l,null,!0),d.push(l));b.ctatdebug("problemStateArr["+h+"] "+(f?"omit ":"keep ")+m+" omitted "+c+" kept "+d.length)}}a.enqueueForRestore(d)}}};ProblemStateRestorer.prototype=Object.create(CTATBase.prototype);ProblemStateRestorer.prototype.constructor=ProblemStateRestorer;var SCORMProblemSummary=function(){CTATBase.call(this,"SCORMProblemSummary","")};Object.defineProperty(SCORMProblemSummary,"LESSON_STATUS",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.lesson_status"});Object.defineProperty(SCORMProblemSummary,"RAW_SCORE",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.score.raw"});Object.defineProperty(SCORMProblemSummary,"EXIT",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.exit"});
Object.defineProperty(SCORMProblemSummary,"SESSION_TIME",{enumerable:!1,configurable:!1,writable:!1,value:"cmi.core.session_time"});Object.defineProperty(SCORMProblemSummary,"ExitReason",{enumerable:!1,configurable:!1,writable:!1,value:{timeout:"time-out",suspend:"suspend",logout:"logout",done:" "}});
Object.defineProperty(SCORMProblemSummary,"LessonStatus",{enumerable:!1,configurable:!1,writable:!1,value:{passed:"passed",completed:"completed",failed:"failed",incomplete:"incomplete",browsed:"browsed",notAttempted:"not attempted"}});SCORMProblemSummary.getLessonStatus=function(a){return CTATMsgType.CompletionValue[1]==a.getCompletionStatus()?SCORMProblemSummary.LessonStatus.completed:SCORMProblemSummary.LessonStatus.incomplete};
SCORMProblemSummary.getRawScore=function(a){var b=a.getUniqueSteps();return 0==b?0:parseInt(100*(a.getUniqueCorrectUnassisted()/b+.005))};SCORMProblemSummary.getExitReason=function(a){return SCORMProblemSummary.ExitReason.suspend};SCORMProblemSummary.getSessionTime=function(a){var b=a.getTimeElapsed();a=b%1E3;var b=(b-a)/1E3,e=b/60,f=e/60,b=b%60;9999<f&&(f=9999,e=b=99,a=990);return sprintf("%04d:%02d:%02d.%02d",f,e,b,a/10)};
SCORMProblemSummary.getProblemSummaryElements=function(a){var b=sprintf("<%s>%s</%s>",SCORMProblemSummary.LESSON_STATUS,SCORMProblemSummary.getLessonStatus(a),SCORMProblemSummary.LESSON_STATUS),e=sprintf("<%s>%d</%s>",SCORMProblemSummary.RAW_SCORE,SCORMProblemSummary.getRawScore(a),SCORMProblemSummary.RAW_SCORE),f=sprintf("<%s>%s</%s>",SCORMProblemSummary.EXIT,SCORMProblemSummary.getExitReason(a),SCORMProblemSummary.EXIT);a=sprintf("<%s>%s</%s>",SCORMProblemSummary.SESSION_TIME,SCORMProblemSummary.getSessionTime(a),
SCORMProblemSummary.SESSION_TIME);return b+e+f+a};CTATMsgType.prototype=Object.create(CTATBase.prototype);CTATMsgType.prototype.constructor=SCORMProblemSummary;"undefined"!==typeof module&&(module.exports=SCORMProblemSummary);var CTATExampleTracer=function(){function a(a,b){b?R|=1<<a:(R&=-65537>>16-a,e())}function b(){return"<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.INTERFACE_REBOOT+"</MessageType></properties></message>"}function e(){n.ctatdebug("workTheQueue() working "+R+", workQueue.length "+L.length+", restoreQueue.length "+M.length);if(0==R)for(;0!=(R=0<L.length|(0<M.length)<<1);){var a,b=!1;0<M.length?(a=M.shift(),b=!0):a=L.shift();if(!f(a,b)){n.ctatdebug("workTheQueue() suspending workQueue.length "+
L.length+", restoreQueue.length "+M.length);n.stopWorking(b?1:0);break}n.ctatdebug("workTheQueue() bottom workQueue.length "+L.length+", restoreQueue.length "+M.length)}}function f(a,b){n.lastMessageAsString=a;var e=n.lastMessageAsXML=(new CTATXML).parseXML(a),f=n.lastMessage=new CTATMessage(e),l=f.getMessageType();n.ctatdebug("CTATExampleTracer.handleMessageFromInterface(msgType "+l+")");switch(l){case CTATMsgType.SET_PREFERENCES:return d(a,f,D,e),!1;case CTATMsgType.INTERFACE_IDENTIFICATION:return!0;
case CTATMsgType.UNTUTORED_ACTION:return b&&n.sendBundle([a]),c(a,f,D,e),!0;case CTATMsgType.INTERFACE_ACTION:return b&&n.sendBundle([a]),h(a,f,D,e),!0;case CTATMsgType.PROBLEM_SUMMARY_REQUEST:return setTimeout(function(a){a=n.getProblemSummary();n.ctatdebug("CTATExampleTracer.ProblemSummaryRequest getProblemSummary() "+n.getProblemSummary());var c="<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.PROBLEM_SUMMARY_RESPONSE+"</MessageType>",c=c+SCORMProblemSummary.getProblemSummaryElements(a),
c=c+("<ProblemSummary>"+a.toXML(!0)+"</ProblemSummary>"),c=c+"<end_of_transaction>true</end_of_transaction></properties></message>",d=[];d.push(c);n.sendBundle(d);J.transition(CTATMsgType.PROBLEM_SUMMARY_RESPONSE,a.getCompletionStatus());n.ctatdebug("CTATExampleTracer.handleProblemSummaryRequest() sent result '"+c+"';");n.startWorking(b?1:0)},4E3),!1;case CTATMsgType.START_STATE_END:return J.transition(CTATMsgType.START_STATE_END),!0;case CTATMsgType.PROBLEM_RESTORE_END:return u(),!0;case CTATMsgType.GO_TO_STATE:return g(f);
default:return console.log("CTATExampleTracer.handleMessageFromInterface(restoring "+b+") "+(b?"sending":"unprocessed")+" message, type "+l+"\n  "+a),b&&n.sendBundle([a]),!0}}function d(a,b,c,d){n.ctatdebug("handleSetPreferences ()");Q=!1;G=b.getProperty("problem_name");n.ctatdebug("SetPreferences.problem_name = "+G);a=c.getElementChildren(c.getElementChildren(d)[1]);for(b=0;b<a.length;b++)if(d=c.getElementName(a[b]),n.ctatdebug("SetPreferences eltName "+d),d)switch(d.toLowerCase()){case "source_id":y=
c.getNodeTextValue(a[b]);break;case "question_file":B=c.getNodeTextValue(a[b]);break;case "skills":n.ctatdebug(" parseSkills("+a[b]+")");d=[];for(var e=D.getElementChildren(a[b]),f=0;f<e.length;f++){var g=D.getElementName(e[f]);if(g&&"skill"==g.toLowerCase()){var h=D.getElementAttr(e[f],"name");if(h&&""!=h.trim()){var g=D.getElementAttr(e[f],"label"),l=D.getElementAttr(e[f],"pSlip"),m=D.getElementAttr(e[f],"description"),p=D.getElementAttr(e[f],"pKnown"),q=D.getElementAttr(e[f],"category"),r=D.getElementAttr(e[f],
"pLearn"),t=D.getElementAttr(e[f],"pGuess"),u=D.getElementAttr(e[f],"history"),h=new CTATExampleTracerSkill(q,h,t,p,l,r,u);h.setLabel(g);h.setDescription(m);d.push(h)}}}n.getProblemSummary().setSkills(new CTATSkills(d));break;case "problem_state_status":J.transition(CTATMsgType.SET_PREFERENCES,c.getNodeTextValue(a[b]));F||(F=new ProblemStateRestorer(n));n.ctatdebug("SetPreferences problemStateRestorer "+F);break;case "curriculum_service_url":CTATConfiguration.set("curriculum_service_url",c.getNodeTextValue(a[b]));
break;case "restore_problem_url":F||(F=new ProblemStateRestorer(n));n.ctatdebug("SetPreferences problemStateRestorer "+F);CTATConfiguration.set("restoreProblemUrl",c.getNodeTextValue(a[b]));break;case "session_id":N=c.getNodeTextValue(a[b]);break;case "authenticity_token":I.setAuthenticityToken(c.getNodeTextValue(a[b]))}n.ctatdebug("questionFile "+B+", outputStatus "+J+", problemStateRestorer "+F);a="undefined"!=typeof sessionStorage&&sessionStorage?sessionStorage.getItem("Go-To-State"):null;null!=
a&&(sessionStorage.removeItem("Go-To-State"),a=Number(a),!Number.isSafeInteger(a)||0>=a||(O=a,J.transition(CTATMsgType.BEGIN_GO_TO_STATE,null)));n.ctatdebug("outputStatus "+J+", problemStateRestorer "+F);a=B;n.ctatdebug("retrieveBRD ("+a.indexOf("data:file/brd;base64,")+")");n.ctatdebug("Using network retrieval to obtain BRD ..."+a);S.retrieveXMLFile(a,c,n);F&&F.retrieveMessages(J)}function c(a,b,c,d){b=b.getTransactionID();n.ctatdebug("UntutoredAction ("+a+"), getTransactionID "+b);I.appendToProblemState(a,
n.getOutputStatus(),!1);if(!Q)return!1;n.setVariablesFromSAI(d,c);return!0}function g(a){a=a.getProperty("nodeID");if(0>a||!sessionStorage||!sessionStorage.setItem)return!0;sessionStorage.setItem("Go-To-State",String(a));if(!CTAT.ToolTutor.reboot("Go-To-State "+a+" from CTATExampleTracer")){var c=[];c.push(b());n.ctatdebug("CTATET.handleGoToState() saved nodeID "+a+"; sending to interface\n"+c);n.sendBundle(c)}return!1}function h(a,b,c,d){n.ctatdebug("Interface action received.");c=b.getTransactionID();
if(!Q)return!1;n.messageTank=new CTATMessageTank(n,c);n.ctatdebug("MessageTank "+n.messageTank);n.ctatdebug("InterfaceAction ("+a+"), getTransactionID "+c);var e=b.getSelectionArray().slice(0);d=b.getActionArray().slice(0);n.ctatdebug("selectionArray "+e+", message.getSelectionArray() "+b.getSelectionArray());if(e[0]&&"_tutor"==e[0].toLowerCase())return n.ctatdebug("handleInterfaceAction tutor cmd SAI "+b.getSAI()+";"),d[0]&&"function"===typeof n[d[0]]&&(c=b.getSAI().getInput(),n[d[0]](c)),!0;!e[0]||
"hint"!=e[0].toLowerCase()&&"help"!=e[0].toLowerCase()?(n.ctatdebug("calling doNewExampleTrace(null, "+b.getSAI()+") sai.selectionArray "+b.getSAI().getSelectionArray()+" msg.selectionArray "+b.getSelectionArray()),p(null,b.getSAI(),"student",!0,c,a)):(n.ctatdebug("handleInterfaceAction() hint request: hintPolicy "+w+", errorSAI "+H),w===CTATHintPolicyEnum.HINTS_UNBIASED?(1<e.length&&(e[1]=""),1<d.length&&(d[1]="")):w!==CTATHintPolicyEnum.HINTS_BIASED_BY_CURRENT_SELECTION_ONLY&&(w===CTATHintPolicyEnum.HINTS_BIASED_BY_PRIOR_ERROR_ONLY?
H&&H.getSelection()?(e.splice(1,0,H.getSelection()),d.splice(1,0,"PreviousFocus")):(e[1]="",d[1]=""):w===CTATHintPolicyEnum.HINTS_BIASED_BY_ALL&&H&&H.getSelection()&&(e.splice(1,0,H.getSelection()),d[1]=CTATMsgType.PREVIOUS_FOCUS.toString())),n.startSkillTransaction(),a=[],d=v.doHint(e,d,b.getInputArray(),"student",a,!0),b=a[0],a=b.getReportableHints(),e=d?""+d.getUniqueID():"",b.setStepID(e),n.updateSkills(CTATExampleTracerSkill.HINT,d?d.getSkillNames():[],e),n.ctatdebug("Before building hint message: tutorSAI "+
b.getTutorSAI()+", hints "+a+", edge # "+e),d=(new CTATTutorMessageBuilder).createHintMessage(a,b.getTutorSAI(),e,c),n.messageTank.addToMessageTank(CTATMsgType.SHOW_HINTS_MESSAGE,d,b,null),c=(new CTATTutorMessageBuilder).createAssociatedRulesMessageForHint(a,b.getTutorSAI(),x(CTATMsgType.DEFAULT_STUDENT_ACTOR),n.getSkillBarVector(!0),e,c),n.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,c,b,null),c=n.getProblemSummary(b.getReportableInterpretation()),n.messageTank.flushMessageTank(c,!0),
n.ctatdebug("handleInterfaceAction() sent hint result "+b),H=null);return!0}function l(a,b,c){var d={tutorAdvice:null,msg:null,msgType:null};if(a.getReportableLink())return d.tutorAdvice=a.getSuccessOrBuggyMsg(),d.tutorAdvice&&d.tutorAdvice.trim()?(d.msg=c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage"):d.tutorAdvice=null,d;n.ctatdebug("CTATET.createBuggyMessage() past getReportableLink()");if(a.isDoneStepFailed())return d.tutorAdvice=CTATMsgType.NOT_DONE_MSG,d.msg=
c.createBuggyMessage(a.getTransactionID(),d.tutorAdvice),d.msgType="BuggyMessage",d;n.ctatdebug("CTATET.createBuggyMessage() past isDoneStepFailed()");var e=b&&b.getTutorSAI()?b.getTutorSAI().getSelection():null,e=e&&""!==e.trim()?e:null,f=a.getStudentSAI()?a.getStudentSAI().getSelection():null,f=f&&""!==f.trim()?f:null;n.ctatdebug("CTATET.createBuggyMessage() past hintSelection0 "+e+", studentSelection0 "+f);if(a.getResult()==CTATExampleTracerLink.NO_MODEL&&a.isOutOfOrder()&&e&&e!=f)return n.ctatdebug("CTATET.createBuggyMessage() to create out of order"),
n.isHighlightRightSelection()?(d.tutorAdvice=n.getOutOfOrderMessage(),d.msg=c.createHighlightWidgetMessage(e,b.getTutorSAI().getAction(),d.tutorAdvice,a.getTransactionID()),d.msgType="HighlightMsg",n.ctatdebug("createBuggyMessage() out of order with highlight; rtn: "+d)):(d.tutorAdvice=CTATGlobals.languageManager.getString("OUTOFORDER"),d.msg=c.createBuggyMessage(a.getTransactionID,d.tutorAdvice),d.msgType="BuggyMessage",n.ctatdebug("createBuggyMessage() out of order without highlight; rtn: "+d)),
d;if(b=A.getDefaultBuggyMsg())return d.tutorAdvice=b,d.msg=c.createBuggyMessage(a.getTransactionID,d.tutorAdvice),d.msgType="BuggyMessage",n.ctatdebug("createBuggyMessage() default buggy msg: "+d),d;n.ctatdebug("createBuggyMessage() no buggy msg: "+d);return d}function m(a,b,c,d){n.ctatdebug("checkForTutorAction("+a+", "+b+", "+c+", "+d+")");var e=[];e[0]=r(A.getNode(a),!0);e[1]=r(A.getNode(b),!1);n.ctatdebug("checkForTutorAction() links[0] "+e[0]+", links[1] "+e[1]+";");a=0;if(e[0]===e[1])e[1]=null;
else if(null===e[0]||"undefined"===typeof e[0])a=1;b=null;n.messageTank||(n.messageTank=new CTATMessageTank(n,null));for(;a<e.length&&null!==e[a]&&"undefined"!==typeof e[a];++a)if(null==c||"undefined"==typeof c)b=p(e[a],e[a].getDefaultSAI(),e[a].getActor(),!0,null);else{b=e[a].getEvaluatedInput(c,d.getReportableVariableTable());var f=e[a].getDefaultSAI().clone();f.setInput(b);b=p(e[a],f,e[a].getActor(),!0,null)}n.ctatdebug("checkForTutorAction() returning "+b+";");return b}function r(a,b){if(null===
a||"undefined"===typeof a||1!==a.getCorrectOutDegree())return null;var c=null;a.getCorrectOutLinks().forEach(function(a){null===c&&a.isTutorPerformed(b)&&0<a.getMaxTraversals()&&(c=a)});return c}function p(a,b,c,d,e,f){n.ctatdebug("doNewExampleTrace (link "+a+", sai "+b+", actor "+c+", doTutorPerformedSteps "+d+", transactionID "+e+", origMsgTxt "+f);var g=e;e=new CTATExampleTracerEvent(n,b,c);if(n.getOutputStatus().isComplete()&&b.isDone())return e.setResult(CTATExampleTracerLink.CORRECT_ACTION),
e.setTutorSAI(b),e.setTransactionID(g),e=q(e,b,c,!1),n.ctatdebug("doNewExampleTrace("+a+", "+b+", "+c+", "+d+", "+g+") returns "+e),e;n.startSkillTransaction();a&&e.addPreloadedLinkMatch(a);var h=v.evaluate(e);n.ctatdebug("Evaluate returned : "+h+", given link "+a+", result "+e);a?(n.ctatdebug("result.getTutorSelection() "+e.getTutorSelection()),n.ctatdebug("result.getTutorAction() "+e.getTutorAction()),n.ctatdebug("result.getTutorInput() "+e.getTutorInput()),n.ctatdebug("typeof(messageTank) "+typeof messageTank),
f=e.getTutorSelection(),g=e.getTutorAction(),h=e.getTutorInput(),(g=n.messageTank.enqueueToolActionToStudent(f,g,h,CTATTutorMessageBuilder.TUTOR_PERFORMED))&&n.messageTank.setTransaction_id(g)):n.isFeedbackSuppressed()?I.replaceInProblemState(f,n.getOutputStatus(),e.getStudentSAI(),A.getFeedbackPolicy()==CTATMsgType.HIDE_BUT_ENFORCE):e.getResult()!=CTATExampleTracerLink.CORRECT_ACTION&&e.getResult()!=CTATExampleTracerLink.FIREABLE_BUGGY_ACTION||I.appendToProblemState(f,n.getOutputStatus(),!1);e.setTransactionID(g);
e=q(e,b,c,d);n.ctatdebug("doNewExampleTrace("+a+", "+b+", "+c+", "+d+", "+g+") returns "+e);return e}function x(a){return"undefined"!=typeof a&&a&&0<=a.toString().toLowerCase().indexOf("tutor")?"Tutor":"Student"}function q(a,b,c,d){n.ctatdebug("finishNewExampleTrace("+a+", "+b+", "+c+", "+d+")");b=a.getStudentSAI();var e=a.getTutorSAI(),f=a.getTransactionID(),g=new CTATTutorMessageBuilder,h="",p=[];null!==a.getReportableLink()&&"undefined"!==typeof a.getReportableLink()?p[0]=a.getReportableLink():
p[0]=null;p=p[0];if(a.isSolverResult())a.getResult();else if(a.getResult()===CTATExampleTracerLink.CORRECT_ACTION)h=p?""+p.getUniqueID():"",a.setStepID(h),CTATMsgType.UNGRADED_TOOL_ACTOR.toUpperCase()!=c.toUpperCase()&&n.messageTank.addToMessageTank(CTATMsgType.CORRECT_ACTION,g.createCorrectActionMessage(f,e),a,e),null!==p&&"undefined"!==typeof p&&n.updateSkills(CTATExampleTracerSkill.CORRECT,p.getSkillNames(),p.getUniqueID()),h=a.getSuccessOrBuggyMsg(),n.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,
g.createAssociatedRulesMessageForAction(a.getResult(),e,x(c),b,n.getSkillBarVector(!0,c),p?p.getUniqueID():-1,f,h),a,e),n.ctatdebug("finishNewExampleTrace() successMsg "+h),h&&n.messageTank.addToMessageTank("SuccessMessage",g.createSuccessMessage(f,h),a,null),H=null,d&&(c=m(p?p.getNextNode():null,v.findCurrentState(!1,!1),n.lastMessage?n.lastMessage.getSAI():null,a))&&(a=c);else{n.messageTank.addToMessageTank(CTATMsgType.INCORRECT_ACTION,g.createInCorrectActionMessage(f,a.getInterpolatedSAI()),a,
null);n.ctatdebug("about to do silent traceForHint("+b+"), selectionArray "+b.getSelectionArray());var q=n.lastSilentHintResult=new CTATExampleTracerEvent(n,b,c);q.setHintRequest(!0);var r=v.traceForHint(q);n.ctatdebug("silent hint result: "+q+"; hintLink "+r);r||(r=v.getBestNextLink(!1,q),n.ctatdebug("getBestNextLink result: "+q+"; hintLink "+r));e=null;r&&((e=q.getTutorSAI())&&e.getSelection()&&a.setTutorSAI(e),h=""+r.getUniqueID(),a.setStepID(h));q=l(a,q,g);n.ctatdebug("createBuggyMessage() tutorAdvice: "+
q.tutorAdvice+";\n  msg "+q.msg);n.updateSkills(CTATExampleTracerSkill.INCORRECT,r?r.getSkillNames():[],h);n.messageTank.addToMessageTank(CTATMsgType.ASSOCIATED_RULES,g.createAssociatedRulesMessageForAction(a.getResult(),e&&e.getSelection()?e:b,x(c),b,n.getSkillBarVector(!0,c),h,f,q.tutorAdvice),a,null);q.msg&&n.messageTank.addToMessageTank(q.msgType,q.msg,a);H=b;d&&CTATExampleTracerLink.FIREABLE_BUGGY_ACTION==a.getResult()?(c=m(p?p.getNextNode():null,v.findCurrentState(!1,!1),n.lastMessage?n.lastMessage.getSAI():
null,a))&&(a=c):a.isDoneStepFailed()&&n.messageTank.flushDelayedFeedback()}n.lastResult=a;c=n.getProblemSummary(a.getReportableInterpretation());n.ctatdebug("finishNewExampleTrace() to flushMessageTank");n.messageTank.flushMessageTank(c,!0);n.ctatdebug("finishNewExampleTrace() sent result "+a.getResult()+", studentSAI "+b);return a}function u(){J.transition(CTATMsgType.PROBLEM_RESTORE_END);var a=n.getSkillBarVector(),b=[],c=new CTATTutorMessageBuilder;b.push(c.createMessage(CTATMsgType.PROBLEM_RESTORE_END,
a?{Skills:a}:null));n.sendBundle(b)}CTATBase.call(this,"CTATExampleTracer","tracer");var n=this,B=null,v,z,A,D=new CTATXML;new XMLSerializer;var H=null,w,E=!0,t=!1,C=null,G=null,y=null,I=new ProblemStateSaver(n);I.setAuthenticityToken(CTATCommLibrary.getAuthenticityToken());var F=null,J=new CTATProblemStateStatus,M=[],L=[],R=0,Q=!1,N="",O=-1,K=null;n.ctatdebug("CTATExampleTracer constructor outputStatus="+J);this.messageTank=this.lastSilentHintResult=this.lastResult=this.lastMessage=this.lastMessageAsXML=
this.lastMessageAsString=null;var S=new CTATCommLibrary;this.receiveFromInterface=function(a){n.ctatdebug("CTATExampleTracer.receiveFromInterface() \n  "+a);L.push(a);e()};this.setVariablesFromSAI=function(a,b){var c=CTATMsgType.getSAIArraysFromElement(a,b);n.getTracer()&&n.getTracer().addInterfaceVariables(c.selection,c.input)};this.traceLinks=function(a){for(var b=[],c=n.getTracer().getBestInterpretation(),d=0;d<a.length&&null!==a[d];++d)c.getTraversalCount(a[d])<a[d].getMinTraversals()&&(n.messageTank=
new CTATMessageTank(n,null),b.push(p(a[d],a[d].getDefaultSAI(),a[d].getActor(),!1,null)),n.ctatdebug("traceLinks["+d+"] result "+b[d]));return b};this.enqueueForRestore=function(a){n.ctatdebug("enqueueForRestore: got "+a.length+" message elements");M=M.concat(a);a=(new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null);M.push(a);n.startWorking(1)};this.startWorking=function(b){a(b,!1)};this.stopWorking=function(b){a(b,!0)};this.goToStartState=function(){var a=A.getStudentStartsHereNode()||
A.getStartNode();a?n.goToState(a.getNodeName()):console.trace("goToStartState() did not find start node")};this.goToState=function(a){a=(a=A.findNode(a))?a.getNodeID():-1;0<a&&n.receiveFromInterface("<message><verb>NotePropertySet</verb><properties><MessageType>"+CTATMsgType.GO_TO_STATE+"</MessageType><nodeID>"+a+"</nodeID></properties></message>")};this.processXML=function(a){n.ctatdebug("processXML ()");if(null!=a){n.ctatdebug("No of children"+D.getElementChildren(a).length);var c=new CTATGraphParser,
d=c.parseGraph(a,n);A=d.gr;v=d.tracer;a=d.ssm;d=d.sgMsg;n.ctatdebug("sendStartStateMessages() nMsgs "+a.length+", outputStatus "+J);for(var e=[],f=new XMLSerializer,g=null,h=0;h<a.length;h++)if("message"==D.getElementName(a[h])){var l=f.serializeToString(a[h]),p=CTATMsgType.getMessageType(l);CTATMsgType.UNTUTORED_ACTION!=p&&CTATMsgType.INTERFACE_ACTION!=p||n.setVariablesFromSAI(a[h],D);CTATMsgType.START_STATE_END==p?(g=e,A.getFeedbackPolicy()!=CTATMsgType.SHOW_ALL_FEEDBACK&&(p=new CTATSAI("hint",
"SetVisible","false"),p=(new CTATTutoringServiceMessageBuilder).createInterfaceActionMessage("dummyTransactionID",p),g.push(p)),g=l,e.push((new CTATTutoringServiceMessageBuilder).createInterfaceConfigurationEnd()),e.push((new CTATTutorMessageBuilder).createLockWidgetMsg(c.getLockWidget()))):e.push(l)}e.unshift(d);e.unshift(b());n.ctatdebug("sendStartStateMessages(): "+a.length+" elts, "+e.length+" strings, "+J);n.sendBundle(e);c=g;a:{a=[];d=A.getStartNode();e=CTATMsgType.START_STATE_END;f=d.getNodeID();
h=O;O=-1;l=null;h==f?J.transition(e,null):0<h&&(l=A.getNode(h));n.ctatdebug("CTATET.resetGoToState("+e+", null, "+f+") returns "+l);l&&J.transition(CTATMsgType.END_GO_TO_STATE,null);(e=l)||(e=A.getStudentStartsHereNode());if(null!==d&&null!==e&&d.getNodeID()!=e.getNodeID()){a=A.getBestSubpath(d,e);n.ctatdebug("advanceToStudentStartsHere() path "+a);if(!a)break a;a=a.getSortedLinks();a=n.traceLinks(a);n.ctatdebug("advanceToStudentStartsHere() results "+a)}e=d=null;0<a.length&&(e=a[a.length-1],a=e.getReportableLink(),
null!==a&&(d=a.getNextNode()));n.ctatdebug("advanceToStudentStartsHere() to check for TPA "+d+", "+e);m(d,v.findCurrentState(!1,!1),null,e)}a=[];c&&a.push(c);J.canRestore()||a.push((new CTATTutorMessageBuilder).createMessage(CTATMsgType.PROBLEM_RESTORE_END,null));0<a.length&&n.sendBundle(a);Q=!0}n.startWorking(0)};this.addGraphSkills=function(a){n.ctatdebug("adding graph skills: "+a.length);0<a.length&&(a=new CTATSkills(a),a.setExternallyDefined(!1),n.getProblemSummary().setSkills(a))};this.sendBundle=
function(a){n.ctatdebug("sending bundle #msgs = "+a.length+", outputStatus "+J);for(var b=0,c=0;c<a.length;c++){n.ctatdebug("Sending message #"+c);var d=a[c];0>=c&&(d='<?xml version="1.0" encoding="UTF-8"?>'+d);I.forwardToInterface(d,c>=a.length-1,J)&&++b}return 0<b};this.setHintPolicy=function(a){w=CTATHintPolicyEnum.lookup(a)};this.isHighlightRightSelection=function(){return E};this.setHighlightRightSelection=function(a){E=a};this.updateSkills=function(a,b,c){var d=[];n.ctatdebug("in updateSkills("+
b+") with step ID = "+c+", transaction result = "+a);var e=n.getProblemSummary().getSkills();if(null===e||"undefined"===typeof e)return d;b.forEach(function(b){b=e.updateSkill(a,b,c);null!==b&&"undefined"!==typeof b&&d.push(b)});return d};this.getSessionID=function(){return N};this.getProblemSummary=function(a){n.ctatdebug("Entering getProblemSummary() problemSummary "+C);if(null===C||"undefined"===typeof C){var b=n.getProblemName();C=null===b||"undefined"===typeof b||1>b.length?new CTATProblemSummary("NoProblemDefined",
null,n.isFeedbackSuppressed()):new CTATProblemSummary(b,null,n.isFeedbackSuppressed())}a&&C.setRequiredSteps(a.countStepsForScore(A));return C};this.getProblemName=function(){return G};this.getSourceID=function(){return y};this.isSourceFlash=function(){return"string"==typeof y&&y.match(/flash/i)};this.isFeedbackSuppressed=function(){return t};this.setFeedbackSuppressed=function(a){t="false"===a?!1:"true"===a?!0:a===CTATMsgType.SHOW_ALL_FEEDBACK?!1:a===CTATMsgType.HIDE_ALL_FEEDBACK?!0:a===CTATMsgType.HIDE_BUT_ENFORCE?
!0:a===CTATMsgType.HIDE_BUT_COMPLETE?!0:!1;n.ctatdebug("setFeedbackSuppressed("+a+"): "+t);C&&C.setCountOnlyLastResults(t)};this.getSkillBarVector=function(a,b){var c=n.getProblemSummary().getSkills();return null===c||"undefined"===typeof c?null:"Student"!=x(b)?null:"undefined"!=typeof a&&a?c.getSkillBarVector(!1,!1):c.getSkillBarVector(!0,!0)};this.startSkillTransaction=function(){var a=n.getProblemSummary().getSkills();a&&a.startTransaction()};this.getProblemStateSaver=function(){return I};this.isSendingSavedMsgsForRestore=
function(){return n.getOutputStatus().isSendingSavedMsgsForRestore()};this.getOutputStatus=function(){return J};this.setOutputStatus=function(a){var b=J.getStatus();n.ctatdebug("setOutputStatus() old "+b+", new "+a);CTATProblemStateStatus[a]?J.setStatus(CTATProblemStateStatus[a]):(console.error("CTATExampleTracer.setOutputStatus() unexpected argument "+a),J.setStatus(CTATProblemStateStatus.empty))};this.getFeedbackPolicy=function(){return A?A.getFeedbackPolicy():CTATMsgType.SHOW_ALL_FEEDBACK};this.getGraph=
function(){return A};this.getTracer=function(){return v};this.getOutOfOrderMessage=function(){return z?z:CTATMsgType.DEFAULT_OUT_OF_ORDER_MESSAGE};this.setOutOfOrderMessage=function(a){z=a};this.getDelayedFeedback=function(){null==K&&(K={});return K};this.clearDelayedFeedback=function(){K=null};this.getQuestionFile=function(a){if(!B||a)return B;a=B.split("/");return a[a.length-1]}};CTATExampleTracer.prototype=Object.create(CTATBase.prototype);CTATExampleTracer.prototype.constructor=CTATExampleTracer;
"undefined"!==typeof module&&(module.exports=CTATExampleTracer);
